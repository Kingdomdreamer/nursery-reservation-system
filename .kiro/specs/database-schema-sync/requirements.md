# 商品予約システム - 要件文書

## はじめに

LINE連携による商品予約システムの包括的な要件定義です。管理者が複数のフォームを作成し、ユーザーがLINE経由で商品を予約・変更・キャンセルできるシステムを構築します。

## 要件

### 要件1: 商品管理機能

**ユーザーストーリー:** 管理者として、商品情報を効率的に管理したいので、商品の基本情報とバリエーションを設定できる機能が必要です。

#### 受入基準

1. WHEN 管理者が商品を登録する THEN システムは商品ID、バリエーションID、商品名、バリエーション名、税設定、価格、バーコードを保存する SHALL
2. WHEN 管理者がCSVで商品を一括登録する THEN システムは商品名と価格を必須項目として処理する SHALL
3. WHEN 管理者が税設定を行う THEN システムは「内税」または「外税」のいずれかを設定できる SHALL
4. WHEN 同一商品で複数の価格パターンがある場合 THEN システムは別商品として登録・管理する SHALL

### 要件2: フォーム管理機能

**ユーザーストーリー:** 管理者として、予約受付用のフォームを柔軟に作成・管理したいので、複数フォームの同時運用機能が必要です。

#### 受入基準

1. WHEN 管理者がフォームを作成する THEN システムは複数のフォームを同時に有効化できる SHALL
2. WHEN 管理者がフォーム設定を行う THEN システムはフォーム名、有効期限、表示項目設定を保存する SHALL
3. WHEN フォーム有効期限を過ぎた場合 THEN システムはフォーム自体を非表示にする SHALL
4. WHEN 管理者が表示項目を設定する THEN システムは氏名、フリガナ、性別、生年月日、電話番号、郵便番号、住所1、住所2、店舗へのコメント欄、商品金額と合計金額の表示/非表示を制御する SHALL
5. WHEN 管理者がフォームに商品を関連付ける THEN システムは商品一覧から選択された商品を保存する SHALL
6. WHEN 管理者が商品ごとの引き取り期間を設定する THEN システムはフォーム内の各商品に個別の引き取り可能期間を設定できる SHALL

### 要件3: 予約機能

**ユーザーストーリー:** ユーザーとして、LINEから簡単に商品を予約したいので、直感的な予約フォームが必要です。

#### 受入基準

1. WHEN ユーザーがLINEからフォームにアクセスする THEN システムは入力画面を表示する SHALL
2. WHEN 入力画面が表示される THEN システムはフォーム名、設定に基づく入力項目、商品選択を表示する SHALL
3. WHEN ユーザーが予約情報を入力する THEN システムは氏名、フリガナ、性別、生年月日、電話番号、郵便番号、住所1、住所2、店舗へのコメント欄の入力を求める SHALL
4. WHEN ユーザーが商品を選択する THEN システムは選択可能な商品一覧とバリエーションを表示する SHALL
5. WHEN ユーザーが引き取り日を選択する THEN システムは商品ごとに設定された引き取り可能期間内の日付のみを表示する SHALL
6. WHEN ユーザーが入力を完了する THEN システムは確認画面を表示する SHALL
7. WHEN ユーザーが確認画面で予約を確定する THEN システムは完了画面を表示する SHALL
8. WHEN 予約が完了する THEN システムは予約情報をDBに保存し、ステータスを「未受取」として設定する SHALL
9. WHEN 予約が完了する THEN システムは一意の予約IDとキャンセルURLを生成する SHALL

### 要件4: 予約変更・キャンセル機能

**ユーザーストーリー:** ユーザーとして、予約内容を変更またはキャンセルしたいので、専用URLから操作できる機能が必要です。

#### 受入基準

1. WHEN ユーザーがキャンセルURLにアクセスする THEN システムは電話番号確認画面を表示する SHALL
2. WHEN ユーザーが電話番号を入力する THEN システムは予約時の電話番号と照合する SHALL
3. WHEN 電話番号認証が成功する THEN システムはキャンセル変更画面を表示する SHALL
4. WHEN キャンセル変更画面が表示される THEN システムは現在の予約内容を表示する SHALL
5. WHEN ユーザーが予約を変更する THEN システムは商品の数量、種類、受け取り日、店舗へのコメント欄の変更を許可する SHALL
6. WHEN ユーザーが商品を追加・削除する THEN システムは予約可能商品からの追加・削除を許可する SHALL
7. WHEN ユーザーが予約をキャンセルする THEN システムは予約ステータスを「キャンセル」に変更する SHALL

### 要件5: 予約履歴管理機能

**ユーザーストーリー:** 管理者として、予約データを効率的に管理したいので、自動的な履歴移行機能が必要です。

#### 受入基準

1. WHEN 管理者が予約ステータスを「受け取り済み」に変更する THEN システムは該当予約のステータスを更新する SHALL
2. WHEN 予約ステータスが「受け取り済み」になる THEN システムは24時間後に該当データを予約履歴テーブルに移動する SHALL
3. WHEN データが履歴テーブルに移動される THEN システムは予約一覧から該当データを削除する SHALL
4. WHEN 管理者が履歴を確認する THEN システムは過去の予約データを検索・表示する SHALL
5. WHEN 商品名が変更される THEN システムは過去の予約データを上書きまたは削除する SHALL

### 要件6: 管理画面機能

**ユーザーストーリー:** 管理者として、予約状況を一元管理したいので、包括的な管理画面が必要です。

#### 受入基準

1. WHEN 管理者がログインする THEN システムはパスワード認証後に管理画面を表示する SHALL
2. WHEN 管理者が予約一覧を確認する THEN システムは現在の予約状況を一覧表示する SHALL
3. WHEN 管理者が予約詳細を確認する THEN システムは個別の予約情報と変更履歴を表示する SHALL
4. WHEN 管理者が予約ステータスを変更する THEN システムは「未受取」「受け取り済み」「キャンセル」の状態管理を行う SHALL
5. WHEN 管理者がフォーム設定を変更する THEN システムは変更内容を即座に反映する SHALL
6. WHEN 管理者が商品を管理する THEN システムはCSV一括登録機能を提供する SHALL

### 要件7: LINE連携機能

**ユーザーストーリー:** ユーザーとして、LINEから自然にシステムを利用したいので、シームレスなLINE連携が必要です。

#### 受入基準

1. WHEN 予約が完了する THEN システムはLINE経由で予約情報を含んだ確認メッセージを送信する SHALL
2. WHEN 確認メッセージを送信する THEN システムはキャンセルURLを含めてメッセージを構成する SHALL
3. WHEN ユーザーがキャンセルURLをクリックする THEN システムは変更・キャンセル画面にアクセスできるようにする SHALL
4. WHEN 予約が変更・キャンセルされる THEN システムはLINE経由で変更内容の通知メッセージを送信する SHALL