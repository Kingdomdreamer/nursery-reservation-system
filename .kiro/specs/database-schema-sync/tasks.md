# 実装タスクリスト

- [ ] 1. データベース構造の再構築
  - 既存テーブルの一括削除と新しいテーブル構造の作成
  - 設計文書のSQLコードを実行してデータベースを再構築する
  - 初期データ（管理者ユーザー、サンプル商品、プリセット）を投入する
  - _要件: 1.1, 1.2, 2.1, 2.2_

- [ ] 2. 統一型定義の作成
  - 新しいデータベース構造に対応したTypeScript型定義を作成
  - src/types/database.ts ファイルに統一された型定義を実装
  - 既存の型定義ファイルとの整合性を確保する
  - _要件: 1.1, 2.1, 3.1_

- [ ] 3. データベースアクセス層の更新
  - Supabase クライアントの型定義を新しい構造に更新
  - src/lib/supabase.ts の Database インターフェースを更新
  - 既存のクエリを新しいテーブル構造に対応させる
  - _要件: 1.1, 2.1, 6.1_

- [ ] 4. 商品管理機能の実装
  - 商品CRUD操作のAPI実装（/api/admin/products）
  - CSV一括登録機能の実装（/api/admin/products/bulk-import）
  - バリエーション管理機能の実装
  - 商品管理画面コンポーネントの作成
  - _要件: 1.1, 1.2, 1.3, 1.4, 6.6_

- [ ] 5. プリセット（フォーム）管理機能の実装
  - プリセットCRUD操作のAPI実装（/api/admin/presets）
  - フォーム設定管理機能の実装
  - 複数フォーム同時有効化機能の実装
  - プリセット管理画面コンポーネントの作成
  - _要件: 2.1, 2.2, 2.3, 2.4, 2.5, 2.6_

- [ ] 6. 統一プリセット設定APIの更新
  - /api/presets/[presetId]/config エンドポイントを新しいDB構造に対応
  - 商品ごとの引き取り期間設定機能を実装
  - フォーム表示項目設定の拡張（性別、生年月日、住所等）
  - エラーハンドリングとレスポンス形式の統一
  - _要件: 2.4, 2.5, 2.6_

- [ ] 7. 予約フォーム画面の実装
  - 入力画面の実装（/form/[presetId]/page.tsx）
  - フォーム名と設定に基づく入力項目の動的表示
  - 商品選択機能の実装
  - 引き取り日選択機能（商品ごとの期間制限対応）
  - バリデーション機能の実装
  - _要件: 3.1, 3.2, 3.3, 3.4, 3.5_

- [ ] 8. 予約確認・完了画面の実装
  - 確認画面の実装（/form/[presetId]/confirm/page.tsx）
  - 完了画面の実装（/form/[presetId]/complete/page.tsx）
  - 予約データの保存処理
  - キャンセルURL生成機能
  - _要件: 3.6, 3.7, 3.8, 3.9_

- [ ] 9. 予約作成APIの実装
  - /api/reservations POST エンドポイントの実装
  - 入力データのバリデーション
  - 予約データのDB保存
  - キャンセルトークンの生成
  - LINE通知の送信
  - _要件: 3.8, 3.9, 7.1, 7.2_

- [ ] 10. 予約変更・キャンセル機能の実装
  - 電話番号確認画面の実装（/cancel/[reservationId]/page.tsx）
  - キャンセル変更画面の実装（/cancel/[reservationId]/edit/page.tsx）
  - 予約詳細取得API（/api/reservations/[reservationId]/cancel）
  - 予約更新API（/api/reservations/[reservationId] PUT）
  - 予約キャンセルAPI（/api/reservations/[reservationId] DELETE）
  - _要件: 4.1, 4.2, 4.3, 4.4, 4.5, 4.6, 4.7_

- [ ] 11. 管理画面認証機能の実装
  - 管理者ログイン画面の実装（/admin/login/page.tsx）
  - パスワード認証機能の実装
  - セッション管理機能の実装
  - 認証ミドルウェアの作成
  - _要件: 6.1_

- [ ] 12. 管理画面ダッシュボードの実装
  - ダッシュボード画面の実装（/admin/dashboard/page.tsx）
  - 予約統計情報の表示
  - 最近の予約一覧表示
  - システム状態の監視機能
  - _要件: 6.2, 6.3_

- [ ] 13. 予約管理機能の実装
  - 予約一覧画面の実装（/admin/reservations/page.tsx）
  - 予約一覧取得API（/api/admin/reservations）
  - 予約ステータス更新機能
  - 予約詳細表示機能
  - フィルタリング・検索機能
  - _要件: 6.2, 6.3, 6.4_

- [ ] 14. 予約履歴管理機能の実装
  - 予約ステータス更新時の自動履歴移行機能
  - 24時間後の自動データ移行バッチ処理
  - 予約履歴テーブルへのデータ移動処理
  - 履歴検索・表示機能
  - _要件: 5.1, 5.2, 5.3, 5.4, 5.5_

- [ ] 15. LINE通知機能の強化
  - 予約完了時の詳細通知メッセージ作成
  - キャンセルURL付きメッセージテンプレート
  - 予約変更・キャンセル時の通知機能
  - エラーハンドリングとリトライ機能
  - _要件: 7.1, 7.2, 7.3, 7.4_

- [ ] 16. エラーハンドリングとバリデーションの統一
  - カスタムエラークラスの実装
  - API エラーハンドラーの統一
  - フロントエンドエラー表示の統一
  - 入力値バリデーションの強化
  - _要件: 全般_

- [ ] 17. パフォーマンス最適化
  - データベースインデックスの作成
  - クエリの最適化
  - フロントエンドコンポーネントの最適化
  - 画像・アセットの最適化
  - _要件: 全般_

- [ ] 18. テスト実装
  - 単体テストの作成（Jest + Testing Library）
  - API統合テストの作成
  - E2Eテストの作成（Playwright）
  - テストデータファクトリーの作成
  - _要件: 全般_

- [ ] 19. セキュリティ強化
  - 入力値サニタイゼーション
  - レート制限の実装
  - CORS設定の最適化
  - 個人情報の暗号化
  - _要件: 全般_

- [ ] 20. 運用・監視機能の実装
  - 構造化ログの実装
  - ヘルスチェックエンドポイント
  - エラー監視機能
  - パフォーマンス監視機能
  - _要件: 全般_