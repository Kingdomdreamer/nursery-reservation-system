# ç·Šæ€¥å¯¾å¿œå®Ÿè£…æŒ‡ç¤ºæ›¸ - React Error #418 & API 404ã‚¨ãƒ©ãƒ¼è§£æ±º

## ğŸ“‹ å¯¾å¿œæ¦‚è¦

**å¯¾è±¡ã‚·ã‚¹ãƒ†ãƒ **: LINEäºˆç´„ã‚·ã‚¹ãƒ†ãƒ ï¼ˆãƒ™ã‚¸ãƒ©ã‚¤ã‚¹ï¼‰  
**å¯¾å¿œæ—¥æ™‚**: 2025å¹´8æœˆ5æ—¥  
**å¯¾å¿œè€…**: Kiro AI Assistant  
**ç·Šæ€¥åº¦**: æœ€é«˜ï¼ˆæœ¬ç•ªç’°å¢ƒã§ã‚µãƒ¼ãƒ“ã‚¹åœæ­¢çŠ¶æ…‹ï¼‰

### ç™ºç”Ÿã—ã¦ã„ãŸå•é¡Œ
1. **React Minified Error #418**: JSXã«ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒç›´æ¥ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã•ã‚Œã‚‹
2. **API 404ã‚¨ãƒ©ãƒ¼**: `/api/admin/preset-products/{presetId}` ãŒæœ¬ç•ªç’°å¢ƒã§404
3. **å•†å“é¸æŠUIä¸å…·åˆ**: ã€Œç¾åœ¨é¸æŠã§ãã¾ã›ã‚“ã€ã®å¸¸æ™‚è¡¨ç¤º

## ğŸ¯ å®Ÿè£…ã—ãŸè§£æ±ºç­–

### 1. React Error #418 å®Œå…¨å¯¾ç­–

#### å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«: `src/components/features/reservation/ProductSelectionSection.tsx`

#### å®Ÿè£…å†…å®¹

**A. å®‰å…¨ãªãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°é–¢æ•°ã®ç›´æ¥å®Ÿè£…**
```typescript
// ç·Šæ€¥å¯¾å¿œ: React Error #418 å®Œå…¨å›é¿ã®ãŸã‚ã®å®‰å…¨ãªãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°é–¢æ•°
const safeRender = (value: unknown): string => {
  if (value === null || value === undefined) return '';
  if (typeof value === 'string') return value;
  if (typeof value === 'number') return String(value);
  if (typeof value === 'boolean') return value ? 'true' : 'false';
  if (typeof value === 'object') {
    try {
      return JSON.stringify(value);
    } catch {
      return '[Object]';
    }
  }
  return String(value);
};

const safeProductName = (product: unknown): string => {
  if (!product || typeof product !== 'object') return 'å•†å“åä¸æ˜';
  const productObj = product as Record<string, unknown>;
  if (typeof productObj.name === 'string') return productObj.name;
  if (typeof productObj.product_name === 'string') return productObj.product_name;
  return 'å•†å“åä¸æ˜';
};

const safePrice = (price: unknown): string => {
  if (typeof price === 'number' && !isNaN(price)) {
    return `Â¥${price.toLocaleString()}`;
  }
  if (typeof price === 'string') {
    const numPrice = parseFloat(price);
    if (!isNaN(numPrice)) {
      return `Â¥${numPrice.toLocaleString()}`;
    }
  }
  return 'Â¥0';
};

const safeQuantity = (quantity: unknown): number => {
  if (typeof quantity === 'number' && !isNaN(quantity)) {
    return Math.max(0, Math.floor(quantity));
  }
  if (typeof quantity === 'string') {
    const numQuantity = parseInt(quantity, 10);
    if (!isNaN(numQuantity)) {
      return Math.max(0, numQuantity);
    }
  }
  return 0;
};

const isValidProduct = (product: unknown): product is {
  id: number;
  name: string;
  price: number;
} => {
  return (
    typeof product === 'object' &&
    product !== null &&
    typeof (product as any).id === 'number' &&
    typeof (product as any).name === 'string' &&
    typeof (product as any).price === 'number'
  );
};
```

**B. å®Œå…¨ãªã‚¨ãƒ©ãƒ¼å¢ƒç•Œã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ**
```typescript
// ç·Šæ€¥å¯¾å¿œ: å®Œå…¨ãªã‚¨ãƒ©ãƒ¼å¢ƒç•Œã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
class ProductSelectionErrorBoundary extends React.Component<
  { children: React.ReactNode },
  { hasError: boolean; error?: Error; errorInfo?: React.ErrorInfo }
> {
  constructor(props: { children: React.ReactNode }) {
    super(props);
    this.state = { hasError: false };
  }

  static getDerivedStateFromError(error: Error) {
    console.error('ProductSelection Error Boundary - getDerivedStateFromError:', error);
    return { hasError: true, error };
  }

  componentDidCatch(error: Error, errorInfo: React.ErrorInfo) {
    console.error('ProductSelection Error Boundary caught an error:', {
      error: error.message,
      stack: error.stack,
      errorInfo: errorInfo.componentStack
    });
    
    this.setState({ 
      hasError: true, 
      error, 
      errorInfo 
    });
  }

  render() {
    if (this.state.hasError) {
      return (
        <div className="bg-red-50 border border-red-200 rounded-lg p-4">
          <div className="flex items-start">
            <div className="flex-shrink-0">
              <svg className="h-5 w-5 text-red-400" viewBox="0 0 20 20" fill="currentColor">
                <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clipRule="evenodd" />
              </svg>
            </div>
            <div className="ml-3">
              <h3 className="text-sm font-medium text-red-800">
                å•†å“é¸æŠã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ
              </h3>
              <p className="text-sm text-red-700 mt-1">
                {this.state.error?.message || 'äºˆæœŸã—ãªã„ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ'}
              </p>
              <div className="mt-3 space-x-2">
                <button
                  onClick={() => {
                    this.setState({ hasError: false, error: undefined, errorInfo: undefined });
                  }}
                  className="text-sm bg-red-600 text-white px-3 py-1 rounded hover:bg-red-700"
                >
                  å†è©¦è¡Œ
                </button>
                <button
                  onClick={() => {
                    window.location.reload();
                  }}
                  className="text-sm bg-gray-600 text-white px-3 py-1 rounded hover:bg-gray-700"
                >
                  ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿
                </button>
              </div>
              
              {/* ãƒ‡ãƒãƒƒã‚°æƒ…å ±ï¼ˆé–‹ç™ºç’°å¢ƒã®ã¿ï¼‰ */}
              {process.env.NODE_ENV === 'development' && this.state.errorInfo && (
                <details className="mt-3">
                  <summary className="text-xs text-red-600 cursor-pointer">
                    ã‚¨ãƒ©ãƒ¼è©³ç´°ã‚’è¡¨ç¤º
                  </summary>
                  <pre className="text-xs text-red-600 mt-2 bg-red-100 p-2 rounded overflow-auto max-h-32">
                    {this.state.error?.stack}
                    {'\n\nComponent Stack:'}
                    {this.state.errorInfo.componentStack}
                  </pre>
                </details>
              )}
            </div>
          </div>
        </div>
      );
    }

    return this.props.children;
  }
}
```

**C. å•†å“ãƒ‡ãƒ¼ã‚¿ã®å®‰å…¨ãªå‡¦ç†ãƒ­ã‚¸ãƒƒã‚¯**
```typescript
// å•†å“ãƒ‡ãƒ¼ã‚¿ã®å®‰å…¨ãªå‡¦ç†
const safeProducts = useMemo(() => {
  if (!isClient) {
    console.log('[ProductSelection] Client not ready');
    return [];
  }
  
  console.log('[ProductSelection] Processing products:', {
    type: typeof products,
    isArray: Array.isArray(products),
    length: products?.length || 0,
    data: products
  });
  
  // ç·Šæ€¥å¯¾å¿œ: å•†å“ãƒ‡ãƒ¼ã‚¿ãŒå–å¾—ã§ããªã„å ´åˆã®è©³ç´°ãªã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
  try {
    if (!products) {
      console.error('[ProductSelection] Products is null or undefined');
      setError('å•†å“ãƒ‡ãƒ¼ã‚¿ãŒå–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿ã—ã¦ãã ã•ã„ã€‚');
      return [];
    }
    
    if (!Array.isArray(products)) {
      console.error('[ProductSelection] Products is not an array:', typeof products, products);
      setError('å•†å“ãƒ‡ãƒ¼ã‚¿ã®å½¢å¼ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“ã€‚ç®¡ç†è€…ã«ãŠå•ã„åˆã‚ã›ãã ã•ã„ã€‚');
      return [];
    }
    
    if (products.length === 0) {
      console.warn('[ProductSelection] Products array is empty');
      setError('ã“ã®ãƒ—ãƒªã‚»ãƒƒãƒˆã«ã¯å•†å“ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ç®¡ç†ç”»é¢ã§å•†å“ã‚’è¿½åŠ ã—ã¦ãã ã•ã„ã€‚');
      return [];
    }
    
    // å•†å“ãƒ‡ãƒ¼ã‚¿ã®æ¤œè¨¼ã¨ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
    const validProducts = products.filter((product, index) => {
      try {
        if (!product) {
          console.warn(`[ProductSelection] Product at index ${index} is null/undefined`);
          return false;
        }
        
        if (!isValidProduct(product)) {
          console.warn(`[ProductSelection] Invalid product at index ${index}:`, product);
          return false;
        }
        
        return true;
      } catch (filterError) {
        console.error(`[ProductSelection] Error filtering product at index ${index}:`, filterError);
        return false;
      }
    });
    
    if (validProducts.length === 0) {
      console.error('[ProductSelection] No valid products found after filtering');
      setError('æœ‰åŠ¹ãªå•†å“ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚ç®¡ç†è€…ã«ãŠå•ã„åˆã‚ã›ãã ã•ã„ã€‚');
      return [];
    }
    
    console.log(`[ProductSelection] Processed ${validProducts.length} valid products`);
    setError(null);
    return validProducts;
    
  } catch (processingError) {
    console.error('[ProductSelection] Error processing products:', processingError);
    setError('å•†å“ãƒ‡ãƒ¼ã‚¿ã®å‡¦ç†ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿ã—ã¦ãã ã•ã„ã€‚');
    return [];
  }
}, [products, isClient]);
```

**D. å…¨ã¦ã®JSXè¡¨ç¤ºç®‡æ‰€ã§ã®å®‰å…¨ãªãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°**
```typescript
// é¸æŠæ¸ˆã¿å•†å“è¡¨ç¤º
{selectedProducts.map((product) => (
  <div key={product.product_id} className="flex justify-between items-center text-sm">
    <span>
      {safeRender(product.product_name)} Ã— {safeRender(product.quantity)}
    </span>
    <div className="flex items-center space-x-2">
      {formSettings?.show_price && (
        <span className="font-medium">
          {safePrice(product.total_price)}
        </span>
      )}
      {/* ... */}
    </div>
  </div>
))}

// å•†å“ä¸€è¦§è¡¨ç¤º
<h4 className="font-medium text-gray-900">
  {safeRender(product.name)}
</h4>
{formSettings?.show_price && (
  <p className="text-sm text-gray-600">
    {safePrice(product.price)}
  </p>
)}

// ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º
{errors.products && (
  <div className="mt-4 bg-red-50 border border-red-200 rounded-lg p-3">
    <p className="text-sm text-red-600">{safeRender(errors.products.message)}</p>
  </div>
)}
```

### 2. API 404ã‚¨ãƒ©ãƒ¼å¯¾ç­–

#### å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«: `src/app/api/admin/preset-products/[presetId]/route.ts`

#### å®Ÿè£…å†…å®¹

**A. Next.js 15å¯¾å¿œã®å‹•çš„ãƒ«ãƒ¼ãƒˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å‡¦ç†**
```typescript
export async function GET(
  request: NextRequest,
  { params }: { params: Promise<{ presetId: string }> }
) {
  try {
    // ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®å®‰å…¨ãªå–å¾—
    const { presetId } = await params;
    const id = Number(presetId);
    
    // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
    if (Number.isNaN(id) || id < 1) {
      console.error(`Invalid presetId: ${presetId}`);
      return NextResponse.json(
        { 
          error: 'ç„¡åŠ¹ãªãƒ—ãƒªã‚»ãƒƒãƒˆIDã§ã™',
          code: 'INVALID_PRESET_ID',
          presetId 
        },
        { status: 400 }
      );
    }

    // Supabaseæ¥ç¶šç¢ºèª
    if (!supabaseAdmin) {
      console.error('Supabase admin client not available');
      return NextResponse.json(
        { 
          error: 'ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šã‚¨ãƒ©ãƒ¼',
          code: 'DB_CONNECTION_ERROR' 
        },
        { status: 500 }
      );
    }

    console.log(`Fetching preset products for presetId: ${id}`);

    // ãƒ—ãƒªã‚»ãƒƒãƒˆå•†å“ãƒ‡ãƒ¼ã‚¿ã®å–å¾—
    const { data: presetProducts, error: dbError } = await supabaseAdmin
      .from('preset_products')
      .select(`
        product_id,
        display_order,
        is_active,
        product:products(
          id,
          name,
          price,
          category_id,
          visible,
          created_at,
          updated_at
        )
      `)
      .eq('preset_id', id)
      .eq('is_active', true)
      .order('display_order');

    if (dbError) {
      console.error('Database query error:', dbError);
      return NextResponse.json(
        { 
          error: 'ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¯ã‚¨ãƒªã‚¨ãƒ©ãƒ¼',
          code: 'DB_QUERY_ERROR',
          details: dbError.message 
        },
        { status: 500 }
      );
    }

    // ãƒ‡ãƒ¼ã‚¿ã®æ•´å½¢ã¨æ¤œè¨¼
    const validProducts = (presetProducts || [])
      .filter(pp => {
        // å•†å“ãƒ‡ãƒ¼ã‚¿ã®å­˜åœ¨ç¢ºèª
        if (!pp.product || typeof pp.product !== 'object') {
          console.warn(`Product not found for product_id: ${pp.product_id}`);
          return false;
        }
        
        // é…åˆ—ã®å ´åˆã¯æœ€åˆã®è¦ç´ ã‚’ä½¿ç”¨
        const product = Array.isArray(pp.product) ? pp.product[0] : pp.product;
        
        if (!product) {
          console.warn(`Product data is empty for product_id: ${pp.product_id}`);
          return false;
        }
        
        // å•†å“ã®å¯è¦–æ€§ç¢ºèª
        if (product.visible === false) {
          console.warn(`Product not visible: ${product.id}`);
          return false;
        }
        
        return true;
      })
      .map(pp => {
        const product = Array.isArray(pp.product) ? pp.product[0] : pp.product;
        return {
          ...product,
          display_order: pp.display_order,
          preset_product_id: pp.product_id
        };
      })
      .sort((a, b) => (a.display_order || 999) - (b.display_order || 999));

    console.log(`Found ${validProducts.length} valid products for preset ${id}`);

    return NextResponse.json({
      success: true,
      data: validProducts,
      meta: {
        presetId: id,
        totalCount: validProducts.length,
        timestamp: new Date().toISOString()
      }
    });

  } catch (error) {
    console.error('Unexpected error in preset-products API:', error);
    return NextResponse.json(
      { 
        error: 'äºˆæœŸã—ãªã„ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ',
        code: 'UNEXPECTED_ERROR',
        details: error instanceof Error ? error.message : 'Unknown error'
      },
      { status: 500 }
    );
  }
}
```

### 3. ãƒ‡ãƒ¼ã‚¿å–å¾—ãƒ•ãƒƒã‚¯å¼·åŒ–

#### å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«: `src/hooks/useFormConfig.ts`

#### å®Ÿè£…å†…å®¹

**A. è©³ç´°ãªãƒ­ã‚°å‡ºåŠ›ã¨ãƒªãƒˆãƒ©ã‚¤æ©Ÿèƒ½**
```typescript
const fetchConfig = useCallback(async (attempt = 0) => {
  if (!enabled || presetId < 1) {
    setLoading(false);
    return;
  }

  try {
    setLoading(true);
    setError(null);
    
    const startTime = Date.now();
    console.log(`[useFormConfig] Fetching config for preset: ${presetId} (attempt ${attempt + 1})`);
    
    // APIå‘¼ã³å‡ºã—
    const response = await fetch(`/api/form/${presetId}`, {
      method: 'GET',
      headers: {
        'Content-Type': 'application/json',
        'Cache-Control': 'no-cache',
      },
    });
    
    const endTime = Date.now();
    const responseTime = endTime - startTime;
    
    console.log(`[useFormConfig] API response:`, {
      status: response.status,
      statusText: response.statusText,
      responseTime: `${responseTime}ms`,
      headers: Object.fromEntries(response.headers.entries())
    });
    
    if (!response.ok) {
      const errorText = await response.text();
      console.error(`[useFormConfig] API error response:`, {
        status: response.status,
        statusText: response.statusText,
        body: errorText
      });
      
      throw new Error(`API error: ${response.status} ${response.statusText}`);
    }
    
    const result = await response.json();
    
    console.log(`[useFormConfig] API result:`, {
      success: result.success,
      hasData: !!result.data,
      productsCount: result.data?.products?.length || 0,
      formSettingsExists: !!result.data?.form_settings,
      presetExists: !!result.data?.preset
    });
    
    if (!result.success || !result.data) {
      throw new Error('ãƒ•ã‚©ãƒ¼ãƒ è¨­å®šã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ');
    }
    
    // ãƒ‡ãƒãƒƒã‚°æƒ…å ±ã®æ›´æ–°
    setDebugInfo({
      presetId,
      responseTime,
      attempt: attempt + 1,
      timestamp: new Date().toISOString(),
      apiResponse: {
        success: result.success,
        dataKeys: result.data ? Object.keys(result.data) : [],
        productsCount: result.data?.products?.length || 0
      }
    });
    
    setConfig(result.data);
    setRetryAttempt(0);
    
  } catch (err) {
    const errorMessage = err instanceof Error ? err.message : 'ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ';
    console.error(`[useFormConfig] Fetch error (attempt ${attempt + 1}):`, err);
    
    // ãƒªãƒˆãƒ©ã‚¤ãƒ­ã‚¸ãƒƒã‚¯
    if (attempt < retryCount - 1) {
      console.log(`[useFormConfig] Retrying in ${retryDelay}ms...`);
      setRetryAttempt(attempt + 1);
      
      setTimeout(() => {
        fetchConfig(attempt + 1);
      }, retryDelay * (attempt + 1)); // æŒ‡æ•°ãƒãƒƒã‚¯ã‚ªãƒ•
      
      return;
    }
    
    // æœ€çµ‚çš„ãªã‚¨ãƒ©ãƒ¼å‡¦ç†
    setError(errorMessage);
    setDebugInfo({
      presetId,
      error: errorMessage,
      attempt: attempt + 1,
      timestamp: new Date().toISOString(),
      finalAttempt: true
    });
    
    onError?.(errorMessage);
  } finally {
    if (attempt === retryCount - 1 || !error) {
      setLoading(false);
    }
  }
}, [presetId, enabled, onError, retryCount, retryDelay]);
```

## ğŸ” å®Ÿè£…æ‰‹é †ï¼ˆä»–ã®AIå‘ã‘æŒ‡ç¤ºï¼‰

### Step 1: ProductSelectionSection.tsx ã®ä¿®æ­£

1. **ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‹ã**: `src/components/features/reservation/ProductSelectionSection.tsx`

2. **ã‚¤ãƒ³ãƒãƒ¼ãƒˆæ–‡ã®ä¿®æ­£**:
   ```typescript
   // æ—¢å­˜ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆæ–‡ã®å¾Œã«ã€å®‰å…¨ãªãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°é–¢æ•°ã‚’ç›´æ¥å®Ÿè£…
   ```

3. **å®‰å…¨ãªãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°é–¢æ•°ã®è¿½åŠ **:
   - `safeRender`é–¢æ•°ã‚’å®Ÿè£…
   - `safeProductName`é–¢æ•°ã‚’å®Ÿè£…
   - `safePrice`é–¢æ•°ã‚’å®Ÿè£…
   - `safeQuantity`é–¢æ•°ã‚’å®Ÿè£…
   - `isValidProduct`å‹ã‚¬ãƒ¼ãƒ‰é–¢æ•°ã‚’å®Ÿè£…

4. **ã‚¨ãƒ©ãƒ¼å¢ƒç•Œã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®è¿½åŠ **:
   - `ProductSelectionErrorBoundary`ã‚¯ãƒ©ã‚¹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’å®Ÿè£…
   - ã‚¨ãƒ©ãƒ¼æ™‚ã®UIè¡¨ç¤ºã‚’å«ã‚€

5. **å•†å“ãƒ‡ãƒ¼ã‚¿å‡¦ç†ãƒ­ã‚¸ãƒƒã‚¯ã®ä¿®æ­£**:
   - `safeProducts`ã®useMemoã‚’è©³ç´°ãªã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ä»˜ãã§å®Ÿè£…
   - try-catchæ–‡ã«ã‚ˆã‚‹å®‰å…¨ãªå‡¦ç†

6. **JSXè¡¨ç¤ºç®‡æ‰€ã®ä¿®æ­£**:
   - å…¨ã¦ã®å•†å“åã€ä¾¡æ ¼ã€æ•°é‡è¡¨ç¤ºã§`safeRender`ç³»é–¢æ•°ã‚’ä½¿ç”¨
   - ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤ºã‚‚`safeRender`ã§åŒ…ã‚€

7. **ã‚¨ãƒ©ãƒ¼å¢ƒç•Œã§ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå…¨ä½“ã‚’åŒ…ã‚€**:
   ```typescript
   return (
     <ProductSelectionErrorBoundary>
       {/* æ—¢å­˜ã®JSX */}
     </ProductSelectionErrorBoundary>
   );
   ```

### Step 2: API ãƒ«ãƒ¼ãƒˆã®ä¿®æ­£

1. **ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‹ã**: `src/app/api/admin/preset-products/[presetId]/route.ts`

2. **GETé–¢æ•°ã®ã‚·ã‚°ãƒãƒãƒ£ä¿®æ­£**:
   ```typescript
   export async function GET(
     request: NextRequest,
     { params }: { params: Promise<{ presetId: string }> }
   ) {
   ```

3. **ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å–å¾—ã®ä¿®æ­£**:
   ```typescript
   const { presetId } = await params;
   const id = Number(presetId);
   ```

4. **PUTé–¢æ•°ã‚‚åŒæ§˜ã«ä¿®æ­£**

### Step 3: useFormConfig ãƒ•ãƒƒã‚¯ã®ä¿®æ­£

1. **ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‹ã**: `src/hooks/useFormConfig.ts`

2. **ä¸è¦ãªã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚’å‰Šé™¤**:
   ```typescript
   // loggeré–¢é€£ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚’å‰Šé™¤
   ```

3. **è©³ç´°ãªãƒ­ã‚°å‡ºåŠ›ã‚’è¿½åŠ **:
   - APIå‘¼ã³å‡ºã—å‰å¾Œã®ãƒ­ã‚°
   - ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚é–“ã®æ¸¬å®š
   - ã‚¨ãƒ©ãƒ¼è©³ç´°ã®å‡ºåŠ›

4. **ãƒªãƒˆãƒ©ã‚¤æ©Ÿèƒ½ã®å®Ÿè£…**:
   - æŒ‡æ•°ãƒãƒƒã‚¯ã‚ªãƒ•ã«ã‚ˆã‚‹ãƒªãƒˆãƒ©ã‚¤
   - ãƒ‡ãƒãƒƒã‚°æƒ…å ±ã®è“„ç©

## ğŸ“‹ æ¤œè¨¼æ‰‹é †

### 1. æœ¬ç•ªç’°å¢ƒã§ã®ç¢ºèª

1. **ãƒ–ãƒ©ã‚¦ã‚¶ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚’é–‹ã**
2. **å•†å“é¸æŠãƒšãƒ¼ã‚¸ã«ã‚¢ã‚¯ã‚»ã‚¹**
3. **ä»¥ä¸‹ã‚’ç¢ºèª**:
   - React Error #418ãŒå‡ºåŠ›ã•ã‚Œãªã„ã“ã¨
   - å•†å“ãŒæ­£å¸¸ã«è¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨
   - æ•°é‡å¤‰æ›´ãŒæ­£å¸¸ã«å‹•ä½œã™ã‚‹ã“ã¨

### 2. ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¿ãƒ–ã§ã®ç¢ºèª

1. **ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¿ãƒ–ã‚’é–‹ã**
2. **APIå‘¼ã³å‡ºã—ã‚’ç¢ºèª**:
   - `/api/form/{presetId}` ãŒ200ã§æˆåŠŸã™ã‚‹ã“ã¨
   - `/api/admin/preset-products/{presetId}` ãŒ404ã§ãªã„ã“ã¨

### 3. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®ç¢ºèª

1. **æ„å›³çš„ã«ã‚¨ãƒ©ãƒ¼ã‚’ç™ºç”Ÿã•ã›ã‚‹**:
   - ç„¡åŠ¹ãªpresetIdã§ã‚¢ã‚¯ã‚»ã‚¹
   - ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’åˆ‡æ–­ã—ã¦ã‚¢ã‚¯ã‚»ã‚¹
2. **é©åˆ‡ãªã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨**
3. **å†è©¦è¡Œãƒœã‚¿ãƒ³ãŒå‹•ä½œã™ã‚‹ã“ã¨**

## ğŸš¨ æ³¨æ„äº‹é …

### å®Ÿè£…æ™‚ã®é‡è¦ãƒã‚¤ãƒ³ãƒˆ

1. **å‹å®‰å…¨æ€§ã®ç¢ºä¿**:
   - å…¨ã¦ã®å¤–éƒ¨ãƒ‡ãƒ¼ã‚¿ã«å¯¾ã—ã¦å‹ãƒã‚§ãƒƒã‚¯ã‚’å®Ÿæ–½
   - `unknown`å‹ã‹ã‚‰å®‰å…¨ã«ã‚­ãƒ£ã‚¹ãƒˆã™ã‚‹

2. **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®å¾¹åº•**:
   - try-catchæ–‡ã«ã‚ˆã‚‹ä¾‹å¤–å‡¦ç†
   - ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼ãªã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸

3. **ãƒ­ã‚°å‡ºåŠ›ã®å……å®Ÿ**:
   - å•é¡Œç‰¹å®šã®ãŸã‚ã®è©³ç´°ãªãƒ­ã‚°
   - æœ¬ç•ªç’°å¢ƒã§ã‚‚ç¢ºèªå¯èƒ½ãªã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãƒ­ã‚°

4. **ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æ©Ÿèƒ½**:
   - ãƒ‡ãƒ¼ã‚¿å–å¾—å¤±æ•—æ™‚ã®ä»£æ›¿è¡¨ç¤º
   - å†è©¦è¡Œæ©Ÿèƒ½ã®æä¾›

### ãƒ‡ãƒ—ãƒ­ã‚¤å¾Œã®ç¢ºèªé …ç›®

1. **React Error #418ã®è§£æ¶ˆ**:
   - ãƒ–ãƒ©ã‚¦ã‚¶ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ã‚¨ãƒ©ãƒ¼ãŒå‡ºåŠ›ã•ã‚Œãªã„ã“ã¨
   - å•†å“é¸æŠUIãŒæ­£å¸¸ã«å‹•ä½œã™ã‚‹ã“ã¨

2. **API 404ã‚¨ãƒ©ãƒ¼ã®è§£æ¶ˆ**:
   - å…¨ã¦ã®APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆãŒæ­£å¸¸ã«å¿œç­”ã™ã‚‹ã“ã¨
   - ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¿ãƒ–ã§404ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãªã„ã“ã¨

3. **ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“ã®æ”¹å–„**:
   - å•†å“é¸æŠãŒæ­£å¸¸ã«å‹•ä½œã™ã‚‹ã“ã¨
   - ã‚¨ãƒ©ãƒ¼æ™‚ã«é©åˆ‡ãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨

## ğŸ“ ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã¾ã ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹å ´åˆ

1. **Vercelã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®ã‚¯ãƒªã‚¢**:
   - Vercelãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ã‚¯ãƒªã‚¢
   - å†ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’å®Ÿè¡Œ

2. **ãƒ–ãƒ©ã‚¦ã‚¶ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®ã‚¯ãƒªã‚¢**:
   - ãƒãƒ¼ãƒ‰ãƒªãƒ­ãƒ¼ãƒ‰ï¼ˆCtrl+Shift+Rï¼‰
   - ãƒ–ãƒ©ã‚¦ã‚¶ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®å®Œå…¨å‰Šé™¤

3. **ãƒ­ã‚°ã®ç¢ºèª**:
   - ãƒ–ãƒ©ã‚¦ã‚¶ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã‚’ç¢ºèª
   - Vercelã®é–¢æ•°ãƒ­ã‚°ã‚’ç¢ºèª

### è¿½åŠ å¯¾å¿œãŒå¿…è¦ãªå ´åˆ

1. **DatabaseService.tsã®ä¿®æ­£**:
   - å•†å“ãƒ‡ãƒ¼ã‚¿å–å¾—ãƒ­ã‚¸ãƒƒã‚¯ã®è¦‹ç›´ã—
   - ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†ã®è¿½åŠ 

2. **å‹å®šç¾©ã®è¦‹ç›´ã—**:
   - Productå‹ã®å³å¯†åŒ–
   - FormConfigResponseå‹ã®ä¿®æ­£

---

**ä½œæˆæ—¥**: 2025å¹´8æœˆ5æ—¥  
**å¯¾è±¡ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: Next.js 15.4.3, React 19.1.0  
**ç·Šæ€¥åº¦**: æœ€é«˜  
**å®Ÿè£…è€…**: Kiro AI Assistant