# 管理画面簡素化指示書 - 早期リリース対応

## 📋 簡素化概要

**目的**: 早期リリースのための管理画面機能の最小化  
**対象**: フォーム作成と予約確認のみに機能を限定  
**作成日**: 2025年8月5日  
**緊急度**: 最高（リリース優先）

## 🎯 残す機能（最小限）

### 1. 必須機能のみ
- **ダッシュボード**: 予約一覧表示のみ
- **フォーム管理**: プリセット作成・商品設定のみ
- **認証**: 簡単なパスワード認証

### 2. 削除する機能
- 通知管理
- レポート機能
- システム設定
- CSVインポート
- 詳細な統計
- 複雑なモーダル

## 🔧 具体的な修正内容

### Phase 1: サイドバーの簡素化

#### 修正1: AdminSidebar.tsx の簡素化

**ファイル**: `src/components/admin/AdminSidebar.tsx`

**修正後**:
```typescript
'use client';

import Link from 'next/link';
import { usePathname } from 'next/navigation';

interface AdminSidebarProps {
  onLogout?: () => void;
}

export default function AdminSidebar({ onLogout }: AdminSidebarProps) {
  const pathname = usePathname();

  const navigationItems = [
    {
      name: 'ダッシュボード',
      href: '/admin',
      icon: (
        <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2H5a2 2 0 00-2-2z" />
        </svg>
      ),
      description: '予約一覧'
    },
    {
      name: 'フォーム管理',
      href: '/admin/settings',
      icon: (
        <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
        </svg>
      ),
      description: 'プリセット・商品設定'
    }
  ];

  const isActive = (href: string) => {
    if (href === '/admin') {
      return pathname === '/admin';
    }
    return pathname.startsWith(href);
  };

  return (
    <div className="w-64 bg-gray-900 h-screen fixed left-0 top-0">
      {/* ヘッダー */}
      <div className="flex items-center h-16 px-4 bg-gray-800">
        <div className="flex items-center">
          <div className="w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center">
            <span className="text-white font-bold text-sm">予</span>
          </div>
          <div className="ml-3">
            <p className="text-white text-sm font-medium">予約システム</p>
            <p className="text-gray-300 text-xs">管理画面</p>
          </div>
        </div>
      </div>

      {/* ナビゲーション */}
      <nav className="mt-8 px-4">
        <ul className="space-y-2">
          {navigationItems.map((item) => (
            <li key={item.name}>
              <Link
                href={item.href}
                className={`
                  group flex items-center px-3 py-3 text-sm font-medium rounded-md transition-colors
                  ${isActive(item.href)
                    ? 'bg-gray-800 text-white border-r-2 border-blue-500'
                    : 'text-gray-300 hover:bg-gray-700 hover:text-white'
                  }
                `}
              >
                <span className={`mr-3 ${isActive(item.href) ? 'text-blue-400' : 'text-gray-400'}`}>
                  {item.icon}
                </span>
                <div>
                  <div>{item.name}</div>
                  <div className="text-xs text-gray-400">{item.description}</div>
                </div>
              </Link>
            </li>
          ))}
        </ul>
      </nav>

      {/* ログアウト */}
      <div className="absolute bottom-0 left-0 right-0 p-4 border-t border-gray-700">
        {onLogout && (
          <button
            onClick={onLogout}
            className="w-full flex items-center px-3 py-2 text-sm text-red-400 hover:text-red-300 rounded-md hover:bg-gray-700"
          >
            <svg className="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17 16l4-4m0 0l-4-4m4 4H7" />
            </svg>
            ログアウト
          </button>
        )}
      </div>
    </div>
  );
}
```

### Phase 2: ダッシュボードの簡素化

#### 修正2: admin/page.tsx の簡素化

**ファイル**: `src/app/admin/page.tsx`

**修正後**:
```typescript
'use client';

import { useState, useEffect } from 'react';
import AdminLayout from '@/components/admin/AdminLayout';

interface SimpleReservation {
  id: string;
  user_name: string;
  phone_number: string;
  product: string[];
  total_amount: number;
  created_at: string;
}

export default function AdminDashboard() {
  const [isAuthenticated, setIsAuthenticated] = useState(false);
  const [password, setPassword] = useState('');
  const [authError, setAuthError] = useState('');
  const [loading, setLoading] = useState(false);
  const [reservations, setReservations] = useState<SimpleReservation[]>([]);

  const ADMIN_PASSWORD = 'admin123';

  const handleLogin = () => {
    if (password === ADMIN_PASSWORD) {
      setIsAuthenticated(true);
      setAuthError('');
      loadReservations();
    } else {
      setAuthError('パスワードが間違っています');
    }
  };

  const loadReservations = async () => {
    setLoading(true);
    try {
      const response = await fetch('/api/admin/dashboard');
      const data = await response.json();

      if (response.ok) {
        setReservations(data.reservations || []);
      }
    } catch (error) {
      console.error('データ読み込みエラー:', error);
    } finally {
      setLoading(false);
    }
  };

  const handleLogout = () => {
    setIsAuthenticated(false);
    setPassword('');
  };

  if (!isAuthenticated) {
    return (
      <div className="min-h-screen bg-gray-50 flex items-center justify-center">
        <div className="max-w-md w-full bg-white rounded-lg shadow-md p-6">
          <h1 className="text-2xl font-bold text-gray-900 mb-6 text-center">
            管理者ログイン
          </h1>
          
          <div className="space-y-4">
            <input
              type="password"
              value={password}
              onChange={(e) => setPassword(e.target.value)}
              onKeyPress={(e) => e.key === 'Enter' && handleLogin()}
              className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
              placeholder="パスワードを入力"
            />
            
            {authError && (
              <div className="text-red-600 text-sm">{authError}</div>
            )}
            
            <button
              onClick={handleLogin}
              className="w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700"
            >
              ログイン
            </button>
          </div>
        </div>
      </div>
    );
  }

  return (
    <AdminLayout 
      title="予約一覧" 
      description="最近の予約を確認できます"
      onLogout={handleLogout}
    >
      {loading ? (
        <div className="text-center py-8">
          <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"></div>
          <p className="mt-4 text-gray-600">読み込み中...</p>
        </div>
      ) : (
        <div className="bg-white shadow rounded-lg">
          <div className="px-4 py-5 sm:p-6">
            <div className="flex justify-between items-center mb-4">
              <h2 className="text-lg font-medium text-gray-900">予約一覧</h2>
              <button
                onClick={loadReservations}
                className="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 text-sm"
              >
                更新
              </button>
            </div>
            
            {reservations.length === 0 ? (
              <p className="text-gray-500 text-center py-8">予約データがありません</p>
            ) : (
              <div className="overflow-x-auto">
                <table className="min-w-full divide-y divide-gray-200">
                  <thead className="bg-gray-50">
                    <tr>
                      <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">
                        顧客名
                      </th>
                      <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">
                        電話番号
                      </th>
                      <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">
                        商品
                      </th>
                      <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">
                        金額
                      </th>
                      <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">
                        予約日時
                      </th>
                    </tr>
                  </thead>
                  <tbody className="bg-white divide-y divide-gray-200">
                    {reservations.map((reservation) => (
                      <tr key={reservation.id} className="hover:bg-gray-50">
                        <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                          {reservation.user_name}
                        </td>
                        <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                          {reservation.phone_number}
                        </td>
                        <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                          {reservation.product?.join(', ') || '-'}
                        </td>
                        <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                          ¥{reservation.total_amount?.toLocaleString() || 0}
                        </td>
                        <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                          {new Date(reservation.created_at).toLocaleString('ja-JP')}
                        </td>
                      </tr>
                    ))}
                  </tbody>
                </table>
              </div>
            )}
          </div>
        </div>
      )}
    </AdminLayout>
  );
}
```

### Phase 3: フォーム管理の簡素化

#### 修正3: settings/page.tsx の簡素化

**新規ファイル**: `src/app/admin/settings/page.tsx`

```typescript
'use client';

import { useState, useEffect } from 'react';
import AdminLayout from '@/components/admin/AdminLayout';

interface SimplePreset {
  id: number;
  preset_name: string;
  created_at: string;
}

interface SimpleProduct {
  id: number;
  name: string;
  price: number;
  category_id: number;
}

export default function SettingsPage() {
  const [presets, setPresets] = useState<SimplePreset[]>([]);
  const [products, setProducts] = useState<SimpleProduct[]>([]);
  const [loading, setLoading] = useState(true);
  
  // プリセット作成フォーム
  const [newPresetName, setNewPresetName] = useState('');
  const [isCreatingPreset, setIsCreatingPreset] = useState(false);
  
  // 商品作成フォーム
  const [newProduct, setNewProduct] = useState({
    name: '',
    price: '',
    category_id: '1'
  });
  const [isCreatingProduct, setIsCreatingProduct] = useState(false);

  useEffect(() => {
    loadData();
  }, []);

  const loadData = async () => {
    setLoading(true);
    try {
      // プリセット取得
      const presetsResponse = await fetch('/api/admin/presets');
      if (presetsResponse.ok) {
        const presetsData = await presetsResponse.json();
        setPresets(presetsData.data || []);
      }

      // 商品取得
      const productsResponse = await fetch('/api/admin/products');
      if (productsResponse.ok) {
        const productsData = await productsResponse.json();
        setProducts(productsData.data || []);
      }
    } catch (error) {
      console.error('データ読み込みエラー:', error);
    } finally {
      setLoading(false);
    }
  };

  const createPreset = async () => {
    if (!newPresetName.trim()) return;
    
    setIsCreatingPreset(true);
    try {
      const response = await fetch('/api/admin/presets', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ preset_name: newPresetName })
      });

      if (response.ok) {
        setNewPresetName('');
        loadData();
      }
    } catch (error) {
      console.error('プリセット作成エラー:', error);
    } finally {
      setIsCreatingPreset(false);
    }
  };

  const createProduct = async () => {
    if (!newProduct.name.trim() || !newProduct.price) return;
    
    setIsCreatingProduct(true);
    try {
      const response = await fetch('/api/admin/products', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          name: newProduct.name,
          price: parseInt(newProduct.price),
          category_id: parseInt(newProduct.category_id),
          visible: true
        })
      });

      if (response.ok) {
        setNewProduct({ name: '', price: '', category_id: '1' });
        loadData();
      }
    } catch (error) {
      console.error('商品作成エラー:', error);
    } finally {
      setIsCreatingProduct(false);
    }
  };

  if (loading) {
    return (
      <AdminLayout title="フォーム管理" description="プリセットと商品を管理します">
        <div className="text-center py-8">
          <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"></div>
          <p className="mt-4 text-gray-600">読み込み中...</p>
        </div>
      </AdminLayout>
    );
  }

  return (
    <AdminLayout title="フォーム管理" description="プリセットと商品を管理します">
      <div className="space-y-8">
        {/* プリセット管理 */}
        <div className="bg-white shadow rounded-lg">
          <div className="px-4 py-5 sm:p-6">
            <h3 className="text-lg font-medium text-gray-900 mb-4">プリセット管理</h3>
            
            {/* プリセット作成フォーム */}
            <div className="mb-6 p-4 bg-gray-50 rounded-lg">
              <div className="flex space-x-4">
                <input
                  type="text"
                  value={newPresetName}
                  onChange={(e) => setNewPresetName(e.target.value)}
                  placeholder="プリセット名を入力"
                  className="flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                />
                <button
                  onClick={createPreset}
                  disabled={isCreatingPreset || !newPresetName.trim()}
                  className="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 disabled:opacity-50"
                >
                  {isCreatingPreset ? '作成中...' : '作成'}
                </button>
              </div>
            </div>

            {/* プリセット一覧 */}
            <div className="space-y-2">
              {presets.map((preset) => (
                <div key={preset.id} className="flex justify-between items-center p-3 border border-gray-200 rounded-md">
                  <div>
                    <span className="font-medium">{preset.preset_name}</span>
                    <span className="ml-2 text-sm text-gray-500">ID: {preset.id}</span>
                  </div>
                  <div className="text-sm text-gray-500">
                    {new Date(preset.created_at).toLocaleDateString('ja-JP')}
                  </div>
                </div>
              ))}
            </div>
          </div>
        </div>

        {/* 商品管理 */}
        <div className="bg-white shadow rounded-lg">
          <div className="px-4 py-5 sm:p-6">
            <h3 className="text-lg font-medium text-gray-900 mb-4">商品管理</h3>
            
            {/* 商品作成フォーム */}
            <div className="mb-6 p-4 bg-gray-50 rounded-lg">
              <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
                <input
                  type="text"
                  value={newProduct.name}
                  onChange={(e) => setNewProduct({...newProduct, name: e.target.value})}
                  placeholder="商品名"
                  className="px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                />
                <input
                  type="number"
                  value={newProduct.price}
                  onChange={(e) => setNewProduct({...newProduct, price: e.target.value})}
                  placeholder="価格"
                  className="px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                />
                <select
                  value={newProduct.category_id}
                  onChange={(e) => setNewProduct({...newProduct, category_id: e.target.value})}
                  className="px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                >
                  <option value="1">カテゴリ1</option>
                  <option value="2">カテゴリ2</option>
                </select>
                <button
                  onClick={createProduct}
                  disabled={isCreatingProduct || !newProduct.name.trim() || !newProduct.price}
                  className="bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 disabled:opacity-50"
                >
                  {isCreatingProduct ? '作成中...' : '商品作成'}
                </button>
              </div>
            </div>

            {/* 商品一覧 */}
            <div className="space-y-2">
              {products.map((product) => (
                <div key={product.id} className="flex justify-between items-center p-3 border border-gray-200 rounded-md">
                  <div>
                    <span className="font-medium">{product.name}</span>
                    <span className="ml-2 text-sm text-gray-500">¥{product.price.toLocaleString()}</span>
                  </div>
                  <div className="text-sm text-gray-500">
                    カテゴリ: {product.category_id}
                  </div>
                </div>
              ))}
            </div>
          </div>
        </div>
      </div>
    </AdminLayout>
  );
}
```

### Phase 4: 不要なファイルの削除

#### 削除対象ファイル一覧

```bash
# 削除するファイル
src/app/admin/notifications/
src/app/admin/reports/
src/app/admin/system/
src/components/admin/CSVImportModal.tsx
src/components/admin/FormSettingsModalNew.tsx
src/components/admin/PresetProductPagination.tsx
src/components/admin/PresetProductSearch.tsx
src/components/admin/PresetProductsModal.tsx
src/components/admin/ProductListSelector.tsx
src/components/admin/ProductModal.tsx
src/components/admin/ProductSearch.tsx
src/components/admin/ProductStats.tsx
src/components/admin/ProductVariationModal.tsx
src/components/admin/ReservationDetailModal.tsx
```

## 📋 実装手順

### Step 1: 不要ファイルの削除（5分）
```bash
# 不要なディレクトリとファイルを削除
rm -rf src/app/admin/notifications
rm -rf src/app/admin/reports  
rm -rf src/app/admin/system
rm src/components/admin/CSVImportModal.tsx
rm src/components/admin/FormSettingsModalNew.tsx
# ... 他の不要ファイル
```

### Step 2: コンポーネントの修正（15分）
1. AdminSidebar.tsx の簡素化
2. admin/page.tsx の簡素化
3. settings/page.tsx の新規作成

### Step 3: 動作確認（10分）
1. ログイン機能
2. 予約一覧表示
3. プリセット作成
4. 商品作成

## 🚨 注意事項

### 1. 最小限の機能のみ
- 複雑なモーダルや詳細機能は全て削除
- シンプルなフォームのみ実装
- エラーハンドリングも最小限

### 2. 後で拡張可能な設計
- 基本的な構造は維持
- 必要に応じて機能追加可能

### 3. 既存APIの活用
- 既存のAPIエンドポイントをそのまま使用
- 新しいAPIは作成しない

## 📊 期待される効果

### 即座の効果
- **開発時間短縮**: 80%の機能削除により大幅な時間短縮
- **バグリスク削減**: シンプルな実装によりバグ発生率低下
- **早期リリース**: 最小限の機能で迅速なリリース実現

### 運用面での効果
- **保守性向上**: シンプルなコードで保守が容易
- **拡張性確保**: 基本構造を維持し将来の拡張に対応

---

**作成者**: Kiro AI Assistant  
**推定実装時間**: 30分  
**優先度**: 最高（リリース必須）