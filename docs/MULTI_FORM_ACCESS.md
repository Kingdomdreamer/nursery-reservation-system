# 複数フォームアクセス設計ドキュメント

## 🎯 概要

ベジライス予約システムでは、複数の商品セット用フォームが利用可能です。ユーザーは目的に応じて適切なフォームにアクセスできます。

---

## 📋 利用可能なフォーム

### 1. 野菜セット（プリセットID: 1）
- **内容**: 新鮮な季節の野菜をお届け
- **対象**: 野菜を中心とした商品をご希望の方

### 2. 果物セット（プリセットID: 2）  
- **内容**: 甘くて美味しい旬の果物
- **対象**: 果物を中心とした商品をご希望の方

### 3. お米セット（プリセットID: 3）
- **内容**: こだわりの美味しいお米
- **対象**: お米を中心とした商品をご希望の方

---

## 🔗 アクセス方法

### パターン1: フォーム選択画面経由（推奨）
```
LIFF URL: https://miniapp.line.me/2007484444-JDmG6Vvy
```

**フロー:**
1. LIFF URLにアクセス
2. フォーム選択画面が表示
3. 希望する商品セットを選択
4. 該当の予約フォームが開く

### パターン2: 直接指定アクセス  
特定のフォームに直接アクセスしたい場合、URLパラメータを使用：

```
野菜セット: https://miniapp.line.me/2007484444-JDmG6Vvy?preset=1
果物セット: https://miniapp.line.me/2007484444-JDmG6Vvy?preset=2
お米セット: https://miniapp.line.me/2007484444-JDmG6Vvy?preset=3
```

---

## 🏗️ 技術実装詳細

### ルーティング構造
```
/                          → フォーム選択画面（またはパラメータ処理）
/form/[presetId]          → 各プリセット用予約フォーム
/confirm/[presetId]       → 各プリセット用確認画面
/complete/[presetId]      → 各プリセット用完了画面
```

### URLパラメータ処理
```typescript
// ルートページ（/page.tsx）での処理
const presetParam = searchParams.get('preset');
if (presetParam) {
  const presetId = parseInt(presetParam, 10);
  if (validPreset) {
    router.push(`/form/${presetId}`);
  }
}
```

### バリデーション
- 無効なプリセットIDが指定された場合 → フォーム選択画面表示
- プリセットIDが未指定の場合 → フォーム選択画面表示
- 有効なプリセットIDが指定された場合 → 該当フォームに直接遷移

---

## 📱 LINEリッチメニューでの活用

### 推奨設定
LINEリッチメニューで各フォームへの直接リンクを設定：

```
┌─────────────┬─────────────┐
│  🥬 野菜セット │  🍎 果物セット │
│   ?preset=1  │   ?preset=2  │  
├─────────────┼─────────────┤
│  🌾 お米セット │  📋 予約確認   │
│   ?preset=3  │   /confirm   │
└─────────────┴─────────────┘
```

### リッチメニューURL設定例
```
野菜セット: https://miniapp.line.me/2007484444-JDmG6Vvy?preset=1
果物セット: https://miniapp.line.me/2007484444-JDmG6Vvy?preset=2  
お米セット: https://miniapp.line.me/2007484444-JDmG6Vvy?preset=3
```

---

## 🎨 ユーザーエクスペリエンス

### フォーム選択画面の特徴
- **直感的デザイン**: 各商品セットが分かりやすく表示
- **説明付き**: 各セットの内容説明を表示
- **タップしやすい**: 大きなボタンで選択しやすい

### アクセスフロー例

#### ケース1: 初回ユーザー
```
1. LINEリッチメニューから「予約する」タップ
2. フォーム選択画面が表示
3. 「野菜セット」を選択
4. 野菜セット用予約フォームが開く
```

#### ケース2: リピートユーザー（直接アクセス）
```
1. LINEリッチメニューから「野菜セット」直接タップ
2. 野菜セット用予約フォームが直接開く
```

---

## 🔧 管理・運用面

### フォーム追加時の対応
新しい商品セットを追加する場合：

1. **データベース**: `product_presets`テーブルに新レコード追加
2. **コード更新**: `page.tsx`の`AVAILABLE_PRESETS`配列に追加
3. **リッチメニュー**: 新しいフォーム用リンクを追加

### フォーム無効化
特定のフォームを一時的に無効化したい場合：
- `AVAILABLE_PRESETS`配列から該当項目を削除
- またはフラグによる表示制御を実装

---

## ✅ メリット

### ユーザーメリット
- **明確な選択**: 目的の商品セットに迷わずアクセス
- **効率的**: 直接リンクで素早くアクセス可能
- **分かりやすい**: 商品セット別に整理された情報

### 管理者メリット  
- **柔軟な運用**: 商品セット別の管理が可能
- **分析しやすい**: プリセット別の予約状況把握
- **拡張性**: 新しい商品セットの追加が容易

### 技術的メリット
- **保守性**: プリセット別の機能追加・修正が容易
- **パフォーマンス**: 必要なデータのみ読み込み
- **セキュリティ**: プリセットIDの妥当性検証実装

---

## 🚀 今後の拡張可能性

### 動的フォーム管理
- データベースからプリセット情報を動的取得
- 管理画面からのフォーム有効/無効切り替え
- 期間限定フォームの自動表示制御

### パーソナライゼーション
- ユーザーの購入履歴に基づくおすすめフォーム表示
- よく利用するフォームの優先表示

### 分析機能
- プリセット別アクセス数の集計
- ユーザーの選択傾向分析
- A/Bテストによる最適化

---

この設計により、「Aフォームに予約したいのにBフォームが開く」問題は完全に解決され、ユーザーは意図した商品セットの予約フォームに確実にアクセスできるようになります。