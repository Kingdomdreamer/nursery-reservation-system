# 実装前確認事項リスト

以下は、実装を開始する前に確認・決定すべき項目のリストです。これらの項目について、関係者と協議し、明確な方針を決定することをお勧めします。

## 1. データベース関連

- [x] **予約データの保持期間**
  - ✅ 予約履歴確認のため3年間保持
  - ✅ 古いデータのアーカイブ方法：3年経過後に削除
  
- [x] **バックアップ戦略**
  - ✅ バックアップ不要（Supabaseの標準バックアップに依存）

- [ ] **インデックス設計**
  - 検索パフォーマンス向上のためのインデックス設計
  - 特に頻繁に検索される条件（日付、ユーザーID、商品カテゴリなど）

## 2. LINE LIFF関連

- [x] **LIFF ID確認**
  - ✅ 本番環境用LIFF ID：2007787336-ONKMVygx
  - ✅ エンドポイントURL：https://vejiraisu.yoyaku.com/

- [x] **LINE開発者チャンネル設定**
  - ✅ LINEログインチャンネル
    - チャンネルID：2007787336
    - チャンネルシークレット：eaf2dc5e15fd8d1cb14303491b751d12
  - ✅ Messaging APIチャンネル
    - チャンネルID：2007484278
    - チャンネルシークレット：36cf07cbd04fe902a7d41d4508d68905
    - アクセストークン：UYqfMDzllpxhibeD9aHspQ1lbP50f1/zJk71E+/2+LYA3NPO7DaGm2YU5BRomA3n86L9z0b1KW+g3D9HsGe0G7iPz0yZtN7liEv5qs3lltZ3YKxP0Zst9BvZsmYnc2qgG1JtF6fEYax4AGQkaZsgCAdB04t89/1O/w1cDnyilFU=

- [x] **LIFF権限スコープ**
  - ✅ profile, openid を使用

- [x] **エラー時のフォールバック**
  - ✅ LIFF初期化失敗時：エラーメッセージ表示後、再試行ボタン提供
  - ✅ ネットワークエラー時：自動再試行（数回）→ 失敗時はブラウザ直接アクセス案内

- [ ] **複数デバイス対応**
  - 同一ユーザーが異なるデバイスからアクセスした場合の挙動
  - デバイス間でのセッション共有の要否

## 3. 予約フロー

- [x] **予約の重複チェック**
  - ✅ 同一ユーザーによる重複予約：最終予約のみ有効（既存予約は上書き）
  - ✅ 重複定義：同一ユーザー・同一プリセットでの予約

- [x] **予約キャンセルポリシー**
  - ✅ キャンセル可能期限：引き取り日の前日まで
  - ✅ キャンセル時の通知：LINE通知で確認メッセージ送信
  - ✅ キャンセル履歴：保持する

- [x] **予約変更の制限**
  - ✅ 変更可能な項目：商品、数量、日付
  - ✅ 変更可能期限：引き取り日の前日まで
  - ✅ 変更履歴：保持する

- [x] **在庫管理連携**
  - ✅ 在庫管理機能は不要

## 4. 管理機能

- [x] **管理者権限レベル**
  - ✅ 管理者数：5人程度
  - ✅ 権限レベル：全権限（閲覧・編集・削除すべて可能）
  - ✅ 権限管理：シンプルな管理者認証（パスワード等）

- [x] **一括操作機能**
  - ✅ 一括キャンセル機能：実装予定
  - ✅ 一括LINE通知送信機能：実装予定
  - ✅ 複数予約の一括処理：実装予定

- [x] **データエクスポート形式**
  - ✅ エクスポート形式：CSV形式
  - ✅ エクスポート項目：全項目エクスポート
  - ✅ 定期的な自動エクスポート：不要（手動エクスポートのみ）

- [x] **分析機能**
  - ✅ 分析機能は不要

## 5. パフォーマンスと拡張性

- [x] **同時アクセス対応**
  - ✅ 想定最大同時アクセス数：100人程度
  - ✅ 負荷テスト計画：基本的な負荷テストのみ実施

- [x] **スケーリング戦略**
  - ✅ 現状はスケーリング戦略は想定していない
  - ✅ 必要に応じて将来検討

- [x] **キャッシュ戦略**
  - ✅ キャッシュ対象データ：商品マスタ、設定情報
  - ✅ キャッシュ更新タイミング：データ更新時に自動更新

## 6. セキュリティ

- [x] **個人情報保護対策**
  - ✅ 個人情報の暗号化：必要（名前、電話番号、住所など）
  - ✅ アクセスログの取得範囲：基本的なアクセスログのみ
  - ✅ ログ保持期間：3年間（予約データと同期）

- [x] **不正アクセス対策**
  - ✅ レート制限：最低限の実装（短時間での大量アクセス制限）
  - ✅ 異常アクセス検知：基本的な検知機能

- [x] **セキュリティ監査**
  - ✅ セキュリティ監査：必要に応じて実施
  - ✅ 脆弱性スキャン：基本的なスキャンのみ

## 7. 運用・保守

- [x] **モニタリング計画**
  - ✅ システム監視：不要
  - ✅ アラート機能：不要

- [x] **障害対応計画**
  - ✅ 障害時の連絡フロー：管理者への直接連絡
  - ✅ 復旧手順：基本的な手順書作成

- [x] **定期メンテナンス**
  - ✅ メンテナンス頻度：半年に1回程度
  - ✅ メンテナンス時間帯：深夜時間帯（利用者が少ない時間）
  - ✅ ユーザー通知方法：事前にLINE通知でお知らせ