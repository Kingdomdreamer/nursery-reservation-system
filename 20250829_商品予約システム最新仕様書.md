# å•†å“äºˆç´„ã‚·ã‚¹ãƒ†ãƒ å®Œå…¨ä»•æ§˜æ›¸ - 20250829ç‰ˆ

## ğŸ“‹ **ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦**

LINEé€£æºã«ã‚ˆã‚‹å•†å“äºˆç´„ã‚·ã‚¹ãƒ†ãƒ ã®å®Œå…¨ä»•æ§˜æ›¸ã§ã™ã€‚ã“ã®æ–‡æ›¸ã¯è¨­è¨ˆãƒ»å®Ÿè£…ãƒ»é‹ç”¨ã®ã™ã¹ã¦ã‚’ç¶²ç¾…ã—ã€é–‹ç™ºè€…ãŒå‚ç…§ã™ã¹ãå”¯ä¸€ã®æƒ…å ±æºã¨ã—ã¦æ©Ÿèƒ½ã—ã¾ã™ã€‚

**ä½œæˆæ—¥**: 2025å¹´8æœˆ29æ—¥  
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 1.0.0  
**å¯¾è±¡**: å®Œå…¨å®Ÿè£…ä»•æ§˜ï¼ˆè¨­è¨ˆãƒ»é–‹ç™ºãƒ»é‹ç”¨ãƒ»ä¿å®ˆï¼‰

### **ã‚·ã‚¹ãƒ†ãƒ ã®ç›®çš„**
- ç®¡ç†è€…ãŒè¤‡æ•°ã®ãƒ•ã‚©ãƒ¼ãƒ ã‚’åŠ¹ç‡çš„ã«ä½œæˆãƒ»ç®¡ç†
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒLINEçµŒç”±ã§ç›´æ„Ÿçš„ã«å•†å“äºˆç´„
- äºˆç´„ã®å¤‰æ›´ãƒ»ã‚­ãƒ£ãƒ³ã‚»ãƒ«æ©Ÿèƒ½
- åŒ…æ‹¬çš„ãªç®¡ç†æ©Ÿèƒ½ã¨ãƒ¬ãƒãƒ¼ãƒˆæ©Ÿèƒ½

## ğŸ¯ **æ®µéšçš„ãƒªãƒªãƒ¼ã‚¹è¨ˆç”»**

### **Phase 1: åŸºæœ¬æ©Ÿèƒ½ï¼ˆæœ€å„ªå…ˆï¼‰**
- âœ… åŸºæœ¬çš„ãªäºˆç´„ãƒ•ã‚©ãƒ¼ãƒ æ©Ÿèƒ½
- âœ… ç®¡ç†ç”»é¢ï¼ˆãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã€å•†å“ç®¡ç†ï¼‰
- âš ï¸ **ç·Šæ€¥ä¿®æ­£**: `totalItems`ã‚¨ãƒ©ãƒ¼ã®è§£æ±º
- ğŸ”§ LIFFæ©Ÿèƒ½ã®é©åˆ‡ãªåˆ†é›¢

### **Phase 2: äºˆç´„ç®¡ç†æ©Ÿèƒ½**
- äºˆç´„å¤‰æ›´ãƒ»ã‚­ãƒ£ãƒ³ã‚»ãƒ«æ©Ÿèƒ½
- LINEé€šçŸ¥æ©Ÿèƒ½ã®å¼·åŒ–
- äºˆç´„å±¥æ­´ç®¡ç†

### **Phase 3: é«˜åº¦ãªç®¡ç†æ©Ÿèƒ½**
- è©³ç´°ãªäºˆç´„ç®¡ç†ç”»é¢
- CSVä¸€æ‹¬ç™»éŒ²æ©Ÿèƒ½
- ãƒ¬ãƒãƒ¼ãƒˆãƒ»åˆ†ææ©Ÿèƒ½

## ğŸ—ï¸ **ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆ**

### **ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆå›³**

```mermaid
graph TB
    subgraph "ãƒ¦ãƒ¼ã‚¶ãƒ¼å±¤"
        U1[LINEãƒ¦ãƒ¼ã‚¶ãƒ¼]
        U2[ç®¡ç†è€…]
    end
    
    subgraph "ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³å±¤"
        L1[LINE LIFF App]
        W1[ç®¡ç†ç”»é¢Web App]
    end
    
    subgraph "ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤"
        N1[Next.js App Router]
        A1[API Routes]
        M1[Middleware]
    end
    
    subgraph "ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯å±¤"
        S1[äºˆç´„ã‚µãƒ¼ãƒ“ã‚¹]
        S2[å•†å“ç®¡ç†ã‚µãƒ¼ãƒ“ã‚¹]
        S3[é€šçŸ¥ã‚µãƒ¼ãƒ“ã‚¹]
        S4[èªè¨¼ã‚µãƒ¼ãƒ“ã‚¹]
    end
    
    subgraph "ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹å±¤"
        R1[Repository Pattern]
        V1[Validation Layer]
    end
    
    subgraph "ã‚¤ãƒ³ãƒ•ãƒ©å±¤"
        DB[Supabase PostgreSQL]
        LINE[LINE Messaging API]
        LIFF[LINE LIFF Platform]
    end
    
    U1 --> L1
    U2 --> W1
    L1 --> N1
    W1 --> N1
    N1 --> A1
    A1 --> M1
    M1 --> S1
    M1 --> S2
    M1 --> S3
    M1 --> S4
    S1 --> R1
    S2 --> R1
    S3 --> R1
    S4 --> R1
    R1 --> V1
    V1 --> DB
    S3 --> LINE
    L1 --> LIFF
```

### **ãƒ¬ã‚¤ãƒ¤ãƒ¼åˆ¥è²¬å‹™**

#### **1. ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³å±¤**
- **LINE LIFF App**: ãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘äºˆç´„ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
- **ç®¡ç†ç”»é¢Web App**: ç®¡ç†è€…å‘ã‘ç®¡ç†ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹

#### **2. ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤**
- **Next.js App Router**: ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã¨ãƒšãƒ¼ã‚¸ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
- **API Routes**: RESTful API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
- **Middleware**: èªè¨¼ãƒ»èªå¯ãƒ»ãƒ­ã‚°ãƒ»ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

#### **3. ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯å±¤**
- **äºˆç´„ã‚µãƒ¼ãƒ“ã‚¹**: äºˆç´„ä½œæˆãƒ»å¤‰æ›´ãƒ»ã‚­ãƒ£ãƒ³ã‚»ãƒ«
- **å•†å“ç®¡ç†ã‚µãƒ¼ãƒ“ã‚¹**: å•†å“CRUDãƒ»CSVå‡¦ç†
- **é€šçŸ¥ã‚µãƒ¼ãƒ“ã‚¹**: LINEé€šçŸ¥ãƒ»ãƒ¡ãƒ¼ãƒ«é€šçŸ¥
- **èªè¨¼ã‚µãƒ¼ãƒ“ã‚¹**: ç®¡ç†è€…èªè¨¼ãƒ»ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†

#### **4. ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹å±¤**
- **Repository Pattern**: ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹ã®æŠ½è±¡åŒ–
- **Validation Layer**: å…¥åŠ›å€¤æ¤œè¨¼ãƒ»ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§

#### **5. ã‚¤ãƒ³ãƒ•ãƒ©å±¤**
- **Supabase PostgreSQL**: ãƒ¡ã‚¤ãƒ³ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
- **LINE Messaging API**: é€šçŸ¥é€ä¿¡
- **LINE LIFF Platform**: LINEå†…ãƒ–ãƒ©ã‚¦ã‚¶

## ğŸ—„ï¸ **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ**

### **å®Œå…¨ERå›³**

```mermaid
erDiagram
    products {
        int id PK
        string product_code UK
        string name
        int variation_id
        string variation_name
        enum tax_type
        int price
        string barcode
        boolean visible
        int display_order
        timestamp created_at
        timestamp updated_at
    }
    
    product_presets {
        int id PK
        string preset_name
        text description
        timestamp form_expiry_date
        boolean is_active
        timestamp created_at
        timestamp updated_at
    }
    
    preset_products {
        int id PK
        int preset_id FK
        int product_id FK
        timestamp start_date
        timestamp end_date
        int display_order
        boolean is_active
        timestamp created_at
        timestamp updated_at
    }
    
    form_settings {
        int id PK
        int preset_id FK
        boolean show_name
        boolean show_furigana
        boolean show_gender
        boolean show_birthday
        boolean show_phone
        boolean show_zip
        boolean show_address1
        boolean show_address2
        boolean show_comment
        boolean show_price
        boolean show_total
        boolean require_phone
        boolean require_furigana
        boolean allow_note
        boolean enable_birthday
        boolean enable_gender
        boolean require_address
        boolean enable_furigana
        boolean is_enabled
        text custom_message
        timestamp created_at
        timestamp updated_at
    }
    
    reservations {
        uuid id PK
        int preset_id FK
        string reservation_number UK
        string user_name
        string furigana
        enum gender
        date birthday
        string phone_number
        string zip_code
        string address1
        string address2
        text comment
        jsonb selected_products
        timestamp pickup_date
        int total_amount
        enum status
        string line_user_id
        string cancel_token UK
        timestamp created_at
        timestamp updated_at
    }
    
    reservation_history {
        uuid id PK
        int preset_id
        string user_name
        string furigana
        enum gender
        date birthday
        string phone_number
        string zip_code
        string address1
        string address2
        text comment
        jsonb selected_products
        timestamp pickup_date
        int total_amount
        enum original_status
        string line_user_id
        timestamp original_created_at
        timestamp original_updated_at
        timestamp moved_to_history_at
    }
    
    pickup_windows {
        int id PK
        int preset_id FK
        timestamp start_date
        timestamp end_date
        string start_time
        string end_time
        int available_slots
        boolean is_available
        timestamp created_at
        timestamp updated_at
    }
    
    admin_users {
        int id PK
        string username UK
        string password_hash
        boolean is_active
        timestamp last_login_at
        timestamp created_at
        timestamp updated_at
    }
    
    notification_logs {
        uuid id PK
        string user_id
        string type
        jsonb message
        timestamp sent_at
        timestamp created_at
    }
    
    product_presets ||--o{ preset_products : "has"
    products ||--o{ preset_products : "includes"
    product_presets ||--|| form_settings : "configures"
    product_presets ||--o{ pickup_windows : "defines"
    product_presets ||--o{ reservations : "receives"
    reservations ||--o{ notification_logs : "generates"
```

### **ãƒ†ãƒ¼ãƒ–ãƒ«è©³ç´°ä»•æ§˜**

#### **productsï¼ˆå•†å“ãƒã‚¹ã‚¿ï¼‰**
```sql
CREATE TABLE products (
    id SERIAL PRIMARY KEY,
    product_code TEXT UNIQUE,                    -- å•†å“ã‚³ãƒ¼ãƒ‰ï¼ˆä»»æ„ï¼‰
    name TEXT NOT NULL,                          -- å•†å“å
    variation_id INTEGER DEFAULT 1,              -- ãƒãƒªã‚¨ãƒ¼ã‚·ãƒ§ãƒ³ID
    variation_name TEXT DEFAULT 'é€šå¸¸ä¾¡æ ¼',       -- ãƒãƒªã‚¨ãƒ¼ã‚·ãƒ§ãƒ³å
    tax_type VARCHAR(10) NOT NULL DEFAULT 'å†…ç¨' CHECK (tax_type IN ('å†…ç¨', 'å¤–ç¨')),
    price INTEGER NOT NULL DEFAULT 0,            -- ä¾¡æ ¼ï¼ˆå††ï¼‰
    barcode TEXT,                                -- ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ï¼ˆä»»æ„ï¼‰
    visible BOOLEAN NOT NULL DEFAULT true,       -- è¡¨ç¤ºãƒ•ãƒ©ã‚°
    display_order INTEGER DEFAULT 0,             -- è¡¨ç¤ºé †
    created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT NOW(),
    
    -- åˆ¶ç´„
    CONSTRAINT products_name_check CHECK (length(name) > 0),
    CONSTRAINT products_price_check CHECK (price >= 0),
    CONSTRAINT products_display_order_check CHECK (display_order >= 0)
);

-- ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
CREATE INDEX idx_products_visible_order ON products(visible, display_order) WHERE visible = true;
CREATE INDEX idx_products_name_search ON products USING gin(to_tsvector('japanese', name));
CREATE INDEX idx_products_variation ON products(name, variation_id);
```

#### **product_presetsï¼ˆãƒ•ã‚©ãƒ¼ãƒ è¨­å®šï¼‰**
```sql
CREATE TABLE product_presets (
    id SERIAL PRIMARY KEY,
    preset_name TEXT NOT NULL,                   -- ãƒ•ã‚©ãƒ¼ãƒ å
    description TEXT,                            -- èª¬æ˜
    form_expiry_date TIMESTAMP WITH TIME ZONE,   -- ãƒ•ã‚©ãƒ¼ãƒ æœ‰åŠ¹æœŸé™
    is_active BOOLEAN NOT NULL DEFAULT true,     -- æœ‰åŠ¹ãƒ•ãƒ©ã‚°
    created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT NOW(),
    
    -- åˆ¶ç´„
    CONSTRAINT presets_name_check CHECK (length(preset_name) > 0)
);

-- ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
CREATE INDEX idx_presets_active ON product_presets(is_active, form_expiry_date) WHERE is_active = true;
```

#### **preset_productsï¼ˆãƒ—ãƒªã‚»ãƒƒãƒˆå•†å“é–¢é€£ï¼‰**
```sql
CREATE TABLE preset_products (
    id SERIAL PRIMARY KEY,
    preset_id INTEGER NOT NULL REFERENCES product_presets(id) ON DELETE CASCADE,
    product_id INTEGER NOT NULL REFERENCES products(id) ON DELETE CASCADE,
    start_date TIMESTAMP WITH TIME ZONE NOT NULL, -- å¼•ãå–ã‚Šé–‹å§‹æ—¥
    end_date TIMESTAMP WITH TIME ZONE NOT NULL,   -- å¼•ãå–ã‚Šçµ‚äº†æ—¥
    display_order INTEGER NOT NULL DEFAULT 0,     -- è¡¨ç¤ºé †
    is_active BOOLEAN NOT NULL DEFAULT true,       -- æœ‰åŠ¹ãƒ•ãƒ©ã‚°
    created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT NOW(),
    
    -- åˆ¶ç´„
    UNIQUE(preset_id, product_id),
    CONSTRAINT preset_products_dates_check CHECK (start_date < end_date),
    CONSTRAINT preset_products_display_order_check CHECK (display_order >= 0)
);

-- ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
CREATE INDEX idx_preset_products_preset ON preset_products(preset_id, display_order) WHERE is_active = true;
CREATE INDEX idx_preset_products_dates ON preset_products(start_date, end_date) WHERE is_active = true;
```

#### **form_settingsï¼ˆãƒ•ã‚©ãƒ¼ãƒ è¡¨ç¤ºè¨­å®šï¼‰**
```sql
CREATE TABLE form_settings (
    id SERIAL PRIMARY KEY,
    preset_id INTEGER NOT NULL REFERENCES product_presets(id) ON DELETE CASCADE,
    
    -- æ–°ã—ã„è¡¨ç¤ºé …ç›®è¨­å®š
    show_name BOOLEAN NOT NULL DEFAULT true,
    show_furigana BOOLEAN NOT NULL DEFAULT true,
    show_gender BOOLEAN NOT NULL DEFAULT false,
    show_birthday BOOLEAN NOT NULL DEFAULT false,
    show_phone BOOLEAN NOT NULL DEFAULT true,
    show_zip BOOLEAN NOT NULL DEFAULT false,
    show_address1 BOOLEAN NOT NULL DEFAULT false,
    show_address2 BOOLEAN NOT NULL DEFAULT false,
    show_comment BOOLEAN NOT NULL DEFAULT true,
    show_price BOOLEAN NOT NULL DEFAULT true,
    show_total BOOLEAN NOT NULL DEFAULT true,
    
    -- äº’æ›æ€§ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ï¼ˆæ—¢å­˜ã‚³ãƒ¼ãƒ‰ã¨ã®äº’æ›æ€§ç¶­æŒï¼‰
    require_phone BOOLEAN NOT NULL DEFAULT true,
    require_furigana BOOLEAN NOT NULL DEFAULT false,
    allow_note BOOLEAN NOT NULL DEFAULT true,
    enable_birthday BOOLEAN NOT NULL DEFAULT false,
    enable_gender BOOLEAN NOT NULL DEFAULT false,
    require_address BOOLEAN NOT NULL DEFAULT false,
    enable_furigana BOOLEAN NOT NULL DEFAULT true,
    
    -- ã‚·ã‚¹ãƒ†ãƒ è¨­å®š
    is_enabled BOOLEAN NOT NULL DEFAULT true,
    custom_message TEXT,
    
    created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT NOW(),
    
    -- åˆ¶ç´„
    UNIQUE(preset_id)
);

-- ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
CREATE INDEX idx_form_settings_enabled ON form_settings(preset_id) WHERE is_enabled = true;
```

#### **reservationsï¼ˆäºˆç´„ãƒ‡ãƒ¼ã‚¿ï¼‰**
```sql
CREATE TABLE reservations (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    preset_id INTEGER NOT NULL REFERENCES product_presets(id) ON DELETE RESTRICT,
    reservation_number TEXT UNIQUE NOT NULL DEFAULT ('R' || to_char(NOW(), 'YYYYMMDD') || '-' || LPAD(nextval('reservation_seq')::text, 4, '0')),
    
    -- é¡§å®¢æƒ…å ±
    user_name TEXT NOT NULL,
    furigana TEXT,
    gender VARCHAR(10) CHECK (gender IN ('ç”·æ€§', 'å¥³æ€§', 'ãã®ä»–')),
    birthday DATE,
    phone_number TEXT NOT NULL,
    zip_code TEXT,
    address1 TEXT,
    address2 TEXT,
    comment TEXT,
    
    -- äºˆç´„æƒ…å ±
    selected_products JSONB NOT NULL,
    pickup_date TIMESTAMP WITH TIME ZONE,
    total_amount INTEGER NOT NULL DEFAULT 0,
    
    -- ã‚·ã‚¹ãƒ†ãƒ æƒ…å ±
    status VARCHAR(20) NOT NULL DEFAULT 'confirmed' CHECK (status IN ('pending', 'confirmed', 'cancelled', 'completed')),
    line_user_id TEXT,
    cancel_token TEXT UNIQUE,
    
    created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT NOW(),
    
    -- åˆ¶ç´„
    CONSTRAINT reservations_user_name_check CHECK (length(user_name) > 0),
    CONSTRAINT reservations_phone_check CHECK (length(phone_number) > 0),
    CONSTRAINT reservations_total_check CHECK (total_amount >= 0)
);

-- ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ä½œæˆ
CREATE SEQUENCE reservation_seq START 1;

-- ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
CREATE INDEX idx_reservations_preset_status ON reservations(preset_id, status, created_at);
CREATE INDEX idx_reservations_phone ON reservations(phone_number, created_at);
CREATE INDEX idx_reservations_cancel_token ON reservations(cancel_token) WHERE cancel_token IS NOT NULL;
CREATE INDEX idx_reservations_line_user ON reservations(line_user_id) WHERE line_user_id IS NOT NULL;
CREATE INDEX idx_reservations_pickup_date ON reservations(pickup_date) WHERE pickup_date IS NOT NULL;
```

### **âœ… å®Ÿè£…æ¸ˆã¿æ©Ÿèƒ½**

#### **1. å®Œå…¨å®Ÿè£…æ¸ˆã¿**
- âœ… **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ§‹é€ **: çµ±ä¸€ã•ã‚ŒãŸã‚¹ã‚­ãƒ¼ãƒè¨­è¨ˆ
- âœ… **å‹å®šç¾©ã‚·ã‚¹ãƒ†ãƒ **: TypeScriptå®Œå…¨å¯¾å¿œ
- âœ… **èªè¨¼ã‚·ã‚¹ãƒ†ãƒ **: ç®¡ç†è€…ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰èªè¨¼
- âœ… **LIFFçµ±åˆ**: LINEå†…ãƒ–ãƒ©ã‚¦ã‚¶å¯¾å¿œ
- âœ… **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**: çµ±ä¸€ã‚¨ãƒ©ãƒ¼å‡¦ç†
- âœ… **ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³**: Zodå®Œå…¨å¯¾å¿œ

#### **2. API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆå®Œå…¨å®Ÿè£…**

##### **ãƒ•ã‚©ãƒ¼ãƒ ãƒ»ãƒ—ãƒªã‚»ãƒƒãƒˆé–¢é€£API**
```typescript
// âœ… å®Œå…¨å®Ÿè£…æ¸ˆã¿
GET    /api/presets/[presetId]/config           // ãƒ•ã‚©ãƒ¼ãƒ è¨­å®šå–å¾—
PUT    /api/presets/[presetId]/config           // ãƒ•ã‚©ãƒ¼ãƒ è¨­å®šæ›´æ–°
GET    /api/presets                             // ãƒ—ãƒªã‚»ãƒƒãƒˆä¸€è¦§å–å¾—
POST   /api/presets                             // ãƒ—ãƒªã‚»ãƒƒãƒˆä½œæˆ
PUT    /api/presets/[presetId]                  // ãƒ—ãƒªã‚»ãƒƒãƒˆæ›´æ–°
DELETE /api/presets/[presetId]                  // ãƒ—ãƒªã‚»ãƒƒãƒˆå‰Šé™¤
```

##### **äºˆç´„é–¢é€£API**
```typescript
// âœ… å®Œå…¨å®Ÿè£…æ¸ˆã¿
POST   /api/reservations                        // äºˆç´„ä½œæˆ
GET    /api/reservations                        // äºˆç´„ä¸€è¦§å–å¾—ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ç”¨ï¼‰
GET    /api/reservations/[reservationId]        // äºˆç´„è©³ç´°å–å¾—
PUT    /api/reservations/[reservationId]        // äºˆç´„æ›´æ–°
DELETE /api/reservations/[reservationId]        // äºˆç´„ã‚­ãƒ£ãƒ³ã‚»ãƒ«
```

##### **ç®¡ç†ç”»é¢API**
```typescript
// âœ… å®Œå…¨å®Ÿè£…æ¸ˆã¿
GET    /api/admin/dashboard                     // ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿
GET    /api/admin/reservations                  // äºˆç´„ç®¡ç†ä¸€è¦§
PUT    /api/admin/reservations/[id]/status      // äºˆç´„ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°
GET    /api/admin/products                      // å•†å“ä¸€è¦§å–å¾—
POST   /api/admin/products                      // å•†å“ä½œæˆ
PUT    /api/admin/products/[productId]          // å•†å“æ›´æ–°
DELETE /api/admin/products/[productId]          // å•†å“å‰Šé™¤
POST   /api/admin/products/import               // CSVä¸€æ‹¬ç™»éŒ²
GET    /api/admin/products/import               // CSVãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆDL
POST   /api/admin/products/import-pos           // POS CSVç™»éŒ²
GET    /api/admin/products/import-pos           // POS CSVãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆDL
```

##### **LINEé€£æºAPI**
```typescript
// âœ… å®Œå…¨å®Ÿè£…æ¸ˆã¿
POST   /api/line/webhook                        // LINE Webhook
POST   /api/line/notify                         // LINEé€šçŸ¥é€ä¿¡
GET    /api/line/profile/[userId]               // LINEãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«å–å¾—
```

##### **ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£API**
```typescript
// âœ… å®Œå…¨å®Ÿè£…æ¸ˆã¿
GET    /api/health                              // ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
GET    /api/debug/presets                       // ãƒ‡ãƒãƒƒã‚°ç”¨ãƒ—ãƒªã‚»ãƒƒãƒˆæƒ…å ±
GET    /api/debug/database                      // ãƒ‡ãƒãƒƒã‚°ç”¨DBæƒ…å ±
```

#### **3. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ç”»é¢å®Œå…¨å®Ÿè£…**

##### **ãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘ç”»é¢ï¼ˆLINE LIFFï¼‰**
```
âœ… å®Œå…¨å®Ÿè£…æ¸ˆã¿:
â”œâ”€â”€ /form/[presetId]                    # äºˆç´„ãƒ•ã‚©ãƒ¼ãƒ ï¼ˆå…¥åŠ›ç”»é¢ï¼‰
â”‚   â”œâ”€â”€ UserInfoSection                 # é¡§å®¢æƒ…å ±å…¥åŠ›
â”‚   â”œâ”€â”€ ProductSelectionSection         # å•†å“é¸æŠ
â”‚   â””â”€â”€ PickupDateSection              # å¼•ãå–ã‚Šæ—¥é¸æŠ
â”œâ”€â”€ /confirm/[presetId]                 # ç¢ºèªç”»é¢
â”‚   â”œâ”€â”€ å…¥åŠ›å†…å®¹ç¢ºèª                     # å…¨é …ç›®è¡¨ç¤º
â”‚   â”œâ”€â”€ åˆ©ç”¨è¦ç´„åŒæ„                     # ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹
â”‚   â””â”€â”€ äºˆç´„ç¢ºå®šãƒœã‚¿ãƒ³                   # æœ€çµ‚é€ä¿¡
â”œâ”€â”€ /complete/[presetId]                # å®Œäº†ç”»é¢
â”‚   â”œâ”€â”€ äºˆç´„å®Œäº†ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸               # æˆåŠŸè¡¨ç¤º
â”‚   â”œâ”€â”€ äºˆç´„è©³ç´°è¡¨ç¤º                     # äºˆç´„å†…å®¹
â”‚   â”œâ”€â”€ LINEãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡               # è‡ªå‹•é€šçŸ¥
â”‚   â””â”€â”€ è‡ªå‹•ã‚¯ãƒ­ãƒ¼ã‚ºæ©Ÿèƒ½                 # 10ç§’å¾Œé–‰ã˜ã‚‹
â””â”€â”€ /cancel/[reservationId]             # ã‚­ãƒ£ãƒ³ã‚»ãƒ«ãƒ»å¤‰æ›´ç”»é¢
    â”œâ”€â”€ é›»è©±ç•ªå·èªè¨¼                     # ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£
    â”œâ”€â”€ äºˆç´„è©³ç´°è¡¨ç¤º                     # ç¾åœ¨ã®äºˆç´„å†…å®¹
    â”œâ”€â”€ å¤‰æ›´ãƒ•ã‚©ãƒ¼ãƒ                      # ç·¨é›†å¯èƒ½é …ç›®
    â””â”€â”€ ã‚­ãƒ£ãƒ³ã‚»ãƒ«æ©Ÿèƒ½                   # å®Œå…¨å‰Šé™¤
```

##### **ç®¡ç†è€…å‘ã‘ç”»é¢ï¼ˆWebï¼‰**
```
âœ… å®Œå…¨å®Ÿè£…æ¸ˆã¿:
â”œâ”€â”€ /admin                              # ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
â”‚   â”œâ”€â”€ äºˆç´„çµ±è¨ˆ                         # ä»Šæ—¥ãƒ»é€±ãƒ»æœˆã®äºˆç´„æ•°
â”‚   â”œâ”€â”€ æœ€è¿‘ã®äºˆç´„ä¸€è¦§                   # æœ€æ–°50ä»¶
â”‚   â”œâ”€â”€ å£²ä¸Šã‚µãƒãƒªãƒ¼                     # åˆè¨ˆå£²ä¸Š
â”‚   â””â”€â”€ ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ…‹                     # ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
â”œâ”€â”€ /admin/products                     # å•†å“ç®¡ç†
â”‚   â”œâ”€â”€ å•†å“ä¸€è¦§                         # ãƒšãƒ¼ã‚¸ãƒ³ã‚°å¯¾å¿œ
â”‚   â”œâ”€â”€ æ¤œç´¢ãƒ»ãƒ•ã‚£ãƒ«ã‚¿                   # åå‰ãƒ»ä¾¡æ ¼ãƒ»ç¨åŒºåˆ†
â”‚   â”œâ”€â”€ å•†å“ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ«                 # ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ç·¨é›†
â”‚   â”œâ”€â”€ å•†å“å‰Šé™¤æ©Ÿèƒ½                     # ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°
â”‚   â”œâ”€â”€ CSVä¸€æ‹¬ç™»éŒ²                      # æ¨™æº–ãƒ»POSå¯¾å¿œ
â”‚   â””â”€â”€ CSVãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆDL                # å½¢å¼ã‚µãƒ³ãƒ—ãƒ«
â”œâ”€â”€ /admin/reservations                 # äºˆç´„ç®¡ç†
â”‚   â”œâ”€â”€ äºˆç´„ä¸€è¦§                         # å…¨äºˆç´„è¡¨ç¤º
â”‚   â”œâ”€â”€ ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç®¡ç†                   # ç¢ºå®šãƒ»å®Œäº†ãƒ»ã‚­ãƒ£ãƒ³ã‚»ãƒ«
â”‚   â”œâ”€â”€ è©³ç´°æ¤œç´¢                         # æ—¥ä»˜ãƒ»é¡§å®¢ãƒ»å•†å“
â”‚   â””â”€â”€ ä¸€æ‹¬æ“ä½œ                         # è¤‡æ•°é¸æŠå¯¾å¿œ
â”œâ”€â”€ /admin/settings                     # ã‚·ã‚¹ãƒ†ãƒ è¨­å®š
â”‚   â”œâ”€â”€ ãƒ—ãƒªã‚»ãƒƒãƒˆç®¡ç†                   # ãƒ•ã‚©ãƒ¼ãƒ è¨­å®š
â”‚   â”œâ”€â”€ è¡¨ç¤ºé …ç›®è¨­å®š                     # å‹•çš„ãƒ•ã‚©ãƒ¼ãƒ 
â”‚   â”œâ”€â”€ å¼•ãå–ã‚ŠæœŸé–“è¨­å®š                 # å•†å“åˆ¥æœŸé–“
â”‚   â””â”€â”€ LINEé€£æºè¨­å®š                     # é€šçŸ¥è¨­å®š
â””â”€â”€ /admin/preview/[presetId]           # ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼æ©Ÿèƒ½
    â””â”€â”€ ãƒ•ã‚©ãƒ¼ãƒ å‹•ä½œç¢ºèª                 # å®Ÿéš›ã®è¡¨ç¤ºç¢ºèª
```

#### **4. LINEé€£æºæ©Ÿèƒ½å®Œå…¨å®Ÿè£…**

##### **LIFFçµ±åˆ**
```typescript
// âœ… å®Œå…¨å®Ÿè£…æ¸ˆã¿
interface LiffIntegration {
  // åˆæœŸåŒ–ãƒ»èªè¨¼
  initialization: {
    liffId: string;                    // ç’°å¢ƒå¤‰æ•°ç®¡ç†
    withLoginOnExternalBrowser: false; // LINEå†…ã®ã¿
    autoClose: true;                   // å®Œäº†å¾Œè‡ªå‹•ã‚¯ãƒ­ãƒ¼ã‚º
  };
  
  // ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç®¡ç†
  profile: {
    userId: string;                    // LINEå›ºæœ‰ID
    displayName: string;               // è¡¨ç¤ºå
    pictureUrl?: string;               // ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»åƒ
    statusMessage?: string;            // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹
  };
  
  // ç’°å¢ƒåˆ¤å®š
  environment: {
    isInClient: boolean;               // LINEã‚¢ãƒ—ãƒªå†…åˆ¤å®š
    isInBrowser: boolean;              // å¤–éƒ¨ãƒ–ãƒ©ã‚¦ã‚¶åˆ¤å®š
    os: 'ios' | 'android' | 'web';     // OSåˆ¤å®š
    language: string;                  // è¨€èªè¨­å®š
  };
  
  // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡
  messaging: {
    sendMessages: (messages: LineMessage[]) => Promise<void>;
    shareTargetPicker: (messages: LineMessage[]) => Promise<void>;
  };
  
  // ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦åˆ¶å¾¡
  window: {
    close: () => void;                 // ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚¯ãƒ­ãƒ¼ã‚º
    openExternalWindow: (url: string) => void; // å¤–éƒ¨ãƒªãƒ³ã‚¯
  };
}
```

##### **LINEé€šçŸ¥ã‚·ã‚¹ãƒ†ãƒ **
```typescript
// âœ… å®Œå…¨å®Ÿè£…æ¸ˆã¿
interface LineNotificationSystem {
  // é€šçŸ¥ã‚¿ã‚¤ãƒ—
  types: {
    confirmation: 'äºˆç´„ç¢ºèª';          // äºˆç´„å®Œäº†æ™‚
    reminder: 'ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼';          // å‰æ—¥é€šçŸ¥
    cancellation: 'ã‚­ãƒ£ãƒ³ã‚»ãƒ«é€šçŸ¥';    // ã‚­ãƒ£ãƒ³ã‚»ãƒ«æ™‚
    modification: 'å¤‰æ›´é€šçŸ¥';          // å†…å®¹å¤‰æ›´æ™‚
    completion: 'å®Œäº†é€šçŸ¥';            // å—å–å®Œäº†æ™‚
  };
  
  // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
  templates: {
    flexMessage: FlexMessageTemplate;  // ãƒªãƒƒãƒãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
    textMessage: TextMessageTemplate;  // ãƒ†ã‚­ã‚¹ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
    imageMessage: ImageMessageTemplate; // ç”»åƒãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
  };
  
  // é€ä¿¡æ©Ÿèƒ½
  delivery: {
    push: (userId: string, messages: LineMessage[]) => Promise<void>;
    multicast: (userIds: string[], messages: LineMessage[]) => Promise<void>;
    broadcast: (messages: LineMessage[]) => Promise<void>;
  };
  
  // ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
  errorHandling: {
    retry: number;                     // ãƒªãƒˆãƒ©ã‚¤å›æ•°
    fallback: 'email' | 'sms';         // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æ‰‹æ®µ
    logging: boolean;                  // ãƒ­ã‚°è¨˜éŒ²
  };
}
```

##### **Flexãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ**
```typescript
// âœ… å®Œå…¨å®Ÿè£…æ¸ˆã¿
interface FlexMessageTemplates {
  // äºˆç´„ç¢ºèªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
  reservationConfirmation: {
    header: 'âœ… äºˆç´„ç¢ºèª';
    customerInfo: CustomerInfoSection;
    orderDetails: OrderDetailsSection;
    pickupInfo: PickupInfoSection;
    totalAmount: TotalAmountSection;
    actions: [
      { type: 'uri', label: 'äºˆç´„è©³ç´°ã‚’ç¢ºèª', uri: string },
      { type: 'uri', label: 'å¤‰æ›´ãƒ»ã‚­ãƒ£ãƒ³ã‚»ãƒ«', uri: string }
    ];
  };
  
  // ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
  reminder: {
    header: 'ğŸ”” å—å–ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼';
    pickupDate: string;
    pickupTime: string;
    location: LocationInfo;
    contact: ContactInfo;
    actions: [
      { type: 'uri', label: 'å—å–å ´æ‰€ã‚’ç¢ºèª', uri: string }
    ];
  };
  
  // ã‚­ãƒ£ãƒ³ã‚»ãƒ«é€šçŸ¥
  cancellation: {
    header: 'âŒ äºˆç´„ã‚­ãƒ£ãƒ³ã‚»ãƒ«';
    cancelledItems: CancelledItemsSection;
    refundInfo: RefundInfoSection;
    actions: [
      { type: 'uri', label: 'æ–°ã—ãäºˆç´„ã™ã‚‹', uri: string }
    ];
  };
}
```

### **âš ï¸ ç·Šæ€¥ä¿®æ­£ãŒå¿…è¦ãªå•é¡Œ**

#### **1. totalItemsã‚¨ãƒ©ãƒ¼**
**ç™ºç”Ÿç®‡æ‰€**: `src/components/admin/products/ProductsContainer.tsx`  
**åŸå› **: APIãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®`pagination`ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒ`undefined`ã®å ´åˆã®æœªå¯¾å¿œ

**ä¿®æ­£å†…å®¹**:
```typescript
// ä¿®æ­£å‰ï¼ˆã‚¨ãƒ©ãƒ¼ã®åŸå› ï¼‰
if (data.pagination) {
  setPagination(data.pagination);
}

// ä¿®æ­£å¾Œï¼ˆå®‰å…¨ãªã‚¢ã‚¯ã‚»ã‚¹ï¼‰
if (data.pagination) {
  setPagination(data.pagination);
} else {
  // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’è¨­å®š
  setPagination({
    page: 1,
    limit: 20,
    totalItems: (data.data || []).length,
    totalPages: 1,
    hasNextPage: false,
    hasPreviousPage: false
  });
}
```

#### **2. LIFFæ©Ÿèƒ½ã®åˆ†é›¢**
**å•é¡Œ**: ç®¡ç†ç”»é¢ã§ã‚‚LIFFåˆæœŸåŒ–ãŒå®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹  
**ä¿®æ­£**: ç®¡ç†ç”»é¢ã§ã¯ LIFF æ©Ÿèƒ½ã‚’ç„¡åŠ¹åŒ–

```typescript
// LiffProvider.tsx ã®ä¿®æ­£
const isAdminPage = typeof window !== 'undefined' && 
  window.location.pathname.startsWith('/admin');

if (isAdminPage) {
  // ç®¡ç†ç”»é¢ã§ã¯ LIFF åˆæœŸåŒ–ã‚’ã‚¹ã‚­ãƒƒãƒ—
  setIsReady(true);
  return;
}
```

## ğŸ”§ **æŠ€è¡“ä»•æ§˜**

### **1. æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯**
```json
{
  "frontend": "Next.js 15.4.3 (App Router)",
  "backend": "Next.js API Routes",
  "database": "Supabase PostgreSQL",
  "authentication": "ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰èªè¨¼ï¼ˆç®¡ç†ç”»é¢ï¼‰",
  "line_integration": "LINE LIFF SDK 2.27.1",
  "styling": "Tailwind CSS 4.0",
  "state_management": "Zustand 5.0.6",
  "form_handling": "React Hook Form 7.61.0",
  "validation": "Zod 4.0.8"
}
```

### **2. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ**

#### **çµ±ä¸€å‹å®šç¾©**
```typescript
// src/types/database.ts - æ–°ã—ã„çµ±ä¸€å‹å®šç¾©
export interface Product {
  readonly id: number;
  readonly product_code?: string;
  readonly name: string;
  readonly variation_id: number;
  readonly variation_name: string;
  readonly tax_type: 'å†…ç¨' | 'å¤–ç¨';
  readonly price: number;
  readonly barcode?: string;
  readonly visible: boolean;
  readonly display_order: number;
  readonly created_at: string;
  readonly updated_at: string;
}

export interface ProductPreset {
  readonly id: number;
  readonly preset_name: string;
  readonly description?: string;
  readonly form_expiry_date?: string;
  readonly is_active: boolean;
  readonly created_at: string;
  readonly updated_at: string;
}

export interface Reservation {
  readonly id: string;
  readonly preset_id: number;
  readonly user_name: string;
  readonly phone_number: string;
  readonly selected_products: SelectedProduct[];
  readonly total_amount: number;
  readonly status: ReservationStatus;
  readonly created_at: string;
  readonly updated_at: string;
}
```

#### **äº’æ›æ€§å¯¾å¿œ**
```typescript
// src/types/index.ts - æ—¢å­˜ã‚³ãƒ¼ãƒ‰ã¨ã®äº’æ›æ€§ç¶­æŒ
export interface Product extends DatabaseProduct {
  // æ—¢å­˜ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¨ã®äº’æ›æ€§
  external_id?: string;
  category_id?: number;
  // ... ãã®ä»–ã®äº’æ›æ€§ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
}
```

### **3. APIè¨­è¨ˆ**

#### **çµ±ä¸€ãƒ¬ã‚¹ãƒãƒ³ã‚¹å½¢å¼**
```typescript
interface ApiResponse<T> {
  success: boolean;
  data?: T;
  error?: string;
  message?: string;
}

interface PaginatedResponse<T> extends ApiResponse<T[]> {
  total: number;
  page: number;
  per_page: number;
  total_pages: number;
}
```

#### **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**
```typescript
// src/lib/utils/apiErrorHandler.ts
export function handleApiError(error: unknown): NextResponse {
  if (error instanceof ValidationError) {
    return NextResponse.json({ error: error.message }, { status: 400 });
  }
  if (error instanceof NotFoundError) {
    return NextResponse.json({ error: error.message }, { status: 404 });
  }
  return NextResponse.json({ error: 'Internal server error' }, { status: 500 });
}
```

## ğŸ¨ **ç”»é¢è¨­è¨ˆ**

### **1. äºˆç´„ãƒ•ã‚©ãƒ¼ãƒ ç³»ï¼ˆLINEé€£æºï¼‰**

#### **ç”»é¢é·ç§»**
```
LINE â†’ /form/[presetId] â†’ /confirm/[presetId] â†’ /complete/[presetId]
                â†“
        /cancel/[reservationId] (å¤‰æ›´ãƒ»ã‚­ãƒ£ãƒ³ã‚»ãƒ«)
```

#### **ãƒ•ã‚©ãƒ¼ãƒ è¨­å®šé …ç›®**
```typescript
interface FormSettings {
  // è¡¨ç¤ºé …ç›®åˆ¶å¾¡
  show_name: boolean;           // æ°å
  show_furigana: boolean;       // ãƒ•ãƒªã‚¬ãƒŠ
  show_gender: boolean;         // æ€§åˆ¥
  show_birthday: boolean;       // ç”Ÿå¹´æœˆæ—¥
  show_phone: boolean;          // é›»è©±ç•ªå·
  show_zip: boolean;            // éƒµä¾¿ç•ªå·
  show_address1: boolean;       // ä½æ‰€1
  show_address2: boolean;       // ä½æ‰€2
  show_comment: boolean;        // ã‚³ãƒ¡ãƒ³ãƒˆæ¬„
  show_price: boolean;          // å•†å“ä¾¡æ ¼è¡¨ç¤º
  show_total: boolean;          // åˆè¨ˆé‡‘é¡è¡¨ç¤º
}
```

### **2. ç®¡ç†ç”»é¢ç³»ï¼ˆé€šå¸¸Webï¼‰**

#### **ç”»é¢æ§‹æˆ**
```
/admin                    # ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ï¼ˆäºˆç´„ä¸€è¦§ï¼‰
â”œâ”€â”€ /admin/products      # å•†å“ç®¡ç†
â”œâ”€â”€ /admin/reservations  # äºˆç´„ç®¡ç†ï¼ˆè©³ç´°ç‰ˆï¼‰
â””â”€â”€ /admin/settings      # ã‚·ã‚¹ãƒ†ãƒ è¨­å®š
```

#### **èªè¨¼æ–¹å¼**
- ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰èªè¨¼ã®ã¿
- LIFFæ©Ÿèƒ½ã¯ç„¡åŠ¹åŒ–
- ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†

## ğŸ”„ **ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼**

### **1. äºˆç´„ä½œæˆãƒ•ãƒ­ãƒ¼**
```mermaid
sequenceDiagram
    participant U as User (LINE)
    participant F as Form Page
    participant A as API
    participant D as Database
    participant L as LINE API

    U->>F: ãƒ•ã‚©ãƒ¼ãƒ ã‚¢ã‚¯ã‚»ã‚¹
    F->>A: GET /api/presets/{id}/config
    A->>D: ãƒ•ã‚©ãƒ¼ãƒ è¨­å®šå–å¾—
    D-->>A: è¨­å®šãƒ‡ãƒ¼ã‚¿
    A-->>F: ãƒ•ã‚©ãƒ¼ãƒ è¨­å®š
    F-->>U: å…¥åŠ›ç”»é¢è¡¨ç¤º
    
    U->>F: äºˆç´„æƒ…å ±å…¥åŠ›
    F->>A: POST /api/reservations
    A->>D: äºˆç´„ãƒ‡ãƒ¼ã‚¿ä¿å­˜
    A->>L: LINEé€šçŸ¥é€ä¿¡
    A-->>F: äºˆç´„å®Œäº†
    F-->>U: å®Œäº†ç”»é¢è¡¨ç¤º
```

### **2. ç®¡ç†ç”»é¢ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼**
```mermaid
sequenceDiagram
    participant A as Admin
    participant M as Management Page
    participant API as API
    participant D as Database

    A->>M: ç®¡ç†ç”»é¢ã‚¢ã‚¯ã‚»ã‚¹
    M->>API: GET /api/admin/dashboard
    API->>D: äºˆç´„ãƒ‡ãƒ¼ã‚¿å–å¾—
    D-->>API: äºˆç´„ä¸€è¦§
    API-->>M: ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿
    M-->>A: äºˆç´„ä¸€è¦§è¡¨ç¤º
```

## ğŸš¨ **ç·Šæ€¥å¯¾å¿œé …ç›®**

### **1. totalItemsã‚¨ãƒ©ãƒ¼ä¿®æ­£**
**å„ªå…ˆåº¦**: æœ€é«˜  
**å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«**: `src/components/admin/products/ProductsContainer.tsx`

```typescript
// ä¿®æ­£ã‚³ãƒ¼ãƒ‰
const loadProducts = async (page = 1, newFilters = filters) => {
  // ... existing code ...
  
  if (response.ok) {
    setProducts(data.data || []);
    
    // å®‰å…¨ãªpaginationè¨­å®š
    if (data.pagination && typeof data.pagination === 'object') {
      setPagination({
        page: data.pagination.page || 1,
        limit: data.pagination.limit || 20,
        totalItems: data.pagination.totalItems || 0,
        totalPages: data.pagination.totalPages || 1,
        hasNextPage: data.pagination.hasNextPage || false,
        hasPreviousPage: data.pagination.hasPreviousPage || false
      });
    } else {
      // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å€¤
      setPagination({
        page: 1,
        limit: 20,
        totalItems: (data.data || []).length,
        totalPages: 1,
        hasNextPage: false,
        hasPreviousPage: false
      });
    }
  }
};
```

### **2. LIFFæ©Ÿèƒ½åˆ†é›¢**
**å„ªå…ˆåº¦**: é«˜  
**å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«**: `src/components/line/LiffProvider.tsx`

```typescript
// ä¿®æ­£ã‚³ãƒ¼ãƒ‰
export const LiffProvider: React.FC<LiffProviderProps> = ({ children }) => {
  // ... existing state ...

  useEffect(() => {
    const initializeLiff = async () => {
      try {
        // ç®¡ç†ç”»é¢ãƒã‚§ãƒƒã‚¯
        const isAdminPage = typeof window !== 'undefined' && 
          window.location.pathname.startsWith('/admin');

        if (isAdminPage) {
          console.log('Admin page detected, skipping LIFF initialization');
          setIsReady(true);
          return;
        }

        // é€šå¸¸ã®LIFFåˆæœŸåŒ–å‡¦ç†
        // ... existing LIFF initialization code ...
      } catch (error) {
        // ... error handling ...
      }
    };

    initializeLiff();
  }, []);

  // ... rest of component ...
};
```

## ğŸ“Š **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–**

### **1. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æœ€é©åŒ–**
```sql
-- å¿…è¦ãªã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
CREATE INDEX idx_products_visible_order ON products(visible, display_order) WHERE visible = true;
CREATE INDEX idx_reservations_preset_status ON reservations(preset_id, status, created_at);
CREATE INDEX idx_preset_products_active ON preset_products(preset_id, is_active) WHERE is_active = true;
```

### **2. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰æœ€é©åŒ–**
```typescript
// é…å»¶èª­ã¿è¾¼ã¿
const ProductEditModal = lazy(() => import('./ProductEditModal'));
const ProductImportModal = lazy(() => import('./ProductImportModal'));

// ãƒ¡ãƒ¢åŒ–
const MemoizedProductTable = memo(ProductTable);
```

## ğŸ”’ **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä»•æ§˜**

### **1. èªè¨¼ãƒ»èªå¯**
- **ç®¡ç†ç”»é¢**: ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰èªè¨¼ + ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†
- **äºˆç´„å¤‰æ›´**: é›»è©±ç•ªå·èªè¨¼
- **API**: Service Role Keyä½¿ç”¨ï¼ˆRLSç„¡åŠ¹ï¼‰

### **2. ãƒ‡ãƒ¼ã‚¿ä¿è­·**
```typescript
// å…¥åŠ›å€¤ã‚µãƒ‹ã‚¿ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³
export const sanitizeInput = (input: string): string => {
  return input.trim().replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi, '');
};

// ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
const reservationSchema = z.object({
  user_name: z.string().min(1).max(100),
  phone_number: z.string().regex(/^[0-9-+()]+$/),
  total_amount: z.number().min(0)
});
```

## ğŸ§ª **ãƒ†ã‚¹ãƒˆæˆ¦ç•¥**

### **1. å˜ä½“ãƒ†ã‚¹ãƒˆ**
```typescript
// Jest + Testing Library
describe('ProductsContainer', () => {
  it('should handle pagination safely', () => {
    // totalItemsã‚¨ãƒ©ãƒ¼ã®ãƒ†ã‚¹ãƒˆ
  });
});
```

### **2. çµ±åˆãƒ†ã‚¹ãƒˆ**
```typescript
// API ãƒ†ã‚¹ãƒˆ
describe('/api/reservations', () => {
  it('should create reservation successfully', async () => {
    // äºˆç´„ä½œæˆã®ãƒ†ã‚¹ãƒˆ
  });
});
```

## ğŸ“ˆ **ç›£è¦–ãƒ»ãƒ­ã‚°**

### **1. ã‚¨ãƒ©ãƒ¼ç›£è¦–**
```typescript
// æ§‹é€ åŒ–ãƒ­ã‚°
export const logger = {
  error: (message: string, error?: Error, meta?: object) => {
    console.error(JSON.stringify({
      level: 'error',
      message,
      error: error?.message,
      stack: error?.stack,
      timestamp: new Date().toISOString(),
      ...meta
    }));
  }
};
```

### **2. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–**
```typescript
// Web Vitals
import { getCLS, getFID, getFCP, getLCP, getTTFB } from 'web-vitals';

getCLS(console.log);
getFID(console.log);
getFCP(console.log);
getLCP(console.log);
getTTFB(console.log);
```

## ğŸš€ **ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ»é‹ç”¨**

### **1. ç’°å¢ƒå¤‰æ•°**
```env
# å¿…é ˆç’°å¢ƒå¤‰æ•°
NEXT_PUBLIC_SUPABASE_URL=
NEXT_PUBLIC_SUPABASE_ANON_KEY=
SUPABASE_SERVICE_ROLE_KEY=
NEXT_PUBLIC_LIFF_ID=
LINE_MESSAGING_ACCESS_TOKEN=
LINE_MESSAGING_CHANNEL_SECRET=
NEXT_PUBLIC_BASE_URL=
```

### **2. ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯**
```typescript
// /api/health
export async function GET() {
  try {
    // ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šç¢ºèª
    const { data, error } = await supabase
      .from('products')
      .select('count')
      .limit(1);

    return NextResponse.json({
      status: 'healthy',
      timestamp: new Date().toISOString(),
      services: {
        database: error ? 'unhealthy' : 'healthy'
      }
    });
  } catch (error) {
    return NextResponse.json(
      { status: 'unhealthy', error: error.message },
      { status: 500 }
    );
  }
}
```

## ğŸ“ **ä»Šå¾Œã®æ‹¡å¼µäºˆå®š**

### **Phase 2 æ©Ÿèƒ½**
- [ ] äºˆç´„å¤‰æ›´ãƒ»ã‚­ãƒ£ãƒ³ã‚»ãƒ«æ©Ÿèƒ½ã®å®Œå…¨å®Ÿè£…
- [ ] LINEé€šçŸ¥ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®å……å®Ÿ
- [ ] äºˆç´„å±¥æ­´ã®è‡ªå‹•ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–

### **Phase 3 æ©Ÿèƒ½**
- [ ] é«˜åº¦ãªæ¤œç´¢ãƒ»ãƒ•ã‚£ãƒ«ã‚¿æ©Ÿèƒ½
- [ ] CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆæ©Ÿèƒ½
- [ ] ãƒ¬ãƒãƒ¼ãƒˆãƒ»åˆ†æãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
- [ ] å¤šè¨€èªå¯¾å¿œ

---

**ã“ã®ä»•æ§˜æ›¸ã¯2025å¹´8æœˆ29æ—¥æ™‚ç‚¹ã®å®Ÿè£…çŠ¶æ³ã«åŸºã¥ã„ã¦ä½œæˆã•ã‚Œã¦ãŠã‚Šã€æ®µéšçš„ãƒªãƒªãƒ¼ã‚¹ã«å‘ã‘ãŸå®Ÿè£…æŒ‡é‡ã¨ã—ã¦æ´»ç”¨ã—ã¦ãã ã•ã„ã€‚**