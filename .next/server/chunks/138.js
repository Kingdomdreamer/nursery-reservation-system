"use strict";exports.id=138,exports.ids=[138],exports.modules={2138:(e,s,a)=>{a.d(s,{Z:()=>c});var l=a(326),t=a(7577),i=a(5442),n=a(572);let c=()=>{let[e,s]=(0,t.useState)([]),[a,c]=(0,t.useState)(!0),[r,d]=(0,t.useState)(""),[o,m]=(0,t.useState)(!1),[x,h]=(0,t.useState)(null),[u,p]=(0,t.useState)(null),[j,b]=(0,t.useState)({name:"",furigana:"",email:"",phone:"",postal_code:"",prefecture:"",city:"",address:"",birth_date:"",gender:""}),[g,f]=(0,t.useState)({}),[N,v]=(0,t.useState)(!1);(0,t.useEffect)(()=>{y()},[]);let y=async()=>{c(!0);try{let{data:e,error:a}=await i.OQ.from("customers").select("*").order("created_at",{ascending:!1});if(a)throw a;s(e||[])}catch(e){console.error("顧客情報の取得に失敗しました:",e)}finally{c(!1)}},w=e.filter(e=>e.name.toLowerCase().includes(r.toLowerCase())||e.phone?.includes(r)||e.email?.toLowerCase().includes(r.toLowerCase())),C=()=>{let e={};return j.name.trim()||(e.name="氏名は必須です"),j.phone.trim()?/^[\d\-\+\(\)\s]+$/.test(j.phone)||(e.phone="有効な電話番号を入力してください"):e.phone="電話番号は必須です",j.email&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(j.email)&&(e.email="有効なメールアドレスを入力してください"),j.postal_code&&!/^\d{3}-?\d{4}$/.test(j.postal_code)&&(e.postal_code="有効な郵便番号を入力してください（例: 123-4567）"),f(e),0===Object.keys(e).length},_=async e=>{if(e.preventDefault(),C()){v(!0);try{let e={name:j.name.trim(),furigana:j.furigana.trim()||null,email:j.email.trim()||null,phone:j.phone.trim(),postal_code:j.postal_code.trim()||null,prefecture:j.prefecture.trim()||null,city:j.city.trim()||null,address:j.address.trim()||null,birth_date:j.birth_date||null,gender:j.gender||null,updated_at:new Date().toISOString()};if(x){let{error:s}=await i.OQ.from("customers").update(e).eq("id",x.id);if(s)throw s}else{let{error:s}=await i.OQ.from("customers").insert([e]);if(s)throw s}O(),y()}catch(e){console.error("顧客情報の保存に失敗しました:",e),alert("保存に失敗しました。もう一度お試しください。")}finally{v(!1)}}},k=e=>{h(e),b({name:e.name,furigana:e.furigana||"",email:e.email||"",phone:e.phone||"",postal_code:e.postal_code||"",prefecture:e.prefecture||"",city:e.city||"",address:e.address||"",birth_date:e.birth_date||"",gender:e.gender||""}),m(!0)},J=async()=>{if(u)try{let{error:e}=await i.OQ.from("customers").delete().eq("id",u.id);if(e)throw e;p(null),y()}catch(e){console.error("顧客情報の削除に失敗しました:",e),alert("削除に失敗しました。もう一度お試しください。")}},O=()=>{b({name:"",furigana:"",email:"",phone:"",postal_code:"",prefecture:"",city:"",address:"",birth_date:"",gender:""}),f({}),h(null),m(!1)},$=e=>s=>{b({...j,[e]:s.target.value}),g[e]&&f({...g,[e]:""})};return(0,l.jsxs)("div",{children:[l.jsx("div",{className:"row mb-4",children:l.jsx("div",{className:"col-12",children:(0,l.jsxs)("div",{className:"d-flex justify-content-between align-items-center",children:[(0,l.jsxs)("div",{children:[l.jsx("h2",{className:"h2 fw-bold text-dark",children:"顧客管理"}),l.jsx("p",{className:"text-muted",children:"顧客情報の一覧・追加・編集・削除"})]}),(0,l.jsxs)("button",{onClick:()=>m(!0),className:"btn btn-primary",children:[l.jsx("i",{className:"bi bi-person-plus me-2"}),"新規顧客追加"]})]})})}),l.jsx("div",{className:"row mb-4",children:l.jsx("div",{className:"col-12",children:l.jsx("div",{className:"card",children:l.jsx("div",{className:"card-body",children:(0,l.jsxs)("div",{className:"input-group",children:[l.jsx("span",{className:"input-group-text",children:l.jsx("i",{className:"bi bi-search"})}),l.jsx("input",{type:"text",placeholder:"名前、電話番号、メールアドレスで検索...",value:r,onChange:e=>d(e.target.value),className:"form-control"})]})})})})}),l.jsx("div",{className:"row",children:(0,l.jsxs)("div",{className:"col-12",children:[(0,l.jsxs)("div",{className:"card",children:[l.jsx("div",{className:"card-header",children:(0,l.jsxs)("h5",{className:"mb-0",children:["顧客一覧 (",w.length,"件)"]})}),l.jsx("div",{className:"card-body",children:a?(0,l.jsxs)("div",{className:"d-flex justify-content-center align-items-center py-5",children:[l.jsx("div",{className:"loading-spinner me-2"}),l.jsx("span",{className:"text-muted",children:"読み込み中..."})]}):w.length>0?l.jsx("div",{className:"table-responsive",children:(0,l.jsxs)("table",{className:"table table-hover",children:[l.jsx("thead",{className:"table-light",children:(0,l.jsxs)("tr",{children:[l.jsx("th",{className:"fw-medium text-muted text-uppercase small",children:"顧客情報"}),l.jsx("th",{className:"fw-medium text-muted text-uppercase small",children:"連絡先"}),l.jsx("th",{className:"fw-medium text-muted text-uppercase small",children:"住所"}),l.jsx("th",{className:"fw-medium text-muted text-uppercase small",children:"登録日"}),l.jsx("th",{className:"fw-medium text-muted text-uppercase small text-end",children:"操作"})]})}),l.jsx("tbody",{children:w.map(e=>(0,l.jsxs)("tr",{children:[l.jsx("td",{className:"px-3 py-3",children:(0,l.jsxs)("div",{className:"d-flex align-items-center",children:[l.jsx("div",{className:"flex-shrink-0 me-3",children:l.jsx("div",{className:"rounded-circle bg-light d-flex align-items-center justify-content-center",style:{width:"40px",height:"40px"},children:l.jsx("i",{className:"bi bi-person text-muted"})})}),(0,l.jsxs)("div",{children:[l.jsx("div",{className:"fw-medium text-dark",children:e.name}),e.furigana&&l.jsx("div",{className:"small text-muted",children:e.furigana})]})]})}),l.jsx("td",{className:"px-3 py-3",children:(0,l.jsxs)("div",{children:[e.phone&&(0,l.jsxs)("div",{className:"d-flex align-items-center small",children:[l.jsx("i",{className:"bi bi-telephone me-1 text-muted"}),e.phone]}),e.email&&(0,l.jsxs)("div",{className:"d-flex align-items-center small mt-1",children:[l.jsx("i",{className:"bi bi-envelope me-1 text-muted"}),e.email]})]})}),l.jsx("td",{className:"px-3 py-3",children:(0,l.jsxs)("div",{className:"small",children:[e.postal_code&&(0,l.jsxs)("div",{children:["〒",e.postal_code]}),(e.prefecture||e.city||e.address)&&(0,l.jsxs)("div",{className:"text-muted",children:[e.prefecture,e.city,e.address]})]})}),l.jsx("td",{className:"px-3 py-3 small text-muted",children:new Date(e.created_at).toLocaleDateString("ja-JP")}),l.jsx("td",{className:"px-3 py-3",children:(0,l.jsxs)("div",{className:"d-flex justify-content-end gap-1",children:[l.jsx("button",{onClick:()=>k(e),className:"btn btn-outline-primary btn-sm",title:"編集",children:l.jsx("i",{className:"bi bi-pencil"})}),l.jsx("button",{onClick:()=>p(e),className:"btn btn-outline-danger btn-sm",title:"削除",children:l.jsx("i",{className:"bi bi-trash"})})]})})]},e.id))})]})}):(0,l.jsxs)("div",{className:"text-center py-5",children:[l.jsx("i",{className:"bi bi-people text-muted",style:{fontSize:"4rem"}}),l.jsx("p",{className:"text-muted mt-3",children:r?"検索条件に合う顧客が見つかりません":"登録されている顧客がいません"}),r&&l.jsx("p",{className:"text-muted small",children:"検索条件を変更してもう一度お試しください。"})]})})]}),o&&l.jsx("div",{className:"modal fade show d-block",tabIndex:-1,style:{backgroundColor:"rgba(0,0,0,0.5)"},children:l.jsx("div",{className:"modal-dialog modal-lg modal-dialog-scrollable",children:(0,l.jsxs)("div",{className:"modal-content",children:[(0,l.jsxs)("div",{className:"modal-header",children:[l.jsx("h5",{className:"modal-title",children:x?"顧客情報編集":"新規顧客追加"}),l.jsx("button",{type:"button",className:"btn-close",onClick:O})]}),(0,l.jsxs)("form",{onSubmit:_,children:[l.jsx("div",{className:"modal-body",children:(0,l.jsxs)("div",{className:"row g-3",children:[(0,l.jsxs)("div",{className:"col-md-6",children:[(0,l.jsxs)("label",{className:"form-label",children:["氏名 ",l.jsx("span",{className:"text-danger",children:"*"})]}),l.jsx("input",{type:"text",value:j.name,onChange:$("name"),className:`form-control ${g.name?"is-invalid":""}`,placeholder:"山田 太郎"}),g.name&&l.jsx("div",{className:"invalid-feedback",children:g.name})]}),(0,l.jsxs)("div",{className:"col-md-6",children:[l.jsx("label",{className:"form-label",children:"フリガナ"}),l.jsx("input",{type:"text",value:j.furigana,onChange:$("furigana"),className:"form-control",placeholder:"ヤマダ タロウ"})]}),(0,l.jsxs)("div",{className:"col-md-6",children:[(0,l.jsxs)("label",{className:"form-label",children:["電話番号 ",l.jsx("span",{className:"text-danger",children:"*"})]}),l.jsx("input",{type:"tel",value:j.phone,onChange:$("phone"),className:`form-control ${g.phone?"is-invalid":""}`,placeholder:"090-1234-5678"}),g.phone&&l.jsx("div",{className:"invalid-feedback",children:g.phone})]}),(0,l.jsxs)("div",{className:"col-md-6",children:[l.jsx("label",{className:"form-label",children:"メールアドレス"}),l.jsx("input",{type:"email",value:j.email,onChange:$("email"),className:`form-control ${g.email?"is-invalid":""}`,placeholder:"example@email.com"}),g.email&&l.jsx("div",{className:"invalid-feedback",children:g.email})]}),(0,l.jsxs)("div",{className:"col-md-6",children:[l.jsx("label",{className:"form-label",children:"郵便番号"}),l.jsx("input",{type:"text",value:j.postal_code,onChange:$("postal_code"),className:`form-control ${g.postal_code?"is-invalid":""}`,placeholder:"123-4567"}),g.postal_code&&l.jsx("div",{className:"invalid-feedback",children:g.postal_code})]}),(0,l.jsxs)("div",{className:"col-md-6",children:[l.jsx("label",{className:"form-label",children:"都道府県"}),l.jsx("input",{type:"text",value:j.prefecture,onChange:$("prefecture"),className:"form-control",placeholder:"東京都"})]}),(0,l.jsxs)("div",{className:"col-md-6",children:[l.jsx("label",{className:"form-label",children:"市区町村"}),l.jsx("input",{type:"text",value:j.city,onChange:$("city"),className:"form-control",placeholder:"新宿区"})]}),(0,l.jsxs)("div",{className:"col-12",children:[l.jsx("label",{className:"form-label",children:"住所"}),l.jsx("input",{type:"text",value:j.address,onChange:$("address"),className:"form-control",placeholder:"西新宿1-1-1"})]}),(0,l.jsxs)("div",{className:"col-md-6",children:[l.jsx("label",{className:"form-label",children:"生年月日"}),l.jsx("input",{type:"date",value:j.birth_date,onChange:$("birth_date"),className:"form-control"})]}),(0,l.jsxs)("div",{className:"col-md-6",children:[l.jsx("label",{className:"form-label",children:"性別"}),(0,l.jsxs)("select",{value:j.gender,onChange:$("gender"),className:"form-select",children:[l.jsx("option",{value:"",children:"選択してください"}),l.jsx("option",{value:"男性",children:"男性"}),l.jsx("option",{value:"女性",children:"女性"}),l.jsx("option",{value:"その他",children:"その他"}),l.jsx("option",{value:"回答しない",children:"回答しない"})]})]})]})}),(0,l.jsxs)("div",{className:"modal-footer",children:[l.jsx("button",{type:"button",onClick:O,className:"btn btn-secondary",children:"キャンセル"}),l.jsx("button",{type:"submit",disabled:N,className:"btn btn-primary",children:N?(0,l.jsxs)(l.Fragment,{children:[l.jsx("span",{className:"loading-spinner me-2"}),"保存中..."]}):(0,l.jsxs)(l.Fragment,{children:[l.jsx("i",{className:"bi bi-check-lg me-2"}),x?"更新":"追加"]})})]})]})]})})}),l.jsx(n.$,{isOpen:!!u,title:"顧客情報の削除",itemName:u?.name||"",onConfirm:J,onCancel:()=>p(null)})]})})]})}},572:(e,s,a)=>{a.d(s,{$:()=>n});var l=a(326);a(7577);var t=a(888);let i=({isOpen:e,title:s,message:a,confirmText:i="実行",cancelText:n="キャンセル",confirmButtonVariant:c="danger",onConfirm:r,onCancel:d,isLoading:o=!1,icon:m="warning"})=>e?l.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onKeyDown:e=>{"Escape"===e.key?d():"Enter"!==e.key||o||r()},onClick:e=>{e.target===e.currentTarget&&d()},children:(0,l.jsxs)("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full mx-4 transform transition-all",role:"dialog","aria-modal":"true","aria-labelledby":"dialog-title","aria-describedby":"dialog-message",children:[l.jsx("div",{className:"p-6 pb-0",children:(0,l.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,l.jsxs)("div",{className:`flex-shrink-0 ${(()=>{switch(c){case"danger":default:return"text-red-500";case"warning":return"text-yellow-500";case"primary":return"text-blue-500";case"success":return"text-green-500"}})()}`,children:["delete"===m&&l.jsx(t.JO,{icon:t.PJ.delete,size:"lg"}),"warning"===m&&l.jsx(t.JO,{icon:t.PJ.warning,size:"lg"}),"success"===m&&l.jsx(t.JO,{icon:t.PJ.success,size:"lg"}),"error"===m&&l.jsx(t.JO,{icon:t.PJ.error,size:"lg"}),"info"===m&&l.jsx(t.JO,{icon:t.PJ.info,size:"lg"}),!["delete","warning","success","error","info"].includes(m)&&l.jsx(t.JO,{icon:t.PJ.alert,size:"lg"})]}),l.jsx("div",{children:l.jsx("h3",{id:"dialog-title",className:"text-lg font-semibold text-gray-900",children:s})})]})}),l.jsx("div",{className:"p-6 pt-4",children:l.jsx("p",{id:"dialog-message",className:"text-gray-600 leading-relaxed",children:a})}),(0,l.jsxs)("div",{className:"p-6 pt-0 flex justify-end space-x-3",children:[l.jsx("button",{type:"button",onClick:d,disabled:o,className:"px-4 py-2 text-gray-700 bg-gray-200 rounded-md font-medium hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:n}),l.jsx("button",{type:"button",onClick:r,disabled:o,className:(()=>{let e="px-4 py-2 rounded-md font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed";switch(c){case"danger":default:return`${e} bg-red-600 text-white hover:bg-red-700 focus:ring-red-500`;case"warning":return`${e} bg-yellow-600 text-white hover:bg-yellow-700 focus:ring-yellow-500`;case"primary":return`${e} bg-blue-600 text-white hover:bg-blue-700 focus:ring-blue-500`;case"success":return`${e} bg-green-600 text-white hover:bg-green-700 focus:ring-green-500`}})(),children:o?(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[l.jsx(t.JO,{icon:t.PJ.loading,size:"sm",className:"animate-spin"}),l.jsx("span",{children:"処理中..."})]}):i})]})]})}):null,n=({isOpen:e,title:s="削除の確認",itemName:a="この項目",onConfirm:t,onCancel:n,isLoading:c=!1})=>l.jsx(i,{isOpen:e,title:s,message:`${a}を削除しますか？この操作は取り消すことができません。`,confirmText:"削除",cancelText:"キャンセル",confirmButtonVariant:"danger",onConfirm:t,onCancel:n,isLoading:c,icon:"delete"})}};