"use strict";exports.id=709,exports.ids=[709],exports.modules={709:(e,s,a)=>{a.d(s,{Z:()=>h});var i=a(326),l=a(7577);class t{static async getAllForms(){return[{id:"1",name:"お問い合わせフォーム",description:"一般的なお問い合わせ用のフォームです",is_active:!0,field_count:5,response_count:12,valid_from:"2024-01-01T00:00:00Z",valid_to:"2024-12-31T23:59:59Z",created_at:"2024-01-01T00:00:00Z",updated_at:"2024-01-15T10:30:00Z",pricing_display:{show_item_prices:!0,show_subtotal:!0,show_total_amount:!0,show_item_quantity:!0,pricing_display_mode:"full"}},{id:"2",name:"商品予約フォーム",description:"商品の予約を受け付けるフォームです",is_active:!1,field_count:8,response_count:5,created_at:"2024-01-10T00:00:00Z",updated_at:"2024-01-20T15:45:00Z",pricing_display:{show_item_prices:!1,show_subtotal:!1,show_total_amount:!0,show_item_quantity:!1,pricing_display_mode:"summary"}}]}static async createForm(e){return{id:`form_${Date.now()}`,name:e.name,description:e.description,is_active:e.isActive,field_count:e.fields.length,response_count:0,valid_from:e.validFrom,valid_to:e.validTo,created_at:new Date().toISOString(),updated_at:new Date().toISOString(),pricing_display:{show_item_prices:!0,show_subtotal:!0,show_total_amount:!0,show_item_quantity:!0,pricing_display_mode:"full"}}}static async toggleFormStatus(e,s){}static async deleteForm(e){}static async getFormById(e){return{id:e,name:"サンプルフォーム",description:"サンプルの説明",is_active:!0,fields:[],pricing_display:{show_item_prices:!0,show_subtotal:!0,show_total_amount:!0,show_item_quantity:!0,pricing_display_mode:"full"},created_at:"2024-01-01T00:00:00Z",updated_at:"2024-01-01T00:00:00Z"}}static getFormStatus(e){if(!e.is_active)return"inactive";let s=new Date;return e.valid_from&&s<new Date(e.valid_from)?"pending":e.valid_to&&s>new Date(e.valid_to)?"expired":"active"}static getValidityPeriodText(e,s){if(!e&&!s)return"無期限";let a=e=>new Date(e).toLocaleDateString("ja-JP");return e&&s?`${a(e)} - ${a(s)}`:e?`${a(e)} -`:s?`- ${a(s)}`:"無期限"}static async updatePricingDisplaySettings(e,s){}static async getPricingDisplaySettings(e){return{show_item_prices:!0,show_subtotal:!0,show_total_amount:!0,show_item_quantity:!0,pricing_display_mode:"full"}}static getPricingDisplayModeLabel(e){return({full:"詳細表示",summary:"合計のみ",hidden:"非表示",custom:"カスタム"})[e]}static getPricingDisplayModeDescription(e){return({full:"商品価格、小計、合計をすべて表示",summary:"合計金額のみを表示",hidden:"価格情報を表示しない",custom:"カスタム設定で表示項目を選択"})[e]}static getPricingDisplayStatistics(e){let s={total:e.length,byMode:{full:0,summary:0,hidden:0,custom:0},showingPrices:0,hidingPrices:0};return e.forEach(e=>{e.pricing_display&&(s.byMode[e.pricing_display.pricing_display_mode]++,"hidden"===e.pricing_display.pricing_display_mode?s.hidingPrices++:s.showingPrices++)}),s}}function c({isOpen:e,form:s,onClose:a,onSave:c}){let[r,d]=(0,l.useState)({show_item_prices:!0,show_subtotal:!0,show_total_amount:!0,show_item_quantity:!0,pricing_display_mode:"full"});return e&&s?i.jsx("div",{className:"modal fade show",style:{display:"block"},tabIndex:-1,children:i.jsx("div",{className:"modal-dialog modal-lg",children:(0,i.jsxs)("div",{className:"modal-content",children:[(0,i.jsxs)("div",{className:"modal-header",children:[(0,i.jsxs)("h5",{className:"modal-title",children:["価格表示設定 - ",s.name]}),i.jsx("button",{type:"button",className:"btn-close",onClick:a})]}),(0,i.jsxs)("div",{className:"modal-body",children:[(0,i.jsxs)("div",{className:"mb-4",children:[i.jsx("label",{className:"form-label fw-medium",children:"表示モード"}),(0,i.jsxs)("select",{value:r.pricing_display_mode,onChange:e=>d(s=>({...s,pricing_display_mode:e.target.value})),className:"form-select",children:[i.jsx("option",{value:"full",children:"詳細表示"}),i.jsx("option",{value:"summary",children:"合計のみ"}),i.jsx("option",{value:"hidden",children:"非表示"}),i.jsx("option",{value:"custom",children:"カスタム"})]}),i.jsx("div",{className:"form-text",children:t.getPricingDisplayModeDescription(r.pricing_display_mode)})]}),("custom"===r.pricing_display_mode||"full"===r.pricing_display_mode)&&(0,i.jsxs)("div",{className:"row g-3",children:[i.jsx("div",{className:"col-md-6",children:(0,i.jsxs)("div",{className:"form-check",children:[i.jsx("input",{className:"form-check-input",type:"checkbox",id:"show_item_prices",checked:r.show_item_prices,onChange:e=>d(s=>({...s,show_item_prices:e.target.checked}))}),i.jsx("label",{className:"form-check-label",htmlFor:"show_item_prices",children:"商品価格を表示"})]})}),i.jsx("div",{className:"col-md-6",children:(0,i.jsxs)("div",{className:"form-check",children:[i.jsx("input",{className:"form-check-input",type:"checkbox",id:"show_item_quantity",checked:r.show_item_quantity,onChange:e=>d(s=>({...s,show_item_quantity:e.target.checked}))}),i.jsx("label",{className:"form-check-label",htmlFor:"show_item_quantity",children:"数量を表示"})]})}),i.jsx("div",{className:"col-md-6",children:(0,i.jsxs)("div",{className:"form-check",children:[i.jsx("input",{className:"form-check-input",type:"checkbox",id:"show_subtotal",checked:r.show_subtotal,onChange:e=>d(s=>({...s,show_subtotal:e.target.checked}))}),i.jsx("label",{className:"form-check-label",htmlFor:"show_subtotal",children:"小計を表示"})]})}),i.jsx("div",{className:"col-md-6",children:(0,i.jsxs)("div",{className:"form-check",children:[i.jsx("input",{className:"form-check-input",type:"checkbox",id:"show_total_amount",checked:r.show_total_amount,onChange:e=>d(s=>({...s,show_total_amount:e.target.checked}))}),i.jsx("label",{className:"form-check-label",htmlFor:"show_total_amount",children:"合計金額を表示"})]})})]})]}),(0,i.jsxs)("div",{className:"modal-footer",children:[i.jsx("button",{type:"button",className:"btn btn-secondary",onClick:a,children:"キャンセル"}),i.jsx("button",{type:"button",className:"btn btn-primary",onClick:()=>{s&&(c(s.id,r),a())},children:"設定を保存"})]})]})})}):null}function r({onCreateForm:e,onEditForm:s}){let[a,r]=(0,l.useState)([]),[d,n]=(0,l.useState)(!0),[o,m]=(0,l.useState)("all"),[h,u]=(0,l.useState)(null),p=async(e,s)=>{try{await t.toggleFormStatus(e,!s),r(a.map(a=>a.id===e?{...a,is_active:!s}:a))}catch(e){alert("フォームステータスの更新に失敗しました。")}},x=async e=>{if(confirm("このフォームを削除しますか？この操作は元に戻せません。"))try{await t.deleteForm(e),r(a.filter(s=>s.id!==e)),alert("フォームが削除されました。")}catch(e){alert("フォームの削除に失敗しました。")}},b=async(e,s)=>{try{await t.updatePricingDisplaySettings(e,s),r(a.map(a=>a.id===e?{...a,pricing_display:s}:a)),alert("価格表示設定が更新されました。")}catch(e){alert("価格表示設定の更新に失敗しました。")}},j=a.filter(e=>"all"===o||("active"===o?e.is_active:"inactive"!==o||!e.is_active)),v=e=>{let s={inactive:{bg:"bg-secondary-subtle",text:"text-secondary",label:"無効"},pending:{bg:"bg-info-subtle",text:"text-info",label:"開始前"},expired:{bg:"bg-danger-subtle",text:"text-danger",label:"期限切れ"},active:{bg:"bg-success-subtle",text:"text-success",label:"公開中"}}[t.getFormStatus(e)];return i.jsx("span",{className:`badge ${s.bg} ${s.text}`,children:s.label})},_=e=>t.getValidityPeriodText(e.valid_from,e.valid_to);return d?i.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{height:"256px"},children:i.jsx("div",{className:"loading-spinner"})}):(0,i.jsxs)("div",{children:[i.jsx("div",{className:"row mb-4",children:i.jsx("div",{className:"col-12",children:(0,i.jsxs)("div",{className:"d-flex justify-content-between align-items-center",children:[(0,i.jsxs)("div",{children:[i.jsx("h2",{className:"h2 fw-bold text-dark",children:"フォーム一覧"}),i.jsx("p",{className:"text-muted",children:"作成済みのフォームを管理できます"})]}),(0,i.jsxs)("div",{className:"d-flex gap-3",children:[(0,i.jsxs)("select",{value:o,onChange:e=>m(e.target.value),className:"form-select form-select-sm px-5",children:[i.jsx("option",{value:"all",children:"すべて"}),i.jsx("option",{value:"active",children:"有効"}),i.jsx("option",{value:"inactive",children:"無効"})]}),(0,i.jsxs)("button",{onClick:e,className:"btn btn-primary btn-sm px-2",style:{padding:"0.375rem 0.75rem",minWidth:"150px"},children:[i.jsx("i",{className:"bi bi-plus-lg me-2"}),"新しいフォーム"]})]})]})})}),(0,i.jsxs)("div",{className:"row g-4 mb-4",children:[i.jsx("div",{className:"col-lg-3 col-md-6",children:i.jsx("div",{className:"dashboard-widget",children:i.jsx("div",{className:"d-flex align-items-center justify-content-between",children:(0,i.jsxs)("div",{children:[i.jsx("div",{className:"dashboard-widget-icon bg-success-subtle text-success",children:i.jsx("i",{className:"bi bi-check-circle"})}),i.jsx("div",{className:"dashboard-widget-value",children:a.filter(e=>e.is_active).length}),i.jsx("div",{className:"dashboard-widget-label",children:"有効なフォーム"})]})})})}),i.jsx("div",{className:"col-lg-3 col-md-6",children:i.jsx("div",{className:"dashboard-widget",children:i.jsx("div",{className:"d-flex align-items-center justify-content-between",children:(0,i.jsxs)("div",{children:[i.jsx("div",{className:"dashboard-widget-icon bg-primary-subtle text-primary",children:i.jsx("i",{className:"bi bi-file-earmark-text"})}),i.jsx("div",{className:"dashboard-widget-value",children:a.length}),i.jsx("div",{className:"dashboard-widget-label",children:"総フォーム数"})]})})})}),i.jsx("div",{className:"col-lg-3 col-md-6",children:i.jsx("div",{className:"dashboard-widget",children:i.jsx("div",{className:"d-flex align-items-center justify-content-between",children:(0,i.jsxs)("div",{children:[i.jsx("div",{className:"dashboard-widget-icon bg-info-subtle text-info",children:i.jsx("i",{className:"bi bi-bar-chart"})}),i.jsx("div",{className:"dashboard-widget-value",children:a.reduce((e,s)=>e+s.response_count,0)}),i.jsx("div",{className:"dashboard-widget-label",children:"総回答数"})]})})})}),i.jsx("div",{className:"col-lg-3 col-md-6",children:i.jsx("div",{className:"dashboard-widget",children:i.jsx("div",{className:"d-flex align-items-center justify-content-between",children:(0,i.jsxs)("div",{children:[i.jsx("div",{className:"dashboard-widget-icon bg-warning-subtle text-warning",children:i.jsx("i",{className:"bi bi-currency-yen"})}),i.jsx("div",{className:"dashboard-widget-value",children:t.getPricingDisplayStatistics(a).showingPrices}),i.jsx("div",{className:"dashboard-widget-label",children:"価格表示中"})]})})})})]}),i.jsx("div",{className:"row mb-4",children:i.jsx("div",{className:"col-12",children:(0,i.jsxs)("div",{className:"card",children:[i.jsx("div",{className:"card-header",children:i.jsx("h6",{className:"mb-0",children:"価格表示設定の統計"})}),i.jsx("div",{className:"card-body",children:i.jsx("div",{className:"row g-3",children:Object.entries(t.getPricingDisplayStatistics(a).byMode).map(([e,s])=>i.jsx("div",{className:"col-lg-3 col-md-6",children:(0,i.jsxs)("div",{className:"text-center p-3 bg-light rounded",children:[i.jsx("div",{className:"h5 mb-1",children:s}),i.jsx("div",{className:"small text-muted",children:t.getPricingDisplayModeLabel(e)})]})},e))})})]})})}),i.jsx("div",{className:"row",children:i.jsx("div",{className:"col-12",children:(0,i.jsxs)("div",{className:"card",children:[i.jsx("div",{className:"card-header",children:(0,i.jsxs)("h5",{className:"mb-0",children:["フォーム一覧 (",j.length,"件)"]})}),i.jsx("div",{className:"card-body p-0",children:j.map(e=>i.jsx("div",{className:"border-bottom p-4",children:(0,i.jsxs)("div",{className:"d-flex justify-content-between align-items-start",children:[(0,i.jsxs)("div",{className:"flex-grow-1",children:[(0,i.jsxs)("div",{className:"d-flex align-items-center gap-3 mb-2",children:[i.jsx("h5",{className:"mb-0 fw-medium",children:e.name}),v(e)]}),i.jsx("p",{className:"text-muted mb-3",children:e.description}),(0,i.jsxs)("div",{className:"row g-3 small",children:[(0,i.jsxs)("div",{className:"col-lg-3 col-md-6",children:[i.jsx("span",{className:"text-muted",children:"フィールド数:"}),(0,i.jsxs)("span",{className:"fw-medium ms-1",children:[e.field_count,"個"]})]}),(0,i.jsxs)("div",{className:"col-lg-3 col-md-6",children:[i.jsx("span",{className:"text-muted",children:"回答数:"}),(0,i.jsxs)("span",{className:"fw-medium ms-1 text-primary",children:[e.response_count,"件"]})]}),(0,i.jsxs)("div",{className:"col-lg-3 col-md-6",children:[i.jsx("span",{className:"text-muted",children:"有効期間:"}),i.jsx("span",{className:"fw-medium ms-1",children:_(e)})]}),(0,i.jsxs)("div",{className:"col-lg-3 col-md-6",children:[i.jsx("span",{className:"text-muted",children:"更新日:"}),i.jsx("span",{className:"fw-medium ms-1",children:new Date(e.updated_at).toLocaleDateString("ja-JP")})]}),(0,i.jsxs)("div",{className:"col-lg-3 col-md-6",children:[i.jsx("span",{className:"text-muted",children:"価格表示:"}),i.jsx("span",{className:"fw-medium ms-1",children:e.pricing_display?t.getPricingDisplayModeLabel(e.pricing_display.pricing_display_mode):"設定なし"})]})]})]}),(0,i.jsxs)("div",{className:"d-flex gap-1 ms-3",children:[(0,i.jsxs)("button",{onClick:()=>s(e.id),className:"btn btn-outline-primary btn-sm",title:"フォームを編集",children:[i.jsx("i",{className:"bi bi-pencil me-1"}),"編集"]}),(0,i.jsxs)("button",{onClick:()=>u(e),className:"btn btn-outline-info btn-sm",title:"価格表示設定",children:[i.jsx("i",{className:"bi bi-currency-yen me-1"}),"価格設定"]}),(0,i.jsxs)("button",{onClick:()=>window.open(`/form/${e.id}`,"_blank"),className:"btn btn-outline-secondary btn-sm",title:"フォームをプレビュー",children:[i.jsx("i",{className:"bi bi-eye me-1"}),"プレビュー"]}),i.jsx("button",{onClick:()=>p(e.id,e.is_active),className:`btn btn-sm ${e.is_active?"btn-outline-warning":"btn-outline-success"}`,title:e.is_active?"フォームを無効にする":"フォームを有効にする",children:i.jsx("i",{className:`bi ${e.is_active?"bi-pause":"bi-play"}`})}),i.jsx("button",{onClick:()=>x(e.id),className:"btn btn-outline-danger btn-sm",title:"フォームを削除",children:i.jsx("i",{className:"bi bi-trash"})})]})]})},e.id))})]})})}),0===j.length&&i.jsx("div",{className:"row",children:i.jsx("div",{className:"col-12",children:i.jsx("div",{className:"card",children:(0,i.jsxs)("div",{className:"card-body text-center py-5",children:[i.jsx("i",{className:"bi bi-file-earmark-text text-muted",style:{fontSize:"4rem"}}),i.jsx("h5",{className:"fw-medium text-dark mt-3 mb-2",children:"フォームが見つかりません"}),(0,i.jsxs)("p",{className:"text-muted mb-4",children:["all"!==o?`${"active"===o?"有効な":"無効な"}フォームはありません。`:"まだフォームが作成されていません。",i.jsx("br",{}),"新しいフォームを作成してください。"]})]})})})}),i.jsx(c,{isOpen:!!h,form:h,onClose:()=>u(null),onSave:b})]})}a(241);let d=[{id:"customer_name",type:"text",label:"お客様名",required:!0,placeholder:"山田太郎"},{id:"customer_furigana",type:"text",label:"フリガナ",required:!1,placeholder:"ヤマダタロウ"},{id:"customer_phone",type:"tel",label:"電話番号",required:!0,placeholder:"090-1234-5678"},{id:"customer_email",type:"email",label:"メールアドレス",required:!1,placeholder:"example@example.com"},{id:"customer_postal_code",type:"text",label:"郵便番号",required:!1,placeholder:"123-4567"},{id:"customer_prefecture",type:"text",label:"都道府県",required:!1,placeholder:"東京都"},{id:"customer_city",type:"text",label:"市区町村",required:!1,placeholder:"渋谷区"},{id:"customer_address",type:"textarea",label:"住所（番地・建物名）",required:!1,placeholder:"1-1-1 サンプルマンション101"},{id:"customer_birth_date",type:"date",label:"生年月日",required:!1},{id:"customer_gender",type:"radio",label:"性別",required:!1,options:["男性","女性","その他"]},{id:"reservation_date",type:"date",label:"受取希望日",required:!0},{id:"pickup_time_slot",type:"select",label:"受取時間帯",required:!0,options:["09:00-10:00","10:00-11:00","11:00-12:00","13:00-14:00","14:00-15:00","15:00-16:00","16:00-17:00"]},{id:"cultivation_purpose",type:"select",label:"栽培目的",required:!1,options:["家庭菜園","観賞用","贈答用","商業栽培","その他"]},{id:"cultivation_location",type:"select",label:"栽培場所",required:!1,options:["露地","ハウス","ベランダ","プランター","その他"]},{id:"experience_level",type:"select",label:"栽培経験",required:!1,options:["初心者","1-2年","3-5年","5年以上","プロ・専門家"]},{id:"preferred_contact_method",type:"radio",label:"希望連絡方法",required:!1,options:["電話","メール","LINE","いずれでも"]},{id:"special_requests",type:"textarea",label:"ご要望・備考",required:!1,placeholder:"ご要望があればお書きください"},{id:"referral_source",type:"select",label:"お知りになったきっかけ",required:!1,options:["知人の紹介","インターネット検索","SNS","チラシ・広告","通りがかり","その他"]}],n=[{value:"text",label:"テキスト"},{value:"email",label:"メールアドレス"},{value:"tel",label:"電話番号"},{value:"number",label:"数値"},{value:"textarea",label:"複数行テキスト"},{value:"select",label:"選択（プルダウン）"},{value:"radio",label:"選択（ラジオボタン）"},{value:"checkbox",label:"複数選択"},{value:"date",label:"日付"}],o=[{id:"custom",name:"カスタムフォーム",description:"1からフォームを作成",fields:[]},{id:"basic_reservation",name:"基本予約フォーム",description:"必要最小限の項目で構成された予約フォーム",fields:["customer_name","customer_phone","customer_email","reservation_date","pickup_time_slot","special_requests"]},{id:"detailed_reservation",name:"詳細予約フォーム",description:"詳細な顧客情報と栽培情報を含む予約フォーム",fields:["customer_name","customer_furigana","customer_phone","customer_email","customer_postal_code","customer_prefecture","customer_city","customer_address","reservation_date","pickup_time_slot","cultivation_purpose","cultivation_location","experience_level","preferred_contact_method","special_requests","referral_source"]},{id:"consultation_form",name:"栽培相談フォーム",description:"栽培相談に特化したフォーム",fields:["customer_name","customer_phone","customer_email","cultivation_purpose","cultivation_location","experience_level","special_requests"]},{id:"feedback_form",name:"お客様アンケート",description:"購入後のフィードバック収集フォーム",fields:["customer_name","customer_email","cultivation_purpose","experience_level","special_requests","referral_source"]}];function m({isOpen:e,onClose:s,onSuccess:a}){let[c,r]=(0,l.useState)({name:"",description:"",valid_from:"",valid_to:""}),[m,h]=(0,l.useState)([]),[u,p]=(0,l.useState)([]),[x,b]=(0,l.useState)([]),[j,v]=(0,l.useState)("all"),[_,g]=(0,l.useState)(""),[N,y]=(0,l.useState)("basic"),[f,w]=(0,l.useState)([]),[k,C]=(0,l.useState)(null),[q,S]=(0,l.useState)(!1),[$,P]=(0,l.useState)("custom"),[F,D]=(0,l.useState)({show_item_prices:!0,show_subtotal:!0,show_total_amount:!0,show_item_quantity:!0,pricing_display_mode:"full"}),L=e=>{m.find(s=>s.id===e.id)||h([...m,e])},T=e=>{h(m.filter(s=>s.id!==e))},O=u.filter(e=>!m.find(s=>s.id===e.id)&&("all"===j||e.category_id===j)&&(!_||!!e.name.toLowerCase().includes(_.toLowerCase()))),I=e=>{f.find(s=>s.id===e.id)||w([...f,{...e}])},E=e=>{C({...e}),S(!0)},V=e=>{confirm("このフィールドを削除しますか？")&&w(f.filter(s=>s.id!==e))},M=e=>{P(e);let s=o.find(s=>s.id===e);s&&s.fields.length>0?w(s.fields.map(e=>{let s=d.find(s=>s.id===e);return s?{...s}:null}).filter(e=>null!==e)):w([])},Z=async()=>{try{let e={name:c.name.trim(),description:c.description.trim(),fields:f,isActive:!1,validFrom:c.valid_from||void 0,validTo:c.valid_to||void 0,selectedProducts:m.map(e=>e.id)},s=await t.createForm(e);A(),a(),window.location.href=`/admin?page=form-builder&id=${s.id}`}catch(e){alert("フォームの作成に失敗しました。")}},A=()=>{r({name:"",description:"",valid_from:"",valid_to:""}),h([]),v("all"),g(""),w([]),y("basic"),C(null),S(!1)},B=()=>{A(),s()};return e?(0,i.jsxs)("div",{className:"modal show d-block",tabIndex:-1,style:{backgroundColor:"rgba(0,0,0,0.5)"},children:[i.jsx("div",{className:"modal-dialog modal-xl",style:{maxWidth:"90vw"},children:(0,i.jsxs)("div",{className:"modal-content",children:[(0,i.jsxs)("div",{className:"modal-header",children:[i.jsx("h5",{className:"modal-title",children:"新しいフォームを作成"}),i.jsx("button",{type:"button",className:"btn-close",onClick:B,"aria-label":"Close"})]}),(0,i.jsxs)("div",{className:"modal-body",style:{maxHeight:"70vh",overflowY:"auto"},children:[(0,i.jsxs)("ul",{className:"nav nav-tabs mb-4",id:"formTabs",role:"tablist",children:[i.jsx("li",{className:"nav-item",role:"presentation",children:(0,i.jsxs)("button",{className:`nav-link ${"basic"===N?"active":""}`,onClick:()=>y("basic"),type:"button",children:[i.jsx("i",{className:"bi bi-info-circle me-1"}),"基本情報"]})}),i.jsx("li",{className:"nav-item",role:"presentation",children:(0,i.jsxs)("button",{className:`nav-link ${"fields"===N?"active":""}`,onClick:()=>y("fields"),type:"button",children:[i.jsx("i",{className:"bi bi-ui-checks me-1"}),"フォームフィールド",f.length>0&&i.jsx("span",{className:"badge bg-primary ms-1",children:f.length})]})}),i.jsx("li",{className:"nav-item",role:"presentation",children:(0,i.jsxs)("button",{className:`nav-link ${"products"===N?"active":""}`,onClick:()=>y("products"),type:"button",children:[i.jsx("i",{className:"bi bi-box-seam me-1"}),"商品選択",m.length>0&&i.jsx("span",{className:"badge bg-primary ms-1",children:m.length})]})}),i.jsx("li",{className:"nav-item",role:"presentation",children:(0,i.jsxs)("button",{className:`nav-link ${"pricing"===N?"active":""}`,onClick:()=>y("pricing"),type:"button",children:[i.jsx("i",{className:"bi bi-currency-dollar me-1"}),"価格表示設定"]})})]}),(0,i.jsxs)("div",{className:"tab-content",children:["basic"===N&&i.jsx("div",{className:"tab-pane fade show active",children:i.jsx("div",{className:"row justify-content-center",children:(0,i.jsxs)("div",{className:"col-md-8",children:[(0,i.jsxs)("div",{className:"mb-4",children:[i.jsx("label",{className:"form-label",children:"フォームテンプレート"}),i.jsx("div",{className:"row g-3",children:o.map(e=>i.jsx("div",{className:"col-md-6",children:i.jsx("div",{className:`card h-100 cursor-pointer ${$===e.id?"border-primary":""}`,onClick:()=>M(e.id),style:{cursor:"pointer"},children:(0,i.jsxs)("div",{className:"card-body",children:[(0,i.jsxs)("div",{className:"d-flex align-items-center mb-2",children:[i.jsx("input",{type:"radio",name:"template",value:e.id,checked:$===e.id,onChange:()=>M(e.id),className:"me-2"}),i.jsx("h6",{className:"card-title mb-0",children:e.name})]}),i.jsx("p",{className:"card-text text-muted small",children:e.description}),e.fields.length>0&&(0,i.jsxs)("small",{className:"text-muted",children:[e.fields.length,"個のフィールド"]})]})})},e.id))})]}),(0,i.jsxs)("div",{className:"mb-4",children:[(0,i.jsxs)("label",{htmlFor:"formName",className:"form-label",children:["フォーム名 ",i.jsx("span",{className:"text-danger",children:"*"})]}),i.jsx("input",{type:"text",className:"form-control",id:"formName",value:c.name,onChange:e=>r({...c,name:e.target.value}),placeholder:"フォーム名を入力してください",required:!0})]}),(0,i.jsxs)("div",{className:"mb-4",children:[i.jsx("label",{htmlFor:"formDescription",className:"form-label",children:"説明"}),i.jsx("textarea",{className:"form-control",id:"formDescription",rows:4,value:c.description,onChange:e=>r({...c,description:e.target.value}),placeholder:"フォームの説明を入力してください"})]}),(0,i.jsxs)("div",{className:"row",children:[i.jsx("div",{className:"col-md-6",children:(0,i.jsxs)("div",{className:"mb-4",children:[i.jsx("label",{htmlFor:"validFrom",className:"form-label",children:"有効期間 開始日"}),i.jsx("input",{type:"datetime-local",className:"form-control",id:"validFrom",value:c.valid_from,onChange:e=>r({...c,valid_from:e.target.value})})]})}),i.jsx("div",{className:"col-md-6",children:(0,i.jsxs)("div",{className:"mb-4",children:[i.jsx("label",{htmlFor:"validTo",className:"form-label",children:"有効期間 終了日"}),i.jsx("input",{type:"datetime-local",className:"form-control",id:"validTo",value:c.valid_to,onChange:e=>r({...c,valid_to:e.target.value})})]})})]})]})})}),"fields"===N&&i.jsx("div",{className:"tab-pane fade show active",children:(0,i.jsxs)("div",{className:"row",children:[(0,i.jsxs)("div",{className:"col-lg-6",children:[(0,i.jsxs)("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[i.jsx("h6",{className:"fw-bold mb-0",children:"設定済みフィールド"}),(0,i.jsxs)("button",{type:"button",className:"btn btn-outline-primary btn-sm",onClick:()=>{C({id:`custom_${Date.now()}`,type:"text",label:"新しいフィールド",required:!1,placeholder:""}),S(!0)},children:[i.jsx("i",{className:"bi bi-plus-lg me-1"}),"カスタムフィールド"]})]}),f.length>0?i.jsx("div",{className:"list-group",children:f.map(e=>i.jsx("div",{className:"list-group-item",children:(0,i.jsxs)("div",{className:"d-flex justify-content-between align-items-start",children:[(0,i.jsxs)("div",{className:"flex-grow-1",children:[(0,i.jsxs)("div",{className:"d-flex align-items-center mb-1",children:[i.jsx("span",{className:"fw-medium",children:e.label}),e.required&&i.jsx("span",{className:"text-danger ms-1",children:"*"}),i.jsx("span",{className:"badge bg-secondary ms-2",children:n.find(s=>s.value===e.type)?.label})]}),(0,i.jsxs)("small",{className:"text-muted",children:[e.placeholder&&`プレースホルダー: ${e.placeholder}`,e.options&&` | 選択肢: ${e.options.join(", ")}`]})]}),(0,i.jsxs)("div",{className:"btn-group",children:[i.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>E(e),children:i.jsx("i",{className:"bi bi-pencil"})}),i.jsx("button",{type:"button",className:"btn btn-outline-danger btn-sm",onClick:()=>V(e.id),children:i.jsx("i",{className:"bi bi-trash"})})]})]})},e.id))}):(0,i.jsxs)("div",{className:"text-center text-muted p-4 border rounded",children:[i.jsx("i",{className:"bi bi-ui-checks display-4"}),i.jsx("p",{className:"mb-0 mt-2",children:"フィールドが設定されていません"}),i.jsx("small",{children:"事前定義されたフィールドから選択するか、カスタムフィールドを作成してください"})]})]}),(0,i.jsxs)("div",{className:"col-lg-6",children:[i.jsx("h6",{className:"fw-bold mb-3",children:"事前定義フィールド"}),i.jsx("div",{className:"row g-2",children:d.map(e=>i.jsx("div",{className:"col-12",children:i.jsx("div",{className:"card card-body p-2",children:(0,i.jsxs)("div",{className:"d-flex justify-content-between align-items-center",children:[(0,i.jsxs)("div",{className:"flex-grow-1",children:[(0,i.jsxs)("div",{className:"d-flex align-items-center",children:[i.jsx("span",{className:"fw-medium small",children:e.label}),e.required&&i.jsx("span",{className:"text-danger ms-1",children:"*"})]}),i.jsx("small",{className:"text-muted",children:n.find(s=>s.value===e.type)?.label})]}),i.jsx("button",{type:"button",className:"btn btn-outline-primary btn-sm",onClick:()=>I(e),disabled:f.some(s=>s.id===e.id),children:f.some(s=>s.id===e.id)?i.jsx("i",{className:"bi bi-check"}):i.jsx("i",{className:"bi bi-plus"})})]})})},e.id))})]})]})}),"products"===N&&i.jsx("div",{className:"tab-pane fade show active",children:(0,i.jsxs)("div",{className:"row",children:[(0,i.jsxs)("div",{className:"col-lg-6",children:[(0,i.jsxs)("h6",{className:"fw-bold mb-3",children:["選択済み商品 (",m.length,"件)"]}),m.length>0?i.jsx("div",{className:"border rounded p-3",style:{maxHeight:"400px",overflowY:"auto"},children:m.map(e=>(0,i.jsxs)("div",{className:"d-flex justify-content-between align-items-center p-2 border-bottom",children:[(0,i.jsxs)("div",{className:"flex-grow-1",children:[i.jsx("div",{className:"fw-medium",children:e.name}),(0,i.jsxs)("small",{className:"text-muted",children:["\xa5",e.price?.toLocaleString()]})]}),i.jsx("button",{type:"button",className:"btn btn-outline-danger btn-sm",onClick:()=>T(e.id),children:i.jsx("i",{className:"bi bi-x"})})]},e.id))}):(0,i.jsxs)("div",{className:"text-center text-muted p-4 border rounded",children:[i.jsx("i",{className:"bi bi-box-seam display-4"}),i.jsx("p",{className:"mb-0 mt-2",children:"商品が選択されていません"}),i.jsx("small",{children:"右側の商品一覧から選択してください"})]})]}),(0,i.jsxs)("div",{className:"col-lg-6",children:[i.jsx("h6",{className:"fw-bold mb-3",children:"商品一覧"}),(0,i.jsxs)("div",{className:"row mb-3",children:[i.jsx("div",{className:"col-md-6",children:(0,i.jsxs)("select",{className:"form-select form-select-sm",value:j,onChange:e=>v(e.target.value),children:[i.jsx("option",{value:"all",children:"すべてのカテゴリ"}),x.map(e=>i.jsx("option",{value:e.id,children:e.name},e.id))]})}),i.jsx("div",{className:"col-md-6",children:i.jsx("input",{type:"text",className:"form-control form-control-sm",placeholder:"商品名で検索...",value:_,onChange:e=>g(e.target.value)})})]}),i.jsx("div",{style:{maxHeight:"400px",overflowY:"auto"},children:O.length>0?i.jsx("div",{className:"row g-2",children:O.map(e=>i.jsx("div",{className:"col-12",children:i.jsx("div",{className:"card card-body p-2 cursor-pointer hover-bg-light",onClick:()=>L(e),style:{cursor:"pointer"},children:(0,i.jsxs)("div",{className:"d-flex justify-content-between align-items-center",children:[(0,i.jsxs)("div",{className:"flex-grow-1",children:[i.jsx("div",{className:"fw-medium small",children:e.name}),(0,i.jsxs)("small",{className:"text-muted",children:["\xa5",e.price?.toLocaleString()]})]}),i.jsx("button",{type:"button",className:"btn btn-outline-primary btn-sm",onClick:s=>{s.stopPropagation(),L(e)},children:i.jsx("i",{className:"bi bi-plus"})})]})})},e.id))}):(0,i.jsxs)("div",{className:"text-center text-muted p-3",children:[i.jsx("i",{className:"bi bi-search"}),i.jsx("p",{className:"mb-0 small",children:"条件に一致する商品がありません"})]})})]})]})}),"pricing"===N&&i.jsx("div",{className:"tab-pane fade show active",children:i.jsx("div",{className:"row justify-content-center",children:i.jsx("div",{className:"col-md-8",children:(0,i.jsxs)("div",{className:"card",children:[i.jsx("div",{className:"card-header",children:(0,i.jsxs)("h5",{className:"card-title mb-0",children:[i.jsx("i",{className:"bi bi-currency-dollar me-2"}),"価格表示設定"]})}),(0,i.jsxs)("div",{className:"card-body",children:[(0,i.jsxs)("div",{className:"mb-4",children:[i.jsx("label",{className:"form-label",children:"価格表示モード"}),(0,i.jsxs)("div",{className:"row g-3",children:[i.jsx("div",{className:"col-md-6",children:i.jsx("div",{className:`card h-100 cursor-pointer ${"full"===F.pricing_display_mode?"border-primary bg-light":""}`,onClick:()=>D({...F,pricing_display_mode:"full"}),style:{cursor:"pointer"},children:(0,i.jsxs)("div",{className:"card-body",children:[(0,i.jsxs)("div",{className:"d-flex align-items-center mb-2",children:[i.jsx("input",{type:"radio",name:"pricing_mode",value:"full",checked:"full"===F.pricing_display_mode,onChange:()=>D({...F,pricing_display_mode:"full"}),className:"me-2"}),i.jsx("h6",{className:"card-title mb-0",children:"完全表示"})]}),i.jsx("p",{className:"card-text text-muted small",children:"すべての価格情報を表示"})]})})}),i.jsx("div",{className:"col-md-6",children:i.jsx("div",{className:`card h-100 cursor-pointer ${"summary"===F.pricing_display_mode?"border-primary bg-light":""}`,onClick:()=>D({...F,pricing_display_mode:"summary"}),style:{cursor:"pointer"},children:(0,i.jsxs)("div",{className:"card-body",children:[(0,i.jsxs)("div",{className:"d-flex align-items-center mb-2",children:[i.jsx("input",{type:"radio",name:"pricing_mode",value:"summary",checked:"summary"===F.pricing_display_mode,onChange:()=>D({...F,pricing_display_mode:"summary"}),className:"me-2"}),i.jsx("h6",{className:"card-title mb-0",children:"要約表示"})]}),i.jsx("p",{className:"card-text text-muted small",children:"合計金額のみ表示"})]})})}),i.jsx("div",{className:"col-md-6",children:i.jsx("div",{className:`card h-100 cursor-pointer ${"hidden"===F.pricing_display_mode?"border-primary bg-light":""}`,onClick:()=>D({...F,pricing_display_mode:"hidden"}),style:{cursor:"pointer"},children:(0,i.jsxs)("div",{className:"card-body",children:[(0,i.jsxs)("div",{className:"d-flex align-items-center mb-2",children:[i.jsx("input",{type:"radio",name:"pricing_mode",value:"hidden",checked:"hidden"===F.pricing_display_mode,onChange:()=>D({...F,pricing_display_mode:"hidden"}),className:"me-2"}),i.jsx("h6",{className:"card-title mb-0",children:"価格非表示"})]}),i.jsx("p",{className:"card-text text-muted small",children:"価格情報を一切表示しない"})]})})}),i.jsx("div",{className:"col-md-6",children:i.jsx("div",{className:`card h-100 cursor-pointer ${"custom"===F.pricing_display_mode?"border-primary bg-light":""}`,onClick:()=>D({...F,pricing_display_mode:"custom"}),style:{cursor:"pointer"},children:(0,i.jsxs)("div",{className:"card-body",children:[(0,i.jsxs)("div",{className:"d-flex align-items-center mb-2",children:[i.jsx("input",{type:"radio",name:"pricing_mode",value:"custom",checked:"custom"===F.pricing_display_mode,onChange:()=>D({...F,pricing_display_mode:"custom"}),className:"me-2"}),i.jsx("h6",{className:"card-title mb-0",children:"カスタム"})]}),i.jsx("p",{className:"card-text text-muted small",children:"個別に設定"})]})})})]})]}),"custom"===F.pricing_display_mode&&(0,i.jsxs)("div",{className:"mb-4",children:[i.jsx("h6",{className:"mb-3",children:"詳細設定"}),(0,i.jsxs)("div",{className:"row g-3",children:[i.jsx("div",{className:"col-md-6",children:(0,i.jsxs)("div",{className:"form-check",children:[i.jsx("input",{className:"form-check-input",type:"checkbox",id:"show_item_prices",checked:F.show_item_prices,onChange:e=>D({...F,show_item_prices:e.target.checked})}),i.jsx("label",{className:"form-check-label",htmlFor:"show_item_prices",children:"商品単価を表示"})]})}),i.jsx("div",{className:"col-md-6",children:(0,i.jsxs)("div",{className:"form-check",children:[i.jsx("input",{className:"form-check-input",type:"checkbox",id:"show_item_quantity",checked:F.show_item_quantity,onChange:e=>D({...F,show_item_quantity:e.target.checked})}),i.jsx("label",{className:"form-check-label",htmlFor:"show_item_quantity",children:"商品数量を表示"})]})}),i.jsx("div",{className:"col-md-6",children:(0,i.jsxs)("div",{className:"form-check",children:[i.jsx("input",{className:"form-check-input",type:"checkbox",id:"show_subtotal",checked:F.show_subtotal,onChange:e=>D({...F,show_subtotal:e.target.checked})}),i.jsx("label",{className:"form-check-label",htmlFor:"show_subtotal",children:"小計を表示"})]})}),i.jsx("div",{className:"col-md-6",children:(0,i.jsxs)("div",{className:"form-check",children:[i.jsx("input",{className:"form-check-input",type:"checkbox",id:"show_total_amount",checked:F.show_total_amount,onChange:e=>D({...F,show_total_amount:e.target.checked})}),i.jsx("label",{className:"form-check-label",htmlFor:"show_total_amount",children:"合計金額を表示"})]})})]})]}),(0,i.jsxs)("div",{className:"mb-4",children:[i.jsx("h6",{className:"mb-3",children:"プレビュー"}),i.jsx("div",{className:"card bg-light",children:(0,i.jsxs)("div",{className:"card-body",children:[(0,i.jsxs)("div",{className:"row",children:[(0,i.jsxs)("div",{className:"col-8",children:[i.jsx("h6",{className:"mb-1",children:"サンプル商品"}),("custom"===F.pricing_display_mode?F.show_item_quantity:"hidden"!==F.pricing_display_mode)&&i.jsx("small",{className:"text-muted",children:"数量: 2個"})]}),(0,i.jsxs)("div",{className:"col-4 text-end",children:[("custom"===F.pricing_display_mode?F.show_item_prices:"full"===F.pricing_display_mode)&&i.jsx("div",{className:"small text-muted",children:"単価: \xa5500"}),("custom"===F.pricing_display_mode?F.show_subtotal:"full"===F.pricing_display_mode)&&i.jsx("div",{className:"small",children:"小計: \xa51,000"})]})]}),i.jsx("hr",{className:"my-2"}),(0,i.jsxs)("div",{className:"d-flex justify-content-between align-items-center",children:[i.jsx("strong",{children:"合計"}),i.jsx("strong",{children:("custom"===F.pricing_display_mode?F.show_total_amount:"hidden"!==F.pricing_display_mode)?"\xa51,000":"※価格は店舗にてお知らせします"})]})]})})]}),(0,i.jsxs)("div",{className:"alert alert-info",children:[i.jsx("i",{className:"bi bi-info-circle me-2"}),"full"===F.pricing_display_mode&&"商品の単価、小計、合計金額がすべて表示されます。","summary"===F.pricing_display_mode&&"合計金額のみが表示されます。","hidden"===F.pricing_display_mode&&"価格情報は一切表示されません。","custom"===F.pricing_display_mode&&"選択した項目のみが表示されます。"]})]})]})})})})]})]}),(0,i.jsxs)("div",{className:"modal-footer",children:[i.jsx("button",{type:"button",className:"btn btn-secondary",onClick:B,children:"キャンセル"}),i.jsx("button",{type:"button",className:"btn btn-primary",onClick:Z,disabled:!c.name.trim(),children:"作成"})]})]})}),q&&k&&i.jsx("div",{className:"modal show d-block",tabIndex:-1,style:{backgroundColor:"rgba(0,0,0,0.5)"},children:i.jsx("div",{className:"modal-dialog",children:(0,i.jsxs)("div",{className:"modal-content",children:[(0,i.jsxs)("div",{className:"modal-header",children:[i.jsx("h5",{className:"modal-title",children:k.id.startsWith("custom_")?"カスタムフィールドを作成":"フィールドを編集"}),i.jsx("button",{type:"button",className:"btn-close",onClick:()=>S(!1),"aria-label":"Close"})]}),(0,i.jsxs)("div",{className:"modal-body",children:[(0,i.jsxs)("div",{className:"mb-3",children:[i.jsx("label",{className:"form-label",children:"フィールドタイプ"}),i.jsx("select",{className:"form-select",value:k.type,onChange:e=>C({...k,type:e.target.value}),children:n.map(e=>i.jsx("option",{value:e.value,children:e.label},e.value))})]}),(0,i.jsxs)("div",{className:"mb-3",children:[i.jsx("label",{className:"form-label",children:"ラベル"}),i.jsx("input",{type:"text",className:"form-control",value:k.label,onChange:e=>C({...k,label:e.target.value}),placeholder:"フィールドのラベルを入力"})]}),(0,i.jsxs)("div",{className:"mb-3",children:[i.jsx("label",{className:"form-label",children:"プレースホルダー"}),i.jsx("input",{type:"text",className:"form-control",value:k.placeholder||"",onChange:e=>C({...k,placeholder:e.target.value}),placeholder:"プレースホルダーテキストを入力（任意）"})]}),("select"===k.type||"radio"===k.type||"checkbox"===k.type)&&(0,i.jsxs)("div",{className:"mb-3",children:[i.jsx("label",{className:"form-label",children:"選択肢（1行に1つずつ入力）"}),i.jsx("textarea",{className:"form-control",rows:4,value:k.options?.join("\n")||"",onChange:e=>C({...k,options:e.target.value.split("\n").filter(e=>e.trim())}),placeholder:"選択肢1 選択肢2 選択肢3"})]}),(0,i.jsxs)("div",{className:"form-check",children:[i.jsx("input",{className:"form-check-input",type:"checkbox",id:"fieldRequired",checked:k.required||!1,onChange:e=>C({...k,required:e.target.checked})}),i.jsx("label",{className:"form-check-label",htmlFor:"fieldRequired",children:"必須項目にする"})]})]}),(0,i.jsxs)("div",{className:"modal-footer",children:[i.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>S(!1),children:"キャンセル"}),i.jsx("button",{type:"button",className:"btn btn-primary",onClick:()=>{if(!k)return;let e=f.findIndex(e=>e.id===k.id);if(e>=0){let s=[...f];s[e]=k,w(s)}else w([...f,k]);C(null),S(!1)},disabled:!k.label.trim(),children:"保存"})]})]})})})]}):null}function h(){let[e,s]=(0,l.useState)(!1);return(0,i.jsxs)(i.Fragment,{children:[i.jsx(r,{onCreateForm:()=>{s(!0)},onEditForm:e=>{window.location.href=`/admin?page=form-builder&id=${e}`}}),i.jsx(m,{isOpen:e,onClose:()=>s(!1),onSuccess:()=>{s(!1)}})]})}},241:(e,s,a)=>{a.d(s,{M:()=>l});var i=a(5442);class l{static async getAllProducts(){let{data:e,error:s}=await i.O.from("products").select(`
        *,
        product_categories (
          id,
          name,
          color
        )
      `).order("created_at",{ascending:!1});if(s)throw s;return e||[]}static async getActiveProducts(){let{data:e,error:s}=await i.O.from("products").select(`
        *,
        product_categories (
          id,
          name,
          color
        )
      `).eq("is_available",!0).order("display_order",{ascending:!0});if(s)throw s;return e||[]}static async getProductsByCategory(e){let{data:s,error:a}=await i.O.from("products").select(`
        *,
        product_categories (
          id,
          name,
          color
        )
      `).eq("category_id",e).eq("is_available",!0).order("display_order",{ascending:!0});if(a)throw a;return s||[]}static async createProduct(e){let{data:s,error:a}=await i.O.from("products").insert([{...e,category_id:e.category_id||null,tax_type:e.tax_type||"inclusive",is_available:!1!==e.is_available,display_order:e.display_order||0}]).select();if(a)throw a;return s[0]}static async updateProduct(e,s){let{data:a,error:l}=await i.O.from("products").update({...s,category_id:s.category_id||null}).eq("id",e).select();if(l)throw l;return a[0]}static async deleteProduct(e){let{error:s}=await i.O.from("products").delete().eq("id",e);if(s)throw s;return!0}static async getAllCategories(){let{data:e,error:s}=await i.O.from("product_categories").select("*").eq("is_active",!0).order("display_order",{ascending:!0});if(s)throw s;return e||[]}static async bulkImportProducts(e){let s={success:0,failed:0,errors:[],warnings:[]},a=[];for(let i=0;i<e.length;i++){let l=e[i],t=i+2;if(!l.name||""===l.name.trim()){s.failed++,s.errors.push(`行${t}: 商品名が入力されていません`);continue}void 0!==l.price&&(isNaN(Number(l.price))||0>Number(l.price))&&(s.warnings.push(`行${t}: 価格が無効です。0に設定されます`),l.price=0),!l.id&&await this.getProductByName(l.name.trim())&&s.warnings.push(`行${t}: 商品「${l.name}」は既に存在します`),a.push({...l,lineNumber:t})}for(let e of a)try{if(e.id){if(!await this.getProductById(e.id)){s.failed++,s.errors.push(`行${e.lineNumber}: ID「${e.id}」の商品が見つかりません`);continue}await this.updateProduct(e.id,{name:e.name.trim(),barcode:e.barcode?.trim()||void 0,price:e.price||0,variation_name:e.variation_name?.trim()||void 0,tax_type:e.tax_type||"inclusive",category_id:e.category_id||void 0,description:e.description?.trim()||void 0})}else await this.createProduct({name:e.name.trim(),barcode:e.barcode?.trim()||void 0,price:e.price||0,variation_name:e.variation_name?.trim()||void 0,tax_type:e.tax_type||"inclusive",category_id:e.category_id||void 0,description:e.description?.trim()||void 0,is_available:!0,display_order:0});s.success++}catch(i){s.failed++;let a=i?.message||i?.toString()||"不明なエラー";s.errors.push(`行${e.lineNumber}: 商品「${e.name}」: ${a}`)}return s}static async getProductByName(e){let{data:s,error:a}=await i.O.from("products").select("id, name").eq("name",e).limit(1);if(a)throw a;return s?.[0]||null}static async getProductById(e){let{data:s,error:a}=await i.O.from("products").select("*").eq("id",e).limit(1);if(a)throw a;return s?.[0]||null}static parseCSV(e){try{let s=e.replace(/\r\n/g,"\n").replace(/\r/g,"\n").trim().split("\n").filter(e=>e.trim());if(s.length<2)throw Error("CSVファイルが空か、ヘッダー行しかありません。最低でもヘッダー行とデータ行が必要です。");let a=s[0].trim();if(!a)throw Error("ヘッダー行が空です");let i=this.parseCSVLine(a).map(e=>e.trim().replace(/^["']|["']$/g,""));if(0===i.length)throw Error("ヘッダー行を解析できませんでした");let l=[],t=[],c=i.map(e=>e.toLowerCase()),r=["name"].filter(e=>!c.includes(e.toLowerCase()));if(r.length>0)throw Error(`必須の列が見つかりません: ${r.join(", ")}

検出された列: ${i.join(", ")}

列名は大文字小文字を区別しません。`);for(let e=1;e<s.length;e++){let a=s[e].trim();if(a)try{let s=this.parseCSVLine(a);s.length,i.length;let c={},r=!1;i.forEach((a,i)=>{let l=s[i]?.trim().replace(/^["']|["']$/g,"")||"";switch(a.toLowerCase()){case"id":l&&(c.id=l);break;case"name":l?c.name=l:(t.push(`行${e+1}: 商品名が入力されていません`),r=!0);break;case"barcode":l&&(c.barcode=l);break;case"price":if(l){let s=parseFloat(l.replace(/[￥,]/g,""));isNaN(s)||s<0?t.push(`行${e+1}: 価格「${l}」が無効です（数値または0以上の値を入力してください）`):c.price=s}break;case"variation_name":l&&(c.variation_name=l);break;case"tax_type":if(l){let s=l.toLowerCase().trim();"内税"===s||"inclusive"===s?c.tax_type="inclusive":"外税"===s||"exclusive"===s?c.tax_type="exclusive":["inclusive","exclusive"].includes(s)?c.tax_type=s:t.push(`行${e+1}: 税区分「${l}」が無効です（内税/外税 または inclusive/exclusiveのみ）`)}break;case"category_id":l&&(c.category_id=l);break;case"description":l&&(c.description=l)}}),!r&&c.name&&l.push(c)}catch(s){t.push(`行${e+1}: 行の解析に失敗しました - ${s.message}`)}}if(t.length>0){let e=`CSVファイルに${t.length}個のエラーがあります:

${t.join("\n")}`;throw Error(e)}if(0===l.length)throw Error("有効な商品データが見つかりませんでした。\n\n以下を確認してください:\n• name列に値が入力されているか\n• データ行が存在するか\n• ファイル形式が正しいか");return l}catch(s){let e=s.message||"不明なエラーが発生しました";throw Error(`CSV解析エラー: ${e}`)}}static parseCSVLine(e){let s=[],a="",i=!1;for(let l=0;l<e.length;l++){let t=e[l];'"'===t||"'"===t?i&&e[l+1]===t?(a+=t,l++):i=!i:","!==t||i?a+=t:(s.push(a),a="")}return s.push(a),s}static generateCSVTemplate(e){return"id,name,barcode,price,variation_name,tax_type,category_id,description\n"+["","トマト苗","4901234567890","300","通常価格","inclusive",e[0]?.id||"","中玉トマトの苗"].join(",")}static async exportToCSV(){return["id,name,barcode,price,variation_name,tax_type,category_id,description",...(await this.getAllProducts()).map(e=>[e.id,`"${e.name}"`,e.barcode||"",e.price,e.variation_name||"",e.tax_type||"",e.category_id||"",`"${e.description||""}"`].join(","))].join("\n")}}}};