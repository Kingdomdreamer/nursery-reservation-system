"use strict";exports.id=553,exports.ids=[553],exports.modules={9553:(e,s,a)=>{a.d(s,{Z:()=>c});var l=a(326),r=a(7577),i=a(241),t=a(1058);function c(){let{showSuccess:e,showError:s,showWarning:a}=(0,t.p)(),[c,n]=(0,r.useState)([]),[d,o]=(0,r.useState)(!1),[m,x]=(0,r.useState)("single"),[h,b]=(0,r.useState)(null),[u,j]=(0,r.useState)(""),[g,p]=(0,r.useState)([]),[v,N]=(0,r.useState)(!1),[f,y]=(0,r.useState)({name:"",category_id:"",description:"",price:0,barcode:"",variation_name:"",tax_type:"inclusive",image_url:"",is_available:!0,display_order:0}),[w,C]=(0,r.useState)(null),[_,S]=(0,r.useState)(!1);(0,r.useCallback)(async()=>{try{let e=await i.M.getAllCategories();n(e)}catch(e){s("カテゴリの取得に失敗しました","カテゴリ情報を読み込めませんでした。ページを再読み込みしてください。"),n([])}},[]);let k=async e=>new Promise((s,a)=>{let l=new FileReader;l.onload=e=>{s(e.target?.result)},l.onerror=()=>a(Error("ファイルの読み込みに失敗しました")),l.readAsDataURL(e)}),V=async()=>{if(!w)return"";S(!0);try{return await k(w)}catch(e){return s("画像のアップロードに失敗しました","画像の処理中にエラーが発生しました。"),""}finally{S(!1)}},F=async a=>{a.preventDefault(),o(!0);try{let s=f.image_url;if(w&&!(s=await V())){o(!1);return}await i.M.createProduct({...f,category_id:f.category_id||void 0,image_url:s}),e("商品を追加しました","商品が正常に登録されました。"),y({name:"",category_id:"",description:"",price:0,barcode:"",variation_name:"",tax_type:"inclusive",image_url:"",is_available:!0,display_order:0}),C(null)}catch(e){s("商品の追加に失敗しました",e?.message||"商品の登録中にエラーが発生しました。")}finally{o(!1)}},E=async()=>{if(!h){s("ファイル未選択","CSVファイルを選択してください");return}try{if(h.size>1048576)throw Error(`ファイルサイズが大きすぎます（${Math.round(1)}MB以下のファイルをアップロードしてください）
現在のサイズ: ${Math.round(h.size/1024*100)/100}KB

大きなファイルの場合は、行数を減らしてから再度お試しください。`);if(0===h.size)throw Error("ファイルが空です");if(!h.name.toLowerCase().endsWith(".csv")&&!h.name.toLowerCase().endsWith(".txt"))throw Error("CSVファイル（.csv または .txt）をアップロードしてください");let s=(await new Promise((e,s)=>{let a=new FileReader,l=setTimeout(()=>{a.abort(),s(Error("ファイル読み込みがタイムアウトしました（30秒）\n\nファイルサイズが大きすぎるか、システムリソースが不足している可能性があります。"))},3e4);a.onloadstart=()=>{},a.onprogress=e=>{e.lengthComputable&&(e.loaded,e.total)},a.onload=a=>{if(clearTimeout(l),a.target?.result){let s=a.target.result;e(s)}else s(Error("ファイルの読み込み結果が空です"))},a.onerror=e=>{clearTimeout(l);let r="ファイル読み込みエラー";if(a.error)switch(a.error.name){case"NotReadableError":r="ファイルが読み取れません（ファイルが破損しているか、使用中の可能性があります）";break;case"SecurityError":r="セキュリティエラー（ファイルへのアクセス権限がありません）";break;case"NotFoundError":r="ファイルが見つかりません";break;case"EncodingError":r="ファイルエンコーディングエラー（UTF-8以外の文字コードの可能性があります）";break;default:r=`ファイル読み込みエラー: ${a.error.message}`}s(Error(`${r}

対処方法:
• ファイルを一度保存し直す
• 文字エンコーディングをUTF-8にする
• ファイルサイズを小さくする
• 別のCSVファイルで試す`))},a.onabort=()=>{clearTimeout(l),s(Error("ファイルの読み込みが中断されました"))};try{a.readAsText(h,"UTF-8")}catch(e){clearTimeout(l),s(Error(`FileReader 起動エラー: ${e instanceof Error?e.message:"不明なエラー"}`))}})).replace(/^\uFEFF/,"");if(!s.trim())throw Error("ファイルが空または読み取れませんでした");if(s.split(/\r?\n/).filter(e=>e.trim()).length<2)throw Error("CSVファイルにはヘッダー行とデータ行が必要です（最低2行）");j(s);let l=i.M.parseCSV(s);p(l),N(!0),l.length>0?e("CSVプレビュー成功",`${l.length}件の商品データを読み込みました`):a("データなし","有効な商品データが見つかりませんでした")}catch(a){let e=a?.message||"ファイルの読み込みに失敗しました";e.includes("Permission")?e="ファイルへのアクセス権限がありません。ファイルを再選択してください。":e.includes("encoding")?e="ファイルの文字エンコーディングが正しくありません。UTF-8形式で保存し直してください。":e.includes("required")&&(e="CSVファイルに必須列（name）が含まれていません。"),s("CSVファイルの解析に失敗しました",`${e}

以下を確認してください:
• ファイル形式：CSV形式（.csv または .txt）
• 文字エンコーディング：UTF-8推奨
• 必須列：name列の存在
• ファイルサイズ：10MB以下
• 権限：ファイルにアクセス可能`),p([]),N(!1)}},$=async()=>{if(0!==g.length){o(!0);try{let e=await i.M.bulkImportProducts(g),s=`処理結果:
成功: ${e.success}件
失敗: ${e.failed}件`;e.warnings&&e.warnings.length>0&&(s+=`

⚠️ 警告:
${e.warnings.join("\n")}`),e.errors.length>0&&(s+=`

❌ エラー:
${e.errors.join("\n")}`),0===e.failed&&0===e.errors.length&&(s+="\n\n✅ すべての商品が正常に処理されました！"),confirm(s+"\n\n処理を完了しますか？")&&(b(null),j(""),p([]),N(!1))}catch(a){let e=a?.message||a?.toString()||"不明なエラーが発生しました";s("CSV インポートに失敗しました",`${e}

CSVファイルの形式を確認してください。`)}finally{o(!1)}}},T=()=>i.M.generateCSVTemplate(c),M=async()=>{try{let e=await i.M.exportToCSV(),s=new Blob([e],{type:"text/csv;charset=utf-8;"}),a=document.createElement("a");a.href=URL.createObjectURL(s),a.download=`products_export_${new Date().toISOString().split("T")[0]}.csv`,a.click()}catch(e){s("CSV エクスポートに失敗しました",e?.message||"エクスポート処理中にエラーが発生しました。")}};return(0,l.jsxs)("div",{children:[l.jsx("div",{className:"row mb-4",children:l.jsx("div",{className:"col-12",children:(0,l.jsxs)("div",{className:"d-flex justify-content-between align-items-center",children:[(0,l.jsxs)("div",{children:[l.jsx("h2",{className:"h3 fw-bold text-dark",children:"商品追加"}),l.jsx("p",{className:"text-muted",children:"新しい商品を登録または一括アップロードします"})]}),(0,l.jsxs)("div",{className:"d-flex gap-3",children:[(0,l.jsxs)("button",{onClick:()=>{let e=new Blob([T()],{type:"text/csv;charset=utf-8;"}),s=document.createElement("a");s.href=URL.createObjectURL(e),s.download="product_template.csv",s.click()},className:"btn btn-outline-secondary d-flex align-items-center gap-2",title:"CSV形式のテンプレートファイルをダウンロード",children:[l.jsx("i",{className:"bi bi-file-earmark-spreadsheet"}),"CSVテンプレート"]}),(0,l.jsxs)("button",{onClick:M,className:"btn btn-outline-primary d-flex align-items-center gap-2",title:"現在の商品データをCSV形式でエクスポート",children:[l.jsx("i",{className:"bi bi-download"}),"商品エクスポート"]})]})]})})}),(0,l.jsxs)("div",{className:"card",children:[l.jsx("div",{className:"card-header bg-light",children:(0,l.jsxs)("nav",{className:"nav nav-tabs card-header-tabs",children:[(0,l.jsxs)("button",{onClick:()=>x("single"),className:`nav-link ${"single"===m?"active":""}`,style:"single"===m?{background:"linear-gradient(135deg, #8bc34a 0%, #7cb342 100%)",color:"white",border:"none"}:{},children:[l.jsx("i",{className:"bi bi-plus-circle me-2"}),"単一商品追加",l.jsx("span",{className:"badge bg-light text-dark ms-2",children:"推奨"})]}),(0,l.jsxs)("button",{onClick:()=>x("csv"),className:`nav-link ${"csv"===m?"active":""}`,style:"csv"===m?{background:"linear-gradient(135deg, #8bc34a 0%, #7cb342 100%)",color:"white",border:"none"}:{},children:[l.jsx("i",{className:"bi bi-file-earmark-spreadsheet me-2"}),"CSV一括追加",l.jsx("span",{className:"badge bg-warning text-dark ms-2",children:"上級者向け"})]})]})}),l.jsx("div",{className:"card-body",children:"single"===m?(0,l.jsxs)("form",{onSubmit:F,children:[(0,l.jsxs)("div",{className:"row g-3",children:[(0,l.jsxs)("div",{className:"col-md-6",children:[l.jsx("label",{className:"form-label fw-medium",children:"商品名 *"}),l.jsx("input",{type:"text",value:f.name,onChange:e=>y({...f,name:e.target.value}),required:!0,className:"form-control"})]}),(0,l.jsxs)("div",{className:"col-md-6",children:[l.jsx("label",{className:"form-label fw-medium",children:"カテゴリ"}),(0,l.jsxs)("select",{value:f.category_id,onChange:e=>y({...f,category_id:e.target.value}),className:"form-select",children:[l.jsx("option",{value:"",children:"カテゴリを選択"}),c.map(e=>l.jsx("option",{value:e.id,children:e.name},e.id))]})]}),(0,l.jsxs)("div",{className:"col-md-6",children:[l.jsx("label",{className:"form-label fw-medium",children:"価格 *"}),l.jsx("input",{type:"number",value:f.price,onChange:e=>y({...f,price:Number(e.target.value)}),required:!0,min:"0",step:"0.01",className:"form-control"})]}),(0,l.jsxs)("div",{className:"col-md-6",children:[l.jsx("label",{className:"form-label fw-medium",children:"JANコード"}),l.jsx("input",{type:"text",value:f.barcode,onChange:e=>y({...f,barcode:e.target.value}),className:"form-control"})]}),(0,l.jsxs)("div",{className:"col-md-6",children:[l.jsx("label",{className:"form-label fw-medium",children:"価格バリエーション名"}),l.jsx("input",{type:"text",value:f.variation_name,onChange:e=>y({...f,variation_name:e.target.value}),placeholder:"例: 通常価格、予約価格",className:"form-control"})]}),(0,l.jsxs)("div",{className:"col-md-6",children:[l.jsx("label",{className:"form-label fw-medium",children:"税区分"}),(0,l.jsxs)("select",{value:f.tax_type,onChange:e=>y({...f,tax_type:e.target.value}),className:"form-select",children:[l.jsx("option",{value:"inclusive",children:"税込"}),l.jsx("option",{value:"exclusive",children:"税抜"})]})]})]}),l.jsx("div",{className:"row g-3 mt-3",children:(0,l.jsxs)("div",{className:"col-12",children:[l.jsx("label",{className:"form-label fw-medium",children:"商品説明"}),l.jsx("textarea",{value:f.description,onChange:e=>y({...f,description:e.target.value}),rows:3,className:"form-control"})]})}),l.jsx("div",{className:"row g-3 mt-3",children:(0,l.jsxs)("div",{className:"col-12",children:[l.jsx("label",{className:"form-label fw-medium",children:"商品画像"}),(0,l.jsxs)("div",{className:"d-flex flex-column gap-3",children:[l.jsx("input",{type:"file",accept:"image/*",onChange:e=>{let a=e.target.files?.[0];if(a){if(a.size>5242880){s("ファイルサイズが大きすぎます","5MB以下のファイルを選択してください。");return}if(!a.type.startsWith("image/")){s("不正なファイル形式です","画像ファイルを選択してください。");return}C(a)}},className:"d-none",id:"image-upload"}),(0,l.jsxs)("label",{htmlFor:"image-upload",className:"btn btn-outline-secondary d-inline-flex align-items-center gap-2 w-fit",children:[l.jsx("i",{className:"bi bi-cloud-upload"}),"画像を選択"]}),w&&(0,l.jsxs)("div",{className:"d-flex align-items-center gap-3",children:[(0,l.jsxs)("div",{className:"text-muted small",children:["選択されたファイル: ",w.name]}),l.jsx("button",{type:"button",onClick:()=>C(null),className:"btn btn-outline-danger btn-sm",children:l.jsx("i",{className:"bi bi-x-circle"})})]}),w&&l.jsx("div",{className:"mt-2",children:l.jsx("img",{src:URL.createObjectURL(w),alt:"商品画像プレビュー",className:"rounded border",style:{width:"128px",height:"128px",objectFit:"cover"}})}),l.jsx("div",{className:"text-muted small",children:"推奨サイズ: 400x400px以上、最大5MB"})]})]})}),l.jsx("div",{className:"row g-3 mt-3",children:l.jsx("div",{className:"col-12",children:(0,l.jsxs)("div",{className:"form-check",children:[l.jsx("input",{type:"checkbox",id:"is_available",checked:f.is_available,onChange:e=>y({...f,is_available:e.target.checked}),className:"form-check-input"}),l.jsx("label",{htmlFor:"is_available",className:"form-check-label fw-medium",children:"販売中として追加"})]})})}),l.jsx("div",{className:"row g-3 mt-4",children:l.jsx("div",{className:"col-12",children:(0,l.jsxs)("div",{className:"d-flex justify-content-end gap-3",children:[l.jsx("button",{type:"button",onClick:()=>{y({name:"",category_id:"",description:"",price:0,barcode:"",variation_name:"",tax_type:"inclusive",image_url:"",is_available:!0,display_order:0}),C(null)},className:"btn btn-outline-secondary",children:"リセット"}),l.jsx("button",{type:"submit",disabled:d||_,className:"btn text-white",style:{background:"linear-gradient(135deg, #8bc34a 0%, #7cb342 100%)",border:"none"},children:d||_?(0,l.jsxs)(l.Fragment,{children:[l.jsx("span",{className:"spinner-border spinner-border-sm me-2"}),_?"画像処理中...":"追加中..."]}):(0,l.jsxs)(l.Fragment,{children:[l.jsx("i",{className:"bi bi-check-circle me-2"}),"商品を追加する"]})})]})})})]}):(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{className:"alert alert-info",children:[l.jsx("h5",{className:"alert-heading",children:"CSV形式について"}),l.jsx("p",{className:"mb-3",children:"以下の列を含むCSVファイルをアップロードしてください："}),(0,l.jsxs)("div",{className:"small",children:[(0,l.jsxs)("div",{children:[l.jsx("strong",{children:"id:"})," 既存商品ID（更新時のみ）"]}),(0,l.jsxs)("div",{children:[l.jsx("strong",{children:"name:"})," 商品名（必須）"]}),(0,l.jsxs)("div",{children:[l.jsx("strong",{children:"barcode:"})," JANコード（任意）"]}),(0,l.jsxs)("div",{children:[l.jsx("strong",{children:"price:"})," 価格（任意、デフォルト0）"]}),(0,l.jsxs)("div",{children:[l.jsx("strong",{children:"variation_name:"})," 価格バリエーション名（任意）"]}),(0,l.jsxs)("div",{children:[l.jsx("strong",{children:"tax_type:"})," 税区分（任意、inclusive/exclusive）"]}),(0,l.jsxs)("div",{children:[l.jsx("strong",{children:"category_id:"})," カテゴリID（任意）"]}),(0,l.jsxs)("div",{children:[l.jsx("strong",{children:"description:"})," 商品説明（任意）"]})]})]}),(0,l.jsxs)("div",{className:"mb-4",children:[l.jsx("label",{className:"form-label fw-medium",children:"CSVファイルをアップロード"}),(0,l.jsxs)("div",{className:"d-flex flex-column gap-3",children:[l.jsx("input",{type:"file",accept:".csv,.txt",onChange:e=>{let s=e.target.files?.[0];s&&(b(s),N(!1),p([]))},className:"d-none",id:"csv-upload"}),(0,l.jsxs)("label",{htmlFor:"csv-upload",className:"btn btn-outline-secondary d-inline-flex align-items-center gap-2 w-fit",style:{cursor:"pointer"},children:[l.jsx("i",{className:"bi bi-file-earmark-spreadsheet fs-5"}),h?"ファイルを変更":"CSVファイルを選択"]}),h&&l.jsx("div",{className:"p-3 bg-primary bg-opacity-10 border border-primary border-opacity-25 rounded",children:(0,l.jsxs)("div",{className:"d-flex align-items-center gap-2",children:[l.jsx("i",{className:"bi bi-file-earmark-spreadsheet text-primary fs-5"}),(0,l.jsxs)("div",{children:[l.jsx("div",{className:"fw-medium text-primary",children:h.name}),(0,l.jsxs)("div",{className:"small text-primary text-opacity-75",children:["ファイルサイズ: ",(h.size/1024).toFixed(1)," KB"]})]})]})})]})]}),(0,l.jsxs)("div",{className:"d-flex gap-3 mb-4",children:[(0,l.jsxs)("button",{onClick:E,disabled:!h,className:"btn btn-outline-primary d-flex align-items-center gap-2",children:[l.jsx("i",{className:"bi bi-eye"}),"プレビュー"]}),v&&l.jsx("button",{onClick:$,disabled:d||0===g.length,className:"btn text-white",style:{background:"linear-gradient(135deg, #8bc34a 0%, #7cb342 100%)",border:"none"},children:d?(0,l.jsxs)(l.Fragment,{children:[l.jsx("span",{className:"spinner-border spinner-border-sm me-2"}),"インポート中..."]}):(0,l.jsxs)(l.Fragment,{children:[l.jsx("i",{className:"bi bi-upload me-2"}),g.length,"件をインポート"]})})]}),v&&g.length>0&&(0,l.jsxs)("div",{className:"card",children:[l.jsx("div",{className:"card-header bg-light",children:(0,l.jsxs)("h5",{className:"card-title mb-0",children:["プレビュー (",g.length,"件)"]})}),l.jsx("div",{className:"card-body p-0",children:l.jsx("div",{className:"table-responsive",children:(0,l.jsxs)("table",{className:"table table-striped table-hover mb-0",children:[l.jsx("thead",{className:"table-light",children:(0,l.jsxs)("tr",{children:[l.jsx("th",{className:"px-3 py-2 fw-medium text-secondary",children:"商品名"}),l.jsx("th",{className:"px-3 py-2 fw-medium text-secondary",children:"価格"}),l.jsx("th",{className:"px-3 py-2 fw-medium text-secondary",children:"バリエーション"}),l.jsx("th",{className:"px-3 py-2 fw-medium text-secondary",children:"JANコード"}),l.jsx("th",{className:"px-3 py-2 fw-medium text-secondary",children:"操作"})]})}),l.jsx("tbody",{children:g.map((e,s)=>(0,l.jsxs)("tr",{children:[l.jsx("td",{className:"px-3 py-2",children:e.name}),(0,l.jsxs)("td",{className:"px-3 py-2",children:["\xa5",(e.price||0).toLocaleString()]}),l.jsx("td",{className:"px-3 py-2 text-muted",children:e.variation_name||"-"}),l.jsx("td",{className:"px-3 py-2 text-muted",children:e.barcode||"-"}),l.jsx("td",{className:"px-3 py-2",children:l.jsx("span",{className:`badge ${e.id?"bg-warning text-dark":"bg-success"}`,children:e.id?"更新":"新規"})})]},s))})]})})})]})]})})]})]})}}};