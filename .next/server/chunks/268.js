"use strict";exports.id=268,exports.ids=[268],exports.modules={268:(e,s,a)=>{a.d(s,{Z:()=>c});var l=a(326),t=a(7577),i=a(5442);function c(){let[e,s]=(0,t.useState)([]),[a,c]=(0,t.useState)(null),[n,d]=(0,t.useState)(!1),[r,m]=(0,t.useState)(!1),[o,x]=(0,t.useState)(!0),b=[{value:"reservation_confirmation",label:"予約確定通知",icon:"✅"},{value:"reservation_reminder",label:"予約リマインダー",icon:"⏰"},{value:"payment_confirmation",label:"支払い確認通知",icon:"\uD83D\uDCB0"},{value:"cancellation",label:"キャンセル通知",icon:"❌"}],h=async()=>{try{let{data:e,error:a}=await i.O.from("line_templates").select("*").order("created_at",{ascending:!1});if(a)throw a;s(e||[]),e&&e.length>0&&c(e[0])}catch(e){s([])}finally{x(!1)}},u=async()=>{if(a)try{let{error:e}=await i.O.from("line_templates").update({name:a.name,template_type:a.template_type,subject:a.subject,message:a.message,is_active:a.is_active}).eq("id",a.id);if(e)throw e;await h(),d(!1),alert("テンプレートが保存されました！")}catch(e){alert("テンプレートの保存に失敗しました。")}},p=async()=>{try{let{data:e,error:s}=await i.O.from("line_templates").insert([{name:"新しいテンプレート",template_type:"reservation_confirmation",subject:"",message:"",is_active:!1}]).select().single();if(s)throw s;await h(),c(e),d(!0)}catch(e){alert("テンプレートの作成に失敗しました。")}},j=async s=>{if(confirm("このテンプレートを削除しますか？"))try{let{error:l}=await i.O.from("line_templates").delete().eq("id",s);if(l)throw l;await h(),a?.id===s&&c(e[0]||null),alert("テンプレートが削除されました。")}catch(e){alert("テンプレートの削除に失敗しました。")}},v=async s=>{let a=e.find(e=>e.id===s);if(a)try{let{error:e}=await i.O.from("line_templates").update({is_active:!a.is_active}).eq("id",s);if(e)throw e;await h()}catch(e){alert("テンプレートの有効/無効の切り替えに失敗しました。")}};return o?l.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{height:"256px"},children:l.jsx("div",{className:"loading-spinner"})}):(0,l.jsxs)("div",{className:"row g-0",style:{height:"600px"},children:[l.jsx("div",{className:"col-lg-4 col-md-5",children:(0,l.jsxs)("div",{className:"card h-100",children:[l.jsx("div",{className:"card-header",children:(0,l.jsxs)("div",{className:"d-flex justify-content-between align-items-center",children:[l.jsx("h6",{className:"mb-0",children:"LINEテンプレート"}),(0,l.jsxs)("button",{onClick:p,className:"btn btn-primary btn-sm",children:[l.jsx("i",{className:"bi bi-plus-lg me-1"}),"新規作成"]})]})}),l.jsx("div",{className:"card-body overflow-auto",children:e.map(e=>l.jsx("div",{className:`card mb-3 cursor-pointer ${a?.id===e.id?"border-primary bg-primary-subtle":"border-light"}`,onClick:()=>c(e),style:{cursor:"pointer"},children:(0,l.jsxs)("div",{className:"card-body p-3",children:[(0,l.jsxs)("div",{className:"d-flex justify-content-between align-items-start mb-2",children:[(0,l.jsxs)("div",{className:"d-flex align-items-center gap-2",children:[l.jsx("span",{className:"fs-5",children:b.find(s=>s.value===e.template_type)?.icon}),(0,l.jsxs)("div",{children:[l.jsx("div",{className:"fw-medium small",children:e.name}),l.jsx("div",{className:"text-muted",style:{fontSize:"0.75rem"},children:b.find(s=>s.value===e.template_type)?.label})]})]}),(0,l.jsxs)("div",{className:"d-flex gap-1",children:[l.jsx("button",{onClick:s=>{s.stopPropagation(),v(e.id)},className:`btn btn-sm ${e.is_active?"btn-success":"btn-outline-secondary"}`,children:l.jsx("i",{className:`bi ${e.is_active?"bi-check":"bi-circle"}`})}),l.jsx("button",{onClick:s=>{s.stopPropagation(),j(e.id)},className:"btn btn-outline-danger btn-sm",children:l.jsx("i",{className:"bi bi-trash"})})]})]}),(0,l.jsxs)("div",{className:"text-muted",style:{fontSize:"0.75rem"},children:["最終更新: ",new Date(e.updated_at).toLocaleDateString()]})]})},e.id))})]})}),a&&l.jsx("div",{className:"col-lg-8 col-md-7",children:(0,l.jsxs)("div",{className:"card h-100",children:[l.jsx("div",{className:"card-header",children:(0,l.jsxs)("div",{className:"d-flex justify-content-between align-items-center",children:[l.jsx("h5",{className:"mb-0",children:"テンプレート編集"}),(0,l.jsxs)("div",{className:"d-flex gap-2",children:[(0,l.jsxs)("button",{onClick:()=>m(!r),className:`btn btn-sm ${r?"btn-warning":"btn-outline-secondary"}`,children:[l.jsx("i",{className:`bi ${r?"bi-pencil":"bi-eye"} me-1`}),r?"編集":"プレビュー"]}),n?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("button",{onClick:u,className:"btn btn-success btn-sm",children:[l.jsx("i",{className:"bi bi-check-lg me-1"}),"保存"]}),l.jsx("button",{onClick:()=>d(!1),className:"btn btn-secondary btn-sm",children:"キャンセル"})]}):(0,l.jsxs)("button",{onClick:()=>d(!0),className:"btn btn-primary btn-sm",children:[l.jsx("i",{className:"bi bi-pencil me-1"}),"編集"]})]})]})}),l.jsx("div",{className:"card-body overflow-auto",children:r?l.jsx("div",{children:(0,l.jsxs)("div",{className:"alert alert-success border",children:[(0,l.jsxs)("h6",{className:"alert-heading fw-medium",children:[l.jsx("i",{className:"bi bi-phone me-2"}),"LINEメッセージ プレビュー"]}),(0,l.jsxs)("div",{className:"bg-white rounded p-3 border mt-3",children:[(0,l.jsxs)("div",{className:"fw-medium text-muted mb-2 small",children:["件名: ",a.subject]}),l.jsx("div",{className:"text-dark",style:{whiteSpace:"pre-line",lineHeight:"1.5"},children:(()=>{if(!a)return"";let e=a.message||"";return Object.entries({customer_name:"山田太郎",reservation_id:"R20240101001",phone_number:"090-1234-5678",reservation_date:"2024年1月15日",pickup_time:"10:00-12:00",product_list:"有機肥料A \xd7 2袋\nトマト苗 \xd7 10株",total_amount:"15,000",payment_amount:"15,000",payment_method:"クレジットカード",payment_date:"2024年1月14日 15:30",cancellation_date:"2024年1月14日 16:00",cancellation_reason:"お客様都合",shop_name:"グリーンファーム種苗店",shop_phone:"03-1234-5678"}).forEach(([s,a])=>{e=e.replace(RegExp(`{${s}}`,"g"),a)}),e})()})]})]})}):(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{className:"row g-3 mb-4",children:[(0,l.jsxs)("div",{className:"col-md-6",children:[l.jsx("label",{className:"form-label fw-medium",children:"テンプレート名"}),l.jsx("input",{type:"text",value:a.name,onChange:e=>c({...a,name:e.target.value}),disabled:!n,className:"form-control"})]}),(0,l.jsxs)("div",{className:"col-md-6",children:[l.jsx("label",{className:"form-label fw-medium",children:"テンプレートタイプ"}),l.jsx("select",{value:a.template_type,onChange:e=>c({...a,template_type:e.target.value}),disabled:!n,className:"form-select",children:b.map(e=>(0,l.jsxs)("option",{value:e.value,children:[e.icon," ",e.label]},e.value))})]})]}),(0,l.jsxs)("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"件名"}),l.jsx("input",{type:"text",value:a.subject,onChange:e=>c({...a,subject:e.target.value}),disabled:!n,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:bg-gray-50",placeholder:"メッセージの件名を入力"})]}),(0,l.jsxs)("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"メッセージ本文"}),l.jsx("textarea",{value:a.message,onChange:e=>c({...a,message:e.target.value}),disabled:!n,className:"form-control",rows:12,placeholder:"メッセージ本文を入力してください。変数は {variable_name} の形式で使用できます。"})]}),(0,l.jsxs)("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"利用可能な変数"}),l.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:(0,l.jsxs)("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[(0,l.jsxs)("div",{className:"space-y-1",children:[(0,l.jsxs)("div",{children:[l.jsx("code",{className:"bg-blue-100 px-2 py-1 rounded text-blue-800",children:"{customer_name}"})," - お客様名"]}),(0,l.jsxs)("div",{children:[l.jsx("code",{className:"bg-blue-100 px-2 py-1 rounded text-blue-800",children:"{reservation_id}"})," - 予約番号"]}),(0,l.jsxs)("div",{children:[l.jsx("code",{className:"bg-blue-100 px-2 py-1 rounded text-blue-800",children:"{phone_number}"})," - 電話番号"]}),(0,l.jsxs)("div",{children:[l.jsx("code",{className:"bg-blue-100 px-2 py-1 rounded text-blue-800",children:"{reservation_date}"})," - 予約日"]})]}),(0,l.jsxs)("div",{className:"space-y-1",children:[(0,l.jsxs)("div",{children:[l.jsx("code",{className:"bg-blue-100 px-2 py-1 rounded text-blue-800",children:"{product_list}"})," - 商品一覧"]}),(0,l.jsxs)("div",{children:[l.jsx("code",{className:"bg-blue-100 px-2 py-1 rounded text-blue-800",children:"{total_amount}"})," - 合計金額"]}),(0,l.jsxs)("div",{children:[l.jsx("code",{className:"bg-blue-100 px-2 py-1 rounded text-blue-800",children:"{shop_name}"})," - 店舗名"]}),(0,l.jsxs)("div",{children:[l.jsx("code",{className:"bg-blue-100 px-2 py-1 rounded text-blue-800",children:"{shop_phone}"})," - 店舗電話"]})]})]})})]}),(0,l.jsxs)("div",{className:"flex items-center",children:[l.jsx("input",{type:"checkbox",id:"isActive",checked:a.is_active,onChange:e=>c({...a,is_active:e.target.checked}),disabled:!n,className:"mr-2"}),l.jsx("label",{htmlFor:"isActive",className:"text-sm font-medium text-gray-700",children:"このテンプレートを有効にする"})]})]})})]})})]})}}};