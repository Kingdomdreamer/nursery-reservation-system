"use strict";exports.id=449,exports.ids=[449],exports.modules={1449:(e,t,s)=>{s.d(t,{Z:()=>r});var i=s(326),a=s(7577),l=s(5442);class c{static getStatusBadgeClasses(e){let t={active:{bg:"bg-green-100",text:"text-green-800",label:"アクティブ"},inactive:{bg:"bg-gray-100",text:"text-gray-800",label:"無効"},pending:{bg:"bg-blue-100",text:"text-blue-800",label:"保留中"},confirmed:{bg:"bg-green-100",text:"text-green-800",label:"確定"},cancelled:{bg:"bg-red-100",text:"text-red-800",label:"キャンセル"},completed:{bg:"bg-purple-100",text:"text-purple-800",label:"完了"},expired:{bg:"bg-red-100",text:"text-red-800",label:"期限切れ"},preparing:{bg:"bg-yellow-100",text:"text-yellow-800",label:"準備中"}};return t[e]||t.inactive}static formatDate(e,t){if(!e)return"";let s={year:"numeric",month:"2-digit",day:"2-digit",...t};return new Date(e).toLocaleDateString("ja-JP",s)}static formatDateTime(e){return e?new Date(e).toLocaleDateString("ja-JP",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):""}static formatPrice(e){return`\xa5${e.toLocaleString()}`}static isDateInRange(e,t,s){return(!t||!(e<t))&&(!s||!(e>s))}static calculateDaysUntil(e){let t=new Date;return Math.ceil((new Date(e).getTime()-t.getTime())/864e5)}static getValidityPeriodText(e,t){return e||t?e&&t?`${this.formatDate(e)} - ${this.formatDate(t)}`:e?`${this.formatDate(e)}から`:t?`${this.formatDate(t)}まで`:"期限なし":"期限なし"}}class d{static async getAllForms(){let{data:e,error:t}=await l.OQ.from("form_configurations").select(`
        id,
        name,
        description,
        form_fields,
        settings,
        is_active,
        valid_from,
        valid_to,
        version,
        created_at,
        updated_at
      `).order("updated_at",{ascending:!1});if(t)throw t;let{data:s,error:i}=await l.OQ.from("reservations").select("form_id").not("form_id","is",null);i&&console.warn("Failed to fetch response counts:",i);let a=new Map;return s?.forEach(e=>{let t=a.get(e.form_id)||0;a.set(e.form_id,t+1)}),e?.map(e=>({...e,settings:e.settings||{},version:e.version||1,field_count:e.form_fields?.fields?.length||0,response_count:a.get(e.id)||0}))||[]}static async createForm(e){let{data:t,error:s}=await l.OQ.from("form_configurations").insert([{name:e.name,description:e.description,form_fields:{fields:e.fields},is_active:e.isActive,valid_from:e.validFrom||null,valid_to:e.validTo||null,selected_products:e.selectedProducts||[]}]).select();if(s)throw s;return t[0]}static async updateForm(e,t){let s={};t.name&&(s.name=t.name),t.description&&(s.description=t.description),t.fields&&(s.form_fields={fields:t.fields}),void 0!==t.isActive&&(s.is_active=t.isActive),void 0!==t.validFrom&&(s.valid_from=t.validFrom||null),void 0!==t.validTo&&(s.valid_to=t.validTo||null),t.selectedProducts&&(s.selected_products=t.selectedProducts);let{data:i,error:a}=await l.OQ.from("form_configurations").update(s).eq("id",e).select();if(a)throw a;return i[0]}static async deleteForm(e){let{error:t}=await l.OQ.from("form_configurations").delete().eq("id",e);if(t)throw t;return!0}static async getFormById(e){let{data:t,error:s}=await l.OQ.from("form_configurations").select("*").eq("id",e).single();if(s)throw s;return t}static async toggleFormStatus(e,t){let{error:s}=await l.OQ.from("form_configurations").update({is_active:t}).eq("id",e);if(s)throw s;return!0}static isFormAccessible(e){if(!e.is_active)return!1;let t=new Date,s=e.valid_from?new Date(e.valid_from):null,i=e.valid_to?new Date(e.valid_to):null;return(!s||!(t<s))&&(!i||!(t>i))}static getFormStatus(e){if(!e.is_active)return"inactive";let t=new Date,s=e.valid_from?new Date(e.valid_from):null,i=e.valid_to?new Date(e.valid_to):null;return s&&t<s?"pending":i&&t>i?"expired":"active"}static getValidityPeriodText(e,t){return c.getValidityPeriodText(e,t)}static async checkFormConfiguration(){try{let e=await this.getAllForms(),t=0,s=0,i=0,a=[],l=[],c=new Date;return e.forEach(e=>{let d=this.getFormStatus(e);switch(d){case"active":t++;break;case"inactive":s++;break;case"expired":i++,a.push(`フォーム「${e.name}」が有効期限切れです`);break;case"pending":a.push(`フォーム「${e.name}」がまだ開始されていません`)}if(0===e.field_count&&a.push(`フォーム「${e.name}」にフィールドが設定されていません`),0===e.response_count&&"active"===d&&l.push(`フォーム「${e.name}」はアクティブですが回答がありません`),e.valid_to){let t=new Date(e.valid_to),s=Math.ceil((t.getTime()-c.getTime())/864e5);s<=7&&s>0&&"active"===d&&l.push(`フォーム「${e.name}」が${s}日後に有効期限切れになります`)}}),0===t&&a.push("アクティブなフォームがありません"),0===e.length&&(a.push("フォームが作成されていません"),l.push("最初のフォームを作成することをお勧めします")),{totalForms:e.length,activeForms:t,inactiveForms:s,expiredForms:i,issuesFound:a,recommendations:l}}catch(e){return console.error("フォーム設定チェック中にエラーが発生:",e),{totalForms:0,activeForms:0,inactiveForms:0,expiredForms:0,issuesFound:["フォーム設定の確認中にエラーが発生しました"],recommendations:[]}}}}function r(){let[e,t]=(0,a.useState)([]),[s,l]=(0,a.useState)(!0),[c,r]=(0,a.useState)("all"),n=async(s,i)=>{try{await d.toggleFormStatus(s,!i),t(e.map(e=>e.id===s?{...e,is_active:!i}:e))}catch(e){console.error("フォームステータスの更新に失敗しました:",e),alert("フォームステータスの更新に失敗しました。")}},o=async s=>{if(confirm("このフォームを削除しますか？この操作は元に戻せません。"))try{await d.deleteForm(s),t(e.filter(e=>e.id!==s)),alert("フォームが削除されました。")}catch(e){console.error("フォームの削除に失敗しました:",e),alert("フォームの削除に失敗しました。")}},m=e.filter(e=>"all"===c||("active"===c?e.is_active:"inactive"!==c||!e.is_active)),x=e=>{let t={inactive:{bg:"bg-secondary-subtle",text:"text-secondary",label:"無効"},pending:{bg:"bg-info-subtle",text:"text-info",label:"開始前"},expired:{bg:"bg-danger-subtle",text:"text-danger",label:"期限切れ"},active:{bg:"bg-success-subtle",text:"text-success",label:"公開中"}}[d.getFormStatus(e)];return i.jsx("span",{className:`badge ${t.bg} ${t.text}`,children:t.label})},h=e=>d.getValidityPeriodText(e.valid_from,e.valid_to);return s?i.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{height:"256px"},children:i.jsx("div",{className:"loading-spinner"})}):(0,i.jsxs)("div",{children:[i.jsx("div",{className:"row mb-4",children:i.jsx("div",{className:"col-12",children:(0,i.jsxs)("div",{className:"d-flex justify-content-between align-items-center",children:[(0,i.jsxs)("div",{children:[i.jsx("h2",{className:"h2 fw-bold text-dark",children:"フォーム一覧"}),i.jsx("p",{className:"text-muted",children:"作成済みのフォームを管理できます"})]}),(0,i.jsxs)("div",{className:"d-flex gap-3",children:[(0,i.jsxs)("select",{value:c,onChange:e=>r(e.target.value),className:"form-select",children:[i.jsx("option",{value:"all",children:"すべて"}),i.jsx("option",{value:"active",children:"有効"}),i.jsx("option",{value:"inactive",children:"無効"})]}),(0,i.jsxs)("button",{onClick:()=>window.location.href="/admin?page=form-builder",className:"btn btn-primary",children:[i.jsx("i",{className:"bi bi-plus-lg me-2"}),"新しいフォーム"]})]})]})})}),(0,i.jsxs)("div",{className:"row g-4 mb-4",children:[i.jsx("div",{className:"col-lg-3 col-md-6",children:i.jsx("div",{className:"dashboard-widget",children:i.jsx("div",{className:"d-flex align-items-center justify-content-between",children:(0,i.jsxs)("div",{children:[i.jsx("div",{className:"dashboard-widget-icon bg-success-subtle text-success",children:i.jsx("i",{className:"bi bi-check-circle"})}),i.jsx("div",{className:"dashboard-widget-value",children:e.filter(e=>e.is_active).length}),i.jsx("div",{className:"dashboard-widget-label",children:"有効なフォーム"})]})})})}),i.jsx("div",{className:"col-lg-3 col-md-6",children:i.jsx("div",{className:"dashboard-widget",children:i.jsx("div",{className:"d-flex align-items-center justify-content-between",children:(0,i.jsxs)("div",{children:[i.jsx("div",{className:"dashboard-widget-icon bg-primary-subtle text-primary",children:i.jsx("i",{className:"bi bi-file-earmark-text"})}),i.jsx("div",{className:"dashboard-widget-value",children:e.length}),i.jsx("div",{className:"dashboard-widget-label",children:"総フォーム数"})]})})})}),i.jsx("div",{className:"col-lg-3 col-md-6",children:i.jsx("div",{className:"dashboard-widget",children:i.jsx("div",{className:"d-flex align-items-center justify-content-between",children:(0,i.jsxs)("div",{children:[i.jsx("div",{className:"dashboard-widget-icon bg-info-subtle text-info",children:i.jsx("i",{className:"bi bi-bar-chart"})}),i.jsx("div",{className:"dashboard-widget-value",children:e.reduce((e,t)=>e+t.response_count,0)}),i.jsx("div",{className:"dashboard-widget-label",children:"総回答数"})]})})})}),i.jsx("div",{className:"col-lg-3 col-md-6",children:i.jsx("div",{className:"dashboard-widget",children:i.jsx("div",{className:"d-flex align-items-center justify-content-between",children:(0,i.jsxs)("div",{children:[i.jsx("div",{className:"dashboard-widget-icon bg-warning-subtle text-warning",children:i.jsx("i",{className:"bi bi-list-ol"})}),i.jsx("div",{className:"dashboard-widget-value",children:e.length>0?Math.round(e.reduce((e,t)=>e+t.field_count,0)/e.length):0}),i.jsx("div",{className:"dashboard-widget-label",children:"平均フィールド数"})]})})})})]}),i.jsx("div",{className:"row",children:i.jsx("div",{className:"col-12",children:(0,i.jsxs)("div",{className:"card",children:[i.jsx("div",{className:"card-header",children:(0,i.jsxs)("h5",{className:"mb-0",children:["フォーム一覧 (",m.length,"件)"]})}),i.jsx("div",{className:"card-body p-0",children:m.map(e=>i.jsx("div",{className:"border-bottom p-4",children:(0,i.jsxs)("div",{className:"d-flex justify-content-between align-items-start",children:[(0,i.jsxs)("div",{className:"flex-grow-1",children:[(0,i.jsxs)("div",{className:"d-flex align-items-center gap-3 mb-2",children:[i.jsx("h5",{className:"mb-0 fw-medium",children:e.name}),x(e)]}),i.jsx("p",{className:"text-muted mb-3",children:e.description}),(0,i.jsxs)("div",{className:"row g-3 small",children:[(0,i.jsxs)("div",{className:"col-lg-3 col-md-6",children:[i.jsx("span",{className:"text-muted",children:"フィールド数:"}),(0,i.jsxs)("span",{className:"fw-medium ms-1",children:[e.field_count,"個"]})]}),(0,i.jsxs)("div",{className:"col-lg-3 col-md-6",children:[i.jsx("span",{className:"text-muted",children:"回答数:"}),(0,i.jsxs)("span",{className:"fw-medium ms-1 text-primary",children:[e.response_count,"件"]})]}),(0,i.jsxs)("div",{className:"col-lg-3 col-md-6",children:[i.jsx("span",{className:"text-muted",children:"有効期間:"}),i.jsx("span",{className:"fw-medium ms-1",children:h(e)})]}),(0,i.jsxs)("div",{className:"col-lg-3 col-md-6",children:[i.jsx("span",{className:"text-muted",children:"更新日:"}),i.jsx("span",{className:"fw-medium ms-1",children:new Date(e.updated_at).toLocaleDateString("ja-JP")})]})]})]}),(0,i.jsxs)("div",{className:"d-flex gap-1 ms-3",children:[(0,i.jsxs)("button",{onClick:()=>window.location.href=`/admin?page=form-builder&id=${e.id}`,className:"btn btn-outline-primary btn-sm",title:"フォームを編集",children:[i.jsx("i",{className:"bi bi-pencil me-1"}),"編集"]}),(0,i.jsxs)("button",{onClick:()=>window.open(`/form/${e.id}`,"_blank"),className:"btn btn-outline-secondary btn-sm",title:"フォームをプレビュー",children:[i.jsx("i",{className:"bi bi-eye me-1"}),"プレビュー"]}),i.jsx("button",{onClick:()=>n(e.id,e.is_active),className:`btn btn-sm ${e.is_active?"btn-outline-warning":"btn-outline-success"}`,title:e.is_active?"フォームを無効にする":"フォームを有効にする",children:i.jsx("i",{className:`bi ${e.is_active?"bi-pause":"bi-play"}`})}),i.jsx("button",{onClick:()=>o(e.id),className:"btn btn-outline-danger btn-sm",title:"フォームを削除",children:i.jsx("i",{className:"bi bi-trash"})})]})]})},e.id))})]})})}),0===m.length&&i.jsx("div",{className:"row",children:i.jsx("div",{className:"col-12",children:i.jsx("div",{className:"card",children:(0,i.jsxs)("div",{className:"card-body text-center py-5",children:[i.jsx("i",{className:"bi bi-file-earmark-text text-muted",style:{fontSize:"4rem"}}),i.jsx("h5",{className:"fw-medium text-dark mt-3 mb-2",children:"フォームが見つかりません"}),(0,i.jsxs)("p",{className:"text-muted mb-4",children:["all"!==c?`${"active"===c?"有効な":"無効な"}フォームはありません。`:"まだフォームが作成されていません。",i.jsx("br",{}),"新しいフォームを作成してください。"]})]})})})})]})}}};