"use strict";exports.id=945,exports.ids=[945],exports.modules={1945:(e,s,a)=>{a.d(s,{Z:()=>h});var l=a(326),i=a(7577);class c{static async getAllForms(){return[{id:"1",name:"お問い合わせフォーム",description:"一般的なお問い合わせ用のフォームです",is_active:!0,field_count:5,response_count:12,valid_from:"2024-01-01T00:00:00Z",valid_to:"2024-12-31T23:59:59Z",created_at:"2024-01-01T00:00:00Z",updated_at:"2024-01-15T10:30:00Z",pricing_display:{show_item_prices:!0,show_subtotal:!0,show_total_amount:!0,show_item_quantity:!0,pricing_display_mode:"full"}},{id:"2",name:"商品予約フォーム",description:"商品の予約を受け付けるフォームです",is_active:!1,field_count:8,response_count:5,created_at:"2024-01-10T00:00:00Z",updated_at:"2024-01-20T15:45:00Z",pricing_display:{show_item_prices:!1,show_subtotal:!1,show_total_amount:!0,show_item_quantity:!1,pricing_display_mode:"summary"}}]}static async getFormById(e){return{id:e,name:"サンプルフォーム",description:"サンプルの説明",is_active:!0,fields:[],pricing_display:{show_item_prices:!0,show_subtotal:!0,show_total_amount:!0,show_item_quantity:!0,pricing_display_mode:"full"},created_at:"2024-01-01T00:00:00Z",updated_at:"2024-01-01T00:00:00Z"}}static async createForm(e){return{id:`form_${Date.now()}`,name:e.name,description:e.description,is_active:e.isActive||!1,valid_from:e.validFrom,valid_to:e.validTo,fields:e.fields||[],pricing_display:e.pricing_display||{show_item_prices:!0,show_subtotal:!0,show_total_amount:!0,show_item_quantity:!0,pricing_display_mode:"full"},created_at:new Date().toISOString(),updated_at:new Date().toISOString()}}static async toggleFormStatus(e,s){}static async deleteForm(e){}static getFormStatus(e){if(!e.is_active)return"inactive";let s=new Date;return e.valid_from&&s<new Date(e.valid_from)?"pending":e.valid_to&&s>new Date(e.valid_to)?"expired":"active"}static getValidityPeriodText(e,s){if(!e&&!s)return"無期限";let a=e=>new Date(e).toLocaleDateString("ja-JP");return e&&s?`${a(e)} - ${a(s)}`:e?`${a(e)} -`:s?`- ${a(s)}`:"無期限"}static async updatePricingDisplaySettings(e,s){}static async getPricingDisplaySettings(e){return{show_item_prices:!0,show_subtotal:!0,show_total_amount:!0,show_item_quantity:!0,pricing_display_mode:"full"}}static getPricingDisplayModeLabel(e){return({full:"詳細表示",summary:"合計のみ",hidden:"非表示",custom:"カスタム"})[e]}static getPricingDisplayModeDescription(e){return({full:"商品価格、小計、合計をすべて表示",summary:"合計金額のみを表示",hidden:"価格情報を表示しない",custom:"カスタム設定で表示項目を選択"})[e]}static getPricingDisplayStatistics(e){let s={total:e.length,byMode:{full:0,summary:0,hidden:0,custom:0},showingPrices:0,hidingPrices:0};return e.forEach(e=>{e.pricing_display&&(s.byMode[e.pricing_display.pricing_display_mode]++,"hidden"===e.pricing_display.pricing_display_mode?s.hidingPrices++:s.showingPrices++)}),s}}function t({isOpen:e,form:s,onClose:a,onSave:t}){let[d,r]=(0,i.useState)({show_item_prices:!0,show_subtotal:!0,show_total_amount:!0,show_item_quantity:!0,pricing_display_mode:"full"});return e&&s?l.jsx("div",{className:"modal fade show",style:{display:"block"},tabIndex:-1,children:l.jsx("div",{className:"modal-dialog modal-lg",children:(0,l.jsxs)("div",{className:"modal-content",children:[(0,l.jsxs)("div",{className:"modal-header",children:[(0,l.jsxs)("h5",{className:"modal-title",children:["価格表示設定 - ",s.name]}),l.jsx("button",{type:"button",className:"btn-close",onClick:a})]}),(0,l.jsxs)("div",{className:"modal-body",children:[(0,l.jsxs)("div",{className:"mb-4",children:[l.jsx("label",{className:"form-label fw-medium",children:"表示モード"}),(0,l.jsxs)("select",{value:d.pricing_display_mode,onChange:e=>r(s=>({...s,pricing_display_mode:e.target.value})),className:"form-select",children:[l.jsx("option",{value:"full",children:"詳細表示"}),l.jsx("option",{value:"summary",children:"合計のみ"}),l.jsx("option",{value:"hidden",children:"非表示"}),l.jsx("option",{value:"custom",children:"カスタム"})]}),l.jsx("div",{className:"form-text",children:c.getPricingDisplayModeDescription(d.pricing_display_mode)})]}),("custom"===d.pricing_display_mode||"full"===d.pricing_display_mode)&&(0,l.jsxs)("div",{className:"row g-3",children:[l.jsx("div",{className:"col-md-6",children:(0,l.jsxs)("div",{className:"form-check",children:[l.jsx("input",{className:"form-check-input",type:"checkbox",id:"show_item_prices",checked:d.show_item_prices,onChange:e=>r(s=>({...s,show_item_prices:e.target.checked}))}),l.jsx("label",{className:"form-check-label",htmlFor:"show_item_prices",children:"商品価格を表示"})]})}),l.jsx("div",{className:"col-md-6",children:(0,l.jsxs)("div",{className:"form-check",children:[l.jsx("input",{className:"form-check-input",type:"checkbox",id:"show_item_quantity",checked:d.show_item_quantity,onChange:e=>r(s=>({...s,show_item_quantity:e.target.checked}))}),l.jsx("label",{className:"form-check-label",htmlFor:"show_item_quantity",children:"数量を表示"})]})}),l.jsx("div",{className:"col-md-6",children:(0,l.jsxs)("div",{className:"form-check",children:[l.jsx("input",{className:"form-check-input",type:"checkbox",id:"show_subtotal",checked:d.show_subtotal,onChange:e=>r(s=>({...s,show_subtotal:e.target.checked}))}),l.jsx("label",{className:"form-check-label",htmlFor:"show_subtotal",children:"小計を表示"})]})}),l.jsx("div",{className:"col-md-6",children:(0,l.jsxs)("div",{className:"form-check",children:[l.jsx("input",{className:"form-check-input",type:"checkbox",id:"show_total_amount",checked:d.show_total_amount,onChange:e=>r(s=>({...s,show_total_amount:e.target.checked}))}),l.jsx("label",{className:"form-check-label",htmlFor:"show_total_amount",children:"合計金額を表示"})]})})]})]}),(0,l.jsxs)("div",{className:"modal-footer",children:[l.jsx("button",{type:"button",className:"btn btn-secondary",onClick:a,children:"キャンセル"}),l.jsx("button",{type:"button",className:"btn btn-primary",onClick:()=>{s&&(t(s.id,d),a())},children:"設定を保存"})]})]})})}):null}function d({onCreateForm:e,onEditForm:s}){let[a,d]=(0,i.useState)([]),[r,n]=(0,i.useState)(!0),[m,o]=(0,i.useState)("all"),[h,x]=(0,i.useState)(null),u=async(e,s)=>{try{await c.toggleFormStatus(e,!s),d(a.map(a=>a.id===e?{...a,is_active:!s}:a))}catch(e){alert("フォームステータスの更新に失敗しました。")}},p=async e=>{if(confirm("このフォームを削除しますか？この操作は元に戻せません。"))try{await c.deleteForm(e),d(a.filter(s=>s.id!==e)),alert("フォームが削除されました。")}catch(e){alert("フォームの削除に失敗しました。")}},b=async(e,s)=>{try{await c.updatePricingDisplaySettings(e,s),d(a.map(a=>a.id===e?{...a,pricing_display:s}:a)),alert("価格表示設定が更新されました。")}catch(e){alert("価格表示設定の更新に失敗しました。")}},j=a.filter(e=>"all"===m||("active"===m?e.is_active:"inactive"!==m||!e.is_active)),N=e=>{let s={inactive:{bg:"bg-secondary-subtle",text:"text-secondary",label:"無効"},pending:{bg:"bg-info-subtle",text:"text-info",label:"開始前"},expired:{bg:"bg-danger-subtle",text:"text-danger",label:"期限切れ"},active:{bg:"bg-success-subtle",text:"text-success",label:"公開中"}}[c.getFormStatus(e)];return l.jsx("span",{className:`badge ${s.bg} ${s.text}`,children:s.label})},v=e=>c.getValidityPeriodText(e.valid_from,e.valid_to);return r?l.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{height:"256px"},children:l.jsx("div",{className:"loading-spinner"})}):(0,l.jsxs)("div",{children:[l.jsx("div",{className:"row mb-4",children:l.jsx("div",{className:"col-12",children:(0,l.jsxs)("div",{className:"d-flex justify-content-between align-items-center",children:[(0,l.jsxs)("div",{children:[l.jsx("h2",{className:"h2 fw-bold text-dark",children:"フォーム一覧"}),l.jsx("p",{className:"text-muted",children:"作成済みのフォームを管理できます"})]}),(0,l.jsxs)("div",{className:"d-flex gap-3",children:[(0,l.jsxs)("select",{value:m,onChange:e=>o(e.target.value),className:"form-select form-select-sm px-5",children:[l.jsx("option",{value:"all",children:"すべて"}),l.jsx("option",{value:"active",children:"有効"}),l.jsx("option",{value:"inactive",children:"無効"})]}),(0,l.jsxs)("button",{onClick:e,className:"btn btn-primary btn-sm px-2",style:{padding:"0.375rem 0.75rem",minWidth:"150px"},children:[l.jsx("i",{className:"bi bi-plus-lg me-2"}),"新しいフォーム"]})]})]})})}),(0,l.jsxs)("div",{className:"row g-4 mb-4",children:[l.jsx("div",{className:"col-lg-3 col-md-6",children:l.jsx("div",{className:"dashboard-widget",children:l.jsx("div",{className:"d-flex align-items-center justify-content-between",children:(0,l.jsxs)("div",{children:[l.jsx("div",{className:"dashboard-widget-icon bg-success-subtle text-success",children:l.jsx("i",{className:"bi bi-check-circle"})}),l.jsx("div",{className:"dashboard-widget-value",children:a.filter(e=>e.is_active).length}),l.jsx("div",{className:"dashboard-widget-label",children:"有効なフォーム"})]})})})}),l.jsx("div",{className:"col-lg-3 col-md-6",children:l.jsx("div",{className:"dashboard-widget",children:l.jsx("div",{className:"d-flex align-items-center justify-content-between",children:(0,l.jsxs)("div",{children:[l.jsx("div",{className:"dashboard-widget-icon bg-primary-subtle text-primary",children:l.jsx("i",{className:"bi bi-file-earmark-text"})}),l.jsx("div",{className:"dashboard-widget-value",children:a.length}),l.jsx("div",{className:"dashboard-widget-label",children:"総フォーム数"})]})})})}),l.jsx("div",{className:"col-lg-3 col-md-6",children:l.jsx("div",{className:"dashboard-widget",children:l.jsx("div",{className:"d-flex align-items-center justify-content-between",children:(0,l.jsxs)("div",{children:[l.jsx("div",{className:"dashboard-widget-icon bg-info-subtle text-info",children:l.jsx("i",{className:"bi bi-bar-chart"})}),l.jsx("div",{className:"dashboard-widget-value",children:a.reduce((e,s)=>e+s.response_count,0)}),l.jsx("div",{className:"dashboard-widget-label",children:"総回答数"})]})})})}),l.jsx("div",{className:"col-lg-3 col-md-6",children:l.jsx("div",{className:"dashboard-widget",children:l.jsx("div",{className:"d-flex align-items-center justify-content-between",children:(0,l.jsxs)("div",{children:[l.jsx("div",{className:"dashboard-widget-icon bg-warning-subtle text-warning",children:l.jsx("i",{className:"bi bi-currency-yen"})}),l.jsx("div",{className:"dashboard-widget-value",children:c.getPricingDisplayStatistics(a).showingPrices}),l.jsx("div",{className:"dashboard-widget-label",children:"価格表示中"})]})})})})]}),l.jsx("div",{className:"row mb-4",children:l.jsx("div",{className:"col-12",children:(0,l.jsxs)("div",{className:"card",children:[l.jsx("div",{className:"card-header",children:l.jsx("h6",{className:"mb-0",children:"価格表示設定の統計"})}),l.jsx("div",{className:"card-body",children:l.jsx("div",{className:"row g-3",children:Object.entries(c.getPricingDisplayStatistics(a).byMode).map(([e,s])=>l.jsx("div",{className:"col-lg-3 col-md-6",children:(0,l.jsxs)("div",{className:"text-center p-3 bg-light rounded",children:[l.jsx("div",{className:"h5 mb-1",children:s}),l.jsx("div",{className:"small text-muted",children:c.getPricingDisplayModeLabel(e)})]})},e))})})]})})}),l.jsx("div",{className:"row",children:l.jsx("div",{className:"col-12",children:(0,l.jsxs)("div",{className:"card",children:[l.jsx("div",{className:"card-header",children:(0,l.jsxs)("h5",{className:"mb-0",children:["フォーム一覧 (",j.length,"件)"]})}),l.jsx("div",{className:"card-body p-0",children:j.map(e=>l.jsx("div",{className:"border-bottom p-4",children:(0,l.jsxs)("div",{className:"d-flex justify-content-between align-items-start",children:[(0,l.jsxs)("div",{className:"flex-grow-1",children:[(0,l.jsxs)("div",{className:"d-flex align-items-center gap-3 mb-2",children:[l.jsx("h5",{className:"mb-0 fw-medium",children:e.name}),N(e)]}),l.jsx("p",{className:"text-muted mb-3",children:e.description}),(0,l.jsxs)("div",{className:"row g-3 small",children:[(0,l.jsxs)("div",{className:"col-lg-3 col-md-6",children:[l.jsx("span",{className:"text-muted",children:"フィールド数:"}),(0,l.jsxs)("span",{className:"fw-medium ms-1",children:[e.field_count,"個"]})]}),(0,l.jsxs)("div",{className:"col-lg-3 col-md-6",children:[l.jsx("span",{className:"text-muted",children:"回答数:"}),(0,l.jsxs)("span",{className:"fw-medium ms-1 text-primary",children:[e.response_count,"件"]})]}),(0,l.jsxs)("div",{className:"col-lg-3 col-md-6",children:[l.jsx("span",{className:"text-muted",children:"有効期間:"}),l.jsx("span",{className:"fw-medium ms-1",children:v(e)})]}),(0,l.jsxs)("div",{className:"col-lg-3 col-md-6",children:[l.jsx("span",{className:"text-muted",children:"更新日:"}),l.jsx("span",{className:"fw-medium ms-1",children:new Date(e.updated_at).toLocaleDateString("ja-JP")})]}),(0,l.jsxs)("div",{className:"col-lg-3 col-md-6",children:[l.jsx("span",{className:"text-muted",children:"価格表示:"}),l.jsx("span",{className:"fw-medium ms-1",children:e.pricing_display?c.getPricingDisplayModeLabel(e.pricing_display.pricing_display_mode):"設定なし"})]})]})]}),(0,l.jsxs)("div",{className:"d-flex gap-1 ms-3",children:[(0,l.jsxs)("button",{onClick:()=>s(e.id),className:"btn btn-outline-primary btn-sm",title:"フォームを編集",children:[l.jsx("i",{className:"bi bi-pencil me-1"}),"編集"]}),(0,l.jsxs)("button",{onClick:()=>x(e),className:"btn btn-outline-info btn-sm",title:"価格表示設定",children:[l.jsx("i",{className:"bi bi-currency-yen me-1"}),"価格設定"]}),(0,l.jsxs)("button",{onClick:()=>window.open(`/form/${e.id}`,"_blank"),className:"btn btn-outline-secondary btn-sm",title:"フォームをプレビュー",children:[l.jsx("i",{className:"bi bi-eye me-1"}),"プレビュー"]}),l.jsx("button",{onClick:()=>u(e.id,e.is_active),className:`btn btn-sm ${e.is_active?"btn-outline-warning":"btn-outline-success"}`,title:e.is_active?"フォームを無効にする":"フォームを有効にする",children:l.jsx("i",{className:`bi ${e.is_active?"bi-pause":"bi-play"}`})}),l.jsx("button",{onClick:()=>p(e.id),className:"btn btn-outline-danger btn-sm",title:"フォームを削除",children:l.jsx("i",{className:"bi bi-trash"})})]})]})},e.id))})]})})}),0===j.length&&l.jsx("div",{className:"row",children:l.jsx("div",{className:"col-12",children:l.jsx("div",{className:"card",children:(0,l.jsxs)("div",{className:"card-body text-center py-5",children:[l.jsx("i",{className:"bi bi-file-earmark-text text-muted",style:{fontSize:"4rem"}}),l.jsx("h5",{className:"fw-medium text-dark mt-3 mb-2",children:"フォームが見つかりません"}),(0,l.jsxs)("p",{className:"text-muted mb-4",children:["all"!==m?`${"active"===m?"有効な":"無効な"}フォームはありません。`:"まだフォームが作成されていません。",l.jsx("br",{}),"新しいフォームを作成してください。"]})]})})})}),l.jsx(t,{isOpen:!!h,form:h,onClose:()=>x(null),onSave:b})]})}let r=[{id:"customer_name",type:"text",label:"お客様名",required:!0,placeholder:"山田太郎"},{id:"customer_furigana",type:"text",label:"フリガナ",required:!1,placeholder:"ヤマダタロウ"},{id:"customer_phone",type:"tel",label:"電話番号",required:!0,placeholder:"090-1234-5678"},{id:"customer_email",type:"email",label:"メールアドレス",required:!1,placeholder:"example@example.com"},{id:"customer_postal_code",type:"text",label:"郵便番号",required:!1,placeholder:"123-4567"},{id:"customer_prefecture",type:"text",label:"都道府県",required:!1,placeholder:"東京都"},{id:"customer_city",type:"text",label:"市区町村",required:!1,placeholder:"渋谷区"},{id:"customer_address",type:"textarea",label:"住所（番地・建物名）",required:!1,placeholder:"1-1-1 サンプルマンション101"},{id:"customer_birth_date",type:"date",label:"生年月日",required:!1},{id:"customer_gender",type:"radio",label:"性別",required:!1,options:["男性","女性","その他"]},{id:"reservation_date",type:"date",label:"受取希望日",required:!0},{id:"pickup_time_slot",type:"select",label:"受取時間帯",required:!0,options:["09:00-10:00","10:00-11:00","11:00-12:00","13:00-14:00","14:00-15:00","15:00-16:00","16:00-17:00"]},{id:"cultivation_purpose",type:"select",label:"栽培目的",required:!1,options:["家庭菜園","観賞用","贈答用","商業栽培","その他"]},{id:"cultivation_location",type:"select",label:"栽培場所",required:!1,options:["露地","ハウス","ベランダ","プランター","その他"]},{id:"experience_level",type:"select",label:"栽培経験",required:!1,options:["初心者","1-2年","3-5年","5年以上","プロ・専門家"]},{id:"preferred_contact_method",type:"radio",label:"希望連絡方法",required:!1,options:["電話","メール","LINE","いずれでも"]},{id:"special_requests",type:"textarea",label:"ご要望・備考",required:!1,placeholder:"ご要望があればお書きください"},{id:"referral_source",type:"select",label:"お知りになったきっかけ",required:!1,options:["知人の紹介","インターネット検索","SNS","チラシ・広告","通りがかり","その他"]}],n=[{value:"text",label:"テキスト"},{value:"email",label:"メールアドレス"},{value:"tel",label:"電話番号"},{value:"number",label:"数値"},{value:"textarea",label:"複数行テキスト"},{value:"select",label:"選択（プルダウン）"},{value:"radio",label:"選択（ラジオボタン）"},{value:"checkbox",label:"複数選択"},{value:"date",label:"日付"}],m=[{id:"custom",name:"カスタムフォーム",description:"1からフォームを作成",fields:[]},{id:"basic_reservation",name:"基本予約フォーム",description:"必要最小限の項目で構成された予約フォーム",fields:["customer_name","customer_phone","customer_email","reservation_date","pickup_time_slot","special_requests"]},{id:"detailed_reservation",name:"詳細予約フォーム",description:"詳細な顧客情報と栽培情報を含む予約フォーム",fields:["customer_name","customer_furigana","customer_phone","customer_email","customer_postal_code","customer_prefecture","customer_city","customer_address","reservation_date","pickup_time_slot","cultivation_purpose","cultivation_location","experience_level","preferred_contact_method","special_requests","referral_source"]},{id:"consultation_form",name:"栽培相談フォーム",description:"栽培相談に特化したフォーム",fields:["customer_name","customer_phone","customer_email","cultivation_purpose","cultivation_location","experience_level","special_requests"]},{id:"feedback_form",name:"お客様アンケート",description:"購入後のフィードバック収集フォーム",fields:["customer_name","customer_email","cultivation_purpose","experience_level","special_requests","referral_source"]}];function o({isOpen:e,onClose:s,onSuccess:a}){let[t,d]=(0,i.useState)({name:"",description:"",valid_from:"",valid_to:""}),[o,h]=(0,i.useState)([]),[x,u]=(0,i.useState)([]),[p,b]=(0,i.useState)([]),[j,N]=(0,i.useState)("all"),[v,_]=(0,i.useState)(""),[g,y]=(0,i.useState)("basic"),[f,w]=(0,i.useState)([]),[k,C]=(0,i.useState)(null),[q,S]=(0,i.useState)(!1),[F,D]=(0,i.useState)("custom"),[$,P]=(0,i.useState)({show_item_prices:!0,show_subtotal:!0,show_total_amount:!0,show_item_quantity:!0,pricing_display_mode:"full"}),T=e=>{o.find(s=>s.id===e.id)||h([...o,e])},L=e=>{h(o.filter(s=>s.id!==e))},Z=x.filter(e=>!o.find(s=>s.id===e.id)&&("all"===j||e.category_id===j)&&(!v||!!e.name.toLowerCase().includes(v.toLowerCase()))),I=e=>{f.find(s=>s.id===e.id)||w([...f,{...e}])},M=e=>{C({...e}),S(!0)},O=e=>{confirm("このフィールドを削除しますか？")&&w(f.filter(s=>s.id!==e))},A=e=>{D(e);let s=m.find(s=>s.id===e);s&&s.fields.length>0?w(s.fields.map(e=>{let s=r.find(s=>s.id===e);return s?{...s}:null}).filter(e=>null!==e)):w([])},E=async()=>{try{let e={name:t.name.trim(),description:t.description.trim(),fields:f,isActive:!1,validFrom:t.valid_from||void 0,validTo:t.valid_to||void 0,selectedProducts:o.map(e=>e.id)},s=await c.createForm(e);H(),a(),window.location.href=`/admin?page=form-builder&id=${s.id}`}catch(e){alert("フォームの作成に失敗しました。")}},H=()=>{d({name:"",description:"",valid_from:"",valid_to:""}),h([]),N("all"),_(""),w([]),y("basic"),C(null),S(!1)},W=()=>{H(),s()};return e?(0,l.jsxs)("div",{className:"modal show d-block",tabIndex:-1,style:{backgroundColor:"rgba(0,0,0,0.5)"},children:[l.jsx("div",{className:"modal-dialog modal-xl",style:{maxWidth:"90vw"},children:(0,l.jsxs)("div",{className:"modal-content",children:[(0,l.jsxs)("div",{className:"modal-header",children:[l.jsx("h5",{className:"modal-title",children:"新しいフォームを作成"}),l.jsx("button",{type:"button",className:"btn-close",onClick:W,"aria-label":"Close"})]}),(0,l.jsxs)("div",{className:"modal-body",style:{maxHeight:"70vh",overflowY:"auto"},children:[(0,l.jsxs)("ul",{className:"nav nav-tabs mb-4",id:"formTabs",role:"tablist",children:[l.jsx("li",{className:"nav-item",role:"presentation",children:(0,l.jsxs)("button",{className:`nav-link ${"basic"===g?"active":""}`,onClick:()=>y("basic"),type:"button",children:[l.jsx("i",{className:"bi bi-info-circle me-1"}),"基本情報"]})}),l.jsx("li",{className:"nav-item",role:"presentation",children:(0,l.jsxs)("button",{className:`nav-link ${"fields"===g?"active":""}`,onClick:()=>y("fields"),type:"button",children:[l.jsx("i",{className:"bi bi-ui-checks me-1"}),"フォームフィールド",f.length>0&&l.jsx("span",{className:"badge bg-primary ms-1",children:f.length})]})}),l.jsx("li",{className:"nav-item",role:"presentation",children:(0,l.jsxs)("button",{className:`nav-link ${"products"===g?"active":""}`,onClick:()=>y("products"),type:"button",children:[l.jsx("i",{className:"bi bi-box-seam me-1"}),"商品選択",o.length>0&&l.jsx("span",{className:"badge bg-primary ms-1",children:o.length})]})}),l.jsx("li",{className:"nav-item",role:"presentation",children:(0,l.jsxs)("button",{className:`nav-link ${"pricing"===g?"active":""}`,onClick:()=>y("pricing"),type:"button",children:[l.jsx("i",{className:"bi bi-currency-dollar me-1"}),"価格表示設定"]})})]}),(0,l.jsxs)("div",{className:"tab-content",children:["basic"===g&&l.jsx("div",{className:"tab-pane fade show active",children:l.jsx("div",{className:"row justify-content-center",children:(0,l.jsxs)("div",{className:"col-md-8",children:[(0,l.jsxs)("div",{className:"mb-4",children:[l.jsx("label",{className:"form-label",children:"フォームテンプレート"}),l.jsx("div",{className:"row g-3",children:m.map(e=>l.jsx("div",{className:"col-md-6",children:l.jsx("div",{className:`card h-100 cursor-pointer ${F===e.id?"border-primary":""}`,onClick:()=>A(e.id),style:{cursor:"pointer"},children:(0,l.jsxs)("div",{className:"card-body",children:[(0,l.jsxs)("div",{className:"d-flex align-items-center mb-2",children:[l.jsx("input",{type:"radio",name:"template",value:e.id,checked:F===e.id,onChange:()=>A(e.id),className:"me-2"}),l.jsx("h6",{className:"card-title mb-0",children:e.name})]}),l.jsx("p",{className:"card-text text-muted small",children:e.description}),e.fields.length>0&&(0,l.jsxs)("small",{className:"text-muted",children:[e.fields.length,"個のフィールド"]})]})})},e.id))})]}),(0,l.jsxs)("div",{className:"mb-4",children:[(0,l.jsxs)("label",{htmlFor:"formName",className:"form-label",children:["フォーム名 ",l.jsx("span",{className:"text-danger",children:"*"})]}),l.jsx("input",{type:"text",className:"form-control",id:"formName",value:t.name,onChange:e=>d({...t,name:e.target.value}),placeholder:"フォーム名を入力してください",required:!0})]}),(0,l.jsxs)("div",{className:"mb-4",children:[l.jsx("label",{htmlFor:"formDescription",className:"form-label",children:"説明"}),l.jsx("textarea",{className:"form-control",id:"formDescription",rows:4,value:t.description,onChange:e=>d({...t,description:e.target.value}),placeholder:"フォームの説明を入力してください"})]}),(0,l.jsxs)("div",{className:"row",children:[l.jsx("div",{className:"col-md-6",children:(0,l.jsxs)("div",{className:"mb-4",children:[l.jsx("label",{htmlFor:"validFrom",className:"form-label",children:"有効期間 開始日"}),l.jsx("input",{type:"datetime-local",className:"form-control",id:"validFrom",value:t.valid_from,onChange:e=>d({...t,valid_from:e.target.value})})]})}),l.jsx("div",{className:"col-md-6",children:(0,l.jsxs)("div",{className:"mb-4",children:[l.jsx("label",{htmlFor:"validTo",className:"form-label",children:"有効期間 終了日"}),l.jsx("input",{type:"datetime-local",className:"form-control",id:"validTo",value:t.valid_to,onChange:e=>d({...t,valid_to:e.target.value})})]})})]})]})})}),"fields"===g&&l.jsx("div",{className:"tab-pane fade show active",children:(0,l.jsxs)("div",{className:"row",children:[(0,l.jsxs)("div",{className:"col-lg-6",children:[(0,l.jsxs)("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[l.jsx("h6",{className:"fw-bold mb-0",children:"設定済みフィールド"}),(0,l.jsxs)("button",{type:"button",className:"btn btn-outline-primary btn-sm",onClick:()=>{C({id:`custom_${Date.now()}`,type:"text",label:"新しいフィールド",required:!1,placeholder:""}),S(!0)},children:[l.jsx("i",{className:"bi bi-plus-lg me-1"}),"カスタムフィールド"]})]}),f.length>0?l.jsx("div",{className:"list-group",children:f.map(e=>l.jsx("div",{className:"list-group-item",children:(0,l.jsxs)("div",{className:"d-flex justify-content-between align-items-start",children:[(0,l.jsxs)("div",{className:"flex-grow-1",children:[(0,l.jsxs)("div",{className:"d-flex align-items-center mb-1",children:[l.jsx("span",{className:"fw-medium",children:e.label}),e.required&&l.jsx("span",{className:"text-danger ms-1",children:"*"}),l.jsx("span",{className:"badge bg-secondary ms-2",children:n.find(s=>s.value===e.type)?.label})]}),(0,l.jsxs)("small",{className:"text-muted",children:[e.placeholder&&`プレースホルダー: ${e.placeholder}`,e.options&&` | 選択肢: ${e.options.join(", ")}`]})]}),(0,l.jsxs)("div",{className:"btn-group",children:[l.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>M(e),children:l.jsx("i",{className:"bi bi-pencil"})}),l.jsx("button",{type:"button",className:"btn btn-outline-danger btn-sm",onClick:()=>O(e.id),children:l.jsx("i",{className:"bi bi-trash"})})]})]})},e.id))}):(0,l.jsxs)("div",{className:"text-center text-muted p-4 border rounded",children:[l.jsx("i",{className:"bi bi-ui-checks display-4"}),l.jsx("p",{className:"mb-0 mt-2",children:"フィールドが設定されていません"}),l.jsx("small",{children:"事前定義されたフィールドから選択するか、カスタムフィールドを作成してください"})]})]}),(0,l.jsxs)("div",{className:"col-lg-6",children:[l.jsx("h6",{className:"fw-bold mb-3",children:"事前定義フィールド"}),l.jsx("div",{className:"row g-2",children:r.map(e=>l.jsx("div",{className:"col-12",children:l.jsx("div",{className:"card card-body p-2",children:(0,l.jsxs)("div",{className:"d-flex justify-content-between align-items-center",children:[(0,l.jsxs)("div",{className:"flex-grow-1",children:[(0,l.jsxs)("div",{className:"d-flex align-items-center",children:[l.jsx("span",{className:"fw-medium small",children:e.label}),e.required&&l.jsx("span",{className:"text-danger ms-1",children:"*"})]}),l.jsx("small",{className:"text-muted",children:n.find(s=>s.value===e.type)?.label})]}),l.jsx("button",{type:"button",className:"btn btn-outline-primary btn-sm",onClick:()=>I(e),disabled:f.some(s=>s.id===e.id),children:f.some(s=>s.id===e.id)?l.jsx("i",{className:"bi bi-check"}):l.jsx("i",{className:"bi bi-plus"})})]})})},e.id))})]})]})}),"products"===g&&l.jsx("div",{className:"tab-pane fade show active",children:(0,l.jsxs)("div",{className:"row",children:[(0,l.jsxs)("div",{className:"col-lg-6",children:[(0,l.jsxs)("h6",{className:"fw-bold mb-3",children:["選択済み商品 (",o.length,"件)"]}),o.length>0?l.jsx("div",{className:"border rounded p-3",style:{maxHeight:"400px",overflowY:"auto"},children:o.map(e=>(0,l.jsxs)("div",{className:"d-flex justify-content-between align-items-center p-2 border-bottom",children:[(0,l.jsxs)("div",{className:"flex-grow-1",children:[l.jsx("div",{className:"fw-medium",children:e.name}),(0,l.jsxs)("small",{className:"text-muted",children:["\xa5",e.price?.toLocaleString()]})]}),l.jsx("button",{type:"button",className:"btn btn-outline-danger btn-sm",onClick:()=>L(e.id),children:l.jsx("i",{className:"bi bi-x"})})]},e.id))}):(0,l.jsxs)("div",{className:"text-center text-muted p-4 border rounded",children:[l.jsx("i",{className:"bi bi-box-seam display-4"}),l.jsx("p",{className:"mb-0 mt-2",children:"商品が選択されていません"}),l.jsx("small",{children:"右側の商品一覧から選択してください"})]})]}),(0,l.jsxs)("div",{className:"col-lg-6",children:[l.jsx("h6",{className:"fw-bold mb-3",children:"商品一覧"}),(0,l.jsxs)("div",{className:"row mb-3",children:[l.jsx("div",{className:"col-md-6",children:(0,l.jsxs)("select",{className:"form-select form-select-sm",value:j,onChange:e=>N(e.target.value),children:[l.jsx("option",{value:"all",children:"すべてのカテゴリ"}),p.map(e=>l.jsx("option",{value:e.id,children:e.name},e.id))]})}),l.jsx("div",{className:"col-md-6",children:l.jsx("input",{type:"text",className:"form-control form-control-sm",placeholder:"商品名で検索...",value:v,onChange:e=>_(e.target.value)})})]}),l.jsx("div",{style:{maxHeight:"400px",overflowY:"auto"},children:Z.length>0?l.jsx("div",{className:"row g-2",children:Z.map(e=>l.jsx("div",{className:"col-12",children:l.jsx("div",{className:"card card-body p-2 cursor-pointer hover-bg-light",onClick:()=>T(e),style:{cursor:"pointer"},children:(0,l.jsxs)("div",{className:"d-flex justify-content-between align-items-center",children:[(0,l.jsxs)("div",{className:"flex-grow-1",children:[l.jsx("div",{className:"fw-medium small",children:e.name}),(0,l.jsxs)("small",{className:"text-muted",children:["\xa5",e.price?.toLocaleString()]})]}),l.jsx("button",{type:"button",className:"btn btn-outline-primary btn-sm",onClick:s=>{s.stopPropagation(),T(e)},children:l.jsx("i",{className:"bi bi-plus"})})]})})},e.id))}):(0,l.jsxs)("div",{className:"text-center text-muted p-3",children:[l.jsx("i",{className:"bi bi-search"}),l.jsx("p",{className:"mb-0 small",children:"条件に一致する商品がありません"})]})})]})]})}),"pricing"===g&&l.jsx("div",{className:"tab-pane fade show active",children:l.jsx("div",{className:"row justify-content-center",children:l.jsx("div",{className:"col-md-8",children:(0,l.jsxs)("div",{className:"card",children:[l.jsx("div",{className:"card-header",children:(0,l.jsxs)("h5",{className:"card-title mb-0",children:[l.jsx("i",{className:"bi bi-currency-dollar me-2"}),"価格表示設定"]})}),(0,l.jsxs)("div",{className:"card-body",children:[(0,l.jsxs)("div",{className:"mb-4",children:[l.jsx("label",{className:"form-label",children:"価格表示モード"}),(0,l.jsxs)("div",{className:"row g-3",children:[l.jsx("div",{className:"col-md-6",children:l.jsx("div",{className:`card h-100 cursor-pointer ${"full"===$.pricing_display_mode?"border-primary bg-light":""}`,onClick:()=>P({...$,pricing_display_mode:"full"}),style:{cursor:"pointer"},children:(0,l.jsxs)("div",{className:"card-body",children:[(0,l.jsxs)("div",{className:"d-flex align-items-center mb-2",children:[l.jsx("input",{type:"radio",name:"pricing_mode",value:"full",checked:"full"===$.pricing_display_mode,onChange:()=>P({...$,pricing_display_mode:"full"}),className:"me-2"}),l.jsx("h6",{className:"card-title mb-0",children:"完全表示"})]}),l.jsx("p",{className:"card-text text-muted small",children:"すべての価格情報を表示"})]})})}),l.jsx("div",{className:"col-md-6",children:l.jsx("div",{className:`card h-100 cursor-pointer ${"summary"===$.pricing_display_mode?"border-primary bg-light":""}`,onClick:()=>P({...$,pricing_display_mode:"summary"}),style:{cursor:"pointer"},children:(0,l.jsxs)("div",{className:"card-body",children:[(0,l.jsxs)("div",{className:"d-flex align-items-center mb-2",children:[l.jsx("input",{type:"radio",name:"pricing_mode",value:"summary",checked:"summary"===$.pricing_display_mode,onChange:()=>P({...$,pricing_display_mode:"summary"}),className:"me-2"}),l.jsx("h6",{className:"card-title mb-0",children:"要約表示"})]}),l.jsx("p",{className:"card-text text-muted small",children:"合計金額のみ表示"})]})})}),l.jsx("div",{className:"col-md-6",children:l.jsx("div",{className:`card h-100 cursor-pointer ${"hidden"===$.pricing_display_mode?"border-primary bg-light":""}`,onClick:()=>P({...$,pricing_display_mode:"hidden"}),style:{cursor:"pointer"},children:(0,l.jsxs)("div",{className:"card-body",children:[(0,l.jsxs)("div",{className:"d-flex align-items-center mb-2",children:[l.jsx("input",{type:"radio",name:"pricing_mode",value:"hidden",checked:"hidden"===$.pricing_display_mode,onChange:()=>P({...$,pricing_display_mode:"hidden"}),className:"me-2"}),l.jsx("h6",{className:"card-title mb-0",children:"価格非表示"})]}),l.jsx("p",{className:"card-text text-muted small",children:"価格情報を一切表示しない"})]})})}),l.jsx("div",{className:"col-md-6",children:l.jsx("div",{className:`card h-100 cursor-pointer ${"custom"===$.pricing_display_mode?"border-primary bg-light":""}`,onClick:()=>P({...$,pricing_display_mode:"custom"}),style:{cursor:"pointer"},children:(0,l.jsxs)("div",{className:"card-body",children:[(0,l.jsxs)("div",{className:"d-flex align-items-center mb-2",children:[l.jsx("input",{type:"radio",name:"pricing_mode",value:"custom",checked:"custom"===$.pricing_display_mode,onChange:()=>P({...$,pricing_display_mode:"custom"}),className:"me-2"}),l.jsx("h6",{className:"card-title mb-0",children:"カスタム"})]}),l.jsx("p",{className:"card-text text-muted small",children:"個別に設定"})]})})})]})]}),"custom"===$.pricing_display_mode&&(0,l.jsxs)("div",{className:"mb-4",children:[l.jsx("h6",{className:"mb-3",children:"詳細設定"}),(0,l.jsxs)("div",{className:"row g-3",children:[l.jsx("div",{className:"col-md-6",children:(0,l.jsxs)("div",{className:"form-check",children:[l.jsx("input",{className:"form-check-input",type:"checkbox",id:"show_item_prices",checked:$.show_item_prices,onChange:e=>P({...$,show_item_prices:e.target.checked})}),l.jsx("label",{className:"form-check-label",htmlFor:"show_item_prices",children:"商品単価を表示"})]})}),l.jsx("div",{className:"col-md-6",children:(0,l.jsxs)("div",{className:"form-check",children:[l.jsx("input",{className:"form-check-input",type:"checkbox",id:"show_item_quantity",checked:$.show_item_quantity,onChange:e=>P({...$,show_item_quantity:e.target.checked})}),l.jsx("label",{className:"form-check-label",htmlFor:"show_item_quantity",children:"商品数量を表示"})]})}),l.jsx("div",{className:"col-md-6",children:(0,l.jsxs)("div",{className:"form-check",children:[l.jsx("input",{className:"form-check-input",type:"checkbox",id:"show_subtotal",checked:$.show_subtotal,onChange:e=>P({...$,show_subtotal:e.target.checked})}),l.jsx("label",{className:"form-check-label",htmlFor:"show_subtotal",children:"小計を表示"})]})}),l.jsx("div",{className:"col-md-6",children:(0,l.jsxs)("div",{className:"form-check",children:[l.jsx("input",{className:"form-check-input",type:"checkbox",id:"show_total_amount",checked:$.show_total_amount,onChange:e=>P({...$,show_total_amount:e.target.checked})}),l.jsx("label",{className:"form-check-label",htmlFor:"show_total_amount",children:"合計金額を表示"})]})})]})]}),(0,l.jsxs)("div",{className:"mb-4",children:[l.jsx("h6",{className:"mb-3",children:"プレビュー"}),l.jsx("div",{className:"card bg-light",children:(0,l.jsxs)("div",{className:"card-body",children:[(0,l.jsxs)("div",{className:"row",children:[(0,l.jsxs)("div",{className:"col-8",children:[l.jsx("h6",{className:"mb-1",children:"サンプル商品"}),("custom"===$.pricing_display_mode?$.show_item_quantity:"hidden"!==$.pricing_display_mode)&&l.jsx("small",{className:"text-muted",children:"数量: 2個"})]}),(0,l.jsxs)("div",{className:"col-4 text-end",children:[("custom"===$.pricing_display_mode?$.show_item_prices:"full"===$.pricing_display_mode)&&l.jsx("div",{className:"small text-muted",children:"単価: \xa5500"}),("custom"===$.pricing_display_mode?$.show_subtotal:"full"===$.pricing_display_mode)&&l.jsx("div",{className:"small",children:"小計: \xa51,000"})]})]}),l.jsx("hr",{className:"my-2"}),(0,l.jsxs)("div",{className:"d-flex justify-content-between align-items-center",children:[l.jsx("strong",{children:"合計"}),l.jsx("strong",{children:("custom"===$.pricing_display_mode?$.show_total_amount:"hidden"!==$.pricing_display_mode)?"\xa51,000":"※価格は店舗にてお知らせします"})]})]})})]}),(0,l.jsxs)("div",{className:"alert alert-info",children:[l.jsx("i",{className:"bi bi-info-circle me-2"}),"full"===$.pricing_display_mode&&"商品の単価、小計、合計金額がすべて表示されます。","summary"===$.pricing_display_mode&&"合計金額のみが表示されます。","hidden"===$.pricing_display_mode&&"価格情報は一切表示されません。","custom"===$.pricing_display_mode&&"選択した項目のみが表示されます。"]})]})]})})})})]})]}),(0,l.jsxs)("div",{className:"modal-footer",children:[l.jsx("button",{type:"button",className:"btn btn-secondary",onClick:W,children:"キャンセル"}),l.jsx("button",{type:"button",className:"btn btn-primary",onClick:E,disabled:!t.name.trim(),children:"作成"})]})]})}),q&&k&&l.jsx("div",{className:"modal show d-block",tabIndex:-1,style:{backgroundColor:"rgba(0,0,0,0.5)"},children:l.jsx("div",{className:"modal-dialog",children:(0,l.jsxs)("div",{className:"modal-content",children:[(0,l.jsxs)("div",{className:"modal-header",children:[l.jsx("h5",{className:"modal-title",children:k.id.startsWith("custom_")?"カスタムフィールドを作成":"フィールドを編集"}),l.jsx("button",{type:"button",className:"btn-close",onClick:()=>S(!1),"aria-label":"Close"})]}),(0,l.jsxs)("div",{className:"modal-body",children:[(0,l.jsxs)("div",{className:"mb-3",children:[l.jsx("label",{className:"form-label",children:"フィールドタイプ"}),l.jsx("select",{className:"form-select",value:k.type,onChange:e=>C({...k,type:e.target.value}),children:n.map(e=>l.jsx("option",{value:e.value,children:e.label},e.value))})]}),(0,l.jsxs)("div",{className:"mb-3",children:[l.jsx("label",{className:"form-label",children:"ラベル"}),l.jsx("input",{type:"text",className:"form-control",value:k.label,onChange:e=>C({...k,label:e.target.value}),placeholder:"フィールドのラベルを入力"})]}),(0,l.jsxs)("div",{className:"mb-3",children:[l.jsx("label",{className:"form-label",children:"プレースホルダー"}),l.jsx("input",{type:"text",className:"form-control",value:k.placeholder||"",onChange:e=>C({...k,placeholder:e.target.value}),placeholder:"プレースホルダーテキストを入力（任意）"})]}),("select"===k.type||"radio"===k.type||"checkbox"===k.type)&&(0,l.jsxs)("div",{className:"mb-3",children:[l.jsx("label",{className:"form-label",children:"選択肢（1行に1つずつ入力）"}),l.jsx("textarea",{className:"form-control",rows:4,value:k.options?.join("\n")||"",onChange:e=>C({...k,options:e.target.value.split("\n").filter(e=>e.trim())}),placeholder:"選択肢1 選択肢2 選択肢3"})]}),(0,l.jsxs)("div",{className:"form-check",children:[l.jsx("input",{className:"form-check-input",type:"checkbox",id:"fieldRequired",checked:k.required||!1,onChange:e=>C({...k,required:e.target.checked})}),l.jsx("label",{className:"form-check-label",htmlFor:"fieldRequired",children:"必須項目にする"})]})]}),(0,l.jsxs)("div",{className:"modal-footer",children:[l.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>S(!1),children:"キャンセル"}),l.jsx("button",{type:"button",className:"btn btn-primary",onClick:()=>{if(!k)return;let e=f.findIndex(e=>e.id===k.id);if(e>=0){let s=[...f];s[e]=k,w(s)}else w([...f,k]);C(null),S(!1)},disabled:!k.label.trim(),children:"保存"})]})]})})})]}):null}function h(){let[e,s]=(0,i.useState)(!1);return(0,l.jsxs)(l.Fragment,{children:[l.jsx(d,{onCreateForm:()=>{s(!0)},onEditForm:e=>{window.location.href=`/admin?page=form-builder&id=${e}`}}),l.jsx(o,{isOpen:e,onClose:()=>s(!1),onSuccess:()=>{s(!1)}})]})}}};