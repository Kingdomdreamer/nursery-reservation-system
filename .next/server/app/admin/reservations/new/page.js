(()=>{var e={};e.id=11,e.ids=[11],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},8893:e=>{"use strict";e.exports=require("buffer")},4770:e=>{"use strict";e.exports=require("crypto")},7702:e=>{"use strict";e.exports=require("events")},2615:e=>{"use strict";e.exports=require("http")},5240:e=>{"use strict";e.exports=require("https")},8216:e=>{"use strict";e.exports=require("net")},8621:e=>{"use strict";e.exports=require("punycode")},6162:e=>{"use strict";e.exports=require("stream")},2452:e=>{"use strict";e.exports=require("tls")},7360:e=>{"use strict";e.exports=require("url")},1568:e=>{"use strict";e.exports=require("zlib")},6135:(e,s,t)=>{"use strict";t.r(s),t.d(s,{GlobalError:()=>i.Z,__next_app__:()=>m,originalPathname:()=>o,pages:()=>d,routeModule:()=>u,tree:()=>c}),t(5615),t(4129),t(6083),t(5866);var r=t(3191),a=t(8716),i=t(8001),n=t(5231),l={};for(let e in n)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>n[e]);t.d(s,l);let c=["",{children:["admin",{children:["reservations",{children:["new",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,5615)),"/mnt/c/Claude/インストール/nursery-reservation-system/app/admin/reservations/new/page.tsx"]}]},{}]},{}]},{}]},{layout:[()=>Promise.resolve().then(t.bind(t,4129)),"/mnt/c/Claude/インストール/nursery-reservation-system/app/layout.tsx"],error:[()=>Promise.resolve().then(t.bind(t,6083)),"/mnt/c/Claude/インストール/nursery-reservation-system/app/error.tsx"],"not-found":[()=>Promise.resolve().then(t.t.bind(t,5866,23)),"next/dist/client/components/not-found-error"]}],d=["/mnt/c/Claude/インストール/nursery-reservation-system/app/admin/reservations/new/page.tsx"],o="/admin/reservations/new/page",m={require:t,loadChunk:()=>Promise.resolve()},u=new r.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/admin/reservations/new/page",pathname:"/admin/reservations/new",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},9371:(e,s,t)=>{Promise.resolve().then(t.bind(t,2058))},2058:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>c});var r=t(326),a=t(7577),i=t(5442),n=t(1058),l=t(4030);function c(){let{showSuccess:e,showError:s}=(0,n.p)(),[t,c]=(0,a.useState)(!1),[d,o]=(0,a.useState)([]),[m,u]=(0,a.useState)([]),[h,x]=(0,a.useState)([]),[p,b]=(0,a.useState)(null),[j,v]=(0,a.useState)(!1),[_,N]=(0,a.useState)({customer_id:"",customer_name:"",customer_phone:"",customer_email:"",reservation_date:"",pickup_time_start:"",pickup_time_end:"",notes:"",admin_notes:"",items:[]}),g=e=>{let s=d.find(s=>s.id===e);s&&(b(s),N(e=>({...e,customer_id:s.id,customer_name:s.full_name,customer_phone:s.phone,customer_email:s.email||""})),v(!1))},f=e=>{_.items.find(s=>s.product_id===e.id)?N(s=>({...s,items:s.items.map(s=>s.product_id===e.id?{...s,quantity:s.quantity+1,subtotal:(s.quantity+1)*s.unit_price}:s)})):N(s=>({...s,items:[...s.items,{product_id:e.id,product_name:e.name,quantity:1,unit_price:e.price,subtotal:e.price}]}))},y=(e,s)=>{s<=0?N(s=>({...s,items:s.items.filter(s=>s.product_id!==e)})):N(t=>({...t,items:t.items.map(t=>t.product_id===e?{...t,quantity:s,subtotal:s*t.unit_price}:t)}))},w=e=>{N(s=>({...s,items:s.items.filter(s=>s.product_id!==e)}))},q=()=>_.items.reduce((e,s)=>e+s.subtotal,0),k=async t=>{t.preventDefault(),c(!0);try{let s=_.customer_id;if(j){let{data:e,error:t}=await i.O.from("customers").insert([{full_name:_.customer_name,phone:_.customer_phone,email:_.customer_email||null}]).select().single();if(t)throw t;s=e.id}let t=`R${Date.now().toString().slice(-8)}`,{data:r,error:a}=await i.O.from("reservations").insert([{reservation_number:t,customer_id:s,reservation_date:_.reservation_date,pickup_time_start:_.pickup_time_start||null,pickup_time_end:_.pickup_time_end||null,total_amount:q(),final_amount:q(),discount_amount:0,status:"pending",notes:_.notes||null,admin_notes:_.admin_notes||null}]).select().single();if(a)throw a;let n=_.items.map(e=>({reservation_id:r.id,product_id:e.product_id,quantity:e.quantity,unit_price:e.unit_price,subtotal:e.subtotal})),{error:l}=await i.O.from("reservation_items").insert(n);if(l)throw l;e("予約が作成されました",`予約番号: ${t}`),window.location.href="/admin/reservations"}catch(e){s("予約の作成に失敗しました","予約の作成中にエラーが発生しました。")}finally{c(!1)}},S=[];for(let e=9;e<=17;e++)for(let s=0;s<60;s+=30){let t=`${e.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`,r=30===s?e+1:e,a=30===s?0:s+30,i=`${r.toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}`;r<=18&&S.push({start:t,end:i,label:`${t} - ${i}`})}return r.jsx(l.Z,{children:(0,r.jsxs)("div",{className:"container-fluid",children:[r.jsx("div",{className:"row mb-4",children:r.jsx("div",{className:"col-12",children:(0,r.jsxs)("div",{className:"d-flex justify-content-between align-items-center",children:[r.jsx("h1",{className:"h2 fw-bold text-dark",children:"新規予約追加"}),(0,r.jsxs)("button",{onClick:()=>window.location.href="/admin/reservations",className:"btn btn-outline-secondary",children:[r.jsx("i",{className:"bi bi-arrow-left me-2"}),"戻る"]})]})})}),r.jsx("form",{onSubmit:k,children:(0,r.jsxs)("div",{className:"row",children:[r.jsx("div",{className:"col-lg-6 mb-4",children:(0,r.jsxs)("div",{className:"card",children:[r.jsx("div",{className:"card-header",children:r.jsx("h5",{className:"card-title mb-0",children:"顧客情報"})}),(0,r.jsxs)("div",{className:"card-body",children:[(0,r.jsxs)("div",{className:"form-check mb-3",children:[r.jsx("input",{className:"form-check-input",type:"checkbox",id:"newCustomer",checked:j,onChange:()=>{v(!j),j||(b(null),N(e=>({...e,customer_id:"",customer_name:"",customer_phone:"",customer_email:""})))}}),r.jsx("label",{className:"form-check-label",htmlFor:"newCustomer",children:"新規顧客"})]}),j?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"mb-3",children:[r.jsx("label",{className:"form-label",children:"顧客名 *"}),r.jsx("input",{type:"text",className:"form-control",value:_.customer_name,onChange:e=>N(s=>({...s,customer_name:e.target.value})),required:!0})]}),(0,r.jsxs)("div",{className:"mb-3",children:[r.jsx("label",{className:"form-label",children:"電話番号 *"}),r.jsx("input",{type:"tel",className:"form-control",value:_.customer_phone,onChange:e=>N(s=>({...s,customer_phone:e.target.value})),required:!0})]}),(0,r.jsxs)("div",{className:"mb-3",children:[r.jsx("label",{className:"form-label",children:"メールアドレス"}),r.jsx("input",{type:"email",className:"form-control",value:_.customer_email,onChange:e=>N(s=>({...s,customer_email:e.target.value}))})]})]}):(0,r.jsxs)("div",{className:"mb-3",children:[r.jsx("label",{className:"form-label",children:"既存顧客を選択"}),(0,r.jsxs)("select",{className:"form-select",value:p?.id||"",onChange:e=>g(e.target.value),required:!0,children:[r.jsx("option",{value:"",children:"顧客を選択してください"}),d.map(e=>(0,r.jsxs)("option",{value:e.id,children:[e.full_name," (",e.phone,")"]},e.id))]})]})]})]})}),r.jsx("div",{className:"col-lg-6 mb-4",children:(0,r.jsxs)("div",{className:"card",children:[r.jsx("div",{className:"card-header",children:r.jsx("h5",{className:"card-title mb-0",children:"予約日時"})}),(0,r.jsxs)("div",{className:"card-body",children:[(0,r.jsxs)("div",{className:"mb-3",children:[r.jsx("label",{className:"form-label",children:"受取日 *"}),r.jsx("input",{type:"date",className:"form-control",value:_.reservation_date,onChange:e=>N(s=>({...s,reservation_date:e.target.value})),min:new Date().toISOString().split("T")[0],required:!0})]}),(0,r.jsxs)("div",{className:"mb-3",children:[r.jsx("label",{className:"form-label",children:"受取時間"}),(0,r.jsxs)("select",{className:"form-select",value:_.pickup_time_start,onChange:e=>{let s=S.find(s=>s.start===e.target.value);s&&N(e=>({...e,pickup_time_start:s.start,pickup_time_end:s.end}))},children:[r.jsx("option",{value:"",children:"時間を選択してください"}),S.map(e=>r.jsx("option",{value:e.start,children:e.label},e.start))]})]})]})]})}),r.jsx("div",{className:"col-12 mb-4",children:(0,r.jsxs)("div",{className:"card",children:[r.jsx("div",{className:"card-header",children:r.jsx("h5",{className:"card-title mb-0",children:"商品選択"})}),r.jsx("div",{className:"card-body",children:r.jsx("div",{className:"row",children:m.map(e=>r.jsx("div",{className:"col-md-4 mb-3",children:r.jsx("div",{className:"card",children:(0,r.jsxs)("div",{className:"card-body",children:[r.jsx("h6",{className:"card-title",children:e.name}),r.jsx("p",{className:"card-text small text-muted",children:e.category?.name}),r.jsx("p",{className:"card-text",children:(0,r.jsxs)("strong",{children:["\xa5",e.price.toLocaleString()]})}),(0,r.jsxs)("button",{type:"button",className:"btn btn-sm text-white",style:{background:"linear-gradient(135deg, #8bc34a 0%, #7cb342 100%)",border:"none"},onClick:()=>f(e),children:[r.jsx("i",{className:"bi bi-plus"})," 追加"]})]})})},e.id))})})]})}),_.items.length>0&&r.jsx("div",{className:"col-12 mb-4",children:(0,r.jsxs)("div",{className:"card",children:[r.jsx("div",{className:"card-header",children:r.jsx("h5",{className:"card-title mb-0",children:"選択した商品"})}),r.jsx("div",{className:"card-body",children:r.jsx("div",{className:"table-responsive",children:(0,r.jsxs)("table",{className:"table",children:[r.jsx("thead",{children:(0,r.jsxs)("tr",{children:[r.jsx("th",{children:"商品名"}),r.jsx("th",{children:"単価"}),r.jsx("th",{children:"数量"}),r.jsx("th",{children:"小計"}),r.jsx("th",{children:"操作"})]})}),r.jsx("tbody",{children:_.items.map(e=>(0,r.jsxs)("tr",{children:[r.jsx("td",{children:e.product_name}),(0,r.jsxs)("td",{children:["\xa5",e.unit_price.toLocaleString()]}),r.jsx("td",{children:(0,r.jsxs)("div",{className:"d-flex align-items-center",children:[r.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-sm me-2",onClick:()=>y(e.product_id,e.quantity-1),children:"-"}),r.jsx("span",{className:"mx-2",children:e.quantity}),r.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-sm ms-2",onClick:()=>y(e.product_id,e.quantity+1),children:"+"})]})}),(0,r.jsxs)("td",{children:["\xa5",e.subtotal.toLocaleString()]}),r.jsx("td",{children:r.jsx("button",{type:"button",className:"btn btn-outline-danger btn-sm",onClick:()=>w(e.product_id),children:r.jsx("i",{className:"bi bi-trash"})})})]},e.product_id))}),r.jsx("tfoot",{children:(0,r.jsxs)("tr",{children:[r.jsx("th",{colSpan:3,children:"合計"}),(0,r.jsxs)("th",{children:["\xa5",q().toLocaleString()]}),r.jsx("th",{})]})})]})})})]})}),r.jsx("div",{className:"col-12 mb-4",children:(0,r.jsxs)("div",{className:"card",children:[r.jsx("div",{className:"card-header",children:r.jsx("h5",{className:"card-title mb-0",children:"備考"})}),(0,r.jsxs)("div",{className:"card-body",children:[(0,r.jsxs)("div",{className:"mb-3",children:[r.jsx("label",{className:"form-label",children:"顧客備考"}),r.jsx("textarea",{className:"form-control",rows:3,value:_.notes,onChange:e=>N(s=>({...s,notes:e.target.value})),placeholder:"顧客からの特別な要望など"})]}),(0,r.jsxs)("div",{className:"mb-3",children:[r.jsx("label",{className:"form-label",children:"管理メモ"}),r.jsx("textarea",{className:"form-control",rows:3,value:_.admin_notes,onChange:e=>N(s=>({...s,admin_notes:e.target.value})),placeholder:"管理者向けメモ"})]})]})]})}),r.jsx("div",{className:"col-12",children:(0,r.jsxs)("div",{className:"d-flex justify-content-end gap-3",children:[r.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>window.location.href="/admin/reservations",children:"キャンセル"}),r.jsx("button",{type:"submit",disabled:t||0===_.items.length,className:"btn text-white",style:{background:"linear-gradient(135deg, #8bc34a 0%, #7cb342 100%)",border:"none"},children:t?(0,r.jsxs)(r.Fragment,{children:[r.jsx("span",{className:"spinner-border spinner-border-sm me-2"}),"作成中..."]}):(0,r.jsxs)(r.Fragment,{children:[r.jsx("i",{className:"bi bi-check-circle me-2"}),"予約を作成"]})})]})})]})})]})})}},5615:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>r});let r=(0,t(8570).createProxy)(String.raw`/mnt/c/Claude/インストール/nursery-reservation-system/app/admin/reservations/new/page.tsx#default`)}};var s=require("../../../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),r=s.X(0,[431,496,290,30],()=>t(6135));module.exports=r})();