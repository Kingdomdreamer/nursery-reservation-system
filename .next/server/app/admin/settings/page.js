(()=>{var e={};e.id=140,e.ids=[140],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},8893:e=>{"use strict";e.exports=require("buffer")},4770:e=>{"use strict";e.exports=require("crypto")},7702:e=>{"use strict";e.exports=require("events")},2615:e=>{"use strict";e.exports=require("http")},5240:e=>{"use strict";e.exports=require("https")},8216:e=>{"use strict";e.exports=require("net")},8621:e=>{"use strict";e.exports=require("punycode")},6162:e=>{"use strict";e.exports=require("stream")},2452:e=>{"use strict";e.exports=require("tls")},7360:e=>{"use strict";e.exports=require("url")},1568:e=>{"use strict";e.exports=require("zlib")},9403:(e,s,t)=>{"use strict";t.r(s),t.d(s,{GlobalError:()=>n.Z,__next_app__:()=>m,originalPathname:()=>d,pages:()=>o,routeModule:()=>u,tree:()=>c}),t(2740),t(4129),t(6083),t(5866);var a=t(3191),i=t(8716),n=t(8001),r=t(5231),l={};for(let e in r)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>r[e]);t.d(s,l);let c=["",{children:["admin",{children:["settings",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,2740)),"/mnt/c/Claude/インストール/nursery-reservation-system/app/admin/settings/page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(t.bind(t,4129)),"/mnt/c/Claude/インストール/nursery-reservation-system/app/layout.tsx"],error:[()=>Promise.resolve().then(t.bind(t,6083)),"/mnt/c/Claude/インストール/nursery-reservation-system/app/error.tsx"],"not-found":[()=>Promise.resolve().then(t.t.bind(t,5866,23)),"next/dist/client/components/not-found-error"]}],o=["/mnt/c/Claude/インストール/nursery-reservation-system/app/admin/settings/page.tsx"],d="/admin/settings/page",m={require:t,loadChunk:()=>Promise.resolve()},u=new a.AppPageRouteModule({definition:{kind:i.x.APP_PAGE,page:"/admin/settings/page",pathname:"/admin/settings",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},3948:(e,s,t)=>{Promise.resolve().then(t.bind(t,8796))},8796:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>o});var a=t(326),i=t(7577),n=t(1058),r=t(4030),l=t(5442);class c{static{this.SETTING_KEYS={GENERAL:"general_settings",NOTIFICATIONS:"notification_settings",BUSINESS:"business_settings",ADVANCED:"advanced_settings"}}static async getSettings(){try{let{data:e,error:s}=await l.O.from("system_settings").select("setting_key, setting_value").in("setting_key",Object.values(this.SETTING_KEYS));if(s)return this.getDefaultSettings();let t=this.getDefaultSettings();return e&&e.forEach(e=>{let s="string"==typeof e.setting_value?JSON.parse(e.setting_value):e.setting_value;switch(e.setting_key){case this.SETTING_KEYS.GENERAL:t.general={...t.general,...s};break;case this.SETTING_KEYS.NOTIFICATIONS:t.notifications={...t.notifications,...s};break;case this.SETTING_KEYS.BUSINESS:t.business={...t.business,...s};break;case this.SETTING_KEYS.ADVANCED:t.advanced={...t.advanced,...s}}}),t}catch(e){return this.getDefaultSettings()}}static async saveSettings(e){try{for(let s of[{setting_key:this.SETTING_KEYS.GENERAL,setting_value:JSON.stringify(e.general)},{setting_key:this.SETTING_KEYS.NOTIFICATIONS,setting_value:JSON.stringify(e.notifications)},{setting_key:this.SETTING_KEYS.BUSINESS,setting_value:JSON.stringify(e.business)},{setting_key:this.SETTING_KEYS.ADVANCED,setting_value:JSON.stringify(e.advanced)}]){let{error:e}=await l.O.from("system_settings").upsert(s,{onConflict:"setting_key"});if(e)throw e}}catch(e){throw Error("設定の保存に失敗しました")}}static getDefaultSettings(){return{general:{site_name:"ベジライス予約システム",site_description:"LINE ミニアプリ対応の種苗店予約システム",contact_email:"contact@vegirice.com",contact_phone:"03-1234-5678"},notifications:{email_enabled:!0,line_enabled:!0,sms_enabled:!1,reminder_hours:24},business:{business_hours_start:"09:00",business_hours_end:"18:00",business_days:["月","火","水","木","金","土"],holiday_mode:!1},advanced:{auto_confirm_orders:!1,require_phone_verification:!0,max_reservation_days:30,default_pickup_duration:60}}}static async initializeSettings(){try{let e=this.getDefaultSettings();await this.saveSettings(e)}catch(e){throw Error("設定の初期化に失敗しました")}}static async getSettingsByCategory(e){try{let s=this.SETTING_KEYS[e.toUpperCase()],{data:t,error:a}=await l.O.from("system_settings").select("setting_value").eq("setting_key",s).single();if(a)return this.getDefaultSettings()[e];return t?JSON.parse(t.setting_value):this.getDefaultSettings()[e]}catch(s){return this.getDefaultSettings()[e]}}static async isBusinessOpen(){try{let e=await this.getSettingsByCategory("business");if(e.holiday_mode)return!1;let s=new Date,t=["日","月","火","水","木","金","土"][s.getDay()];if(!e.business_days.includes(t))return!1;let a=100*s.getHours()+s.getMinutes(),i=parseInt(e.business_hours_start.replace(":","")),n=parseInt(e.business_hours_end.replace(":",""));return a>=i&&a<=n}catch(e){return!1}}static async getMaxReservationDate(){try{let e=(await this.getSettingsByCategory("advanced")).max_reservation_days||30,s=new Date;return s.setDate(s.getDate()+e),s}catch(s){let e=new Date;return e.setDate(e.getDate()+30),e}}}function o(){let{showSuccess:e,showError:s}=(0,n.p)(),[t,l]=(0,i.useState)({general:{site_name:"",site_description:"",contact_email:"",contact_phone:""},notifications:{email_enabled:!0,line_enabled:!0,sms_enabled:!1,reminder_hours:24},business:{business_hours_start:"09:00",business_hours_end:"18:00",business_days:["月","火","水","木","金","土"],holiday_mode:!1},advanced:{auto_confirm_orders:!1,require_phone_verification:!0,max_reservation_days:30,default_pickup_duration:60}}),[o,d]=(0,i.useState)(!1),[m,u]=(0,i.useState)("general"),h=async()=>{d(!0);try{await c.saveSettings(t),e("設定が保存されました")}catch(e){s("設定の保存に失敗しました")}finally{d(!1)}},_=(e,s)=>{l(t=>({...t,general:{...t.general,[e]:s}}))},g=(e,s)=>{l(t=>({...t,notifications:{...t.notifications,[e]:s}}))},b=(e,s)=>{l(t=>({...t,business:{...t.business,[e]:s}}))},x=(e,s)=>{l(t=>({...t,advanced:{...t.advanced,[e]:s}}))},p=e=>{b("business_days",t.business.business_days.includes(e)?t.business.business_days.filter(s=>s!==e):[...t.business.business_days,e])};return a.jsx(r.Z,{children:(0,a.jsxs)("div",{className:"container-fluid",children:[a.jsx("div",{className:"row",children:a.jsx("div",{className:"col-12",children:(0,a.jsxs)("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[a.jsx("h1",{className:"h2 fw-bold text-dark",children:"システム設定"}),a.jsx("button",{onClick:h,disabled:o,className:"btn text-white",style:{background:"linear-gradient(135deg, #8bc34a 0%, #7cb342 100%)",border:"none"},children:o?(0,a.jsxs)(a.Fragment,{children:[a.jsx("span",{className:"spinner-border spinner-border-sm me-2"}),"保存中..."]}):(0,a.jsxs)(a.Fragment,{children:[a.jsx("i",{className:"bi bi-check-circle me-2"}),"設定を保存"]})})]})})}),(0,a.jsxs)("div",{className:"row",children:[a.jsx("div",{className:"col-lg-3 col-md-4 mb-4",children:(0,a.jsxs)("div",{className:"card",children:[a.jsx("div",{className:"card-header",children:a.jsx("h5",{className:"card-title mb-0",children:"設定カテゴリ"})}),a.jsx("div",{className:"list-group list-group-flush",children:[{id:"general",label:"基本設定",icon:"bi-gear"},{id:"notifications",label:"通知設定",icon:"bi-bell"},{id:"business",label:"営業設定",icon:"bi-clock"},{id:"advanced",label:"高度な設定",icon:"bi-tools"}].map(e=>(0,a.jsxs)("button",{onClick:()=>u(e.id),className:`list-group-item list-group-item-action d-flex align-items-center ${m===e.id?"active":""}`,style:m===e.id?{background:"linear-gradient(135deg, #8bc34a 0%, #7cb342 100%)",color:"white"}:{},children:[a.jsx("i",{className:`${e.icon} me-3`}),e.label]},e.id))})]})}),a.jsx("div",{className:"col-lg-9 col-md-8",children:a.jsx("div",{className:"card",children:(0,a.jsxs)("div",{className:"card-body",children:["general"===m&&(0,a.jsxs)("div",{children:[a.jsx("h5",{className:"card-title mb-4",children:"基本設定"}),(0,a.jsxs)("div",{className:"row g-3",children:[(0,a.jsxs)("div",{className:"col-md-6",children:[a.jsx("label",{className:"form-label fw-medium",children:"サイト名"}),a.jsx("input",{type:"text",className:"form-control",value:t.general.site_name,onChange:e=>_("site_name",e.target.value)})]}),(0,a.jsxs)("div",{className:"col-md-6",children:[a.jsx("label",{className:"form-label fw-medium",children:"連絡先メール"}),a.jsx("input",{type:"email",className:"form-control",value:t.general.contact_email,onChange:e=>_("contact_email",e.target.value)})]}),(0,a.jsxs)("div",{className:"col-md-6",children:[a.jsx("label",{className:"form-label fw-medium",children:"連絡先電話番号"}),a.jsx("input",{type:"tel",className:"form-control",value:t.general.contact_phone,onChange:e=>_("contact_phone",e.target.value)})]}),(0,a.jsxs)("div",{className:"col-12",children:[a.jsx("label",{className:"form-label fw-medium",children:"サイト説明"}),a.jsx("textarea",{className:"form-control",rows:3,value:t.general.site_description,onChange:e=>_("site_description",e.target.value)})]})]})]}),"notifications"===m&&(0,a.jsxs)("div",{children:[a.jsx("h5",{className:"card-title mb-4",children:"通知設定"}),(0,a.jsxs)("div",{className:"row g-3",children:[a.jsx("div",{className:"col-12",children:(0,a.jsxs)("div",{className:"form-check",children:[a.jsx("input",{className:"form-check-input",type:"checkbox",id:"email_enabled",checked:t.notifications.email_enabled,onChange:e=>g("email_enabled",e.target.checked)}),a.jsx("label",{className:"form-check-label fw-medium",htmlFor:"email_enabled",children:"メール通知を有効にする"})]})}),a.jsx("div",{className:"col-12",children:(0,a.jsxs)("div",{className:"form-check",children:[a.jsx("input",{className:"form-check-input",type:"checkbox",id:"line_enabled",checked:t.notifications.line_enabled,onChange:e=>g("line_enabled",e.target.checked)}),a.jsx("label",{className:"form-check-label fw-medium",htmlFor:"line_enabled",children:"LINE通知を有効にする"})]})}),a.jsx("div",{className:"col-12",children:(0,a.jsxs)("div",{className:"form-check",children:[a.jsx("input",{className:"form-check-input",type:"checkbox",id:"sms_enabled",checked:t.notifications.sms_enabled,onChange:e=>g("sms_enabled",e.target.checked)}),a.jsx("label",{className:"form-check-label fw-medium",htmlFor:"sms_enabled",children:"SMS通知を有効にする"})]})}),(0,a.jsxs)("div",{className:"col-md-6",children:[a.jsx("label",{className:"form-label fw-medium",children:"リマインダー送信時間（時間前）"}),a.jsx("input",{type:"number",className:"form-control",min:"1",max:"72",value:t.notifications.reminder_hours,onChange:e=>g("reminder_hours",parseInt(e.target.value))})]})]})]}),"business"===m&&(0,a.jsxs)("div",{children:[a.jsx("h5",{className:"card-title mb-4",children:"営業設定"}),(0,a.jsxs)("div",{className:"row g-3",children:[(0,a.jsxs)("div",{className:"col-md-6",children:[a.jsx("label",{className:"form-label fw-medium",children:"営業開始時間"}),a.jsx("input",{type:"time",className:"form-control",value:t.business.business_hours_start,onChange:e=>b("business_hours_start",e.target.value)})]}),(0,a.jsxs)("div",{className:"col-md-6",children:[a.jsx("label",{className:"form-label fw-medium",children:"営業終了時間"}),a.jsx("input",{type:"time",className:"form-control",value:t.business.business_hours_end,onChange:e=>b("business_hours_end",e.target.value)})]}),(0,a.jsxs)("div",{className:"col-12",children:[a.jsx("label",{className:"form-label fw-medium",children:"営業日"}),a.jsx("div",{className:"d-flex gap-2 mt-2",children:["月","火","水","木","金","土","日"].map(e=>a.jsx("button",{type:"button",onClick:()=>p(e),className:`btn ${t.business.business_days.includes(e)?"text-white":"btn-outline-secondary"}`,style:t.business.business_days.includes(e)?{background:"linear-gradient(135deg, #8bc34a 0%, #7cb342 100%)",border:"none"}:{},children:e},e))})]}),a.jsx("div",{className:"col-12",children:(0,a.jsxs)("div",{className:"form-check",children:[a.jsx("input",{className:"form-check-input",type:"checkbox",id:"holiday_mode",checked:t.business.holiday_mode,onChange:e=>b("holiday_mode",e.target.checked)}),a.jsx("label",{className:"form-check-label fw-medium",htmlFor:"holiday_mode",children:"休業モード（すべての予約を一時停止）"})]})})]})]}),"advanced"===m&&(0,a.jsxs)("div",{children:[a.jsx("h5",{className:"card-title mb-4",children:"高度な設定"}),(0,a.jsxs)("div",{className:"row g-3",children:[a.jsx("div",{className:"col-12",children:(0,a.jsxs)("div",{className:"form-check",children:[a.jsx("input",{className:"form-check-input",type:"checkbox",id:"auto_confirm_orders",checked:t.advanced.auto_confirm_orders,onChange:e=>x("auto_confirm_orders",e.target.checked)}),a.jsx("label",{className:"form-check-label fw-medium",htmlFor:"auto_confirm_orders",children:"注文を自動確定する"})]})}),a.jsx("div",{className:"col-12",children:(0,a.jsxs)("div",{className:"form-check",children:[a.jsx("input",{className:"form-check-input",type:"checkbox",id:"require_phone_verification",checked:t.advanced.require_phone_verification,onChange:e=>x("require_phone_verification",e.target.checked)}),a.jsx("label",{className:"form-check-label fw-medium",htmlFor:"require_phone_verification",children:"電話番号の確認を必須にする"})]})}),(0,a.jsxs)("div",{className:"col-md-6",children:[a.jsx("label",{className:"form-label fw-medium",children:"最大予約可能日数"}),a.jsx("input",{type:"number",className:"form-control",min:"1",max:"365",value:t.advanced.max_reservation_days,onChange:e=>x("max_reservation_days",parseInt(e.target.value))})]}),(0,a.jsxs)("div",{className:"col-md-6",children:[a.jsx("label",{className:"form-label fw-medium",children:"デフォルト受取時間（分）"}),a.jsx("input",{type:"number",className:"form-control",min:"15",max:"480",step:"15",value:t.advanced.default_pickup_duration,onChange:e=>x("default_pickup_duration",parseInt(e.target.value))})]})]})]})]})})})]})]})})}},2740:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>a});let a=(0,t(8570).createProxy)(String.raw`/mnt/c/Claude/インストール/nursery-reservation-system/app/admin/settings/page.tsx#default`)}};var s=require("../../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),a=s.X(0,[431,496,290,30],()=>t(9403));module.exports=a})();