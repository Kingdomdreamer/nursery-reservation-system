(()=>{var e={};e.id=512,e.ids=[512],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},8893:e=>{"use strict";e.exports=require("buffer")},4770:e=>{"use strict";e.exports=require("crypto")},7702:e=>{"use strict";e.exports=require("events")},2615:e=>{"use strict";e.exports=require("http")},5240:e=>{"use strict";e.exports=require("https")},8216:e=>{"use strict";e.exports=require("net")},8621:e=>{"use strict";e.exports=require("punycode")},6162:e=>{"use strict";e.exports=require("stream")},2452:e=>{"use strict";e.exports=require("tls")},7360:e=>{"use strict";e.exports=require("url")},1568:e=>{"use strict";e.exports=require("zlib")},9746:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>s.Z,__next_app__:()=>u,originalPathname:()=>l,pages:()=>d,routeModule:()=>p,tree:()=>c}),r(2516),r(4129),r(6083),r(5866);var i=r(3191),a=r(8716),s=r(8001),o=r(5231),n={};for(let e in o)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(n[e]=()=>o[e]);r.d(t,n);let c=["",{children:["admin",{children:["products",{children:["add",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,2516)),"/mnt/c/Claude/インストール/nursery-reservation-system/app/admin/products/add/page.tsx"]}]},{}]},{}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,4129)),"/mnt/c/Claude/インストール/nursery-reservation-system/app/layout.tsx"],error:[()=>Promise.resolve().then(r.bind(r,6083)),"/mnt/c/Claude/インストール/nursery-reservation-system/app/error.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,5866,23)),"next/dist/client/components/not-found-error"]}],d=["/mnt/c/Claude/インストール/nursery-reservation-system/app/admin/products/add/page.tsx"],l="/admin/products/add/page",u={require:r,loadChunk:()=>Promise.resolve()},p=new i.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/admin/products/add/page",pathname:"/admin/products/add",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},1761:(e,t,r)=>{Promise.resolve().then(r.bind(r,672))},672:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>o});var i=r(326);r(7577);var a=r(4030),s=r(9553);function o(){return i.jsx(a.Z,{children:(0,i.jsxs)("div",{className:"container-fluid",children:[i.jsx("div",{className:"row mb-4",children:i.jsx("div",{className:"col-12",children:(0,i.jsxs)("div",{className:"d-flex justify-content-between align-items-center",children:[i.jsx("h1",{className:"h2 fw-bold text-dark",children:"新規商品追加"}),(0,i.jsxs)("button",{onClick:()=>window.location.href="/admin/products",className:"btn btn-outline-secondary",children:[i.jsx("i",{className:"bi bi-arrow-left me-2"}),"商品一覧に戻る"]})]})})}),i.jsx(s.Z,{})]})})}},241:(e,t,r)=>{"use strict";r.d(t,{M:()=>a});var i=r(5442);class a{static async getAllProducts(){let{data:e,error:t}=await i.O.from("products").select(`
        *,
        product_categories (
          id,
          name,
          color
        )
      `).order("created_at",{ascending:!1});if(t)throw t;return e||[]}static async getActiveProducts(){let{data:e,error:t}=await i.O.from("products").select(`
        *,
        product_categories (
          id,
          name,
          color
        )
      `).eq("is_available",!0).order("display_order",{ascending:!0});if(t)throw t;return e||[]}static async getProductsByCategory(e){let{data:t,error:r}=await i.O.from("products").select(`
        *,
        product_categories (
          id,
          name,
          color
        )
      `).eq("category_id",e).eq("is_available",!0).order("display_order",{ascending:!0});if(r)throw r;return t||[]}static async createProduct(e){let{data:t,error:r}=await i.O.from("products").insert([{...e,category_id:e.category_id||null,tax_type:e.tax_type||"inclusive",is_available:!1!==e.is_available,display_order:e.display_order||0}]).select();if(r)throw r;return t[0]}static async updateProduct(e,t){let{data:r,error:a}=await i.O.from("products").update({...t,category_id:t.category_id||null}).eq("id",e).select();if(a)throw a;return r[0]}static async deleteProduct(e){let{error:t}=await i.O.from("products").delete().eq("id",e);if(t)throw t;return!0}static async getAllCategories(){let{data:e,error:t}=await i.O.from("product_categories").select("*").eq("is_active",!0).order("display_order",{ascending:!0});if(t)throw t;return e||[]}static async bulkImportProducts(e){let t={success:0,failed:0,errors:[],warnings:[]},r=[];for(let i=0;i<e.length;i++){let a=e[i],s=i+2;if(!a.name||""===a.name.trim()){t.failed++,t.errors.push(`行${s}: 商品名が入力されていません`);continue}void 0!==a.price&&(isNaN(Number(a.price))||0>Number(a.price))&&(t.warnings.push(`行${s}: 価格が無効です。0に設定されます`),a.price=0),!a.id&&await this.getProductByName(a.name.trim())&&t.warnings.push(`行${s}: 商品「${a.name}」は既に存在します`),r.push({...a,lineNumber:s})}for(let e of r)try{if(e.id){if(!await this.getProductById(e.id)){t.failed++,t.errors.push(`行${e.lineNumber}: ID「${e.id}」の商品が見つかりません`);continue}await this.updateProduct(e.id,{name:e.name.trim(),barcode:e.barcode?.trim()||void 0,price:e.price||0,variation_name:e.variation_name?.trim()||void 0,tax_type:e.tax_type||"inclusive",category_id:e.category_id||void 0,description:e.description?.trim()||void 0})}else await this.createProduct({name:e.name.trim(),barcode:e.barcode?.trim()||void 0,price:e.price||0,variation_name:e.variation_name?.trim()||void 0,tax_type:e.tax_type||"inclusive",category_id:e.category_id||void 0,description:e.description?.trim()||void 0,is_available:!0,display_order:0});t.success++}catch(i){t.failed++;let r=i?.message||i?.toString()||"不明なエラー";t.errors.push(`行${e.lineNumber}: 商品「${e.name}」: ${r}`)}return t}static async getProductByName(e){let{data:t,error:r}=await i.O.from("products").select("id, name").eq("name",e).limit(1);if(r)throw r;return t?.[0]||null}static async getProductById(e){let{data:t,error:r}=await i.O.from("products").select("*").eq("id",e).limit(1);if(r)throw r;return t?.[0]||null}static parseCSV(e){try{let t=e.replace(/\r\n/g,"\n").replace(/\r/g,"\n").trim().split("\n").filter(e=>e.trim());if(t.length<2)throw Error("CSVファイルが空か、ヘッダー行しかありません。最低でもヘッダー行とデータ行が必要です。");let r=t[0].trim();if(!r)throw Error("ヘッダー行が空です");let i=this.parseCSVLine(r).map(e=>e.trim().replace(/^["']|["']$/g,""));if(0===i.length)throw Error("ヘッダー行を解析できませんでした");let a=[],s=[],o=i.map(e=>e.toLowerCase()),n=["name"].filter(e=>!o.includes(e.toLowerCase()));if(n.length>0)throw Error(`必須の列が見つかりません: ${n.join(", ")}

検出された列: ${i.join(", ")}

列名は大文字小文字を区別しません。`);for(let e=1;e<t.length;e++){let r=t[e].trim();if(r)try{let t=this.parseCSVLine(r);t.length,i.length;let o={},n=!1;i.forEach((r,i)=>{let a=t[i]?.trim().replace(/^["']|["']$/g,"")||"";switch(r.toLowerCase()){case"id":a&&(o.id=a);break;case"name":a?o.name=a:(s.push(`行${e+1}: 商品名が入力されていません`),n=!0);break;case"barcode":a&&(o.barcode=a);break;case"price":if(a){let t=parseFloat(a.replace(/[￥,]/g,""));isNaN(t)||t<0?s.push(`行${e+1}: 価格「${a}」が無効です（数値または0以上の値を入力してください）`):o.price=t}break;case"variation_name":a&&(o.variation_name=a);break;case"tax_type":if(a){let t=a.toLowerCase().trim();"内税"===t||"inclusive"===t?o.tax_type="inclusive":"外税"===t||"exclusive"===t?o.tax_type="exclusive":["inclusive","exclusive"].includes(t)?o.tax_type=t:s.push(`行${e+1}: 税区分「${a}」が無効です（内税/外税 または inclusive/exclusiveのみ）`)}break;case"category_id":a&&(o.category_id=a);break;case"description":a&&(o.description=a)}}),!n&&o.name&&a.push(o)}catch(t){s.push(`行${e+1}: 行の解析に失敗しました - ${t.message}`)}}if(s.length>0){let e=`CSVファイルに${s.length}個のエラーがあります:

${s.join("\n")}`;throw Error(e)}if(0===a.length)throw Error("有効な商品データが見つかりませんでした。\n\n以下を確認してください:\n• name列に値が入力されているか\n• データ行が存在するか\n• ファイル形式が正しいか");return a}catch(t){let e=t.message||"不明なエラーが発生しました";throw Error(`CSV解析エラー: ${e}`)}}static parseCSVLine(e){let t=[],r="",i=!1;for(let a=0;a<e.length;a++){let s=e[a];'"'===s||"'"===s?i&&e[a+1]===s?(r+=s,a++):i=!i:","!==s||i?r+=s:(t.push(r),r="")}return t.push(r),t}static generateCSVTemplate(e){return"id,name,barcode,price,variation_name,tax_type,category_id,description\n"+["","トマト苗","4901234567890","300","通常価格","inclusive",e[0]?.id||"","中玉トマトの苗"].join(",")}static async exportToCSV(){return["id,name,barcode,price,variation_name,tax_type,category_id,description",...(await this.getAllProducts()).map(e=>[e.id,`"${e.name}"`,e.barcode||"",e.price,e.variation_name||"",e.tax_type||"",e.category_id||"",`"${e.description||""}"`].join(","))].join("\n")}}},2516:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>i});let i=(0,r(8570).createProxy)(String.raw`/mnt/c/Claude/インストール/nursery-reservation-system/app/admin/products/add/page.tsx#default`)}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),i=t.X(0,[431,496,290,30,553],()=>r(9746));module.exports=i})();