(()=>{var e={};e.id=512,e.ids=[512],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},8893:e=>{"use strict";e.exports=require("buffer")},4770:e=>{"use strict";e.exports=require("crypto")},7702:e=>{"use strict";e.exports=require("events")},2615:e=>{"use strict";e.exports=require("http")},5240:e=>{"use strict";e.exports=require("https")},8216:e=>{"use strict";e.exports=require("net")},8621:e=>{"use strict";e.exports=require("punycode")},6162:e=>{"use strict";e.exports=require("stream")},2452:e=>{"use strict";e.exports=require("tls")},7360:e=>{"use strict";e.exports=require("url")},1568:e=>{"use strict";e.exports=require("zlib")},9746:(e,r,t)=>{"use strict";t.r(r),t.d(r,{GlobalError:()=>s.Z,__next_app__:()=>u,originalPathname:()=>l,pages:()=>d,routeModule:()=>p,tree:()=>c}),t(2516),t(4129),t(6083),t(5866);var i=t(3191),a=t(8716),s=t(8001),n=t(5231),o={};for(let e in n)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>n[e]);t.d(r,o);let c=["",{children:["admin",{children:["products",{children:["add",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,2516)),"/mnt/c/Claude/インストール/nursery-reservation-system/app/admin/products/add/page.tsx"]}]},{}]},{}]},{}]},{layout:[()=>Promise.resolve().then(t.bind(t,4129)),"/mnt/c/Claude/インストール/nursery-reservation-system/app/layout.tsx"],error:[()=>Promise.resolve().then(t.bind(t,6083)),"/mnt/c/Claude/インストール/nursery-reservation-system/app/error.tsx"],"not-found":[()=>Promise.resolve().then(t.t.bind(t,5866,23)),"next/dist/client/components/not-found-error"]}],d=["/mnt/c/Claude/インストール/nursery-reservation-system/app/admin/products/add/page.tsx"],l="/admin/products/add/page",u={require:t,loadChunk:()=>Promise.resolve()},p=new i.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/admin/products/add/page",pathname:"/admin/products/add",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},1761:(e,r,t)=>{Promise.resolve().then(t.bind(t,672))},672:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>n});var i=t(326);t(7577);var a=t(4030),s=t(9553);function n(){return i.jsx(a.Z,{children:(0,i.jsxs)("div",{className:"container-fluid",children:[i.jsx("div",{className:"row mb-4",children:i.jsx("div",{className:"col-12",children:(0,i.jsxs)("div",{className:"d-flex justify-content-between align-items-center",children:[i.jsx("h1",{className:"h2 fw-bold text-dark",children:"新規商品追加"}),(0,i.jsxs)("button",{onClick:()=>window.location.href="/admin/products",className:"btn btn-outline-secondary",children:[i.jsx("i",{className:"bi bi-arrow-left me-2"}),"商品一覧に戻る"]})]})})}),i.jsx(s.Z,{})]})})}},241:(e,r,t)=>{"use strict";t.d(r,{M:()=>a});var i=t(5442);class a{static async checkDatabaseConstraints(){try{let{data:e,error:r}=await i.O.from("products").select("id, name, barcode").limit(5);if(r)return;e?.map(e=>e.name),e?.filter(e=>e.barcode).map(e=>e.barcode)}catch(e){}}static async getAllProducts(){let{data:e,error:r}=await i.O.from("products").select("*").order("created_at",{ascending:!1});if(r)throw r;return e||[]}static async getActiveProducts(){let{data:e,error:r}=await i.O.from("products").select("*").eq("is_available",!0).order("created_at",{ascending:!1});if(r)throw r;return e||[]}static async getProductsByCategory(e){let{data:r,error:t}=await i.O.from("products").select("*").eq("category_id",e).eq("is_available",!0).order("created_at",{ascending:!1});if(t)throw t;return r||[]}static async createProduct(e){try{let r=e.barcode?.trim()||null;if(r){let{data:e,error:t}=await i.O.from("products").select("id, name, barcode").eq("barcode",r).single();if(e)throw Error(`このバーコード「${r}」は既に商品「${e.name}」で使用されています。別のバーコードを使用してください。`)}let{data:t,error:a}=await i.O.from("products").select("id, name").eq("name",e.name).single();if(t)throw Error(`商品名「${e.name}」は既に登録されています。別の商品名を使用してください。`);let s={name:e.name?.trim(),description:e.description?.trim()||null,price:Number(e.price)||0,category_id:e.category_id?.trim()||null,unit:e.unit?.trim()||null,min_order_quantity:Number(e.min_order_quantity)||1,max_order_quantity:e.max_order_quantity?Number(e.max_order_quantity):null,variation_name:e.variation_name?.trim()||null,image_url:e.image_url?.trim()||null,barcode:r,tax_type:e.tax_type||"inclusive",is_available:!1!==e.is_available,display_order:e.display_order||0},{data:n,error:o}=await i.O.from("products").insert(s).select("*").single();if(o){if("23505"===o.code){let e=o.details||o.message||"";if(e.includes("barcode"))throw Error("このバーコードは既に登録されています。別のバーコードを使用してください。");if(e.includes("name"))throw Error("この商品名は既に登録されています。別の商品名を使用してください。");if(e.includes("pkey")||e.includes("Primary key"))throw Error("内部エラー: 商品IDの重複が発生しました。再度お試しください。");throw Error(`重複エラー: ${e}`)}if(o.code?.startsWith("23")){let e={23502:"必須フィールドが入力されていません",23503:"関連データが存在しません（カテゴリIDなど）",23514:"入力値が制約に違反しています"}[o.code]||"制約違反エラーが発生しました";throw Error(`${e}: ${o.message}`)}throw o}return n}catch(e){throw e}}static async updateProduct(e,r){let{data:t,error:a}=await i.O.from("products").update({...r,category_id:r.category_id||null,updated_at:new Date().toISOString()}).eq("id",e).select("*").single();if(a)throw a;return t}static async deleteProduct(e){let{error:r}=await i.O.from("products").delete().eq("id",e);if(r)throw r;return!0}static async getAllCategories(){let{data:e,error:r}=await i.O.from("product_categories").select("*").eq("is_active",!0).order("display_order",{ascending:!0});if(r)throw r;return e||[]}static async bulkImportProducts(e){let r={success:0,failed:0,errors:[],warnings:[]},t=[];for(let i=0;i<e.length;i++){let a=e[i],s=i+2;if(!a.name||""===a.name.trim()){r.failed++,r.errors.push(`行${s}: 商品名が入力されていません`);continue}void 0!==a.price&&(isNaN(Number(a.price))||0>Number(a.price))&&(r.warnings.push(`行${s}: 価格が無効です。0に設定されます`),a.price=0),!a.id&&await this.getProductByName(a.name.trim())&&r.warnings.push(`行${s}: 商品「${a.name}」は既に存在します`),t.push({...a,lineNumber:s})}for(let e of t)try{if(e.id){if(!await this.getProductById(e.id)){r.failed++,r.errors.push(`行${e.lineNumber}: ID「${e.id}」の商品が見つかりません`);continue}await this.updateProduct(e.id,{name:e.name.trim(),barcode:e.barcode?.trim()||void 0,price:e.price||0,variation_name:e.variation_name?.trim()||void 0,tax_type:e.tax_type||"inclusive",category_id:e.category_id||void 0,description:e.description?.trim()||void 0})}else await this.createProduct({name:e.name.trim(),barcode:e.barcode?.trim()||void 0,price:e.price||0,variation_name:e.variation_name?.trim()||void 0,tax_type:e.tax_type||"inclusive",category_id:e.category_id||void 0,description:e.description?.trim()||void 0,is_available:!0,display_order:0});r.success++}catch(i){r.failed++;let t=i?.message||i?.toString()||"不明なエラー";r.errors.push(`行${e.lineNumber}: 商品「${e.name}」: ${t}`)}return r}static async getProductByName(e){let{data:r,error:t}=await i.O.from("products").select("id, name").eq("name",e).limit(1);if(t)throw t;return r?.[0]||null}static async getProductById(e){let{data:r,error:t}=await i.O.from("products").select("*").eq("id",e).limit(1);if(t)throw t;return r?.[0]||null}static parseCSV(e){try{let r=e.replace(/\r\n/g,"\n").replace(/\r/g,"\n").trim().split("\n").filter(e=>e.trim());if(r.length<2)throw Error("CSVファイルが空か、ヘッダー行しかありません。最低でもヘッダー行とデータ行が必要です。");let t=r[0].trim();if(!t)throw Error("ヘッダー行が空です");let i=this.parseCSVLine(t).map(e=>e.trim().replace(/^["']|["']$/g,""));if(0===i.length)throw Error("ヘッダー行を解析できませんでした");let a=[],s=[],n=i.map(e=>e.toLowerCase()),o=["name"].filter(e=>!n.includes(e.toLowerCase()));if(o.length>0)throw Error(`必須の列が見つかりません: ${o.join(", ")}

検出された列: ${i.join(", ")}

列名は大文字小文字を区別しません。`);for(let e=1;e<r.length;e++){let t=r[e].trim();if(t)try{let r=this.parseCSVLine(t);r.length,i.length;let n={},o=!1;i.forEach((t,i)=>{let a=r[i]?.trim().replace(/^["']|["']$/g,"")||"";switch(t.toLowerCase()){case"id":a&&(n.id=a);break;case"name":a?n.name=a:(s.push(`行${e+1}: 商品名が入力されていません`),o=!0);break;case"barcode":a&&(n.barcode=a);break;case"price":if(a){let r=parseFloat(a.replace(/[￥,]/g,""));isNaN(r)||r<0?s.push(`行${e+1}: 価格「${a}」が無効です（数値または0以上の値を入力してください）`):n.price=r}break;case"variation_name":a&&(n.variation_name=a);break;case"tax_type":if(a){let r=a.toLowerCase().trim();"内税"===r||"inclusive"===r?n.tax_type="inclusive":"外税"===r||"exclusive"===r?n.tax_type="exclusive":["inclusive","exclusive"].includes(r)?n.tax_type=r:s.push(`行${e+1}: 税区分「${a}」が無効です（内税/外税 または inclusive/exclusiveのみ）`)}break;case"category_id":a&&(n.category_id=a);break;case"description":a&&(n.description=a)}}),!o&&n.name&&a.push(n)}catch(r){s.push(`行${e+1}: 行の解析に失敗しました - ${r.message}`)}}if(s.length>0){let e=`CSVファイルに${s.length}個のエラーがあります:

${s.join("\n")}`;throw Error(e)}if(0===a.length)throw Error("有効な商品データが見つかりませんでした。\n\n以下を確認してください:\n• name列に値が入力されているか\n• データ行が存在するか\n• ファイル形式が正しいか");return a}catch(r){let e=r.message||"不明なエラーが発生しました";throw Error(`CSV解析エラー: ${e}`)}}static parseCSVLine(e){let r=[],t="",i=!1;for(let a=0;a<e.length;a++){let s=e[a];'"'===s||"'"===s?i&&e[a+1]===s?(t+=s,a++):i=!i:","!==s||i?t+=s:(r.push(t),t="")}return r.push(t),r}static generateCSVTemplate(e){return"id,name,barcode,price,variation_name,tax_type,category_id,description\n"+["","トマト苗","4901234567890","300","通常価格","inclusive",e[0]?.id||"","中玉トマトの苗"].join(",")}static async exportToCSV(){return["id,name,barcode,price,variation_name,tax_type,category_id,description",...(await this.getAllProducts()).map(e=>[e.id,`"${e.name}"`,e.barcode||"",e.price,e.variation_name||"",e.tax_type||"",e.category_id||"",`"${e.description||""}"`].join(","))].join("\n")}}},2516:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>i});let i=(0,t(8570).createProxy)(String.raw`/mnt/c/Claude/インストール/nursery-reservation-system/app/admin/products/add/page.tsx#default`)}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),i=r.X(0,[431,496,290,30,553],()=>t(9746));module.exports=i})();