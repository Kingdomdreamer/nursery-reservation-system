"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[836],{1836:function(e,s,a){a.d(s,{Z:function(){return p}});var i=a(7437),t=a(2265),l=a(2141);class c{static async getAllForms(){try{let{data:e,error:s}=await l.O.from("form_configurations").select("\n          *,\n          pricing_display_settings:pricing_display_settings(*)\n        ").order("created_at",{ascending:!1});if(s)throw s;return(e||[]).map(e=>{var s;return{id:e.id,name:e.name,description:e.description||"",is_active:e.is_active,field_count:Array.isArray(e.form_fields)?e.form_fields.length:0,response_count:0,valid_from:e.valid_from,valid_to:e.valid_to,created_at:e.created_at,updated_at:e.updated_at,pricing_display:(null===(s=e.pricing_display_settings)||void 0===s?void 0:s[0])||{show_item_prices:!0,show_subtotal:!0,show_total_amount:!0,show_item_quantity:!0,pricing_display_mode:"full"}}})}catch(e){return[{id:"1",name:"お問い合わせフォーム",description:"一般的なお問い合わせ用のフォームです",is_active:!0,field_count:5,response_count:12,valid_from:"2024-01-01T00:00:00Z",valid_to:"2024-12-31T23:59:59Z",created_at:"2024-01-01T00:00:00Z",updated_at:"2024-01-15T10:30:00Z",pricing_display:{show_item_prices:!0,show_subtotal:!0,show_total_amount:!0,show_item_quantity:!0,pricing_display_mode:"full"}}]}}static async createForm(e){try{let{data:s,error:a}=await l.O.from("form_configurations").insert({name:e.name.trim(),description:e.description.trim()||null,form_fields:e.fields,settings:{selectedProducts:e.selectedProducts,version:1},is_active:e.isActive,valid_from:e.validFrom||null,valid_to:e.validTo||null,version:1}).select().single();if(a)throw a;let{error:i}=await l.O.from("pricing_display_settings").insert({form_id:s.id,show_item_prices:!0,show_subtotal:!0,show_total_amount:!0,show_item_quantity:!0,pricing_display_mode:"full"});return{id:s.id,name:s.name,description:s.description||"",is_active:s.is_active,field_count:e.fields.length,response_count:0,valid_from:s.valid_from,valid_to:s.valid_to,created_at:s.created_at,updated_at:s.updated_at,pricing_display:{show_item_prices:!0,show_subtotal:!0,show_total_amount:!0,show_item_quantity:!0,pricing_display_mode:"full"}}}catch(e){throw Error("フォーム作成に失敗しました: ".concat(e instanceof Error?e.message:"不明なエラー"))}}static async toggleFormStatus(e,s){try{let{error:a}=await l.O.from("form_configurations").update({is_active:s,updated_at:new Date().toISOString()}).eq("id",e);if(a)throw a}catch(e){throw Error("フォームステータスの更新に失敗しました: ".concat(e instanceof Error?e.message:"不明なエラー"))}}static async deleteForm(e){try{let{error:s}=await l.O.from("pricing_display_settings").delete().eq("form_id",e),{error:a}=await l.O.from("form_configurations").delete().eq("id",e);if(a)throw a}catch(e){throw Error("フォーム削除に失敗しました: ".concat(e instanceof Error?e.message:"不明なエラー"))}}static async getFormById(e){try{var s;let{data:a,error:i}=await l.O.from("form_configurations").select("\n          *,\n          pricing_display_settings:pricing_display_settings(*)\n        ").eq("id",e).single();if(i){if("PGRST116"===i.code)return null;throw i}return{id:a.id,name:a.name,description:a.description||"",is_active:a.is_active,fields:a.form_fields||[],pricing_display:(null===(s=a.pricing_display_settings)||void 0===s?void 0:s[0])||{show_item_prices:!0,show_subtotal:!0,show_total_amount:!0,show_item_quantity:!0,pricing_display_mode:"full"},created_at:a.created_at,updated_at:a.updated_at}}catch(e){return null}}static getFormStatus(e){if(!e.is_active)return"inactive";let s=new Date;return e.valid_from&&s<new Date(e.valid_from)?"pending":e.valid_to&&s>new Date(e.valid_to)?"expired":"active"}static getValidityPeriodText(e,s){if(!e&&!s)return"無期限";let a=e=>new Date(e).toLocaleDateString("ja-JP");return e&&s?"".concat(a(e)," - ").concat(a(s)):e?"".concat(a(e)," -"):s?"- ".concat(a(s)):"無期限"}static async updatePricingDisplaySettings(e,s){try{let{error:a}=await l.O.from("pricing_display_settings").upsert({form_id:e,show_item_prices:s.show_item_prices,show_subtotal:s.show_subtotal,show_total_amount:s.show_total_amount,show_item_quantity:s.show_item_quantity,pricing_display_mode:s.pricing_display_mode,updated_at:new Date().toISOString()});if(a)throw a}catch(e){throw Error("価格表示設定の更新に失敗しました: ".concat(e instanceof Error?e.message:"不明なエラー"))}}static async getPricingDisplaySettings(e){try{let{data:s,error:a}=await l.O.from("pricing_display_settings").select("*").eq("form_id",e).single();if(a){if("PGRST116"===a.code)return{show_item_prices:!0,show_subtotal:!0,show_total_amount:!0,show_item_quantity:!0,pricing_display_mode:"full"};throw a}return{show_item_prices:s.show_item_prices,show_subtotal:s.show_subtotal,show_total_amount:s.show_total_amount,show_item_quantity:s.show_item_quantity,pricing_display_mode:s.pricing_display_mode}}catch(e){return{show_item_prices:!0,show_subtotal:!0,show_total_amount:!0,show_item_quantity:!0,pricing_display_mode:"full"}}}static getPricingDisplayModeLabel(e){return({full:"詳細表示",summary:"合計のみ",hidden:"非表示",custom:"カスタム"})[e]}static getPricingDisplayModeDescription(e){return({full:"商品価格、小計、合計をすべて表示",summary:"合計金額のみを表示",hidden:"価格情報を表示しない",custom:"カスタム設定で表示項目を選択"})[e]}static getPricingDisplayStatistics(e){let s={total:e.length,byMode:{full:0,summary:0,hidden:0,custom:0},showingPrices:0,hidingPrices:0};return e.forEach(e=>{e.pricing_display&&(s.byMode[e.pricing_display.pricing_display_mode]++,"hidden"===e.pricing_display.pricing_display_mode?s.hidingPrices++:s.showingPrices++)}),s}}function r(e){let{isOpen:s,form:a,onClose:l,onSave:r}=e,[d,n]=(0,t.useState)({show_item_prices:!0,show_subtotal:!0,show_total_amount:!0,show_item_quantity:!0,pricing_display_mode:"full"});return((0,t.useEffect)(()=>{(null==a?void 0:a.pricing_display)&&n(a.pricing_display)},[a]),s&&a)?(0,i.jsx)("div",{className:"modal fade show",style:{display:"block"},tabIndex:-1,children:(0,i.jsx)("div",{className:"modal-dialog modal-lg",children:(0,i.jsxs)("div",{className:"modal-content",children:[(0,i.jsxs)("div",{className:"modal-header",children:[(0,i.jsxs)("h5",{className:"modal-title",children:["価格表示設定 - ",a.name]}),(0,i.jsx)("button",{type:"button",className:"btn-close",onClick:l})]}),(0,i.jsxs)("div",{className:"modal-body",children:[(0,i.jsxs)("div",{className:"mb-4",children:[(0,i.jsx)("label",{className:"form-label fw-medium",children:"表示モード"}),(0,i.jsxs)("select",{value:d.pricing_display_mode,onChange:e=>n(s=>({...s,pricing_display_mode:e.target.value})),className:"form-select",children:[(0,i.jsx)("option",{value:"full",children:"詳細表示"}),(0,i.jsx)("option",{value:"summary",children:"合計のみ"}),(0,i.jsx)("option",{value:"hidden",children:"非表示"}),(0,i.jsx)("option",{value:"custom",children:"カスタム"})]}),(0,i.jsx)("div",{className:"form-text",children:c.getPricingDisplayModeDescription(d.pricing_display_mode)})]}),("custom"===d.pricing_display_mode||"full"===d.pricing_display_mode)&&(0,i.jsxs)("div",{className:"row g-3",children:[(0,i.jsx)("div",{className:"col-md-6",children:(0,i.jsxs)("div",{className:"form-check",children:[(0,i.jsx)("input",{className:"form-check-input",type:"checkbox",id:"show_item_prices",checked:d.show_item_prices,onChange:e=>n(s=>({...s,show_item_prices:e.target.checked}))}),(0,i.jsx)("label",{className:"form-check-label",htmlFor:"show_item_prices",children:"商品価格を表示"})]})}),(0,i.jsx)("div",{className:"col-md-6",children:(0,i.jsxs)("div",{className:"form-check",children:[(0,i.jsx)("input",{className:"form-check-input",type:"checkbox",id:"show_item_quantity",checked:d.show_item_quantity,onChange:e=>n(s=>({...s,show_item_quantity:e.target.checked}))}),(0,i.jsx)("label",{className:"form-check-label",htmlFor:"show_item_quantity",children:"数量を表示"})]})}),(0,i.jsx)("div",{className:"col-md-6",children:(0,i.jsxs)("div",{className:"form-check",children:[(0,i.jsx)("input",{className:"form-check-input",type:"checkbox",id:"show_subtotal",checked:d.show_subtotal,onChange:e=>n(s=>({...s,show_subtotal:e.target.checked}))}),(0,i.jsx)("label",{className:"form-check-label",htmlFor:"show_subtotal",children:"小計を表示"})]})}),(0,i.jsx)("div",{className:"col-md-6",children:(0,i.jsxs)("div",{className:"form-check",children:[(0,i.jsx)("input",{className:"form-check-input",type:"checkbox",id:"show_total_amount",checked:d.show_total_amount,onChange:e=>n(s=>({...s,show_total_amount:e.target.checked}))}),(0,i.jsx)("label",{className:"form-check-label",htmlFor:"show_total_amount",children:"合計金額を表示"})]})})]})]}),(0,i.jsxs)("div",{className:"modal-footer",children:[(0,i.jsx)("button",{type:"button",className:"btn btn-secondary",onClick:l,children:"キャンセル"}),(0,i.jsx)("button",{type:"button",className:"btn btn-primary",onClick:()=>{a&&(r(a.id,d),l())},children:"設定を保存"})]})]})})}):null}function d(e){let{onCreateForm:s,onEditForm:a}=e,[l,d]=(0,t.useState)([]),[n,o]=(0,t.useState)(!0),[m,h]=(0,t.useState)("all"),[u,p]=(0,t.useState)(null);(0,t.useEffect)(()=>{x()},[]);let x=async()=>{try{let e=await c.getAllForms();d(e)}catch(e){d([])}finally{o(!1)}},_=async(e,s)=>{try{await c.toggleFormStatus(e,!s),d(l.map(a=>a.id===e?{...a,is_active:!s}:a))}catch(e){alert("フォームステータスの更新に失敗しました。")}},b=async e=>{if(confirm("このフォームを削除しますか？この操作は元に戻せません。"))try{await c.deleteForm(e),d(l.filter(s=>s.id!==e)),alert("フォームが削除されました。")}catch(e){alert("フォームの削除に失敗しました。")}},v=async(e,s)=>{try{await c.updatePricingDisplaySettings(e,s),d(l.map(a=>a.id===e?{...a,pricing_display:s}:a)),alert("価格表示設定が更新されました。")}catch(e){alert("価格表示設定の更新に失敗しました。")}},g=l.filter(e=>"all"===m||("active"===m?e.is_active:"inactive"!==m||!e.is_active)),j=e=>{let s={inactive:{bg:"bg-secondary-subtle",text:"text-secondary",label:"無効"},pending:{bg:"bg-info-subtle",text:"text-info",label:"開始前"},expired:{bg:"bg-danger-subtle",text:"text-danger",label:"期限切れ"},active:{bg:"bg-success-subtle",text:"text-success",label:"公開中"}}[c.getFormStatus(e)];return(0,i.jsx)("span",{className:"badge ".concat(s.bg," ").concat(s.text),children:s.label})},N=e=>c.getValidityPeriodText(e.valid_from,e.valid_to);return n?(0,i.jsx)("div",{className:"d-flex justify-content-center align-items-center",style:{height:"256px"},children:(0,i.jsx)("div",{className:"loading-spinner"})}):(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"row mb-4",children:(0,i.jsx)("div",{className:"col-12",children:(0,i.jsxs)("div",{className:"d-flex justify-content-between align-items-center",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h2",{className:"h2 fw-bold text-dark",children:"フォーム一覧"}),(0,i.jsx)("p",{className:"text-muted",children:"作成済みのフォームを管理できます"})]}),(0,i.jsxs)("div",{className:"d-flex gap-3",children:[(0,i.jsxs)("select",{value:m,onChange:e=>h(e.target.value),className:"form-select form-select-sm px-5",children:[(0,i.jsx)("option",{value:"all",children:"すべて"}),(0,i.jsx)("option",{value:"active",children:"有効"}),(0,i.jsx)("option",{value:"inactive",children:"無効"})]}),(0,i.jsxs)("button",{onClick:s,className:"btn btn-primary btn-sm px-2",style:{padding:"0.375rem 0.75rem",minWidth:"150px"},children:[(0,i.jsx)("i",{className:"bi bi-plus-lg me-2"}),"新しいフォーム"]})]})]})})}),(0,i.jsxs)("div",{className:"row g-4 mb-4",children:[(0,i.jsx)("div",{className:"col-lg-3 col-md-6",children:(0,i.jsx)("div",{className:"dashboard-widget",children:(0,i.jsx)("div",{className:"d-flex align-items-center justify-content-between",children:(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"dashboard-widget-icon bg-success-subtle text-success",children:(0,i.jsx)("i",{className:"bi bi-check-circle"})}),(0,i.jsx)("div",{className:"dashboard-widget-value",children:l.filter(e=>e.is_active).length}),(0,i.jsx)("div",{className:"dashboard-widget-label",children:"有効なフォーム"})]})})})}),(0,i.jsx)("div",{className:"col-lg-3 col-md-6",children:(0,i.jsx)("div",{className:"dashboard-widget",children:(0,i.jsx)("div",{className:"d-flex align-items-center justify-content-between",children:(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"dashboard-widget-icon bg-primary-subtle text-primary",children:(0,i.jsx)("i",{className:"bi bi-file-earmark-text"})}),(0,i.jsx)("div",{className:"dashboard-widget-value",children:l.length}),(0,i.jsx)("div",{className:"dashboard-widget-label",children:"総フォーム数"})]})})})}),(0,i.jsx)("div",{className:"col-lg-3 col-md-6",children:(0,i.jsx)("div",{className:"dashboard-widget",children:(0,i.jsx)("div",{className:"d-flex align-items-center justify-content-between",children:(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"dashboard-widget-icon bg-info-subtle text-info",children:(0,i.jsx)("i",{className:"bi bi-bar-chart"})}),(0,i.jsx)("div",{className:"dashboard-widget-value",children:l.reduce((e,s)=>e+s.response_count,0)}),(0,i.jsx)("div",{className:"dashboard-widget-label",children:"総回答数"})]})})})}),(0,i.jsx)("div",{className:"col-lg-3 col-md-6",children:(0,i.jsx)("div",{className:"dashboard-widget",children:(0,i.jsx)("div",{className:"d-flex align-items-center justify-content-between",children:(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"dashboard-widget-icon bg-warning-subtle text-warning",children:(0,i.jsx)("i",{className:"bi bi-currency-yen"})}),(0,i.jsx)("div",{className:"dashboard-widget-value",children:c.getPricingDisplayStatistics(l).showingPrices}),(0,i.jsx)("div",{className:"dashboard-widget-label",children:"価格表示中"})]})})})})]}),(0,i.jsx)("div",{className:"row mb-4",children:(0,i.jsx)("div",{className:"col-12",children:(0,i.jsxs)("div",{className:"card",children:[(0,i.jsx)("div",{className:"card-header",children:(0,i.jsx)("h6",{className:"mb-0",children:"価格表示設定の統計"})}),(0,i.jsx)("div",{className:"card-body",children:(0,i.jsx)("div",{className:"row g-3",children:Object.entries(c.getPricingDisplayStatistics(l).byMode).map(e=>{let[s,a]=e;return(0,i.jsx)("div",{className:"col-lg-3 col-md-6",children:(0,i.jsxs)("div",{className:"text-center p-3 bg-light rounded",children:[(0,i.jsx)("div",{className:"h5 mb-1",children:a}),(0,i.jsx)("div",{className:"small text-muted",children:c.getPricingDisplayModeLabel(s)})]})},s)})})})]})})}),(0,i.jsx)("div",{className:"row",children:(0,i.jsx)("div",{className:"col-12",children:(0,i.jsxs)("div",{className:"card",children:[(0,i.jsx)("div",{className:"card-header",children:(0,i.jsxs)("h5",{className:"mb-0",children:["フォーム一覧 (",g.length,"件)"]})}),(0,i.jsx)("div",{className:"card-body p-0",children:g.map(e=>(0,i.jsx)("div",{className:"border-bottom p-4",children:(0,i.jsxs)("div",{className:"d-flex justify-content-between align-items-start",children:[(0,i.jsxs)("div",{className:"flex-grow-1",children:[(0,i.jsxs)("div",{className:"d-flex align-items-center gap-3 mb-2",children:[(0,i.jsx)("h5",{className:"mb-0 fw-medium",children:e.name}),j(e)]}),(0,i.jsx)("p",{className:"text-muted mb-3",children:e.description}),(0,i.jsxs)("div",{className:"row g-3 small",children:[(0,i.jsxs)("div",{className:"col-lg-3 col-md-6",children:[(0,i.jsx)("span",{className:"text-muted",children:"フィールド数:"}),(0,i.jsxs)("span",{className:"fw-medium ms-1",children:[e.field_count,"個"]})]}),(0,i.jsxs)("div",{className:"col-lg-3 col-md-6",children:[(0,i.jsx)("span",{className:"text-muted",children:"回答数:"}),(0,i.jsxs)("span",{className:"fw-medium ms-1 text-primary",children:[e.response_count,"件"]})]}),(0,i.jsxs)("div",{className:"col-lg-3 col-md-6",children:[(0,i.jsx)("span",{className:"text-muted",children:"有効期間:"}),(0,i.jsx)("span",{className:"fw-medium ms-1",children:N(e)})]}),(0,i.jsxs)("div",{className:"col-lg-3 col-md-6",children:[(0,i.jsx)("span",{className:"text-muted",children:"更新日:"}),(0,i.jsx)("span",{className:"fw-medium ms-1",children:new Date(e.updated_at).toLocaleDateString("ja-JP")})]}),(0,i.jsxs)("div",{className:"col-lg-3 col-md-6",children:[(0,i.jsx)("span",{className:"text-muted",children:"価格表示:"}),(0,i.jsx)("span",{className:"fw-medium ms-1",children:e.pricing_display?c.getPricingDisplayModeLabel(e.pricing_display.pricing_display_mode):"設定なし"})]})]})]}),(0,i.jsxs)("div",{className:"d-flex gap-1 ms-3",children:[(0,i.jsxs)("button",{onClick:()=>a(e.id),className:"btn btn-outline-primary btn-sm",title:"フォームを編集",children:[(0,i.jsx)("i",{className:"bi bi-pencil me-1"}),"編集"]}),(0,i.jsxs)("button",{onClick:()=>p(e),className:"btn btn-outline-info btn-sm",title:"価格表示設定",children:[(0,i.jsx)("i",{className:"bi bi-currency-yen me-1"}),"価格設定"]}),(0,i.jsxs)("button",{onClick:()=>window.open("/form/".concat(e.id),"_blank"),className:"btn btn-outline-secondary btn-sm",title:"フォームをプレビュー",children:[(0,i.jsx)("i",{className:"bi bi-eye me-1"}),"プレビュー"]}),(0,i.jsx)("button",{onClick:()=>_(e.id,e.is_active),className:"btn btn-sm ".concat(e.is_active?"btn-outline-warning":"btn-outline-success"),title:e.is_active?"フォームを無効にする":"フォームを有効にする",children:(0,i.jsx)("i",{className:"bi ".concat(e.is_active?"bi-pause":"bi-play")})}),(0,i.jsx)("button",{onClick:()=>b(e.id),className:"btn btn-outline-danger btn-sm",title:"フォームを削除",children:(0,i.jsx)("i",{className:"bi bi-trash"})})]})]})},e.id))})]})})}),0===g.length&&(0,i.jsx)("div",{className:"row",children:(0,i.jsx)("div",{className:"col-12",children:(0,i.jsx)("div",{className:"card",children:(0,i.jsxs)("div",{className:"card-body text-center py-5",children:[(0,i.jsx)("i",{className:"bi bi-file-earmark-text text-muted",style:{fontSize:"4rem"}}),(0,i.jsx)("h5",{className:"fw-medium text-dark mt-3 mb-2",children:"フォームが見つかりません"}),(0,i.jsxs)("p",{className:"text-muted mb-4",children:["all"!==m?"".concat("active"===m?"有効な":"無効な","フォームはありません。"):"まだフォームが作成されていません。",(0,i.jsx)("br",{}),"新しいフォームを作成してください。"]})]})})})}),(0,i.jsx)(r,{isOpen:!!u,form:u,onClose:()=>p(null),onSave:v})]})}var n=a(9976);let o=[{id:"customer_name",type:"text",label:"お客様名",required:!0,placeholder:"山田太郎"},{id:"customer_furigana",type:"text",label:"フリガナ",required:!1,placeholder:"ヤマダタロウ"},{id:"customer_phone",type:"tel",label:"電話番号",required:!0,placeholder:"090-1234-5678"},{id:"customer_email",type:"email",label:"メールアドレス",required:!1,placeholder:"example@example.com"},{id:"customer_postal_code",type:"text",label:"郵便番号",required:!1,placeholder:"123-4567"},{id:"customer_prefecture",type:"text",label:"都道府県",required:!1,placeholder:"東京都"},{id:"customer_city",type:"text",label:"市区町村",required:!1,placeholder:"渋谷区"},{id:"customer_address",type:"textarea",label:"住所（番地・建物名）",required:!1,placeholder:"1-1-1 サンプルマンション101"},{id:"customer_birth_date",type:"date",label:"生年月日",required:!1},{id:"customer_gender",type:"radio",label:"性別",required:!1,options:["男性","女性","その他"]},{id:"reservation_date",type:"date",label:"受取希望日",required:!0},{id:"pickup_time_slot",type:"select",label:"受取時間帯",required:!0,options:["09:00-10:00","10:00-11:00","11:00-12:00","13:00-14:00","14:00-15:00","15:00-16:00","16:00-17:00"]},{id:"cultivation_purpose",type:"select",label:"栽培目的",required:!1,options:["家庭菜園","観賞用","贈答用","商業栽培","その他"]},{id:"cultivation_location",type:"select",label:"栽培場所",required:!1,options:["露地","ハウス","ベランダ","プランター","その他"]},{id:"experience_level",type:"select",label:"栽培経験",required:!1,options:["初心者","1-2年","3-5年","5年以上","プロ・専門家"]},{id:"preferred_contact_method",type:"radio",label:"希望連絡方法",required:!1,options:["電話","メール","LINE","いずれでも"]},{id:"special_requests",type:"textarea",label:"ご要望・備考",required:!1,placeholder:"ご要望があればお書きください"},{id:"referral_source",type:"select",label:"お知りになったきっかけ",required:!1,options:["知人の紹介","インターネット検索","SNS","チラシ・広告","通りがかり","その他"]}],m=[{value:"text",label:"テキスト"},{value:"email",label:"メールアドレス"},{value:"tel",label:"電話番号"},{value:"number",label:"数値"},{value:"textarea",label:"複数行テキスト"},{value:"select",label:"選択（プルダウン）"},{value:"radio",label:"選択（ラジオボタン）"},{value:"checkbox",label:"複数選択"},{value:"date",label:"日付"}],h=[{id:"custom",name:"カスタムフォーム",description:"1からフォームを作成",fields:[]},{id:"basic_reservation",name:"基本予約フォーム",description:"必要最小限の項目で構成された予約フォーム",fields:["customer_name","customer_phone","customer_email","reservation_date","pickup_time_slot","special_requests"]},{id:"detailed_reservation",name:"詳細予約フォーム",description:"詳細な顧客情報と栽培情報を含む予約フォーム",fields:["customer_name","customer_furigana","customer_phone","customer_email","customer_postal_code","customer_prefecture","customer_city","customer_address","reservation_date","pickup_time_slot","cultivation_purpose","cultivation_location","experience_level","preferred_contact_method","special_requests","referral_source"]},{id:"consultation_form",name:"栽培相談フォーム",description:"栽培相談に特化したフォーム",fields:["customer_name","customer_phone","customer_email","cultivation_purpose","cultivation_location","experience_level","special_requests"]},{id:"feedback_form",name:"お客様アンケート",description:"購入後のフィードバック収集フォーム",fields:["customer_name","customer_email","cultivation_purpose","experience_level","special_requests","referral_source"]}];function u(e){var s;let{isOpen:a,onClose:l,onSuccess:r}=e,[d,u]=(0,t.useState)({name:"",description:"",valid_from:"",valid_to:""}),[p,x]=(0,t.useState)([]),[_,b]=(0,t.useState)([]),[v,g]=(0,t.useState)([]),[j,N]=(0,t.useState)("all"),[y,f]=(0,t.useState)(""),[w,k]=(0,t.useState)("basic"),[C,q]=(0,t.useState)([]),[S,P]=(0,t.useState)(null),[F,D]=(0,t.useState)(!1),[E,O]=(0,t.useState)("custom"),[L,T]=(0,t.useState)({show_item_prices:!0,show_subtotal:!0,show_total_amount:!0,show_item_quantity:!0,pricing_display_mode:"full"});(0,t.useEffect)(()=>{a&&(A(),I())},[a]);let A=async()=>{try{let e=await n.M.getAllProducts();b(e)}catch(e){}},I=async()=>{try{let e=await n.M.getAllCategories();g(e)}catch(e){}},M=e=>{p.find(s=>s.id===e.id)||x([...p,e])},V=e=>{x(p.filter(s=>s.id!==e))},B=_.filter(e=>!p.find(s=>s.id===e.id)&&("all"===j||e.category_id===j)&&(!y||!!e.name.toLowerCase().includes(y.toLowerCase()))),Z=e=>{C.find(s=>s.id===e.id)||q([...C,{...e}])},R=e=>{P({...e}),D(!0)},H=e=>{confirm("このフィールドを削除しますか？")&&q(C.filter(s=>s.id!==e))},W=e=>{O(e);let s=h.find(s=>s.id===e);s&&s.fields.length>0?q(s.fields.map(e=>{let s=o.find(s=>s.id===e);return s?{...s}:null}).filter(e=>null!==e)):q([])},Y=async()=>{try{let e={name:d.name.trim(),description:d.description.trim(),fields:C,isActive:!1,validFrom:d.valid_from||void 0,validTo:d.valid_to||void 0,selectedProducts:p.map(e=>e.id)},s=await c.createForm(e);G(),r(),window.location.href="/admin?page=form-builder&id=".concat(s.id)}catch(e){alert("フォームの作成に失敗しました。")}},G=()=>{u({name:"",description:"",valid_from:"",valid_to:""}),x([]),N("all"),f(""),q([]),k("basic"),P(null),D(!1)},J=()=>{G(),l()};return a?(0,i.jsxs)("div",{className:"modal show d-block",tabIndex:-1,style:{backgroundColor:"rgba(0,0,0,0.5)"},children:[(0,i.jsx)("div",{className:"modal-dialog modal-xl",style:{maxWidth:"90vw"},children:(0,i.jsxs)("div",{className:"modal-content",children:[(0,i.jsxs)("div",{className:"modal-header",children:[(0,i.jsx)("h5",{className:"modal-title",children:"新しいフォームを作成"}),(0,i.jsx)("button",{type:"button",className:"btn-close",onClick:J,"aria-label":"Close"})]}),(0,i.jsxs)("div",{className:"modal-body",style:{maxHeight:"70vh",overflowY:"auto"},children:[(0,i.jsxs)("ul",{className:"nav nav-tabs mb-4",id:"formTabs",role:"tablist",children:[(0,i.jsx)("li",{className:"nav-item",role:"presentation",children:(0,i.jsxs)("button",{className:"nav-link ".concat("basic"===w?"active":""),onClick:()=>k("basic"),type:"button",children:[(0,i.jsx)("i",{className:"bi bi-info-circle me-1"}),"基本情報"]})}),(0,i.jsx)("li",{className:"nav-item",role:"presentation",children:(0,i.jsxs)("button",{className:"nav-link ".concat("fields"===w?"active":""),onClick:()=>k("fields"),type:"button",children:[(0,i.jsx)("i",{className:"bi bi-ui-checks me-1"}),"フォームフィールド",C.length>0&&(0,i.jsx)("span",{className:"badge bg-primary ms-1",children:C.length})]})}),(0,i.jsx)("li",{className:"nav-item",role:"presentation",children:(0,i.jsxs)("button",{className:"nav-link ".concat("products"===w?"active":""),onClick:()=>k("products"),type:"button",children:[(0,i.jsx)("i",{className:"bi bi-box-seam me-1"}),"商品選択",p.length>0&&(0,i.jsx)("span",{className:"badge bg-primary ms-1",children:p.length})]})}),(0,i.jsx)("li",{className:"nav-item",role:"presentation",children:(0,i.jsxs)("button",{className:"nav-link ".concat("pricing"===w?"active":""),onClick:()=>k("pricing"),type:"button",children:[(0,i.jsx)("i",{className:"bi bi-currency-dollar me-1"}),"価格表示設定"]})})]}),(0,i.jsxs)("div",{className:"tab-content",children:["basic"===w&&(0,i.jsx)("div",{className:"tab-pane fade show active",children:(0,i.jsx)("div",{className:"row justify-content-center",children:(0,i.jsxs)("div",{className:"col-md-8",children:[(0,i.jsxs)("div",{className:"mb-4",children:[(0,i.jsx)("label",{className:"form-label",children:"フォームテンプレート"}),(0,i.jsx)("div",{className:"row g-3",children:h.map(e=>(0,i.jsx)("div",{className:"col-md-6",children:(0,i.jsx)("div",{className:"card h-100 cursor-pointer ".concat(E===e.id?"border-primary":""),onClick:()=>W(e.id),style:{cursor:"pointer"},children:(0,i.jsxs)("div",{className:"card-body",children:[(0,i.jsxs)("div",{className:"d-flex align-items-center mb-2",children:[(0,i.jsx)("input",{type:"radio",name:"template",value:e.id,checked:E===e.id,onChange:()=>W(e.id),className:"me-2"}),(0,i.jsx)("h6",{className:"card-title mb-0",children:e.name})]}),(0,i.jsx)("p",{className:"card-text text-muted small",children:e.description}),e.fields.length>0&&(0,i.jsxs)("small",{className:"text-muted",children:[e.fields.length,"個のフィールド"]})]})})},e.id))})]}),(0,i.jsxs)("div",{className:"mb-4",children:[(0,i.jsxs)("label",{htmlFor:"formName",className:"form-label",children:["フォーム名 ",(0,i.jsx)("span",{className:"text-danger",children:"*"})]}),(0,i.jsx)("input",{type:"text",className:"form-control",id:"formName",value:d.name,onChange:e=>u({...d,name:e.target.value}),placeholder:"フォーム名を入力してください",required:!0})]}),(0,i.jsxs)("div",{className:"mb-4",children:[(0,i.jsx)("label",{htmlFor:"formDescription",className:"form-label",children:"説明"}),(0,i.jsx)("textarea",{className:"form-control",id:"formDescription",rows:4,value:d.description,onChange:e=>u({...d,description:e.target.value}),placeholder:"フォームの説明を入力してください"})]}),(0,i.jsxs)("div",{className:"row",children:[(0,i.jsx)("div",{className:"col-md-6",children:(0,i.jsxs)("div",{className:"mb-4",children:[(0,i.jsx)("label",{htmlFor:"validFrom",className:"form-label",children:"有効期間 開始日"}),(0,i.jsx)("input",{type:"datetime-local",className:"form-control",id:"validFrom",value:d.valid_from,onChange:e=>u({...d,valid_from:e.target.value})})]})}),(0,i.jsx)("div",{className:"col-md-6",children:(0,i.jsxs)("div",{className:"mb-4",children:[(0,i.jsx)("label",{htmlFor:"validTo",className:"form-label",children:"有効期間 終了日"}),(0,i.jsx)("input",{type:"datetime-local",className:"form-control",id:"validTo",value:d.valid_to,onChange:e=>u({...d,valid_to:e.target.value})})]})})]})]})})}),"fields"===w&&(0,i.jsx)("div",{className:"tab-pane fade show active",children:(0,i.jsxs)("div",{className:"row",children:[(0,i.jsxs)("div",{className:"col-lg-6",children:[(0,i.jsxs)("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[(0,i.jsx)("h6",{className:"fw-bold mb-0",children:"設定済みフィールド"}),(0,i.jsxs)("button",{type:"button",className:"btn btn-outline-primary btn-sm",onClick:()=>{P({id:"custom_".concat(Date.now()),type:"text",label:"新しいフィールド",required:!1,placeholder:""}),D(!0)},children:[(0,i.jsx)("i",{className:"bi bi-plus-lg me-1"}),"カスタムフィールド"]})]}),C.length>0?(0,i.jsx)("div",{className:"list-group",children:C.map(e=>{var s;return(0,i.jsx)("div",{className:"list-group-item",children:(0,i.jsxs)("div",{className:"d-flex justify-content-between align-items-start",children:[(0,i.jsxs)("div",{className:"flex-grow-1",children:[(0,i.jsxs)("div",{className:"d-flex align-items-center mb-1",children:[(0,i.jsx)("span",{className:"fw-medium",children:e.label}),e.required&&(0,i.jsx)("span",{className:"text-danger ms-1",children:"*"}),(0,i.jsx)("span",{className:"badge bg-secondary ms-2",children:null===(s=m.find(s=>s.value===e.type))||void 0===s?void 0:s.label})]}),(0,i.jsxs)("small",{className:"text-muted",children:[e.placeholder&&"プレースホルダー: ".concat(e.placeholder),e.options&&" | 選択肢: ".concat(e.options.join(", "))]})]}),(0,i.jsxs)("div",{className:"btn-group",children:[(0,i.jsx)("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>R(e),children:(0,i.jsx)("i",{className:"bi bi-pencil"})}),(0,i.jsx)("button",{type:"button",className:"btn btn-outline-danger btn-sm",onClick:()=>H(e.id),children:(0,i.jsx)("i",{className:"bi bi-trash"})})]})]})},e.id)})}):(0,i.jsxs)("div",{className:"text-center text-muted p-4 border rounded",children:[(0,i.jsx)("i",{className:"bi bi-ui-checks display-4"}),(0,i.jsx)("p",{className:"mb-0 mt-2",children:"フィールドが設定されていません"}),(0,i.jsx)("small",{children:"事前定義されたフィールドから選択するか、カスタムフィールドを作成してください"})]})]}),(0,i.jsxs)("div",{className:"col-lg-6",children:[(0,i.jsx)("h6",{className:"fw-bold mb-3",children:"事前定義フィールド"}),(0,i.jsx)("div",{className:"row g-2",children:o.map(e=>{var s;return(0,i.jsx)("div",{className:"col-12",children:(0,i.jsx)("div",{className:"card card-body p-2",children:(0,i.jsxs)("div",{className:"d-flex justify-content-between align-items-center",children:[(0,i.jsxs)("div",{className:"flex-grow-1",children:[(0,i.jsxs)("div",{className:"d-flex align-items-center",children:[(0,i.jsx)("span",{className:"fw-medium small",children:e.label}),e.required&&(0,i.jsx)("span",{className:"text-danger ms-1",children:"*"})]}),(0,i.jsx)("small",{className:"text-muted",children:null===(s=m.find(s=>s.value===e.type))||void 0===s?void 0:s.label})]}),(0,i.jsx)("button",{type:"button",className:"btn btn-outline-primary btn-sm",onClick:()=>Z(e),disabled:C.some(s=>s.id===e.id),children:C.some(s=>s.id===e.id)?(0,i.jsx)("i",{className:"bi bi-check"}):(0,i.jsx)("i",{className:"bi bi-plus"})})]})})},e.id)})})]})]})}),"products"===w&&(0,i.jsx)("div",{className:"tab-pane fade show active",children:(0,i.jsxs)("div",{className:"row",children:[(0,i.jsxs)("div",{className:"col-lg-6",children:[(0,i.jsxs)("h6",{className:"fw-bold mb-3",children:["選択済み商品 (",p.length,"件)"]}),p.length>0?(0,i.jsx)("div",{className:"border rounded p-3",style:{maxHeight:"400px",overflowY:"auto"},children:p.map(e=>{var s;return(0,i.jsxs)("div",{className:"d-flex justify-content-between align-items-center p-2 border-bottom",children:[(0,i.jsxs)("div",{className:"flex-grow-1",children:[(0,i.jsx)("div",{className:"fw-medium",children:e.name}),(0,i.jsxs)("small",{className:"text-muted",children:["\xa5",null===(s=e.price)||void 0===s?void 0:s.toLocaleString()]})]}),(0,i.jsx)("button",{type:"button",className:"btn btn-outline-danger btn-sm",onClick:()=>V(e.id),children:(0,i.jsx)("i",{className:"bi bi-x"})})]},e.id)})}):(0,i.jsxs)("div",{className:"text-center text-muted p-4 border rounded",children:[(0,i.jsx)("i",{className:"bi bi-box-seam display-4"}),(0,i.jsx)("p",{className:"mb-0 mt-2",children:"商品が選択されていません"}),(0,i.jsx)("small",{children:"右側の商品一覧から選択してください"})]})]}),(0,i.jsxs)("div",{className:"col-lg-6",children:[(0,i.jsx)("h6",{className:"fw-bold mb-3",children:"商品一覧"}),(0,i.jsxs)("div",{className:"row mb-3",children:[(0,i.jsx)("div",{className:"col-md-6",children:(0,i.jsxs)("select",{className:"form-select form-select-sm",value:j,onChange:e=>N(e.target.value),children:[(0,i.jsx)("option",{value:"all",children:"すべてのカテゴリ"}),v.map(e=>(0,i.jsx)("option",{value:e.id,children:e.name},e.id))]})}),(0,i.jsx)("div",{className:"col-md-6",children:(0,i.jsx)("input",{type:"text",className:"form-control form-control-sm",placeholder:"商品名で検索...",value:y,onChange:e=>f(e.target.value)})})]}),(0,i.jsx)("div",{style:{maxHeight:"400px",overflowY:"auto"},children:B.length>0?(0,i.jsx)("div",{className:"row g-2",children:B.map(e=>{var s;return(0,i.jsx)("div",{className:"col-12",children:(0,i.jsx)("div",{className:"card card-body p-2 cursor-pointer hover-bg-light",onClick:()=>M(e),style:{cursor:"pointer"},children:(0,i.jsxs)("div",{className:"d-flex justify-content-between align-items-center",children:[(0,i.jsxs)("div",{className:"flex-grow-1",children:[(0,i.jsx)("div",{className:"fw-medium small",children:e.name}),(0,i.jsxs)("small",{className:"text-muted",children:["\xa5",null===(s=e.price)||void 0===s?void 0:s.toLocaleString()]})]}),(0,i.jsx)("button",{type:"button",className:"btn btn-outline-primary btn-sm",onClick:s=>{s.stopPropagation(),M(e)},children:(0,i.jsx)("i",{className:"bi bi-plus"})})]})})},e.id)})}):(0,i.jsxs)("div",{className:"text-center text-muted p-3",children:[(0,i.jsx)("i",{className:"bi bi-search"}),(0,i.jsx)("p",{className:"mb-0 small",children:"条件に一致する商品がありません"})]})})]})]})}),"pricing"===w&&(0,i.jsx)("div",{className:"tab-pane fade show active",children:(0,i.jsx)("div",{className:"row justify-content-center",children:(0,i.jsx)("div",{className:"col-md-8",children:(0,i.jsxs)("div",{className:"card",children:[(0,i.jsx)("div",{className:"card-header",children:(0,i.jsxs)("h5",{className:"card-title mb-0",children:[(0,i.jsx)("i",{className:"bi bi-currency-dollar me-2"}),"価格表示設定"]})}),(0,i.jsxs)("div",{className:"card-body",children:[(0,i.jsxs)("div",{className:"mb-4",children:[(0,i.jsx)("label",{className:"form-label",children:"価格表示モード"}),(0,i.jsxs)("div",{className:"row g-3",children:[(0,i.jsx)("div",{className:"col-md-6",children:(0,i.jsx)("div",{className:"card h-100 cursor-pointer ".concat("full"===L.pricing_display_mode?"border-primary bg-light":""),onClick:()=>T({...L,pricing_display_mode:"full"}),style:{cursor:"pointer"},children:(0,i.jsxs)("div",{className:"card-body",children:[(0,i.jsxs)("div",{className:"d-flex align-items-center mb-2",children:[(0,i.jsx)("input",{type:"radio",name:"pricing_mode",value:"full",checked:"full"===L.pricing_display_mode,onChange:()=>T({...L,pricing_display_mode:"full"}),className:"me-2"}),(0,i.jsx)("h6",{className:"card-title mb-0",children:"完全表示"})]}),(0,i.jsx)("p",{className:"card-text text-muted small",children:"すべての価格情報を表示"})]})})}),(0,i.jsx)("div",{className:"col-md-6",children:(0,i.jsx)("div",{className:"card h-100 cursor-pointer ".concat("summary"===L.pricing_display_mode?"border-primary bg-light":""),onClick:()=>T({...L,pricing_display_mode:"summary"}),style:{cursor:"pointer"},children:(0,i.jsxs)("div",{className:"card-body",children:[(0,i.jsxs)("div",{className:"d-flex align-items-center mb-2",children:[(0,i.jsx)("input",{type:"radio",name:"pricing_mode",value:"summary",checked:"summary"===L.pricing_display_mode,onChange:()=>T({...L,pricing_display_mode:"summary"}),className:"me-2"}),(0,i.jsx)("h6",{className:"card-title mb-0",children:"要約表示"})]}),(0,i.jsx)("p",{className:"card-text text-muted small",children:"合計金額のみ表示"})]})})}),(0,i.jsx)("div",{className:"col-md-6",children:(0,i.jsx)("div",{className:"card h-100 cursor-pointer ".concat("hidden"===L.pricing_display_mode?"border-primary bg-light":""),onClick:()=>T({...L,pricing_display_mode:"hidden"}),style:{cursor:"pointer"},children:(0,i.jsxs)("div",{className:"card-body",children:[(0,i.jsxs)("div",{className:"d-flex align-items-center mb-2",children:[(0,i.jsx)("input",{type:"radio",name:"pricing_mode",value:"hidden",checked:"hidden"===L.pricing_display_mode,onChange:()=>T({...L,pricing_display_mode:"hidden"}),className:"me-2"}),(0,i.jsx)("h6",{className:"card-title mb-0",children:"価格非表示"})]}),(0,i.jsx)("p",{className:"card-text text-muted small",children:"価格情報を一切表示しない"})]})})}),(0,i.jsx)("div",{className:"col-md-6",children:(0,i.jsx)("div",{className:"card h-100 cursor-pointer ".concat("custom"===L.pricing_display_mode?"border-primary bg-light":""),onClick:()=>T({...L,pricing_display_mode:"custom"}),style:{cursor:"pointer"},children:(0,i.jsxs)("div",{className:"card-body",children:[(0,i.jsxs)("div",{className:"d-flex align-items-center mb-2",children:[(0,i.jsx)("input",{type:"radio",name:"pricing_mode",value:"custom",checked:"custom"===L.pricing_display_mode,onChange:()=>T({...L,pricing_display_mode:"custom"}),className:"me-2"}),(0,i.jsx)("h6",{className:"card-title mb-0",children:"カスタム"})]}),(0,i.jsx)("p",{className:"card-text text-muted small",children:"個別に設定"})]})})})]})]}),"custom"===L.pricing_display_mode&&(0,i.jsxs)("div",{className:"mb-4",children:[(0,i.jsx)("h6",{className:"mb-3",children:"詳細設定"}),(0,i.jsxs)("div",{className:"row g-3",children:[(0,i.jsx)("div",{className:"col-md-6",children:(0,i.jsxs)("div",{className:"form-check",children:[(0,i.jsx)("input",{className:"form-check-input",type:"checkbox",id:"show_item_prices",checked:L.show_item_prices,onChange:e=>T({...L,show_item_prices:e.target.checked})}),(0,i.jsx)("label",{className:"form-check-label",htmlFor:"show_item_prices",children:"商品単価を表示"})]})}),(0,i.jsx)("div",{className:"col-md-6",children:(0,i.jsxs)("div",{className:"form-check",children:[(0,i.jsx)("input",{className:"form-check-input",type:"checkbox",id:"show_item_quantity",checked:L.show_item_quantity,onChange:e=>T({...L,show_item_quantity:e.target.checked})}),(0,i.jsx)("label",{className:"form-check-label",htmlFor:"show_item_quantity",children:"商品数量を表示"})]})}),(0,i.jsx)("div",{className:"col-md-6",children:(0,i.jsxs)("div",{className:"form-check",children:[(0,i.jsx)("input",{className:"form-check-input",type:"checkbox",id:"show_subtotal",checked:L.show_subtotal,onChange:e=>T({...L,show_subtotal:e.target.checked})}),(0,i.jsx)("label",{className:"form-check-label",htmlFor:"show_subtotal",children:"小計を表示"})]})}),(0,i.jsx)("div",{className:"col-md-6",children:(0,i.jsxs)("div",{className:"form-check",children:[(0,i.jsx)("input",{className:"form-check-input",type:"checkbox",id:"show_total_amount",checked:L.show_total_amount,onChange:e=>T({...L,show_total_amount:e.target.checked})}),(0,i.jsx)("label",{className:"form-check-label",htmlFor:"show_total_amount",children:"合計金額を表示"})]})})]})]}),(0,i.jsxs)("div",{className:"mb-4",children:[(0,i.jsx)("h6",{className:"mb-3",children:"プレビュー"}),(0,i.jsx)("div",{className:"card bg-light",children:(0,i.jsxs)("div",{className:"card-body",children:[(0,i.jsxs)("div",{className:"row",children:[(0,i.jsxs)("div",{className:"col-8",children:[(0,i.jsx)("h6",{className:"mb-1",children:"サンプル商品"}),("custom"===L.pricing_display_mode?L.show_item_quantity:"hidden"!==L.pricing_display_mode)&&(0,i.jsx)("small",{className:"text-muted",children:"数量: 2個"})]}),(0,i.jsxs)("div",{className:"col-4 text-end",children:[("custom"===L.pricing_display_mode?L.show_item_prices:"full"===L.pricing_display_mode)&&(0,i.jsx)("div",{className:"small text-muted",children:"単価: \xa5500"}),("custom"===L.pricing_display_mode?L.show_subtotal:"full"===L.pricing_display_mode)&&(0,i.jsx)("div",{className:"small",children:"小計: \xa51,000"})]})]}),(0,i.jsx)("hr",{className:"my-2"}),(0,i.jsxs)("div",{className:"d-flex justify-content-between align-items-center",children:[(0,i.jsx)("strong",{children:"合計"}),(0,i.jsx)("strong",{children:("custom"===L.pricing_display_mode?L.show_total_amount:"hidden"!==L.pricing_display_mode)?"\xa51,000":"※価格は店舗にてお知らせします"})]})]})})]}),(0,i.jsxs)("div",{className:"alert alert-info",children:[(0,i.jsx)("i",{className:"bi bi-info-circle me-2"}),"full"===L.pricing_display_mode&&"商品の単価、小計、合計金額がすべて表示されます。","summary"===L.pricing_display_mode&&"合計金額のみが表示されます。","hidden"===L.pricing_display_mode&&"価格情報は一切表示されません。","custom"===L.pricing_display_mode&&"選択した項目のみが表示されます。"]})]})]})})})})]})]}),(0,i.jsxs)("div",{className:"modal-footer d-flex align-items-center",children:[(0,i.jsx)("div",{className:"flex-grow-1",children:!d.name.trim()&&(0,i.jsxs)("small",{className:"text-muted",children:[(0,i.jsx)("i",{className:"bi bi-info-circle me-1"}),"フォーム名を入力してください"]})}),(0,i.jsx)("button",{type:"button",className:"btn btn-secondary",onClick:J,children:"キャンセル"}),(0,i.jsx)("button",{type:"button",className:"btn btn-primary",onClick:Y,disabled:!d.name.trim(),title:d.name.trim()?"":"フォーム名を入力してください",children:"作成"})]})]})}),F&&S&&(0,i.jsx)("div",{className:"modal show d-block",tabIndex:-1,style:{backgroundColor:"rgba(0,0,0,0.5)"},children:(0,i.jsx)("div",{className:"modal-dialog",children:(0,i.jsxs)("div",{className:"modal-content",children:[(0,i.jsxs)("div",{className:"modal-header",children:[(0,i.jsx)("h5",{className:"modal-title",children:S.id.startsWith("custom_")?"カスタムフィールドを作成":"フィールドを編集"}),(0,i.jsx)("button",{type:"button",className:"btn-close",onClick:()=>D(!1),"aria-label":"Close"})]}),(0,i.jsxs)("div",{className:"modal-body",children:[(0,i.jsxs)("div",{className:"mb-3",children:[(0,i.jsx)("label",{className:"form-label",children:"フィールドタイプ"}),(0,i.jsx)("select",{className:"form-select",value:S.type,onChange:e=>P({...S,type:e.target.value}),children:m.map(e=>(0,i.jsx)("option",{value:e.value,children:e.label},e.value))})]}),(0,i.jsxs)("div",{className:"mb-3",children:[(0,i.jsx)("label",{className:"form-label",children:"ラベル"}),(0,i.jsx)("input",{type:"text",className:"form-control",value:S.label,onChange:e=>P({...S,label:e.target.value}),placeholder:"フィールドのラベルを入力"})]}),(0,i.jsxs)("div",{className:"mb-3",children:[(0,i.jsx)("label",{className:"form-label",children:"プレースホルダー"}),(0,i.jsx)("input",{type:"text",className:"form-control",value:S.placeholder||"",onChange:e=>P({...S,placeholder:e.target.value}),placeholder:"プレースホルダーテキストを入力（任意）"})]}),("select"===S.type||"radio"===S.type||"checkbox"===S.type)&&(0,i.jsxs)("div",{className:"mb-3",children:[(0,i.jsx)("label",{className:"form-label",children:"選択肢（1行に1つずつ入力）"}),(0,i.jsx)("textarea",{className:"form-control",rows:4,value:(null===(s=S.options)||void 0===s?void 0:s.join("\n"))||"",onChange:e=>P({...S,options:e.target.value.split("\n").filter(e=>e.trim())}),placeholder:"選択肢1 選択肢2 選択肢3"})]}),(0,i.jsxs)("div",{className:"form-check",children:[(0,i.jsx)("input",{className:"form-check-input",type:"checkbox",id:"fieldRequired",checked:S.required||!1,onChange:e=>P({...S,required:e.target.checked})}),(0,i.jsx)("label",{className:"form-check-label",htmlFor:"fieldRequired",children:"必須項目にする"})]})]}),(0,i.jsxs)("div",{className:"modal-footer",children:[(0,i.jsx)("button",{type:"button",className:"btn btn-secondary",onClick:()=>D(!1),children:"キャンセル"}),(0,i.jsx)("button",{type:"button",className:"btn btn-primary",onClick:()=>{if(!S)return;let e=C.findIndex(e=>e.id===S.id);if(e>=0){let s=[...C];s[e]=S,q(s)}else q([...C,S]);P(null),D(!1)},disabled:!S.label.trim(),children:"保存"})]})]})})})]}):null}function p(){let[e,s]=(0,t.useState)(!1);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(d,{onCreateForm:()=>{s(!0)},onEditForm:e=>{window.location.href="/admin?page=form-builder&id=".concat(e)}}),(0,i.jsx)(u,{isOpen:e,onClose:()=>s(!1),onSuccess:()=>{s(!1)}})]})}},9976:function(e,s,a){a.d(s,{M:function(){return t}});var i=a(2141);class t{static async getAllProducts(){let{data:e,error:s}=await i.O.from("products").select("*").order("created_at",{ascending:!1});if(s)throw s;return e||[]}static async getActiveProducts(){let{data:e,error:s}=await i.O.from("products").select("*").eq("is_available",!0).order("created_at",{ascending:!1});if(s)throw s;return e||[]}static async getProductsByCategory(e){let{data:s,error:a}=await i.O.from("products").select("*").eq("category_id",e).eq("is_available",!0).order("created_at",{ascending:!1});if(a)throw a;return s||[]}static async createProduct(e){let{data:s,error:a}=await i.O.from("products").insert([{...e,category_id:e.category_id||null,tax_type:e.tax_type||"inclusive",is_available:!1!==e.is_available,display_order:e.display_order||0}]).select();if(a)throw a;return s[0]}static async updateProduct(e,s){let{data:a,error:t}=await i.O.from("products").update({...s,category_id:s.category_id||null}).eq("id",e).select();if(t)throw t;return a[0]}static async deleteProduct(e){let{error:s}=await i.O.from("products").delete().eq("id",e);if(s)throw s;return!0}static async getAllCategories(){let{data:e,error:s}=await i.O.from("product_categories").select("*").eq("is_active",!0).order("display_order",{ascending:!0});if(s)throw s;return e||[]}static async bulkImportProducts(e){let s={success:0,failed:0,errors:[],warnings:[]},a=[];for(let i=0;i<e.length;i++){let t=e[i],l=i+2;if(!t.name||""===t.name.trim()){s.failed++,s.errors.push("行".concat(l,": 商品名が入力されていません"));continue}void 0!==t.price&&(isNaN(Number(t.price))||0>Number(t.price))&&(s.warnings.push("行".concat(l,": 価格が無効です。0に設定されます")),t.price=0),!t.id&&await this.getProductByName(t.name.trim())&&s.warnings.push("行".concat(l,": 商品「").concat(t.name,"」は既に存在します")),a.push({...t,lineNumber:l})}for(let e of a)try{var i,t,l,c,r,d;if(e.id){if(!await this.getProductById(e.id)){s.failed++,s.errors.push("行".concat(e.lineNumber,": ID「").concat(e.id,"」の商品が見つかりません"));continue}await this.updateProduct(e.id,{name:e.name.trim(),barcode:(null===(i=e.barcode)||void 0===i?void 0:i.trim())||void 0,price:e.price||0,variation_name:(null===(t=e.variation_name)||void 0===t?void 0:t.trim())||void 0,tax_type:e.tax_type||"inclusive",category_id:e.category_id||void 0,description:(null===(l=e.description)||void 0===l?void 0:l.trim())||void 0})}else await this.createProduct({name:e.name.trim(),barcode:(null===(c=e.barcode)||void 0===c?void 0:c.trim())||void 0,price:e.price||0,variation_name:(null===(r=e.variation_name)||void 0===r?void 0:r.trim())||void 0,tax_type:e.tax_type||"inclusive",category_id:e.category_id||void 0,description:(null===(d=e.description)||void 0===d?void 0:d.trim())||void 0,is_available:!0,display_order:0});s.success++}catch(i){s.failed++;let a=(null==i?void 0:i.message)||(null==i?void 0:i.toString())||"不明なエラー";s.errors.push("行".concat(e.lineNumber,": 商品「").concat(e.name,"」: ").concat(a))}return s}static async getProductByName(e){let{data:s,error:a}=await i.O.from("products").select("id, name").eq("name",e).limit(1);if(a)throw a;return(null==s?void 0:s[0])||null}static async getProductById(e){let{data:s,error:a}=await i.O.from("products").select("*").eq("id",e).limit(1);if(a)throw a;return(null==s?void 0:s[0])||null}static parseCSV(e){try{let s=e.replace(/\r\n/g,"\n").replace(/\r/g,"\n").trim().split("\n").filter(e=>e.trim());if(s.length<2)throw Error("CSVファイルが空か、ヘッダー行しかありません。最低でもヘッダー行とデータ行が必要です。");let a=s[0].trim();if(!a)throw Error("ヘッダー行が空です");let i=this.parseCSVLine(a).map(e=>e.trim().replace(/^["']|["']$/g,""));if(0===i.length)throw Error("ヘッダー行を解析できませんでした");let t=[],l=[],c=i.map(e=>e.toLowerCase()),r=["name"].filter(e=>!c.includes(e.toLowerCase()));if(r.length>0)throw Error("必須の列が見つかりません: ".concat(r.join(", "),"\n\n検出された列: ").concat(i.join(", "),"\n\n列名は大文字小文字を区別しません。"));for(let e=1;e<s.length;e++){let a=s[e].trim();if(a)try{let s=this.parseCSVLine(a);s.length,i.length;let c={},r=!1;i.forEach((a,i)=>{var t;let d=(null===(t=s[i])||void 0===t?void 0:t.trim().replace(/^["']|["']$/g,""))||"";switch(a.toLowerCase()){case"id":d&&(c.id=d);break;case"name":d?c.name=d:(l.push("行".concat(e+1,": 商品名が入力されていません")),r=!0);break;case"barcode":d&&(c.barcode=d);break;case"price":if(d){let s=parseFloat(d.replace(/[￥,]/g,""));isNaN(s)||s<0?l.push("行".concat(e+1,": 価格「").concat(d,"」が無効です（数値または0以上の値を入力してください）")):c.price=s}break;case"variation_name":d&&(c.variation_name=d);break;case"tax_type":if(d){let s=d.toLowerCase().trim();"内税"===s||"inclusive"===s?c.tax_type="inclusive":"外税"===s||"exclusive"===s?c.tax_type="exclusive":["inclusive","exclusive"].includes(s)?c.tax_type=s:l.push("行".concat(e+1,": 税区分「").concat(d,"」が無効です（内税/外税 または inclusive/exclusiveのみ）"))}break;case"category_id":d&&(c.category_id=d);break;case"description":d&&(c.description=d)}}),!r&&c.name&&t.push(c)}catch(s){l.push("行".concat(e+1,": 行の解析に失敗しました - ").concat(s.message))}}if(l.length>0){let e="CSVファイルに".concat(l.length,"個のエラーがあります:\n\n").concat(l.join("\n"));throw Error(e)}if(0===t.length)throw Error("有効な商品データが見つかりませんでした。\n\n以下を確認してください:\n• name列に値が入力されているか\n• データ行が存在するか\n• ファイル形式が正しいか");return t}catch(s){let e=s.message||"不明なエラーが発生しました";throw Error("CSV解析エラー: ".concat(e))}}static parseCSVLine(e){let s=[],a="",i=!1;for(let t=0;t<e.length;t++){let l=e[t];'"'===l||"'"===l?i&&e[t+1]===l?(a+=l,t++):i=!i:","!==l||i?a+=l:(s.push(a),a="")}return s.push(a),s}static generateCSVTemplate(e){var s;return"id,name,barcode,price,variation_name,tax_type,category_id,description\n"+["","トマト苗","4901234567890","300","通常価格","inclusive",(null===(s=e[0])||void 0===s?void 0:s.id)||"","中玉トマトの苗"].join(",")}static async exportToCSV(){return["id,name,barcode,price,variation_name,tax_type,category_id,description",...(await this.getAllProducts()).map(e=>[e.id,'"'.concat(e.name,'"'),e.barcode||"",e.price,e.variation_name||"",e.tax_type||"",e.category_id||"",'"'.concat(e.description||"",'"')].join(","))].join("\n")}}}}]);