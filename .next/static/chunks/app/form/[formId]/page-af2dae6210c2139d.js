(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[978],{7805:function(e,s,t){Promise.resolve().then(t.bind(t,9122))},9122:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return o}});var i=t(7437),a=t(2265),r=t(9376),n=t(2141),l=t(7755),c=t(6882);function o(){let e=(0,r.useParams)().formId,[s,t]=(0,a.useState)(null),[o,d]=(0,a.useState)(!0),[m,x]=(0,a.useState)(null),[u,g]=(0,a.useState)(!1);(0,a.useEffect)(()=>{e&&(p(),h())},[e]);let h=()=>{g(window.navigator.userAgent.includes("Line/"))},p=async()=>{d(!0),x(null);try{let{data:s,error:i}=await n.OQ.from("forms").select("\n          *,\n          form_fields(*),\n          form_products(\n            *,\n            product:products(\n              *,\n              category:product_categories(*)\n            )\n          )\n        ").eq("id",e).eq("is_active",!0).single();if(i)throw i;if(!s){x("フォームが見つかりません");return}let a=new Date;if(s.valid_from&&new Date(s.valid_from)>a){x("このフォームはまだ受付開始時刻になっていません");return}if(s.valid_to&&new Date(s.valid_to)<a){x("このフォームの受付は終了しました");return}let r={id:s.id,name:s.name,description:s.description,fields:(s.form_fields||[]).map(e=>({id:e.field_id,type:e.field_type,label:e.label,placeholder:e.placeholder,required:e.is_required,options:e.options,description:e.description,category:e.category||"other",enabled:e.is_enabled})),products:(s.form_products||[]).map(e=>{var s;return{id:e.product.id,name:e.product.name,category_name:null===(s=e.product.category)||void 0===s?void 0:s.name,price:e.product.price,variation_name:e.variation_name,selected_price:e.selected_price||e.product.price,selected_variation:e.variation_name}}),settings:{showProgress:s.show_progress||!0,allowEdit:s.allow_edit||!0,confirmationMessage:s.confirmation_message||"ご予約ありがとうございました。",businessName:s.business_name||"",validFrom:s.valid_from,validTo:s.valid_to,isActive:s.is_active}};t(r)}catch(e){console.error("フォーム設定の取得に失敗しました:",e),x("フォーム設定の読み込みに失敗しました")}finally{d(!1)}};return o?(0,i.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,i.jsxs)("div",{className:"text-center",children:[(0,i.jsx)(c.JO,{icon:c.PJ.loading,size:"xl",className:"animate-spin text-blue-500 mx-auto mb-4"}),(0,i.jsx)("p",{className:"text-gray-600",children:"フォームを読み込み中..."})]})}):m?(0,i.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:(0,i.jsxs)("div",{className:"bg-white rounded-lg shadow-lg p-8 max-w-md w-full text-center",children:[(0,i.jsx)(c.JO,{icon:c.PJ.error,size:"xl",className:"text-red-500 mx-auto mb-4"}),(0,i.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"アクセスできません"}),(0,i.jsx)("p",{className:"text-gray-600 mb-4",children:m}),(0,i.jsx)("button",{onClick:()=>window.history.back(),className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"戻る"})]})}):s?(0,i.jsxs)("div",{className:"min-h-screen ".concat(u?"bg-white":"bg-gray-50"),children:[!u&&(0,i.jsx)("div",{className:"bg-white border-b border-gray-200",children:(0,i.jsx)("div",{className:"max-w-lg mx-auto px-4 py-3",children:(0,i.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,i.jsx)(c.JO,{icon:c.PJ.plant,size:"lg",className:"text-green-600"}),(0,i.jsxs)("div",{children:[(0,i.jsx)("h1",{className:"text-lg font-semibold text-gray-900",children:s.settings.businessName||"種苗店予約システム"}),(0,i.jsx)("p",{className:"text-sm text-gray-600",children:"予約フォーム"})]})]})})}),(0,i.jsx)("div",{className:"".concat(u?"p-0":"p-4"),children:(0,i.jsx)("div",{className:"".concat(u?"":"max-w-lg mx-auto"),children:(0,i.jsx)(l.Z,{formConfig:s})})}),!u&&(0,i.jsx)("div",{className:"bg-white border-t border-gray-200 mt-8",children:(0,i.jsx)("div",{className:"max-w-lg mx-auto px-4 py-6 text-center",children:(0,i.jsxs)("p",{className:"text-sm text-gray-500",children:["Powered by ",s.settings.businessName||"種苗店予約システム"]})})})]}):(0,i.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:(0,i.jsxs)("div",{className:"bg-white rounded-lg shadow-lg p-8 max-w-md w-full text-center",children:[(0,i.jsx)(c.JO,{icon:c.PJ.warning,size:"xl",className:"text-yellow-500 mx-auto mb-4"}),(0,i.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"フォームが見つかりません"}),(0,i.jsx)("p",{className:"text-gray-600 mb-4",children:"指定されたフォームは存在しないか、無効になっています。"}),(0,i.jsx)("button",{onClick:()=>window.history.back(),className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"戻る"})]})})}}},function(e){e.O(0,[500,880,971,117,744],function(){return e(e.s=7805)}),_N_E=e.O()}]);