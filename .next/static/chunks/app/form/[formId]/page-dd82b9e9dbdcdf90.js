(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[978],{7805:function(e,t,i){Promise.resolve().then(i.bind(i,9122))},6882:function(e,t,i){"use strict";i.d(t,{JO:function(){return eN},PJ:function(){return ev}});var s=i(7437),r=i(9397),a=i(4630),n=i(8930),o=i(2489),c=i(3229),l=i(8867),d=i(3247),u=i(740),m=i(9076),h=i(2660),f=i(6858),w=i(2451),p=i(407),g=i(875),Z=i(8293),x=i(7684),y=i(2369),_=i(5805),b=i(9663),v=i(7692),I=i(1047),N=i(1723),j=i(8736),C=i(804),k=i(2735),L=i(7689),O=i(4794),P=i(6275),S=i(8226),J=i(5252),E=i(3041),q=i(9345),z=i(8335),A=i(8919),D=i(2718),W=i(3774),F=i(2048),B=i(7877),M=i(5302),T=i(5131),X=i(3639),G=i(3245),R=i(112),U=i(2208),V=i(7769),Y=i(5884),H=i(4415),Q=i(6337),K=i(9711),$=i(1567),ee=i(91),et=i(8728),ei=i(9637),es=i(7586),er=i(1473),ea=i(4766),en=i(2252),eo=i(7404),ec=i(3057),el=i(2879),ed=i(9547),eu=i(9646),em=i(5929),eh=i(1341),ef=i(6540),ew=i(6595),ep=i(8997),eg=i(8896),eZ=i(2720),ex=i(1178),ey=i(7414),e_=i(401),eb=i(3388);let ev={add:r.Z,edit:a.Z,delete:n.Z,remove:o.Z,save:c.Z,copy:l.Z,search:d.Z,filter:u.Z,refresh:m.Z,back:h.Z,forward:f.Z,up:w.Z,down:p.Z,chevronDown:g.Z,menu:Z.Z,more:x.Z,user:y.Z,users:_.Z,profile:b.Z,logout:v.Z,calendar:I.Z,clock:N.Z,file:j.Z,document:j.Z,image:C.Z,download:k.Z,upload:L.Z,product:O.Z,cart:P.Z,payment:S.Z,money:J.Z,phone:E.Z,mail:q.Z,link:z.Z,share:A.Z,message:D.Z,location:W.Z,map:F.Z,navigation:B.Z,success:M.Z,error:T.Z,warning:X.Z,info:G.Z,help:R.Z,eye:U.Z,eyeOff:V.Z,show:U.Z,hide:V.Z,expand:Y.Z,collapse:H.Z,lock:Q.Z,unlock:K.Z,security:Q.Z,exit:v.Z,chart:$.Z,stats:$.Z,database:ee.Z,settings:et.Z,admin:et.Z,config:et.Z,home:ei.Z,dashboard:ei.Z,list:es.Z,grid:er.Z,notification:ea.Z,alert:en.Z,qrcode:eo.Z,plant:ec.Z,seed:O.Z,flower:el.Z,tree:ec.Z,leaf:ed.Z,garden:eu.Z,sun:em.Z,cloud:eh.Z,rain:eh.Z,weather:em.Z,loading:ef.Z,spinner:m.Z,star:ew.Z,heart:ep.Z,target:eg.Z,tag:eZ.Z,bookmark:ex.Z,gift:ey.Z,check:e_.Z,cancel:o.Z,confirm:M.Z,customerInfo:y.Z,reservationInfo:I.Z,otherInfo:j.Z,packageIcon:O.Z,mobileIcon:eb.Z,saveIcon:c.Z,qrIcon:eo.Z,searchIcon:d.Z,deleteIcon:n.Z,closeIcon:o.Z,moneyIcon:J.Z},eI={xs:12,sm:16,md:20,lg:24,xl:32,"2xl":48},eN=e=>{let{icon:t,size:i="md",className:r="",color:a,...n}=e,o="number"==typeof i?i:eI[i];return(0,s.jsx)(t,{width:o,height:o,className:r,color:a,...n})}},1274:function(e,t,i){"use strict";i.d(t,{LiffProvider:function(){return n},a0:function(){return o}});var s=i(7437),r=i(2265);let a=(0,r.createContext)(void 0),n=e=>{let{children:t,liffId:i,autoInit:n=!0}=e,[o,c]=(0,r.useState)(null),[l,d]=(0,r.useState)(!1),[u,m]=(0,r.useState)(!1),[h,f]=(0,r.useState)(null),[w,p]=(0,r.useState)(null);(0,r.useEffect)(()=>{let e=document.createElement("script");return e.src="https://static.line-scdn.net/liff/edge/2/sdk.js",e.async=!0,e.onload=()=>{window.liff&&n&&i&&g(i)},e.onerror=()=>{p("LIFFライブラリの読み込みに失敗しました")},document.head.appendChild(e),()=>{document.head.removeChild(e)}},[i,n]);let g=async e=>{try{if(p(null),!window.liff)throw Error("LIFFライブラリが読み込まれていません");if(await window.liff.init({liffId:e}),c(window.liff),d(!0),m(window.liff.isInClient()),window.liff.isLoggedIn())try{let e=await window.liff.getProfile();f({userId:e.userId,displayName:e.displayName,pictureUrl:e.pictureUrl,statusMessage:e.statusMessage})}catch(e){}}catch(e){p("LINEミニアプリの初期化に失敗しました")}},Z=async e=>{if(!o||!o.isInClient())throw Error("LINEアプリ内でのみ利用可能です");try{await o.sendMessages(e)}catch(e){throw e}},x=async e=>{if(!o)throw Error("LIFFが初期化されていません");try{await o.shareTargetPicker(e)}catch(e){throw e}};return(0,s.jsx)(a.Provider,{value:{liff:o,isLiffReady:l,isInLineApp:u,profile:h,error:w,initializeLiff:g,closeLiff:()=>{o&&o.isInClient()&&o.closeWindow()},sendMessages:Z,shareTargetPicker:x},children:t})},o=()=>{let e=(0,r.useContext)(a);if(void 0===e)throw Error("useLiff must be used within a LiffProvider");return e}},9122:function(e,t,i){"use strict";i.r(t),i.d(t,{default:function(){return d}});var s=i(7437),r=i(2265),a=i(9376),n=i(2141),o=i(7755),c=i(6882),l=i(1274);function d(){let e=(0,a.useParams)().formId,[t,i]=(0,r.useState)(null),[d,u]=(0,r.useState)(!0),[m,h]=(0,r.useState)(null),[f,w]=(0,r.useState)(!1),{isLiffReady:p,isInLineApp:g,profile:Z,liff:x}=(0,l.a0)();(0,r.useEffect)(()=>{e&&y()},[e]),(0,r.useEffect)(()=>{w(g)},[g]);let y=async()=>{u(!0),h(null);try{let{data:t,error:s}=await n.O.from("forms").select("\n          *,\n          form_fields(*),\n          form_products(\n            *,\n            product:products(\n              *,\n              category:product_categories(*)\n            )\n          )\n        ").eq("id",e).eq("is_active",!0).single(),{data:r}=await n.O.from("form_display_settings").select("*").eq("form_id",e).single();if(s)throw s;if(!t){h("フォームが見つかりません");return}let a=new Date;if(t.valid_from&&new Date(t.valid_from)>a){h("このフォームはまだ受付開始時刻になっていません");return}if(t.valid_to&&new Date(t.valid_to)<a){h("このフォームの受付は終了しました");return}let o={id:t.id,name:t.name,description:t.description,fields:(t.form_fields||[]).map(e=>({id:e.field_id,type:e.field_type,label:e.label,placeholder:e.placeholder,required:e.is_required,options:e.options,description:e.description,category:e.category||"other",enabled:e.is_enabled})),products:(t.form_products||[]).map(e=>{var t;return{id:e.product.id,name:e.product.name,category_name:null===(t=e.product.category)||void 0===t?void 0:t.name,price:e.product.price,variation_name:e.variation_name,selected_price:e.selected_price||e.product.price,selected_variation:e.variation_name}}),settings:{showProgress:t.show_progress||!0,allowEdit:t.allow_edit||!0,confirmationMessage:t.confirmation_message||"ご予約ありがとうございました。",businessName:t.business_name||"",validFrom:t.valid_from,validTo:t.valid_to,isActive:t.is_active},pricingSettings:r?{show_item_prices:r.show_item_prices,show_subtotal:r.show_subtotal,show_total_amount:r.show_total_amount,show_item_quantity:r.show_item_quantity,pricing_display_mode:r.pricing_display_mode}:void 0};i(o)}catch(e){h("フォーム設定の読み込みに失敗しました")}finally{u(!1)}};return d?(0,s.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)(c.JO,{icon:c.PJ.loading,size:"xl",className:"animate-spin text-blue-500 mx-auto mb-4"}),(0,s.jsx)("p",{className:"text-gray-600",children:"フォームを読み込み中..."})]})}):m?(0,s.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-lg p-8 max-w-md w-full text-center",children:[(0,s.jsx)(c.JO,{icon:c.PJ.error,size:"xl",className:"text-red-500 mx-auto mb-4"}),(0,s.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"アクセスできません"}),(0,s.jsx)("p",{className:"text-gray-600 mb-4",children:m}),(0,s.jsx)("button",{onClick:()=>window.history.back(),className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"戻る"})]})}):t?(0,s.jsxs)("div",{className:"min-h-screen ".concat(f?"bg-white":"bg-gray-50"),children:[!f&&(0,s.jsx)("div",{className:"bg-white border-b border-gray-200",children:(0,s.jsx)("div",{className:"max-w-lg mx-auto px-4 py-3",children:(0,s.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,s.jsx)(c.JO,{icon:c.PJ.plant,size:"lg",className:"text-green-600"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-lg font-semibold text-gray-900",children:t.settings.businessName||"ベジライス予約システム"}),(0,s.jsx)("p",{className:"text-sm text-gray-600",children:"予約フォーム"})]})]})})}),!1,(0,s.jsx)("div",{className:"".concat(f?"p-0":"p-4"),children:(0,s.jsx)("div",{className:"".concat(f?"":"max-w-lg mx-auto"),children:(0,s.jsx)(o.Z,{formConfig:{...t,products:t.products,pricingSettings:t.pricingSettings},liffProfile:Z,isLiffReady:p})})}),!f&&(0,s.jsx)("div",{className:"bg-white border-t border-gray-200 mt-8",children:(0,s.jsx)("div",{className:"max-w-lg mx-auto px-4 py-6 text-center",children:(0,s.jsxs)("p",{className:"text-sm text-gray-500",children:["Powered by ",t.settings.businessName||"ベジライス予約システム"]})})})]}):(0,s.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-lg p-8 max-w-md w-full text-center",children:[(0,s.jsx)(c.JO,{icon:c.PJ.warning,size:"xl",className:"text-yellow-500 mx-auto mb-4"}),(0,s.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"フォームが見つかりません"}),(0,s.jsx)("p",{className:"text-gray-600 mb-4",children:"指定されたフォームは存在しないか、無効になっています。"}),(0,s.jsx)("button",{onClick:()=>window.history.back(),className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"戻る"})]})})}},2141:function(e,t,i){"use strict";i.d(t,{O:function(){return s}});let s=(0,i(6580).eI)("https://uscvsipskkbegcfktjyt.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVzY3ZzaXBza2tiZWdjZmt0anl0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI0MDI4MzUsImV4cCI6MjA2Nzk3ODgzNX0.VhcGWXb-PpHTfqPApSIG4C6xXLik8JClsNhOdJIgdzw")},9376:function(e,t,i){"use strict";var s=i(5475);i.o(s,"useParams")&&i.d(t,{useParams:function(){return s.useParams}}),i.o(s,"usePathname")&&i.d(t,{usePathname:function(){return s.usePathname}})},3123:function(e,t,i){"use strict";i.d(t,{r:function(){return r}});var s=i(2141);class r{static async linkLineAuthToCustomer(e,t,i){try{let s=await this.findCustomerByLineId(e);if(s)return await this.updateCustomerWithLineAuth(s,t,i);return await this.createCustomerWithLineAuth(e,t,i)}catch(e){throw e}}static async findCustomerByLineId(e){try{let{data:t,error:i}=await s.O.from("customers").select("*").eq("line_user_id",e).single();if(i&&"PGRST116"!==i.code)throw i;return t||null}catch(e){return null}}static async findCustomerByEmail(e){try{let{data:t,error:i}=await s.O.from("customers").select("*").eq("email",e).single();if(i&&"PGRST116"!==i.code)throw i;return t||null}catch(e){return null}}static async findCustomerByPhone(e){try{let{data:t,error:i}=await s.O.from("customers").select("*").eq("phone",e).single();if(i&&"PGRST116"!==i.code)throw i;return t||null}catch(e){return null}}static async updateCustomerWithLineAuth(e,t,i){try{let r={...e,...i,line_user_id:t.userId,updated_at:new Date().toISOString()},{data:a,error:n}=await s.O.from("customers").update(r).eq("id",e.id).select().single();if(n)throw n;return a}catch(e){throw e}}static async createCustomerWithLineAuth(e,t,i){try{let r={...i,line_user_id:e,full_name:i.full_name||t.displayName,created_at:new Date().toISOString(),updated_at:new Date().toISOString()},{data:a,error:n}=await s.O.from("customers").insert([r]).select().single();if(n)throw n;return a}catch(e){throw e}}static async autoLinkExistingCustomer(e,t,i){try{if(i.email){let e=await this.findCustomerByEmail(i.email);if(e)return await this.updateCustomerWithLineAuth(e,t,i)}if(i.phone){let e=await this.findCustomerByPhone(i.phone);if(e)return await this.updateCustomerWithLineAuth(e,t,i)}return await this.createCustomerWithLineAuth(e,t,i)}catch(e){throw e}}static async unlinkLineAuth(e){try{let{error:t}=await s.O.from("customers").update({line_user_id:null,updated_at:new Date().toISOString()}).eq("id",e);if(t)throw t}catch(e){throw e}}static async getCustomerLineAuthStatus(e){try{let{data:t,error:i}=await s.O.from("customers").select("line_user_id").eq("id",e).single();if(i)throw i;return{isLinked:!!t.line_user_id,lineUserId:t.line_user_id}}catch(e){return{isLinked:!1}}}static async getLineAuthenticatedCustomers(){try{let{data:e,error:t}=await s.O.from("customers").select("*").not("line_user_id","is",null).order("created_at",{ascending:!1});if(t)throw t;return e||[]}catch(e){return[]}}}}},function(e){e.O(0,[454,580,755,362,744],function(){return e(e.s=7805)}),_N_E=e.O()}]);