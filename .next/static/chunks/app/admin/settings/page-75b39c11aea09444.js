(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[140],{8124:function(e,s,a){Promise.resolve().then(a.bind(a,3090))},3090:function(e,s,a){"use strict";a.r(s),a.d(s,{default:function(){return d}});var i=a(7437),t=a(2265),n=a(9703),c=a(1254),l=a(2141);class r{static async getSettings(){try{let{data:e,error:s}=await l.O.from("system_settings").select("setting_key, setting_value").in("setting_key",Object.values(this.SETTING_KEYS));if(s)return this.getDefaultSettings();let a=this.getDefaultSettings();return e&&e.forEach(e=>{let s="string"==typeof e.setting_value?JSON.parse(e.setting_value):e.setting_value;switch(e.setting_key){case this.SETTING_KEYS.GENERAL:a.general={...a.general,...s};break;case this.SETTING_KEYS.NOTIFICATIONS:a.notifications={...a.notifications,...s};break;case this.SETTING_KEYS.BUSINESS:a.business={...a.business,...s};break;case this.SETTING_KEYS.ADVANCED:a.advanced={...a.advanced,...s}}}),a}catch(e){return this.getDefaultSettings()}}static async saveSettings(e){try{for(let s of[{setting_key:this.SETTING_KEYS.GENERAL,setting_value:JSON.stringify(e.general)},{setting_key:this.SETTING_KEYS.NOTIFICATIONS,setting_value:JSON.stringify(e.notifications)},{setting_key:this.SETTING_KEYS.BUSINESS,setting_value:JSON.stringify(e.business)},{setting_key:this.SETTING_KEYS.ADVANCED,setting_value:JSON.stringify(e.advanced)}]){let{error:e}=await l.O.from("system_settings").upsert(s,{onConflict:"setting_key"});if(e)throw e}}catch(e){throw Error("設定の保存に失敗しました")}}static getDefaultSettings(){return{general:{site_name:"ベジライス予約システム",site_description:"LINE ミニアプリ対応の種苗店予約システム",contact_email:"contact@vegirice.com",contact_phone:"03-1234-5678"},notifications:{email_enabled:!0,line_enabled:!0,sms_enabled:!1,reminder_hours:24},business:{business_hours_start:"09:00",business_hours_end:"18:00",business_days:["月","火","水","木","金","土"],holiday_mode:!1},advanced:{auto_confirm_orders:!1,require_phone_verification:!0,max_reservation_days:30,default_pickup_duration:60}}}static async initializeSettings(){try{let e=this.getDefaultSettings();await this.saveSettings(e)}catch(e){throw Error("設定の初期化に失敗しました")}}static async getSettingsByCategory(e){try{let s=this.SETTING_KEYS[e.toUpperCase()],{data:a,error:i}=await l.O.from("system_settings").select("setting_value").eq("setting_key",s).single();if(i)return this.getDefaultSettings()[e];return a?JSON.parse(a.setting_value):this.getDefaultSettings()[e]}catch(s){return this.getDefaultSettings()[e]}}static async isBusinessOpen(){try{let e=await this.getSettingsByCategory("business");if(e.holiday_mode)return!1;let s=new Date,a=["日","月","火","水","木","金","土"][s.getDay()];if(!e.business_days.includes(a))return!1;let i=100*s.getHours()+s.getMinutes(),t=parseInt(e.business_hours_start.replace(":","")),n=parseInt(e.business_hours_end.replace(":",""));return i>=t&&i<=n}catch(e){return!1}}static async getMaxReservationDate(){try{let e=(await this.getSettingsByCategory("advanced")).max_reservation_days||30,s=new Date;return s.setDate(s.getDate()+e),s}catch(s){let e=new Date;return e.setDate(e.getDate()+30),e}}}function d(){let{showSuccess:e,showError:s}=(0,n.p)(),[a,l]=(0,t.useState)({general:{site_name:"",site_description:"",contact_email:"",contact_phone:""},notifications:{email_enabled:!0,line_enabled:!0,sms_enabled:!1,reminder_hours:24},business:{business_hours_start:"09:00",business_hours_end:"18:00",business_days:["月","火","水","木","金","土"],holiday_mode:!1},advanced:{auto_confirm_orders:!1,require_phone_verification:!0,max_reservation_days:30,default_pickup_duration:60}}),[d,o]=(0,t.useState)(!1),[m,h]=(0,t.useState)("general");(0,t.useEffect)(()=>{u()},[]);let u=async()=>{try{let e=await r.getSettings();l(e)}catch(e){s("設定の読み込みに失敗しました")}},_=async()=>{o(!0);try{await r.saveSettings(a),e("設定が保存されました")}catch(e){s("設定の保存に失敗しました")}finally{o(!1)}},b=(e,s)=>{l(a=>({...a,general:{...a.general,[e]:s}}))},g=(e,s)=>{l(a=>({...a,notifications:{...a.notifications,[e]:s}}))},f=(e,s)=>{l(a=>({...a,business:{...a.business,[e]:s}}))},N=(e,s)=>{l(a=>({...a,advanced:{...a.advanced,[e]:s}}))},x=e=>{f("business_days",a.business.business_days.includes(e)?a.business.business_days.filter(s=>s!==e):[...a.business.business_days,e])};return(0,i.jsx)(c.Z,{children:(0,i.jsxs)("div",{className:"container-fluid",children:[(0,i.jsx)("div",{className:"row",children:(0,i.jsx)("div",{className:"col-12",children:(0,i.jsxs)("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[(0,i.jsx)("h1",{className:"h2 fw-bold text-dark",children:"システム設定"}),(0,i.jsx)("button",{onClick:_,disabled:d,className:"btn text-white",style:{background:"linear-gradient(135deg, #8bc34a 0%, #7cb342 100%)",border:"none"},children:d?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("span",{className:"spinner-border spinner-border-sm me-2"}),"保存中..."]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("i",{className:"bi bi-check-circle me-2"}),"設定を保存"]})})]})})}),(0,i.jsxs)("div",{className:"row",children:[(0,i.jsx)("div",{className:"col-lg-3 col-md-4 mb-4",children:(0,i.jsxs)("div",{className:"card",children:[(0,i.jsx)("div",{className:"card-header",children:(0,i.jsx)("h5",{className:"card-title mb-0",children:"設定カテゴリ"})}),(0,i.jsx)("div",{className:"list-group list-group-flush",children:[{id:"general",label:"基本設定",icon:"bi-gear"},{id:"notifications",label:"通知設定",icon:"bi-bell"},{id:"business",label:"営業設定",icon:"bi-clock"},{id:"advanced",label:"高度な設定",icon:"bi-tools"}].map(e=>(0,i.jsxs)("button",{onClick:()=>h(e.id),className:"list-group-item list-group-item-action d-flex align-items-center ".concat(m===e.id?"active":""),style:m===e.id?{background:"linear-gradient(135deg, #8bc34a 0%, #7cb342 100%)",color:"white"}:{},children:[(0,i.jsx)("i",{className:"".concat(e.icon," me-3")}),e.label]},e.id))})]})}),(0,i.jsx)("div",{className:"col-lg-9 col-md-8",children:(0,i.jsx)("div",{className:"card",children:(0,i.jsxs)("div",{className:"card-body",children:["general"===m&&(0,i.jsxs)("div",{children:[(0,i.jsx)("h5",{className:"card-title mb-4",children:"基本設定"}),(0,i.jsxs)("div",{className:"row g-3",children:[(0,i.jsxs)("div",{className:"col-md-6",children:[(0,i.jsx)("label",{className:"form-label fw-medium",children:"サイト名"}),(0,i.jsx)("input",{type:"text",className:"form-control",value:a.general.site_name,onChange:e=>b("site_name",e.target.value)})]}),(0,i.jsxs)("div",{className:"col-md-6",children:[(0,i.jsx)("label",{className:"form-label fw-medium",children:"連絡先メール"}),(0,i.jsx)("input",{type:"email",className:"form-control",value:a.general.contact_email,onChange:e=>b("contact_email",e.target.value)})]}),(0,i.jsxs)("div",{className:"col-md-6",children:[(0,i.jsx)("label",{className:"form-label fw-medium",children:"連絡先電話番号"}),(0,i.jsx)("input",{type:"tel",className:"form-control",value:a.general.contact_phone,onChange:e=>b("contact_phone",e.target.value)})]}),(0,i.jsxs)("div",{className:"col-12",children:[(0,i.jsx)("label",{className:"form-label fw-medium",children:"サイト説明"}),(0,i.jsx)("textarea",{className:"form-control",rows:3,value:a.general.site_description,onChange:e=>b("site_description",e.target.value)})]})]})]}),"notifications"===m&&(0,i.jsxs)("div",{children:[(0,i.jsx)("h5",{className:"card-title mb-4",children:"通知設定"}),(0,i.jsxs)("div",{className:"row g-3",children:[(0,i.jsx)("div",{className:"col-12",children:(0,i.jsxs)("div",{className:"form-check",children:[(0,i.jsx)("input",{className:"form-check-input",type:"checkbox",id:"email_enabled",checked:a.notifications.email_enabled,onChange:e=>g("email_enabled",e.target.checked)}),(0,i.jsx)("label",{className:"form-check-label fw-medium",htmlFor:"email_enabled",children:"メール通知を有効にする"})]})}),(0,i.jsx)("div",{className:"col-12",children:(0,i.jsxs)("div",{className:"form-check",children:[(0,i.jsx)("input",{className:"form-check-input",type:"checkbox",id:"line_enabled",checked:a.notifications.line_enabled,onChange:e=>g("line_enabled",e.target.checked)}),(0,i.jsx)("label",{className:"form-check-label fw-medium",htmlFor:"line_enabled",children:"LINE通知を有効にする"})]})}),(0,i.jsx)("div",{className:"col-12",children:(0,i.jsxs)("div",{className:"form-check",children:[(0,i.jsx)("input",{className:"form-check-input",type:"checkbox",id:"sms_enabled",checked:a.notifications.sms_enabled,onChange:e=>g("sms_enabled",e.target.checked)}),(0,i.jsx)("label",{className:"form-check-label fw-medium",htmlFor:"sms_enabled",children:"SMS通知を有効にする"})]})}),(0,i.jsxs)("div",{className:"col-md-6",children:[(0,i.jsx)("label",{className:"form-label fw-medium",children:"リマインダー送信時間（時間前）"}),(0,i.jsx)("input",{type:"number",className:"form-control",min:"1",max:"72",value:a.notifications.reminder_hours,onChange:e=>g("reminder_hours",parseInt(e.target.value))})]})]})]}),"business"===m&&(0,i.jsxs)("div",{children:[(0,i.jsx)("h5",{className:"card-title mb-4",children:"営業設定"}),(0,i.jsxs)("div",{className:"row g-3",children:[(0,i.jsxs)("div",{className:"col-md-6",children:[(0,i.jsx)("label",{className:"form-label fw-medium",children:"営業開始時間"}),(0,i.jsx)("input",{type:"time",className:"form-control",value:a.business.business_hours_start,onChange:e=>f("business_hours_start",e.target.value)})]}),(0,i.jsxs)("div",{className:"col-md-6",children:[(0,i.jsx)("label",{className:"form-label fw-medium",children:"営業終了時間"}),(0,i.jsx)("input",{type:"time",className:"form-control",value:a.business.business_hours_end,onChange:e=>f("business_hours_end",e.target.value)})]}),(0,i.jsxs)("div",{className:"col-12",children:[(0,i.jsx)("label",{className:"form-label fw-medium",children:"営業日"}),(0,i.jsx)("div",{className:"d-flex gap-2 mt-2",children:["月","火","水","木","金","土","日"].map(e=>(0,i.jsx)("button",{type:"button",onClick:()=>x(e),className:"btn ".concat(a.business.business_days.includes(e)?"text-white":"btn-outline-secondary"),style:a.business.business_days.includes(e)?{background:"linear-gradient(135deg, #8bc34a 0%, #7cb342 100%)",border:"none"}:{},children:e},e))})]}),(0,i.jsx)("div",{className:"col-12",children:(0,i.jsxs)("div",{className:"form-check",children:[(0,i.jsx)("input",{className:"form-check-input",type:"checkbox",id:"holiday_mode",checked:a.business.holiday_mode,onChange:e=>f("holiday_mode",e.target.checked)}),(0,i.jsx)("label",{className:"form-check-label fw-medium",htmlFor:"holiday_mode",children:"休業モード（すべての予約を一時停止）"})]})})]})]}),"advanced"===m&&(0,i.jsxs)("div",{children:[(0,i.jsx)("h5",{className:"card-title mb-4",children:"高度な設定"}),(0,i.jsxs)("div",{className:"row g-3",children:[(0,i.jsx)("div",{className:"col-12",children:(0,i.jsxs)("div",{className:"form-check",children:[(0,i.jsx)("input",{className:"form-check-input",type:"checkbox",id:"auto_confirm_orders",checked:a.advanced.auto_confirm_orders,onChange:e=>N("auto_confirm_orders",e.target.checked)}),(0,i.jsx)("label",{className:"form-check-label fw-medium",htmlFor:"auto_confirm_orders",children:"注文を自動確定する"})]})}),(0,i.jsx)("div",{className:"col-12",children:(0,i.jsxs)("div",{className:"form-check",children:[(0,i.jsx)("input",{className:"form-check-input",type:"checkbox",id:"require_phone_verification",checked:a.advanced.require_phone_verification,onChange:e=>N("require_phone_verification",e.target.checked)}),(0,i.jsx)("label",{className:"form-check-label fw-medium",htmlFor:"require_phone_verification",children:"電話番号の確認を必須にする"})]})}),(0,i.jsxs)("div",{className:"col-md-6",children:[(0,i.jsx)("label",{className:"form-label fw-medium",children:"最大予約可能日数"}),(0,i.jsx)("input",{type:"number",className:"form-control",min:"1",max:"365",value:a.advanced.max_reservation_days,onChange:e=>N("max_reservation_days",parseInt(e.target.value))})]}),(0,i.jsxs)("div",{className:"col-md-6",children:[(0,i.jsx)("label",{className:"form-label fw-medium",children:"デフォルト受取時間（分）"}),(0,i.jsx)("input",{type:"number",className:"form-control",min:"15",max:"480",step:"15",value:a.advanced.default_pickup_duration,onChange:e=>N("default_pickup_duration",parseInt(e.target.value))})]})]})]})]})})})]})]})})}r.SETTING_KEYS={GENERAL:"general_settings",NOTIFICATIONS:"notification_settings",BUSINESS:"business_settings",ADVANCED:"advanced_settings"}},2141:function(e,s,a){"use strict";a.d(s,{O:function(){return i}});let i=(0,a(6580).eI)("https://uscvsipskkbegcfktjyt.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVzY3ZzaXBza2tiZWdjZmt0anl0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI0MDI4MzUsImV4cCI6MjA2Nzk3ODgzNX0.VhcGWXb-PpHTfqPApSIG4C6xXLik8JClsNhOdJIgdzw")}},function(e){e.O(0,[454,580,448,254,362,744],function(){return e(e.s=8124)}),_N_E=e.O()}]);