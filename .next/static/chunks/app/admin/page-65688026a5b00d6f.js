(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3],{9435:function(e,t,s){Promise.resolve().then(s.bind(s,5057))},5057:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return z}});var a=s(7437),n=s(2265),i=s(7464),r=s(6882),l=s(2141);class c{static async getAllNotifications(){try{let e=[],{data:t}=await l.OQ.from("reservations").select("\n          id,\n          reservation_number,\n          status,\n          created_at,\n          updated_at,\n          customer:customers (name)\n        ").order("created_at",{ascending:!1}).limit(5);null==t||t.forEach(t=>{if(Date.now()-new Date(t.created_at).getTime()<864e5){var s;e.push({id:"reservation_".concat(t.id),title:"新しい予約",message:"".concat((null===(s=t.customer)||void 0===s?void 0:s.name)||"顧客","様から新しい予約が入りました（").concat(t.reservation_number,"）"),type:"info",isRead:!1,createdAt:t.created_at,actionUrl:"/admin?page=reservation-list"})}"confirmed"===t.status&&new Date(t.updated_at).getTime()-new Date(t.created_at).getTime()>6e4&&e.push({id:"confirmed_".concat(t.id),title:"予約確定",message:"予約 ".concat(t.reservation_number," が確定されました"),type:"success",isRead:Math.random()>.7,createdAt:t.updated_at,actionUrl:"/admin?page=reservation-list"})});let{count:s}=await l.OQ.from("reservations").select("*",{count:"exact",head:!0}).eq("status","pending");return s&&s>5&&e.push({id:"pending_reservations",title:"保留中の予約",message:"".concat(s,"件の予約が確認待ちです"),type:"warning",isRead:!1,createdAt:new Date().toISOString(),actionUrl:"/admin?page=reservation-list"}),e.sort((e,t)=>new Date(t.createdAt).getTime()-new Date(e.createdAt).getTime()).slice(0,10)}catch(e){return console.error("Failed to fetch notifications:",e),[]}}static async getUnreadNotifications(){return(await this.getAllNotifications()).filter(e=>!e.isRead)}static async markAsRead(e){try{return!0}catch(e){return console.error("Failed to mark notification as read:",e),!1}}static async markAllAsRead(){try{return!0}catch(e){return console.error("Failed to mark all notifications as read:",e),!1}}static async createNotification(e){try{return{...e,id:"custom_".concat(Date.now()),createdAt:new Date().toISOString()}}catch(e){return console.error("Failed to create notification:",e),null}}static formatTimeAgo(e){let t=new Date,s=new Date(e),a=t.getTime()-s.getTime(),n=Math.floor(a/6e4),i=Math.floor(a/36e5);return n<1?"今":n<60?"".concat(n,"分前"):i<24?"".concat(i,"時間前"):"".concat(Math.floor(a/864e5),"日前")}static getNotificationTypeColor(e){switch(e){case"info":return"bg-primary";case"success":return"bg-success";case"warning":return"bg-warning";case"error":return"bg-danger";default:return"bg-secondary"}}static async generateSystemNotifications(){try{let e=[],{error:t}=await l.OQ.from("products").select("count",{count:"exact",head:!0});for(let s of(t&&e.push({title:"システムエラー",message:"データベース接続に問題があります",type:"error",isRead:!1}),e))await this.createNotification(s)}catch(e){console.error("Failed to generate system notifications:",e)}}}let d=()=>{let[e,t]=(0,n.useState)(!1),[s,i]=(0,n.useState)([]),[l,d]=(0,n.useState)(!1),o=(0,n.useRef)(null);(0,n.useEffect)(()=>{m();let e=e=>{o.current&&!o.current.contains(e.target)&&t(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);let m=async()=>{d(!0);try{let e=await c.getAllNotifications();i(e)}catch(e){console.error("通知の取得に失敗しました:",e)}finally{d(!1)}},u=async e=>{try{await c.markAsRead(e)&&i(t=>t.map(t=>t.id===e?{...t,isRead:!0}:t))}catch(e){console.error("通知の既読化に失敗しました:",e)}},x=async()=>{try{await c.markAllAsRead()&&i(e=>e.map(e=>({...e,isRead:!0})))}catch(e){console.error("全通知の既読化に失敗しました:",e)}},h=s.filter(e=>!e.isRead).length,g=e=>{switch(e){case"info":return r.PJ.info;case"success":return r.PJ.success;case"warning":return r.PJ.warning;case"error":return r.PJ.error;default:return r.PJ.notification}},p=e=>c.getNotificationTypeColor(e);return(0,a.jsxs)("div",{className:"position-relative",ref:o,children:[(0,a.jsxs)("button",{className:"btn btn-outline-secondary position-relative",onClick:()=>t(!e),title:"通知",children:[(0,a.jsx)(r.JO,{icon:r.PJ.notification,size:"sm"}),h>0&&(0,a.jsx)("span",{className:"position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger",children:h>99?"99+":h})]}),e&&(0,a.jsxs)("div",{className:"position-absolute end-0 mt-2 bg-white border border-secondary rounded shadow-lg",style:{width:"320px",zIndex:1e3},children:[(0,a.jsxs)("div",{className:"d-flex align-items-center justify-content-between p-3 border-bottom",children:[(0,a.jsx)("h6",{className:"mb-0 fw-bold",children:"通知"}),h>0&&(0,a.jsx)("button",{className:"btn btn-sm btn-outline-primary",onClick:x,children:"すべて既読"})]}),(0,a.jsx)("div",{className:"notification-list",style:{maxHeight:"400px",overflowY:"auto"},children:l?(0,a.jsxs)("div",{className:"d-flex align-items-center justify-content-center p-4",children:[(0,a.jsx)(r.JO,{icon:r.PJ.loading,size:"sm",className:"animate-spin me-2"}),(0,a.jsx)("span",{children:"読み込み中..."})]}):s.length>0?s.map(e=>(0,a.jsx)("div",{className:"p-3 border-bottom cursor-pointer ".concat(e.isRead?"":"bg-light"),onClick:()=>{e.isRead||u(e.id),e.actionUrl&&(window.location.href=e.actionUrl),t(!1)},style:{cursor:"pointer"},children:(0,a.jsxs)("div",{className:"d-flex align-items-start",children:[(0,a.jsx)("div",{className:"badge ".concat(p(e.type)," me-2 mt-1"),children:(0,a.jsx)(r.JO,{icon:g(e.type),size:"xs"})}),(0,a.jsxs)("div",{className:"flex-grow-1",children:[(0,a.jsxs)("div",{className:"d-flex align-items-center justify-content-between",children:[(0,a.jsx)("h6",{className:"mb-1 ".concat(e.isRead?"":"fw-bold"),children:e.title}),!e.isRead&&(0,a.jsx)("span",{className:"badge bg-primary rounded-pill",children:"新着"})]}),(0,a.jsx)("p",{className:"mb-1 small text-muted",children:e.message}),(0,a.jsx)("small",{className:"text-muted",children:c.formatTimeAgo(e.createdAt)})]})]})},e.id)):(0,a.jsxs)("div",{className:"text-center p-4 text-muted",children:[(0,a.jsx)(r.JO,{icon:r.PJ.notification,size:"lg",className:"text-muted mb-2"}),(0,a.jsx)("p",{className:"mb-0",children:"新しい通知はありません"})]})}),s.length>0&&(0,a.jsx)("div",{className:"p-2 border-top text-center",children:(0,a.jsx)("button",{className:"btn btn-sm btn-link text-decoration-none",onClick:()=>{t(!1)},children:"すべての通知を表示"})})]})]})},o=[{id:"dashboard",label:"ダッシュボード",icon:"\uD83D\uDCCA"},{id:"reservations",label:"予約管理",icon:"\uD83D\uDCC5",children:[{id:"reservation-list",label:"予約一覧",icon:"\uD83D\uDCCB"},{id:"reservation-calendar",label:"予約カレンダー",icon:"\uD83D\uDDD3️",isUnimplemented:!0},{id:"reservation-search",label:"予約検索",icon:"\uD83D\uDD0D",isUnimplemented:!0}]},{id:"products",label:"商品管理",icon:"\uD83C\uDF31",children:[{id:"product-list",label:"商品一覧",icon:"\uD83D\uDCE6"},{id:"product-add",label:"商品追加",icon:"➕"},{id:"product-categories",label:"カテゴリ管理",icon:"\uD83C\uDFF7️"}]},{id:"customers",label:"顧客管理",icon:"\uD83D\uDC65",children:[{id:"customer-list",label:"顧客管理",icon:"\uD83D\uDC64"},{id:"customer-search",label:"顧客検索",icon:"\uD83D\uDD0D",isUnimplemented:!0}]},{id:"forms",label:"フォーム管理",icon:"\uD83D\uDCDD",children:[{id:"form-builder",label:"フォーム作成",icon:"\uD83D\uDEE0️"},{id:"form-list",label:"フォーム一覧",icon:"\uD83D\uDCCB"},{id:"form-settings",label:"フォーム設定",icon:"⚙️",isUnimplemented:!0}]},{id:"settings",label:"設定",icon:"⚙️",children:[{id:"business-settings",label:"店舗設定",icon:"\uD83C\uDFEA",isUnimplemented:!0},{id:"notification-settings",label:"LINE通知設定",icon:"\uD83D\uDD14"},{id:"user-management",label:"ユーザー管理",icon:"\uD83D\uDC68‍\uD83D\uDCBC",isUnimplemented:!0}]}];function m(e){var t,s,l,c;let{children:m,currentPage:u,onPageChange:x}=e,[h,g]=(0,n.useState)(new Set(["reservations","forms"])),[p,v]=(0,n.useState)(!1),[b,j]=(0,n.useState)(!1),{user:f,signOut:y}=(0,i.a)(),N=e=>{let t=new Set(h);t.has(e)?t.delete(e):t.add(e),g(t)},_=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=h.has(e.id),n=u===e.id,i=e.children&&e.children.length>0;return(0,a.jsxs)("div",{className:"menu-item",children:[(0,a.jsx)("div",{className:"menu-item-button ".concat(n?"active":""," level-").concat(t),onClick:()=>{if(i)N(e.id);else{if(e.isUnimplemented){alert("この機能は現在メンテナンス中です。しばらくお待ちください。");return}x(e.id)}},children:(0,a.jsxs)("div",{className:"menu-item-content",children:[(0,a.jsx)("span",{className:"menu-icon",children:e.icon}),!p&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",{className:"menu-label",children:e.label}),e.isUnimplemented&&(0,a.jsx)("span",{className:"maintenance-badge",children:"メンテ中"}),i&&(0,a.jsx)("span",{className:"menu-arrow ".concat(s?"expanded":""),children:"▼"})]})]})}),i&&s&&!p&&(0,a.jsx)("div",{className:"menu-children",children:e.children.map(e=>_(e,t+1))})]},e.id)};return(0,a.jsxs)("div",{className:"admin-layout",children:[b&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-40 md:hidden",onClick:()=>j(!1)}),(0,a.jsxs)("aside",{className:"admin-sidebar ".concat(p?"collapsed":""," ").concat(b?"mobile-open":""),children:[(0,a.jsxs)("div",{className:"sidebar-header",children:[(0,a.jsxs)("div",{className:"logo-section",children:[(0,a.jsx)("span",{className:"logo-icon",children:"\uD83C\uDF31"}),!p&&(0,a.jsx)("span",{className:"logo-text",children:"ベジライス管理"})]}),(0,a.jsx)("button",{className:"sidebar-toggle",onClick:()=>v(!p),children:p?"▶":"◀"})]}),(0,a.jsx)("nav",{className:"sidebar-nav",children:o.map(e=>_(e))}),(0,a.jsx)("div",{className:"sidebar-footer",children:(0,a.jsxs)("div",{className:"user-info",children:[(0,a.jsx)("span",{className:"user-icon",children:"\uD83D\uDC68‍\uD83D\uDCBC"}),!p&&(0,a.jsxs)("div",{className:"user-details",children:[(0,a.jsx)("div",{className:"user-name",children:"管理者"}),(0,a.jsx)("div",{className:"user-role",children:"Administrator"})]})]})})]}),(0,a.jsxs)("main",{className:"admin-main ".concat(p?"sidebar-collapsed":""),children:[(0,a.jsx)("header",{className:"admin-header",children:(0,a.jsxs)("div",{className:"header-content",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("button",{className:"md:hidden p-2 rounded-lg bg-gray-100 hover:bg-gray-200",onClick:()=>j(!b),children:(0,a.jsx)("span",{className:"text-xl",children:b?"✕":"☰"})}),(0,a.jsx)("h1",{className:"page-title",children:(null===(l=o.find(e=>{var t;return e.id===u||(null===(t=e.children)||void 0===t?void 0:t.some(e=>e.id===u))}))||void 0===l?void 0:null===(s=l.children)||void 0===s?void 0:null===(t=s.find(e=>e.id===u))||void 0===t?void 0:t.label)||(null===(c=o.find(e=>e.id===u))||void 0===c?void 0:c.label)||"ダッシュボード"})]}),(0,a.jsxs)("div",{className:"header-actions",children:[(0,a.jsx)(d,{}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("span",{className:"text-sm text-gray-600 hidden sm:block",children:null==f?void 0:f.email}),(0,a.jsxs)("button",{onClick:()=>y(),className:"btn-modern btn-outline-modern btn-sm flex items-center gap-2",title:"ログアウト",children:[(0,a.jsx)(r.JO,{icon:r.PJ.exit,size:"sm"}),(0,a.jsx)("span",{className:"hidden sm:inline",children:"ログアウト"})]})]})]})]})}),(0,a.jsx)("div",{className:"admin-content",children:m})]})]})}class u{static getStatusBadgeClasses(e){let t={active:{bg:"bg-green-100",text:"text-green-800",label:"アクティブ"},inactive:{bg:"bg-gray-100",text:"text-gray-800",label:"無効"},pending:{bg:"bg-blue-100",text:"text-blue-800",label:"保留中"},confirmed:{bg:"bg-green-100",text:"text-green-800",label:"確定"},cancelled:{bg:"bg-red-100",text:"text-red-800",label:"キャンセル"},completed:{bg:"bg-purple-100",text:"text-purple-800",label:"完了"},expired:{bg:"bg-red-100",text:"text-red-800",label:"期限切れ"},preparing:{bg:"bg-yellow-100",text:"text-yellow-800",label:"準備中"}};return t[e]||t.inactive}static formatDate(e,t){if(!e)return"";let s={year:"numeric",month:"2-digit",day:"2-digit",...t};return new Date(e).toLocaleDateString("ja-JP",s)}static formatDateTime(e){return e?new Date(e).toLocaleDateString("ja-JP",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):""}static formatPrice(e){return"\xa5".concat(e.toLocaleString())}static isDateInRange(e,t,s){return(!t||!(e<t))&&(!s||!(e>s))}static calculateDaysUntil(e){let t=new Date;return Math.ceil((new Date(e).getTime()-t.getTime())/864e5)}static getValidityPeriodText(e,t){return e||t?e&&t?"".concat(this.formatDate(e)," - ").concat(this.formatDate(t)):e?"".concat(this.formatDate(e),"から"):t?"".concat(this.formatDate(t),"まで"):"期限なし":"期限なし"}}class x{static async getAllForms(){let{data:e,error:t}=await l.OQ.from("form_configurations").select("\n        id,\n        name,\n        description,\n        form_fields,\n        settings,\n        is_active,\n        valid_from,\n        valid_to,\n        version,\n        created_at,\n        updated_at\n      ").order("updated_at",{ascending:!1});if(t)throw t;let{data:s,error:a}=await l.OQ.from("reservations").select("form_id").not("form_id","is",null);a&&console.warn("Failed to fetch response counts:",a);let n=new Map;return null==s||s.forEach(e=>{let t=n.get(e.form_id)||0;n.set(e.form_id,t+1)}),(null==e?void 0:e.map(e=>{var t,s;return{...e,settings:e.settings||{},version:e.version||1,field_count:(null===(s=e.form_fields)||void 0===s?void 0:null===(t=s.fields)||void 0===t?void 0:t.length)||0,response_count:n.get(e.id)||0}}))||[]}static async createForm(e){let{data:t,error:s}=await l.OQ.from("form_configurations").insert([{name:e.name,description:e.description,form_fields:{fields:e.fields},is_active:e.isActive,valid_from:e.validFrom||null,valid_to:e.validTo||null,selected_products:e.selectedProducts||[]}]).select();if(s)throw s;return t[0]}static async updateForm(e,t){let s={};t.name&&(s.name=t.name),t.description&&(s.description=t.description),t.fields&&(s.form_fields={fields:t.fields}),void 0!==t.isActive&&(s.is_active=t.isActive),void 0!==t.validFrom&&(s.valid_from=t.validFrom||null),void 0!==t.validTo&&(s.valid_to=t.validTo||null),t.selectedProducts&&(s.selected_products=t.selectedProducts);let{data:a,error:n}=await l.OQ.from("form_configurations").update(s).eq("id",e).select();if(n)throw n;return a[0]}static async deleteForm(e){let{error:t}=await l.OQ.from("form_configurations").delete().eq("id",e);if(t)throw t;return!0}static async getFormById(e){let{data:t,error:s}=await l.OQ.from("form_configurations").select("*").eq("id",e).single();if(s)throw s;return t}static async toggleFormStatus(e,t){let{error:s}=await l.OQ.from("form_configurations").update({is_active:t}).eq("id",e);if(s)throw s;return!0}static isFormAccessible(e){if(!e.is_active)return!1;let t=new Date,s=e.valid_from?new Date(e.valid_from):null,a=e.valid_to?new Date(e.valid_to):null;return(!s||!(t<s))&&(!a||!(t>a))}static getFormStatus(e){if(!e.is_active)return"inactive";let t=new Date,s=e.valid_from?new Date(e.valid_from):null,a=e.valid_to?new Date(e.valid_to):null;return s&&t<s?"pending":a&&t>a?"expired":"active"}static getValidityPeriodText(e,t){return u.getValidityPeriodText(e,t)}static async checkFormConfiguration(){try{let e=await this.getAllForms(),t=0,s=0,a=0,n=[],i=[],r=new Date;return e.forEach(e=>{let l=this.getFormStatus(e);switch(l){case"active":t++;break;case"inactive":s++;break;case"expired":a++,n.push("フォーム「".concat(e.name,"」が有効期限切れです"));break;case"pending":n.push("フォーム「".concat(e.name,"」がまだ開始されていません"))}if(0===e.field_count&&n.push("フォーム「".concat(e.name,"」にフィールドが設定されていません")),0===e.response_count&&"active"===l&&i.push("フォーム「".concat(e.name,"」はアクティブですが回答がありません")),e.valid_to){let t=new Date(e.valid_to),s=Math.ceil((t.getTime()-r.getTime())/864e5);s<=7&&s>0&&"active"===l&&i.push("フォーム「".concat(e.name,"」が").concat(s,"日後に有効期限切れになります"))}}),0===t&&n.push("アクティブなフォームがありません"),0===e.length&&(n.push("フォームが作成されていません"),i.push("最初のフォームを作成することをお勧めします")),{totalForms:e.length,activeForms:t,inactiveForms:s,expiredForms:a,issuesFound:n,recommendations:i}}catch(e){return console.error("フォーム設定チェック中にエラーが発生:",e),{totalForms:0,activeForms:0,inactiveForms:0,expiredForms:0,issuesFound:["フォーム設定の確認中にエラーが発生しました"],recommendations:[]}}}}function h(e){let{onPageChange:t}=e,[s,i]=(0,n.useState)(!1),[c,d]=(0,n.useState)(null),[o,m]=(0,n.useState)(!1),[u,h]=(0,n.useState)([{icon:"calendar",label:"今日の予約",value:"0",trend:"+0",trendLabel:"昨日比",trendType:"positive",color:"blue"},{icon:"users",label:"総顧客数",value:"0",trend:"+0",trendLabel:"今月",trendType:"positive",color:"purple"},{icon:"document",label:"フォーム数",value:"0",trend:"+0",trendLabel:"今月追加",trendType:"positive",color:"orange"}]),[g,p]=(0,n.useState)([]),[v,b]=(0,n.useState)(!0);(0,n.useEffect)(()=>{j()},[]);let j=async()=>{try{b(!0);let e=new Date().toISOString().split("T")[0],{data:t,error:s}=await l.OQ.from("reservations").select("id").gte("created_at","".concat(e,"T00:00:00")).lt("created_at","".concat(e,"T23:59:59")),{data:a,error:n}=await l.OQ.from("customers").select("id"),{data:i,error:c}=await l.OQ.from("forms").select("id").eq("is_active",!0),{data:d,error:o}=await l.OQ.from("reservations").select("\n          id,\n          total_amount,\n          status,\n          created_at,\n          customers(name)\n        ").order("created_at",{ascending:!1}).limit(5);s&&console.error("予約データ取得エラー:",s),n&&console.error("顧客データ取得エラー:",n),c&&console.error("フォームデータ取得エラー:",c),o&&console.error("アクティビティデータ取得エラー:",o);let m=(null==t?void 0:t.length)||0,u=(null==a?void 0:a.length)||0,x=(null==i?void 0:i.length)||0;if(h([{icon:"calendar",label:"今日の予約",value:m.toString(),trend:"+0",trendLabel:"昨日比",trendType:"positive",color:"blue"},{icon:"users",label:"総顧客数",value:u.toString(),trend:"+0",trendLabel:"今月",trendType:"positive",color:"purple"},{icon:"document",label:"フォーム数",value:x.toString(),trend:"+0",trendLabel:"今月追加",trendType:"positive",color:"orange"}]),d){let e=d.map(e=>{var t;let s=f(new Date(e.created_at));return{icon:r.PJ.success,iconColor:"green",text:"".concat((null===(t=e.customers)||void 0===t?void 0:t.name)||"不明な顧客","様の予約が").concat("confirmed"===e.status?"確定":"受付","されました"),time:s,amount:e.total_amount?"\xa5".concat(e.total_amount.toLocaleString()):null}});p(e)}}catch(e){console.error("ダッシュボードデータの取得に失敗しました:",e)}finally{b(!1)}},f=e=>{let t=new Date().getTime()-e.getTime(),s=Math.floor(t/6e4),a=Math.floor(t/36e5);return s<60?"".concat(s,"分前"):a<24?"".concat(a,"時間前"):"".concat(Math.floor(a/24),"日前")},y=async()=>{m(!0),i(!0);try{let e=await x.checkFormConfiguration();d(e)}catch(e){console.error("フォーム設定確認中にエラー:",e),d({totalForms:0,activeForms:0,inactiveForms:0,expiredForms:0,issuesFound:["フォーム設定の確認中にエラーが発生しました"],recommendations:[]})}finally{m(!1)}};return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-800",children:"ダッシュボード"}),(0,a.jsx)("p",{className:"text-gray-600",children:"種苗店管理システム - 今日の概要"})]}),(0,a.jsxs)("div",{className:"text-sm text-gray-500",children:["最終更新: ",new Date().toLocaleString("ja-JP")]})]}),v?(0,a.jsx)("div",{className:"admin-stats-grid",children:[1,2,3,4].map(e=>(0,a.jsxs)("div",{className:"admin-widget blue animate-pulse",children:[(0,a.jsxs)("div",{className:"admin-widget-header",children:[(0,a.jsx)("div",{className:"admin-widget-title",children:"読み込み中..."}),(0,a.jsx)("div",{className:"admin-widget-icon",children:(0,a.jsx)(r.JO,{icon:r.PJ.loading,size:"md",className:"animate-spin"})})]}),(0,a.jsx)("div",{className:"admin-widget-value",children:"---"}),(0,a.jsxs)("div",{className:"admin-widget-trend positive",children:[(0,a.jsx)("span",{children:"---"}),(0,a.jsx)("span",{className:"text-gray-500",children:"(---)"})]})]},e))}):(0,a.jsx)("div",{className:"admin-stats-grid",children:u.map((e,t)=>(0,a.jsxs)("div",{className:"admin-widget ".concat(e.color),children:[(0,a.jsxs)("div",{className:"admin-widget-header",children:[(0,a.jsx)("div",{className:"admin-widget-title",children:e.label}),(0,a.jsxs)("div",{className:"admin-widget-icon",children:["calendar"===e.icon&&(0,a.jsx)(r.JO,{icon:r.PJ.calendar,size:"md"}),"users"===e.icon&&(0,a.jsx)(r.JO,{icon:r.PJ.users,size:"md"}),"document"===e.icon&&(0,a.jsx)(r.JO,{icon:r.PJ.document,size:"md"})]})]}),(0,a.jsx)("div",{className:"admin-widget-value",children:e.value}),(0,a.jsxs)("div",{className:"admin-widget-trend ".concat(e.trendType),children:[(0,a.jsx)("span",{children:e.trend}),(0,a.jsxs)("span",{className:"text-gray-500",children:["(",e.trendLabel,")"]})]})]},t))}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,a.jsxs)("div",{className:"lg:col-span-1",children:[(0,a.jsxs)("div",{className:"admin-card",children:[(0,a.jsx)("div",{className:"admin-card-header",children:(0,a.jsx)("h3",{className:"admin-card-title",children:"クイックアクション"})}),(0,a.jsx)("div",{className:"admin-card-content",children:(0,a.jsx)("div",{className:"space-y-3",children:[{icon:"edit",title:"新規予約追加",description:"お客様の予約を追加",action:()=>null==t?void 0:t("reservation-list")},{icon:"packageIcon",title:"商品追加",description:"新しい商品を登録",action:()=>null==t?void 0:t("product-add")},{icon:"user",title:"顧客管理",description:"顧客情報を管理",action:()=>null==t?void 0:t("customer-list")},{icon:"document",title:"フォーム管理",description:"予約フォームを管理",action:()=>null==t?void 0:t("form-list")}].map((e,t)=>(0,a.jsx)("button",{onClick:e.action,className:"btn-modern btn-outline-modern w-full p-4 lg:p-6 text-left",children:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsxs)("div",{className:"flex-shrink-0",children:["edit"===e.icon&&(0,a.jsx)(r.JO,{icon:r.PJ.edit,size:"lg"}),"packageIcon"===e.icon&&(0,a.jsx)(r.JO,{icon:r.PJ.packageIcon,size:"lg"}),"user"===e.icon&&(0,a.jsx)(r.JO,{icon:r.PJ.user,size:"lg"}),"document"===e.icon&&(0,a.jsx)(r.JO,{icon:r.PJ.document,size:"lg"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-medium text-gray-900 lg:text-lg",children:e.title}),(0,a.jsx)("div",{className:"text-sm lg:text-base text-gray-500",children:e.description})]})]})},t))})})]}),(0,a.jsxs)("div",{className:"admin-card mt-6",children:[(0,a.jsx)("div",{className:"admin-card-header",children:(0,a.jsx)("h3",{className:"admin-card-title",children:"今日のタスク"})}),(0,a.jsx)("div",{className:"admin-card-content",children:(0,a.jsx)("div",{className:"space-y-3",children:[{icon:"phone",task:"田中様への確認電話",time:"14:00",priority:"high"},{icon:"document",task:"フォーム設定の確認",time:"15:30",priority:"medium"},{icon:"mail",task:"週次レポートの送信",time:"17:00",priority:"low"}].map((e,t)=>(0,a.jsxs)("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-lg",children:[(0,a.jsxs)("div",{className:"flex-shrink-0",children:["phone"===e.icon&&(0,a.jsx)(r.JO,{icon:r.PJ.phone,size:"md"}),"document"===e.icon&&(0,a.jsx)(r.JO,{icon:r.PJ.document,size:"md"}),"mail"===e.icon&&(0,a.jsx)(r.JO,{icon:r.PJ.mail,size:"md"})]}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("div",{className:"font-medium text-sm",children:e.task}),(0,a.jsx)("div",{className:"text-xs text-gray-500",children:e.time})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:["フォーム設定の確認"===e.task&&(0,a.jsx)("button",{onClick:y,className:"text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded hover:bg-blue-200",children:"実行"}),(0,a.jsx)("div",{className:"w-2 h-2 rounded-full ".concat("high"===e.priority?"bg-red-400":"medium"===e.priority?"bg-yellow-400":"bg-green-400")})]})]},t))})})]})]}),(0,a.jsxs)("div",{className:"lg:col-span-2",children:[(0,a.jsxs)("div",{className:"admin-card",children:[(0,a.jsx)("div",{className:"admin-card-header",children:(0,a.jsx)("h3",{className:"admin-card-title",children:"最近のアクティビティ"})}),(0,a.jsx)("div",{className:"admin-card-content",children:v?(0,a.jsx)("div",{className:"space-y-3",children:[1,2,3].map(e=>(0,a.jsxs)("div",{className:"admin-activity-item animate-pulse",children:[(0,a.jsx)("div",{className:"admin-activity-icon bg-gray-200",children:(0,a.jsx)(r.JO,{icon:r.PJ.loading,size:"sm",className:"animate-spin"})}),(0,a.jsxs)("div",{className:"admin-activity-content",children:[(0,a.jsx)("div",{className:"admin-activity-text bg-gray-200 h-4 rounded"}),(0,a.jsx)("div",{className:"admin-activity-time bg-gray-200 h-3 rounded mt-1"})]})]},e))}):(0,a.jsx)("div",{className:"space-y-3",children:g.length>0?g.map((e,t)=>(0,a.jsxs)("div",{className:"admin-activity-item",children:[(0,a.jsx)("div",{className:"admin-activity-icon bg-".concat(e.iconColor,"-100 text-").concat(e.iconColor,"-600"),children:(0,a.jsx)(r.JO,{icon:e.icon,size:"sm"})}),(0,a.jsxs)("div",{className:"admin-activity-content",children:[(0,a.jsx)("div",{className:"admin-activity-text",children:e.text}),(0,a.jsx)("div",{className:"admin-activity-time",children:e.time})]}),e.amount&&(0,a.jsx)("div",{className:"font-medium text-green-600",children:e.amount})]},t)):(0,a.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,a.jsx)(r.JO,{icon:r.PJ.info,size:"xl",className:"mx-auto mb-2 text-gray-400"}),(0,a.jsx)("p",{children:"最近のアクティビティはありません"})]})})})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mt-6",children:[(0,a.jsxs)("div",{className:"admin-card",children:[(0,a.jsx)("div",{className:"admin-card-header",children:(0,a.jsx)("h3",{className:"admin-card-title",children:"今月の目標達成率"})}),(0,a.jsx)("div",{className:"admin-card-content",children:(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex justify-between mb-2",children:[(0,a.jsx)("span",{className:"text-sm font-medium",children:"売上目標"}),(0,a.jsx)("span",{className:"text-sm text-gray-600",children:"73%"})]}),(0,a.jsx)("div",{className:"admin-progress",children:(0,a.jsx)("div",{className:"admin-progress-bar green",style:{width:"73%"}})})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex justify-between mb-2",children:[(0,a.jsx)("span",{className:"text-sm font-medium",children:"予約件数"}),(0,a.jsx)("span",{className:"text-sm text-gray-600",children:"85%"})]}),(0,a.jsx)("div",{className:"admin-progress",children:(0,a.jsx)("div",{className:"admin-progress-bar blue",style:{width:"85%"}})})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex justify-between mb-2",children:[(0,a.jsx)("span",{className:"text-sm font-medium",children:"顧客満足度"}),(0,a.jsx)("span",{className:"text-sm text-gray-600",children:"92%"})]}),(0,a.jsx)("div",{className:"admin-progress",children:(0,a.jsx)("div",{className:"admin-progress-bar orange",style:{width:"92%"}})})]})]})})]}),(0,a.jsxs)("div",{className:"admin-card",children:[(0,a.jsx)("div",{className:"admin-card-header",children:(0,a.jsx)("h3",{className:"admin-card-title",children:"週間予約統計"})}),(0,a.jsx)("div",{className:"admin-card-content",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"text-3xl font-bold text-blue-600 mb-2",children:"127"}),(0,a.jsx)("div",{className:"text-sm text-gray-600 mb-4",children:"今週の総予約数"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[(0,a.jsxs)("div",{className:"text-center p-3 bg-green-50 rounded-lg",children:[(0,a.jsx)("div",{className:"font-bold text-green-600",children:"98"}),(0,a.jsx)("div",{className:"text-gray-600",children:"確定済み"})]}),(0,a.jsxs)("div",{className:"text-center p-3 bg-yellow-50 rounded-lg",children:[(0,a.jsx)("div",{className:"font-bold text-yellow-600",children:"29"}),(0,a.jsx)("div",{className:"text-gray-600",children:"保留中"})]})]})]})})]})]})]})]}),s&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,a.jsx)("div",{className:"bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold",children:"フォーム設定確認結果"}),(0,a.jsx)("button",{onClick:()=>i(!1),className:"text-gray-400 hover:text-gray-600",children:"✕"})]}),o?(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)(r.JO,{icon:r.PJ.loading,size:"xl",className:"animate-spin mx-auto mb-4 text-blue-600"}),(0,a.jsx)("p",{className:"text-gray-600",children:"フォーム設定を確認しています..."})]}):c&&(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[(0,a.jsxs)("div",{className:"bg-blue-50 p-4 rounded-lg text-center",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:c.totalForms}),(0,a.jsx)("div",{className:"text-sm text-gray-600",children:"総フォーム数"})]}),(0,a.jsxs)("div",{className:"bg-green-50 p-4 rounded-lg text-center",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-green-600",children:c.activeForms}),(0,a.jsx)("div",{className:"text-sm text-gray-600",children:"アクティブ"})]}),(0,a.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg text-center",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-gray-600",children:c.inactiveForms}),(0,a.jsx)("div",{className:"text-sm text-gray-600",children:"非アクティブ"})]}),(0,a.jsxs)("div",{className:"bg-red-50 p-4 rounded-lg text-center",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-red-600",children:c.expiredForms}),(0,a.jsx)("div",{className:"text-sm text-gray-600",children:"期限切れ"})]})]}),c.issuesFound.length>0&&(0,a.jsxs)("div",{children:[(0,a.jsxs)("h4",{className:"font-medium text-red-700 mb-3 flex items-center",children:[(0,a.jsx)(r.JO,{icon:r.PJ.warning,size:"sm",className:"mr-2"}),"問題点 (",c.issuesFound.length,"件)"]}),(0,a.jsx)("div",{className:"space-y-2",children:c.issuesFound.map((e,t)=>(0,a.jsx)("div",{className:"bg-red-50 border border-red-200 p-3 rounded text-sm text-red-700",children:e},t))})]}),c.recommendations.length>0&&(0,a.jsxs)("div",{children:[(0,a.jsxs)("h4",{className:"font-medium text-yellow-700 mb-3 flex items-center",children:[(0,a.jsx)(r.JO,{icon:r.PJ.info,size:"sm",className:"mr-2"}),"推奨事項 (",c.recommendations.length,"件)"]}),(0,a.jsx)("div",{className:"space-y-2",children:c.recommendations.map((e,t)=>(0,a.jsx)("div",{className:"bg-yellow-50 border border-yellow-200 p-3 rounded text-sm text-yellow-700",children:e},t))})]}),0===c.issuesFound.length&&0===c.recommendations.length&&(0,a.jsxs)("div",{className:"bg-green-50 border border-green-200 p-4 rounded text-center",children:[(0,a.jsx)(r.JO,{icon:r.PJ.success,size:"lg",className:"mx-auto mb-2 text-green-600"}),(0,a.jsx)("p",{className:"text-green-700 font-medium",children:"フォーム設定に問題はありません"}),(0,a.jsx)("p",{className:"text-green-600 text-sm mt-1",children:"すべてのフォームが正常に設定されています"})]})]}),(0,a.jsxs)("div",{className:"mt-6 flex justify-end space-x-3",children:[(0,a.jsx)("button",{onClick:()=>i(!1),className:"px-4 py-2 border border-gray-300 rounded text-gray-700 hover:bg-gray-50",children:"閉じる"}),c&&(0,a.jsx)("button",{onClick:()=>null==t?void 0:t("form-builder"),className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"フォーム設定画面へ"})]})]})})})]})}var g=s(7755),p=e=>{let{isOpen:t,onClose:s,onProductSelect:i,excludeProductIds:c=[]}=e,[d,o]=(0,n.useState)([]),[m,u]=(0,n.useState)([]),[x,h]=(0,n.useState)(""),[g,p]=(0,n.useState)("all"),[v,b]=(0,n.useState)(!1),[j,f]=(0,n.useState)(null),[y,N]=(0,n.useState)(""),[_,w]=(0,n.useState)(0),[D,C]=(0,n.useState)(1),[k,S]=(0,n.useState)(!1);(0,n.useEffect)(()=>{t&&(P(),O())},[t]);let P=async()=>{b(!0);try{let{data:e,error:t}=await l.OQ.from("products").select("\n          *,\n          category:product_categories(*),\n          variations:product_variations(*)\n        ").eq("is_available",!0).order("display_order",{ascending:!0});if(t)throw t;o(e||[])}catch(e){console.error("商品の取得に失敗しました:",e)}finally{b(!1)}},O=async()=>{try{let{data:e,error:t}=await l.OQ.from("product_categories").select("*").eq("is_active",!0).order("display_order",{ascending:!0});if(t)throw t;u(e||[])}catch(e){console.error("カテゴリの取得に失敗しました:",e)}},J=d.filter(e=>{var t;let s="all"===g||e.category_id===g,a=e.name.toLowerCase().includes(x.toLowerCase())||(null===(t=e.description)||void 0===t?void 0:t.toLowerCase().includes(x.toLowerCase())),n=!c.includes(e.id);return s&&a&&n}),F=e=>{e.variations&&e.variations.length>0?(f(e),N(e.variations[0].id),w(e.variations[0].price),C(1),S(!0)):L(e)},L=(e,t,s,a)=>{i(e,s||e.price,t,a||1),z()},z=()=>{h(""),p("all"),f(null),N(""),w(0),C(1),S(!1),s()},E=e=>{var t;N(e);let s=null==j?void 0:null===(t=j.variations)||void 0===t?void 0:t.find(t=>t.id===e);s&&w(s.price)};return t?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg max-w-5xl w-full max-h-[90vh] overflow-hidden",children:[(0,a.jsxs)("div",{className:"p-6 border-b border-gray-200",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,a.jsxs)("h3",{className:"text-xl font-semibold text-gray-900 flex items-center space-x-2",children:[(0,a.jsx)(r.JO,{icon:r.PJ.packageIcon,size:"lg"}),(0,a.jsx)("span",{children:"商品を選択"})]}),(0,a.jsx)("button",{onClick:z,className:"p-2 text-gray-400 hover:text-gray-600 transition-colors",children:(0,a.jsx)(r.JO,{icon:r.PJ.closeIcon,size:"md"})})]}),(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4",children:[(0,a.jsxs)("div",{className:"flex-1 relative",children:[(0,a.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,a.jsx)(r.JO,{icon:r.PJ.searchIcon,size:"sm",className:"text-gray-400"})}),(0,a.jsx)("input",{type:"text",placeholder:"商品名で検索...",value:x,onChange:e=>h(e.target.value),className:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),(0,a.jsxs)("select",{value:g,onChange:e=>p(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[(0,a.jsx)("option",{value:"all",children:"全カテゴリ"}),m.map(e=>(0,a.jsx)("option",{value:e.id,children:e.name},e.id))]}),(0,a.jsx)("button",{onClick:P,disabled:v,className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors disabled:opacity-50",children:(0,a.jsx)(r.JO,{icon:r.PJ.refresh,size:"sm"})})]})]}),(0,a.jsx)("div",{className:"p-6 overflow-y-auto",style:{maxHeight:"calc(90vh - 200px)"},children:v?(0,a.jsxs)("div",{className:"flex items-center justify-center py-12",children:[(0,a.jsx)(r.JO,{icon:r.PJ.loading,size:"lg",className:"animate-spin text-blue-500"}),(0,a.jsx)("span",{className:"ml-2 text-gray-600",children:"商品を読み込み中..."})]}):J.length>0?(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:J.map(e=>{var t;return(0,a.jsxs)("div",{className:"border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow cursor-pointer",onClick:()=>F(e),children:[(0,a.jsx)("div",{className:"w-full h-32 bg-gray-100 rounded-lg mb-3 flex items-center justify-center",children:(0,a.jsx)(r.JO,{icon:r.PJ.packageIcon,size:"xl",className:"text-gray-400"})}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("h4",{className:"font-medium text-gray-900 line-clamp-2",children:e.name}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:null===(t=e.category)||void 0===t?void 0:t.name}),e.description&&(0,a.jsx)("p",{className:"text-sm text-gray-600 line-clamp-2",children:e.description}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"text-lg font-bold text-blue-600",children:["\xa5",e.price.toLocaleString()]}),e.variations&&e.variations.length>0&&(0,a.jsxs)("div",{className:"text-xs text-gray-500",children:[e.variations.length,"種類の選択肢"]})]}),(0,a.jsx)("div",{className:"flex items-center space-x-2",children:void 0!==e.stock_quantity&&null!==e.stock_quantity&&(0,a.jsxs)("span",{className:"text-xs px-2 py-1 rounded ".concat(e.stock_quantity>10?"bg-green-100 text-green-800":e.stock_quantity>0?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"),children:["在庫: ",e.stock_quantity]})})]}),(0,a.jsx)("button",{className:"w-full bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium",onClick:t=>{t.stopPropagation(),F(e)},children:e.variations&&e.variations.length>0?"詳細設定":"追加"})]})]},e.id)})}):(0,a.jsxs)("div",{className:"text-center py-12",children:[(0,a.jsx)(r.JO,{icon:r.PJ.searchIcon,size:"xl",className:"text-gray-400 mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-gray-600",children:"条件に合う商品が見つかりません"}),(0,a.jsx)("p",{className:"text-sm text-gray-500 mt-2",children:"検索条件を変更してお試しください"})]})})]})}),k&&j&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-60 p-4",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg max-w-md w-full",children:[(0,a.jsx)("div",{className:"p-6 border-b border-gray-200",children:(0,a.jsx)("h4",{className:"text-lg font-semibold text-gray-900",children:"商品設定"})}),(0,a.jsxs)("div",{className:"p-6 space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h5",{className:"font-medium text-gray-900 mb-2",children:j.name}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:j.description})]}),j.variations&&j.variations.length>0&&(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"バリエーション"}),(0,a.jsx)("select",{value:y,onChange:e=>E(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:j.variations.map(e=>(0,a.jsxs)("option",{value:e.id,children:[e.name," - \xa5",e.price.toLocaleString()]},e.id))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"価格"}),(0,a.jsx)("input",{type:"number",value:_,onChange:e=>w(Number(e.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",min:"0"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"デフォルト数量"}),(0,a.jsx)("input",{type:"number",value:D,onChange:e=>C(Number(e.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",min:"1"})]})]}),(0,a.jsxs)("div",{className:"p-6 pt-0 flex justify-end space-x-3",children:[(0,a.jsx)("button",{onClick:()=>S(!1),className:"px-4 py-2 text-gray-700 bg-gray-200 rounded-lg hover:bg-gray-300 transition-colors",children:"キャンセル"}),(0,a.jsx)("button",{onClick:()=>{if(j){var e;let t=null===(e=j.variations)||void 0===e?void 0:e.find(e=>e.id===y);L(j,null==t?void 0:t.name,_,D)}S(!1)},className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"追加"})]})]})})]}):null};let v=e=>{let{isOpen:t,title:s,message:n,confirmText:i="実行",cancelText:l="キャンセル",confirmButtonVariant:c="danger",onConfirm:d,onCancel:o,isLoading:m=!1,icon:u="warning"}=e;return t?(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onKeyDown:e=>{"Escape"===e.key?o():"Enter"!==e.key||m||d()},onClick:e=>{e.target===e.currentTarget&&o()},children:(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full mx-4 transform transition-all",role:"dialog","aria-modal":"true","aria-labelledby":"dialog-title","aria-describedby":"dialog-message",children:[(0,a.jsx)("div",{className:"p-6 pb-0",children:(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsxs)("div",{className:"flex-shrink-0 ".concat((()=>{switch(c){case"danger":default:return"text-red-500";case"warning":return"text-yellow-500";case"primary":return"text-blue-500";case"success":return"text-green-500"}})()),children:["delete"===u&&(0,a.jsx)(r.JO,{icon:r.PJ.delete,size:"lg"}),"warning"===u&&(0,a.jsx)(r.JO,{icon:r.PJ.warning,size:"lg"}),"success"===u&&(0,a.jsx)(r.JO,{icon:r.PJ.success,size:"lg"}),"error"===u&&(0,a.jsx)(r.JO,{icon:r.PJ.error,size:"lg"}),"info"===u&&(0,a.jsx)(r.JO,{icon:r.PJ.info,size:"lg"}),!["delete","warning","success","error","info"].includes(u)&&(0,a.jsx)(r.JO,{icon:r.PJ.alert,size:"lg"})]}),(0,a.jsx)("div",{children:(0,a.jsx)("h3",{id:"dialog-title",className:"text-lg font-semibold text-gray-900",children:s})})]})}),(0,a.jsx)("div",{className:"p-6 pt-4",children:(0,a.jsx)("p",{id:"dialog-message",className:"text-gray-600 leading-relaxed",children:n})}),(0,a.jsxs)("div",{className:"p-6 pt-0 flex justify-end space-x-3",children:[(0,a.jsx)("button",{type:"button",onClick:o,disabled:m,className:"px-4 py-2 text-gray-700 bg-gray-200 rounded-md font-medium hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:l}),(0,a.jsx)("button",{type:"button",onClick:d,disabled:m,className:(()=>{let e="px-4 py-2 rounded-md font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed";switch(c){case"danger":default:return"".concat(e," bg-red-600 text-white hover:bg-red-700 focus:ring-red-500");case"warning":return"".concat(e," bg-yellow-600 text-white hover:bg-yellow-700 focus:ring-yellow-500");case"primary":return"".concat(e," bg-blue-600 text-white hover:bg-blue-700 focus:ring-blue-500");case"success":return"".concat(e," bg-green-600 text-white hover:bg-green-700 focus:ring-green-500")}})(),children:m?(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(r.JO,{icon:r.PJ.loading,size:"sm",className:"animate-spin"}),(0,a.jsx)("span",{children:"処理中..."})]}):i})]})]})}):null},b=e=>{let{isOpen:t,title:s="削除の確認",itemName:n="この項目",onConfirm:i,onCancel:r,isLoading:l=!1}=e;return(0,a.jsx)(v,{isOpen:t,title:s,message:"".concat(n,"を削除しますか？この操作は取り消すことができません。"),confirmText:"削除",cancelText:"キャンセル",confirmButtonVariant:"danger",onConfirm:i,onCancel:r,isLoading:l,icon:"delete"})},j={customer_name:{id:"customer_name",type:"text",label:"氏名",placeholder:"山田 太郎",required:!0,description:"フルネームでご記入ください",category:"customer"},customer_furigana:{id:"customer_furigana",type:"text",label:"フリガナ",placeholder:"ヤマダ タロウ",required:!1,description:"カタカナでご記入ください",category:"customer"},customer_phone:{id:"customer_phone",type:"tel",label:"電話番号",placeholder:"090-1234-5678",required:!0,description:"緊急時のご連絡先",category:"customer"},customer_postal_code:{id:"customer_postal_code",type:"text",label:"郵便番号",placeholder:"123-4567",required:!1,category:"customer"},customer_address:{id:"customer_address",type:"textarea",label:"住所",placeholder:"東京都渋谷区...",required:!1,category:"customer"},customer_birth_date:{id:"customer_birth_date",type:"date",label:"生年月日",required:!1,category:"customer"},customer_gender:{id:"customer_gender",type:"radio",label:"性別",required:!1,options:["男性","女性","その他","回答しない"],category:"customer"},reservation_date:{id:"reservation_date",type:"date",label:"受取希望日",required:!0,description:"商品をお受け取りいただく日をお選びください",category:"reservation"},special_requests:{id:"special_requests",type:"textarea",label:"ご要望・備考",placeholder:"その他ご要望がございましたらご記入ください",required:!1,category:"other"}};function f(){var e;let{formId:t,onFormSaved:s}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},[i,c]=(0,n.useState)({id:t||"form-".concat(Date.now()),name:"商品予約フォーム",description:"片桐商店 ベジライスの商品予約を承ります",fields:Object.values(j).map(e=>({...e,enabled:!0})),products:[],settings:{showProgress:!0,allowEdit:!0,confirmationMessage:"ご予約ありがとうございました。確認のお電話をさせていただきます。",businessName:"片桐商店 ベジライス",validFrom:void 0,validTo:void 0,isActive:!0}}),[d,o]=(0,n.useState)(!1),[m,u]=(0,n.useState)([]),[x,h]=(0,n.useState)([]),[v,f]=(0,n.useState)(!1),[y,N]=(0,n.useState)(!1),[_,w]=(0,n.useState)(""),[D,C]=(0,n.useState)("all"),[k,S]=(0,n.useState)(null);(0,n.useEffect)(()=>{O(),J(),t&&P()},[t]);let P=async()=>{if(t)try{let{data:e,error:s}=await l.OQ.from("forms").select("\n          *,\n          form_fields(*),\n          form_products(\n            *,\n            product:products(\n              *,\n              category:product_categories(*)\n            )\n          )\n        ").eq("id",t).single();if(s)throw s;if(e){let t={id:e.id,name:e.name,description:e.description,fields:(e.form_fields||[]).map(e=>({id:e.field_id,type:e.field_type,label:e.label,placeholder:e.placeholder,required:e.is_required,options:e.options,description:e.description,category:e.category||"other",enabled:e.is_enabled})),products:(e.form_products||[]).map(e=>{var t;return{id:e.product.id,name:e.product.name,category_name:null===(t=e.product.category)||void 0===t?void 0:t.name,price:e.product.price,variation_name:e.variation_name,selected_price:e.selected_price||e.product.price,selected_variation:e.variation_name}}),settings:{showProgress:e.show_progress||!0,allowEdit:e.allow_edit||!0,confirmationMessage:e.confirmation_message||"ご予約ありがとうございました。",businessName:e.business_name||"",validFrom:e.valid_from,validTo:e.valid_to,isActive:e.is_active}};c(t)}}catch(e){console.error("フォーム設定の読み込みに失敗しました:",e)}},O=async()=>{try{let{data:e,error:t}=await l.OQ.from("products").select("\n          *,\n          category:product_categories(*)\n        ").eq("is_available",!0).order("display_order",{ascending:!0});if(t)throw t;u(e||[])}catch(e){console.error("商品の取得に失敗しました:",e)}},J=async()=>{try{let{data:e,error:t}=await l.OQ.from("product_categories").select("*").eq("is_active",!0).order("display_order",{ascending:!0});if(t)throw t;h(e||[])}catch(e){console.error("カテゴリの取得に失敗しました:",e)}},F=e=>{c({...i,fields:i.fields.map(t=>t.id===e?{...t,enabled:!t.enabled}:t)})},L=e=>{S(e)},z=async()=>{o(!0);try{let{data:e,error:t}=await l.OQ.from("forms").upsert({id:i.id,name:i.name,description:i.description,show_progress:i.settings.showProgress,allow_edit:i.settings.allowEdit,confirmation_message:i.settings.confirmationMessage,business_name:i.settings.businessName,valid_from:i.settings.validFrom||null,valid_to:i.settings.validTo||null,is_active:i.settings.isActive,updated_at:new Date().toISOString()}).select().single();if(t)throw t;if(await l.OQ.from("form_fields").delete().eq("form_id",i.id),await l.OQ.from("form_products").delete().eq("form_id",i.id),i.fields.length>0){let e=i.fields.map((e,t)=>({form_id:i.id,field_id:e.id,field_type:e.type,label:e.label,placeholder:e.placeholder,is_required:e.required,options:e.options,description:e.description,category:e.category,is_enabled:e.enabled,display_order:t})),{error:t}=await l.OQ.from("form_fields").insert(e);if(t)throw t}if(i.products.length>0){let e=i.products.map((e,t)=>({form_id:i.id,product_id:e.id,selected_price:e.selected_price,variation_name:e.selected_variation,display_order:t})),{error:t}=await l.OQ.from("form_products").insert(e);if(t)throw t}s&&s(i.id),alert("フォーム設定を保存しました")}catch(e){console.error("フォーム設定の保存に失敗しました:",e),alert("フォーム設定の保存に失敗しました。もう一度お試しください。")}finally{o(!1)}};m.filter(e=>{let t="all"===D||e.category_id===D,s=e.name.toLowerCase().includes(_.toLowerCase()),a=!i.products.find(t=>t.id===e.id);return t&&s&&a});let E={customer:{title:"顧客情報",icon:r.PJ.customerInfo},reservation:{title:"予約情報",icon:r.PJ.reservationInfo},other:{title:"その他",icon:r.PJ.otherInfo}},T=()=>{let e=window.location.origin;return"".concat(e,"/form/").concat(i.id)};return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-gray-800",children:"予約フォーム設定"}),(0,a.jsx)("p",{className:"text-gray-600",children:"フォーム項目と予約対象商品を設定します"})]}),(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsxs)("button",{onClick:()=>N(!y),className:"btn-modern btn-outline-modern flex items-center space-x-2",children:[(0,a.jsx)(r.JO,{icon:r.PJ.qrIcon,size:"sm"}),(0,a.jsx)("span",{children:"QRコード表示"})]}),(0,a.jsx)("button",{onClick:z,disabled:d,className:"btn-modern btn-success-modern flex items-center space-x-2 disabled:opacity-50 disabled:cursor-not-allowed",children:d?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(r.JO,{icon:r.PJ.loading,size:"sm",className:"animate-spin"}),(0,a.jsx)("span",{children:"保存中..."})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(r.JO,{icon:r.PJ.saveIcon,size:"sm"}),(0,a.jsx)("span",{children:"設定を保存"})]})})]})]}),y&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold",children:"フォームQRコード"}),(0,a.jsx)("button",{onClick:()=>N(!1),className:"btn-modern btn-ghost-modern btn-sm",children:(0,a.jsx)(r.JO,{icon:r.PJ.closeIcon,size:"sm"})})]}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("img",{src:(()=>{let e=T();return"https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=".concat(encodeURIComponent(e))})(),alt:"フォームQRコード",className:"mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-sm text-gray-600 mb-3",children:"このQRコードで予約フォームにアクセスできます"}),(0,a.jsx)("div",{className:"text-xs bg-gray-100 p-2 rounded break-all",children:T()}),(0,a.jsx)("button",{onClick:()=>navigator.clipboard.writeText(T()),className:"btn-modern btn-secondary-modern mt-3",children:"URLをコピー"})]})]})}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"admin-card",children:[(0,a.jsx)("div",{className:"admin-card-header",children:(0,a.jsx)("h3",{className:"admin-card-title",children:"基本設定"})}),(0,a.jsxs)("div",{className:"admin-card-content space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"フォーム名"}),(0,a.jsx)("input",{type:"text",value:i.name,onChange:e=>c({...i,name:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"説明文"}),(0,a.jsx)("textarea",{value:i.description,onChange:e=>c({...i,description:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",rows:3})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"受付開始日時"}),(0,a.jsx)("input",{type:"datetime-local",value:i.settings.validFrom||"",onChange:e=>c({...i,settings:{...i.settings,validFrom:e.target.value||void 0}}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"受付終了日時"}),(0,a.jsx)("input",{type:"datetime-local",value:i.settings.validTo||"",onChange:e=>c({...i,settings:{...i.settings,validTo:e.target.value||void 0}}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"flex items-center",children:[(0,a.jsx)("input",{type:"checkbox",checked:i.settings.isActive,onChange:e=>c({...i,settings:{...i.settings,isActive:e.target.checked}}),className:"mr-2"}),"フォームを有効にする"]}),(0,a.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:"無効にするとフォームにアクセスできなくなります"})]})]})]}),(0,a.jsxs)("div",{className:"admin-card",children:[(0,a.jsx)("div",{className:"admin-card-header",children:(0,a.jsx)("h3",{className:"admin-card-title",children:"フォーム項目設定"})}),(0,a.jsx)("div",{className:"admin-card-content",children:Object.entries(E).map(e=>{let[t,s]=e;return(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsxs)("h4",{className:"flex items-center gap-2 font-medium text-gray-900 mb-3",children:[(0,a.jsx)(r.JO,{icon:s.icon,size:"sm"}),s.title]}),(0,a.jsx)("div",{className:"space-y-2",children:i.fields.filter(e=>e.category===t).map(e=>(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-medium",children:e.label}),(0,a.jsxs)("div",{className:"text-sm text-gray-500",children:[e.type," ",e.required&&"(必須)"]})]}),(0,a.jsxs)("label",{className:"relative inline-flex items-center cursor-pointer",children:[(0,a.jsx)("input",{type:"checkbox",checked:e.enabled,onChange:()=>F(e.id),className:"sr-only peer"}),(0,a.jsx)("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})]},e.id))})]},t)})})]}),(0,a.jsxs)("div",{className:"admin-card",children:[(0,a.jsx)("div",{className:"admin-card-header",children:(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("h3",{className:"admin-card-title",children:"予約対象商品"}),(0,a.jsxs)("button",{onClick:()=>f(!0),className:"btn-modern btn-primary-modern btn-sm flex items-center space-x-2",children:[(0,a.jsx)(r.JO,{icon:r.PJ.packageIcon,size:"sm"}),(0,a.jsx)("span",{children:"商品を追加"})]})]})}),(0,a.jsx)("div",{className:"admin-card-content",children:i.products.length>0?(0,a.jsx)("div",{className:"space-y-3",children:i.products.map(e=>{var t;return(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-medium",children:e.name}),(0,a.jsxs)("div",{className:"text-sm text-gray-500",children:["\xa5",null===(t=e.selected_price)||void 0===t?void 0:t.toLocaleString(),e.selected_variation&&" (".concat(e.selected_variation,")"),e.category_name&&" - ".concat(e.category_name)]})]}),(0,a.jsx)("button",{onClick:()=>L(e.id),className:"btn-modern btn-danger-modern btn-sm btn-icon-only",children:(0,a.jsx)(r.JO,{icon:r.PJ.deleteIcon,size:"sm"})})]},e.id)})}):(0,a.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,a.jsx)("div",{className:"mb-4",children:(0,a.jsx)(r.JO,{icon:r.PJ.packageIcon,size:"xl",className:"mx-auto text-gray-400"})}),(0,a.jsx)("p",{children:"予約対象商品が設定されていません"}),(0,a.jsx)("p",{className:"text-sm",children:"「商品を追加」ボタンから商品を選択してください"})]})})]})]}),(0,a.jsxs)("div",{className:"admin-card",children:[(0,a.jsxs)("div",{className:"admin-card-header",children:[(0,a.jsx)("h3",{className:"admin-card-title",children:"フォームプレビュー"}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"実際のフォーム画面と同じ表示・機能です"})]}),(0,a.jsx)("div",{className:"admin-card-content",children:(0,a.jsx)(g.Z,{formConfig:i})})]})]}),(0,a.jsx)(p,{isOpen:v,onClose:()=>f(!1),onProductSelect:(e,t,s,a)=>{var n;let r={id:e.id,name:e.name,category_name:null===(n=e.category)||void 0===n?void 0:n.name,price:e.price,variation_name:e.variation_name,selected_price:t||e.price,selected_variation:s||e.variation_name};c({...i,products:[...i.products,r]}),f(!1)},excludeProductIds:i.products.map(e=>e.id)}),(0,a.jsx)(b,{isOpen:!!k,title:"商品の削除",itemName:k?(null===(e=i.products.find(e=>e.id===k))||void 0===e?void 0:e.name)||"選択された商品":"",onConfirm:()=>{k&&(c({...i,products:i.products.filter(e=>e.id!==k)}),S(null))},onCancel:()=>S(null)})]})}function y(){let[e,t]=(0,n.useState)([]),[s,i]=(0,n.useState)(!0),[r,l]=(0,n.useState)("all");(0,n.useEffect)(()=>{c()},[]);let c=async()=>{try{let e=await x.getAllForms();t(e)}catch(e){console.error("フォーム一覧の取得に失敗しました:",e),t([])}finally{i(!1)}},d=async(s,a)=>{try{await x.toggleFormStatus(s,!a),t(e.map(e=>e.id===s?{...e,is_active:!a}:e))}catch(e){console.error("フォームステータスの更新に失敗しました:",e),alert("フォームステータスの更新に失敗しました。")}},o=async s=>{if(confirm("このフォームを削除しますか？この操作は元に戻せません。"))try{await x.deleteForm(s),t(e.filter(e=>e.id!==s)),alert("フォームが削除されました。")}catch(e){console.error("フォームの削除に失敗しました:",e),alert("フォームの削除に失敗しました。")}},m=e.filter(e=>"all"===r||("active"===r?e.is_active:"inactive"!==r||!e.is_active)),u=e=>{let t={inactive:{bg:"bg-gray-100",text:"text-gray-800",label:"無効"},pending:{bg:"bg-blue-100",text:"text-blue-800",label:"開始前"},expired:{bg:"bg-red-100",text:"text-red-800",label:"期限切れ"},active:{bg:"bg-green-100",text:"text-green-800",label:"公開中"}}[x.getFormStatus(e)];return(0,a.jsx)("span",{className:"px-2 py-1 text-xs font-medium rounded-full ".concat(t.bg," ").concat(t.text),children:t.label})},h=e=>x.getValidityPeriodText(e.valid_from,e.valid_to);return s?(0,a.jsx)("div",{className:"flex justify-center items-center h-64",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-gray-800",children:"フォーム一覧"}),(0,a.jsx)("p",{className:"text-gray-600",children:"作成済みのフォームを管理できます"})]}),(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsxs)("select",{value:r,onChange:e=>l(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,a.jsx)("option",{value:"all",children:"すべて"}),(0,a.jsx)("option",{value:"active",children:"有効"}),(0,a.jsx)("option",{value:"inactive",children:"無効"})]}),(0,a.jsxs)("button",{onClick:()=>window.location.href="/admin?page=form-builder",className:"btn-modern btn-primary-modern flex items-center gap-2",children:[(0,a.jsx)("span",{className:"text-lg",children:"\uD83D\uDEE0️"}),"新しいフォーム"]})]})]}),(0,a.jsxs)("div",{className:"admin-stats-grid",children:[(0,a.jsxs)("div",{className:"admin-widget green",children:[(0,a.jsxs)("div",{className:"admin-widget-header",children:[(0,a.jsx)("div",{className:"admin-widget-title",children:"有効なフォーム"}),(0,a.jsx)("div",{className:"admin-widget-icon",children:"✅"})]}),(0,a.jsx)("div",{className:"admin-widget-value",children:e.filter(e=>e.is_active).length})]}),(0,a.jsxs)("div",{className:"admin-widget blue",children:[(0,a.jsxs)("div",{className:"admin-widget-header",children:[(0,a.jsx)("div",{className:"admin-widget-title",children:"総フォーム数"}),(0,a.jsx)("div",{className:"admin-widget-icon",children:"\uD83D\uDCDD"})]}),(0,a.jsx)("div",{className:"admin-widget-value",children:e.length})]}),(0,a.jsxs)("div",{className:"admin-widget purple",children:[(0,a.jsxs)("div",{className:"admin-widget-header",children:[(0,a.jsx)("div",{className:"admin-widget-title",children:"総回答数"}),(0,a.jsx)("div",{className:"admin-widget-icon",children:"\uD83D\uDCCA"})]}),(0,a.jsx)("div",{className:"admin-widget-value",children:e.reduce((e,t)=>e+t.response_count,0)})]}),(0,a.jsxs)("div",{className:"admin-widget orange",children:[(0,a.jsxs)("div",{className:"admin-widget-header",children:[(0,a.jsx)("div",{className:"admin-widget-title",children:"平均フィールド数"}),(0,a.jsx)("div",{className:"admin-widget-icon",children:"\uD83D\uDCCB"})]}),(0,a.jsx)("div",{className:"admin-widget-value",children:e.length>0?Math.round(e.reduce((e,t)=>e+t.field_count,0)/e.length):0})]})]}),(0,a.jsx)("div",{className:"space-y-4",children:m.map(e=>(0,a.jsx)("div",{className:"admin-card",children:(0,a.jsx)("div",{className:"admin-card-content",children:(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:e.name}),u(e)]}),(0,a.jsx)("p",{className:"text-gray-600 mb-4",children:e.description}),(0,a.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-500",children:"フィールド数:"}),(0,a.jsxs)("span",{className:"font-medium ml-1",children:[e.field_count,"個"]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-500",children:"回答数:"}),(0,a.jsxs)("span",{className:"font-medium ml-1 text-blue-600",children:[e.response_count,"件"]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-500",children:"有効期間:"}),(0,a.jsx)("span",{className:"font-medium ml-1",children:h(e)})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-500",children:"更新日:"}),(0,a.jsx)("span",{className:"font-medium ml-1",children:new Date(e.updated_at).toLocaleDateString("ja-JP")})]})]})]}),(0,a.jsxs)("div",{className:"flex gap-2 ml-4",children:[(0,a.jsx)("button",{onClick:()=>window.location.href="/admin?page=form-builder&id=".concat(e.id),className:"btn-modern btn-outline-modern btn-sm",title:"フォームを編集",children:"✏️ 編集"}),(0,a.jsx)("button",{onClick:()=>window.open("/form/".concat(e.id),"_blank"),className:"btn-modern btn-secondary-modern btn-sm",title:"フォームをプレビュー",children:"\uD83D\uDC41️ プレビュー"}),(0,a.jsx)("button",{onClick:()=>d(e.id,e.is_active),className:"btn-modern btn-sm ".concat(e.is_active?"btn-warning-modern":"btn-success-modern"),title:e.is_active?"フォームを無効にする":"フォームを有効にする",children:e.is_active?"⏸️":"▶️"}),(0,a.jsx)("button",{onClick:()=>o(e.id),className:"btn-modern btn-danger-modern btn-sm",title:"フォームを削除",children:"\uD83D\uDDD1️"})]})]})})},e.id))}),0===m.length&&(0,a.jsx)("div",{className:"admin-card",children:(0,a.jsxs)("div",{className:"text-center py-12",children:[(0,a.jsx)("div",{className:"text-6xl mb-4",children:"\uD83D\uDCDD"}),(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"フォームが見つかりません"}),(0,a.jsxs)("p",{className:"text-gray-600 mb-6",children:["all"!==r?"".concat("active"===r?"有効な":"無効な","フォームはありません。"):"まだフォームが作成されていません。",(0,a.jsx)("br",{}),"新しいフォームを作成してください。"]}),(0,a.jsx)("button",{onClick:()=>window.location.href="/admin?page=form-builder",className:"btn-modern btn-primary-modern",children:"\uD83D\uDEE0️ 新しいフォームを作成"})]})})]})}var N=s(9703);function _(){let{showSuccess:e,showError:t}=(0,N.p)(),[s,i]=(0,n.useState)([]),[r,c]=(0,n.useState)([]),[d,o]=(0,n.useState)(!0),[m,u]=(0,n.useState)("all"),[x,h]=(0,n.useState)(""),[g,p]=(0,n.useState)(!1);(0,n.useEffect)(()=>{v(),b()},[]);let v=async()=>{try{let{data:e,error:t}=await l.OQ.from("products").select("\n          *,\n          category:product_categories(*)\n        ").order("display_order",{ascending:!0});if(t)throw t;i(e||[])}catch(e){console.error("商品の取得に失敗しました:",e),i([])}finally{o(!1)}},b=async()=>{try{let{data:e,error:t}=await l.OQ.from("product_categories").select("*").eq("is_active",!0).order("display_order",{ascending:!0});if(t)throw t;c(e||[])}catch(e){console.error("カテゴリの取得に失敗しました:",e),c([])}},j=async(e,a)=>{try{let{error:t}=await l.OQ.from("products").update({is_available:!a}).eq("id",e);if(t)throw t;i(s.map(t=>t.id===e?{...t,is_available:!a}:t))}catch(e){console.error("商品ステータスの更新に失敗しました:",e),t("ステータス更新に失敗しました",(null==e?void 0:e.message)||"商品ステータスの更新中にエラーが発生しました。")}},f=async a=>{if(confirm("この商品を削除しますか？"))try{let{error:t}=await l.OQ.from("products").delete().eq("id",a);if(t)throw t;i(s.filter(e=>e.id!==a)),e("商品を削除しました","商品が正常に削除されました。")}catch(e){console.error("商品の削除に失敗しました:",e),t("商品の削除に失敗しました",(null==e?void 0:e.message)||"商品の削除中にエラーが発生しました。")}},y=s.filter(e=>{let t="all"===m||e.category_id===m,s=e.name.toLowerCase().includes(x.toLowerCase())||e.description&&e.description.toLowerCase().includes(x.toLowerCase());return t&&s});return d?(0,a.jsx)("div",{className:"flex justify-center items-center h-64",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-gray-800",children:"商品一覧"}),(0,a.jsx)("div",{className:"flex gap-3",children:(0,a.jsx)("button",{onClick:()=>window.location.href="/admin/products/add",className:"btn-modern btn-success-modern",children:"\uD83D\uDCE6 新規商品追加"})})]}),(0,a.jsx)("div",{className:"bg-white p-4 rounded-lg shadow-sm border",children:(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"カテゴリ"}),(0,a.jsxs)("select",{value:m,onChange:e=>u(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,a.jsx)("option",{value:"all",children:"すべてのカテゴリ"}),r.map(e=>(0,a.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"商品検索"}),(0,a.jsx)("input",{type:"text",value:x,onChange:e=>h(e.target.value),placeholder:"商品名で検索...",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,a.jsx)("div",{className:"flex items-end",children:(0,a.jsxs)("div",{className:"text-sm text-gray-600",children:[y.length," 件の商品"]})})]})}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border overflow-hidden",children:[(0,a.jsx)("div",{className:"hidden lg:block overflow-x-auto",children:(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"商品情報"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"カテゴリ"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"価格・単位"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"ステータス"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"アクション"})]})}),(0,a.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:y.map(e=>{var t;return(0,a.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,a.jsx)("td",{className:"px-6 py-4",children:(0,a.jsxs)("div",{className:"flex items-center",children:[e.image_url?(0,a.jsx)("img",{src:e.image_url,alt:e.name,className:"h-12 w-12 lg:h-16 lg:w-16 rounded-lg object-cover mr-4"}):(0,a.jsx)("div",{className:"h-12 w-12 lg:h-16 lg:w-16 bg-gray-200 rounded-lg flex items-center justify-center mr-4",children:(0,a.jsx)("span",{className:"text-lg lg:text-xl",children:"\uD83D\uDCE6"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.name}),e.description&&(0,a.jsx)("div",{className:"text-sm text-gray-500 max-w-xs sm:max-w-sm lg:max-w-xs truncate",children:e.description}),e.barcode&&(0,a.jsxs)("div",{className:"text-xs text-gray-400",children:["JAN: ",e.barcode]})]})]})}),(0,a.jsx)("td",{className:"px-6 py-4",children:(0,a.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:(null===(t=e.category)||void 0===t?void 0:t.name)||"未分類"})}),(0,a.jsxs)("td",{className:"px-6 py-4",children:[(0,a.jsxs)("div",{className:"text-sm text-gray-900",children:["\xa5",e.price.toLocaleString()]}),(0,a.jsx)("div",{className:"text-sm text-gray-500",children:e.unit}),e.variation_name&&(0,a.jsx)("div",{className:"text-xs text-gray-400",children:e.variation_name})]}),(0,a.jsx)("td",{className:"px-6 py-4",children:(0,a.jsx)("button",{onClick:()=>j(e.id,e.is_available),className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(e.is_available?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:e.is_available?"✓ 販売中":"✕ 停止中"})}),(0,a.jsx)("td",{className:"px-6 py-4",children:(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsx)("button",{onClick:()=>window.location.href="/admin/products/edit/".concat(e.id),className:"btn-modern btn-outline-modern btn-sm",children:"✏️ 編集"}),(0,a.jsx)("button",{onClick:()=>f(e.id),className:"btn-modern btn-danger-modern btn-sm",children:"\uD83D\uDDD1️ 削除"})]})})]},e.id)})})]})}),(0,a.jsx)("div",{className:"lg:hidden",children:(0,a.jsx)("div",{className:"divide-y divide-gray-200",children:y.map(e=>{var t;return(0,a.jsxs)("div",{className:"p-4 hover:bg-gray-50",children:[(0,a.jsxs)("div",{className:"flex items-center mb-3",children:[e.image_url?(0,a.jsx)("img",{src:e.image_url,alt:e.name,className:"h-12 w-12 sm:h-14 sm:w-14 rounded-lg object-cover mr-3"}):(0,a.jsx)("div",{className:"h-12 w-12 sm:h-14 sm:w-14 bg-gray-200 rounded-lg flex items-center justify-center mr-3",children:(0,a.jsx)("span",{className:"text-lg sm:text-xl",children:"\uD83D\uDCE6"})}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.name}),e.description&&(0,a.jsx)("div",{className:"text-sm text-gray-500 truncate",children:e.description}),(0,a.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[(0,a.jsx)("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:(null===(t=e.category)||void 0===t?void 0:t.name)||"未分類"}),(0,a.jsx)("button",{onClick:()=>j(e.id,e.is_available),className:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium ".concat(e.is_available?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:e.is_available?"✓ 販売中":"✕ 停止中"})]})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm mb-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-500",children:"価格:"}),(0,a.jsxs)("div",{className:"font-medium",children:["\xa5",e.price.toLocaleString()]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-500",children:"単位:"}),(0,a.jsx)("div",{children:e.unit})]}),e.barcode&&(0,a.jsxs)("div",{className:"col-span-2",children:[(0,a.jsx)("span",{className:"text-gray-500",children:"JAN:"}),(0,a.jsx)("div",{className:"text-xs",children:e.barcode})]}),e.variation_name&&(0,a.jsxs)("div",{className:"col-span-2",children:[(0,a.jsx)("span",{className:"text-gray-500",children:"バリエーション:"}),(0,a.jsx)("div",{className:"text-xs",children:e.variation_name})]})]}),(0,a.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,a.jsx)("button",{onClick:()=>window.location.href="/admin/products/edit/".concat(e.id),className:"btn-modern btn-outline-modern btn-sm text-xs px-3 py-1",children:"編集"}),(0,a.jsx)("button",{onClick:()=>f(e.id),className:"btn-modern btn-danger-modern btn-sm text-xs px-3 py-1",children:"削除"})]})]},e.id)})})})]}),0===y.length&&(0,a.jsxs)("div",{className:"text-center py-12",children:[(0,a.jsx)("div",{className:"text-6xl mb-4",children:"\uD83D\uDCE6"}),(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"商品が見つかりません"}),(0,a.jsx)("p",{className:"text-gray-500",children:"検索条件を変更するか、新しい商品を追加してください。"})]})]})}class w{static async getAllProducts(){let{data:e,error:t}=await l.OQ.from("products").select("\n        *,\n        product_categories (\n          id,\n          name,\n          color\n        )\n      ").order("created_at",{ascending:!1});if(t)throw t;return e||[]}static async getActiveProducts(){let{data:e,error:t}=await l.OQ.from("products").select("\n        *,\n        product_categories (\n          id,\n          name,\n          color\n        )\n      ").eq("is_available",!0).order("display_order",{ascending:!0});if(t)throw t;return e||[]}static async getProductsByCategory(e){let{data:t,error:s}=await l.OQ.from("products").select("\n        *,\n        product_categories (\n          id,\n          name,\n          color\n        )\n      ").eq("category_id",e).eq("is_available",!0).order("display_order",{ascending:!0});if(s)throw s;return t||[]}static async createProduct(e){let{data:t,error:s}=await l.OQ.from("products").insert([{...e,category_id:e.category_id||null,tax_type:e.tax_type||"inclusive",is_available:!1!==e.is_available,display_order:e.display_order||0}]).select();if(s)throw s;return t[0]}static async updateProduct(e,t){let{data:s,error:a}=await l.OQ.from("products").update({...t,category_id:t.category_id||null}).eq("id",e).select();if(a)throw a;return s[0]}static async deleteProduct(e){let{error:t}=await l.OQ.from("products").delete().eq("id",e);if(t)throw t;return!0}static async getAllCategories(){let{data:e,error:t}=await l.OQ.from("product_categories").select("*").eq("is_active",!0).order("display_order",{ascending:!0});if(t)throw t;return e||[]}static async bulkImportProducts(e){let t={success:0,failed:0,errors:[],warnings:[]},s=[];for(let a=0;a<e.length;a++){let n=e[a],i=a+2;if(!n.name||""===n.name.trim()){t.failed++,t.errors.push("行".concat(i,": 商品名が入力されていません"));continue}void 0!==n.price&&(isNaN(Number(n.price))||0>Number(n.price))&&(t.warnings.push("行".concat(i,": 価格が無効です。0に設定されます")),n.price=0),!n.id&&await this.getProductByName(n.name.trim())&&t.warnings.push("行".concat(i,": 商品「").concat(n.name,"」は既に存在します")),s.push({...n,lineNumber:i})}for(let e of s)try{var a,n,i,r,l,c;if(e.id){if(!await this.getProductById(e.id)){t.failed++,t.errors.push("行".concat(e.lineNumber,": ID「").concat(e.id,"」の商品が見つかりません"));continue}await this.updateProduct(e.id,{name:e.name.trim(),barcode:(null===(a=e.barcode)||void 0===a?void 0:a.trim())||void 0,price:e.price||0,variation_name:(null===(n=e.variation_name)||void 0===n?void 0:n.trim())||void 0,tax_type:e.tax_type||"inclusive",category_id:e.category_id||void 0,description:(null===(i=e.description)||void 0===i?void 0:i.trim())||void 0})}else await this.createProduct({name:e.name.trim(),barcode:(null===(r=e.barcode)||void 0===r?void 0:r.trim())||void 0,price:e.price||0,variation_name:(null===(l=e.variation_name)||void 0===l?void 0:l.trim())||void 0,tax_type:e.tax_type||"inclusive",category_id:e.category_id||void 0,description:(null===(c=e.description)||void 0===c?void 0:c.trim())||void 0,is_available:!0,display_order:0});t.success++}catch(a){t.failed++;let s=(null==a?void 0:a.message)||(null==a?void 0:a.toString())||"不明なエラー";t.errors.push("行".concat(e.lineNumber,": 商品「").concat(e.name,"」: ").concat(s))}return t}static async getProductByName(e){let{data:t,error:s}=await l.OQ.from("products").select("id, name").eq("name",e).limit(1);if(s)throw s;return(null==t?void 0:t[0])||null}static async getProductById(e){let{data:t,error:s}=await l.OQ.from("products").select("*").eq("id",e).limit(1);if(s)throw s;return(null==t?void 0:t[0])||null}static parseCSV(e){try{let t=e.trim().split("\n");if(t.length<2)throw Error("CSVファイルが空か、ヘッダー行しかありません");let s=t[0].split(",").map(e=>e.trim().replace(/^["']|["']$/g,"")),a=[],n=[],i=["name"].filter(e=>!s.some(t=>t.toLowerCase()===e.toLowerCase()));if(i.length>0)throw Error("必須の列が見つかりません: ".concat(i.join(", ")));for(let e=1;e<t.length;e++){let i=t[e].trim();if(!i)continue;let r=this.parseCSVLine(i),l={},c=!1;s.forEach((t,s)=>{var a;let i=(null===(a=r[s])||void 0===a?void 0:a.trim().replace(/^["']|["']$/g,""))||"";switch(t.toLowerCase()){case"id":i&&(l.id=i);break;case"name":i?l.name=i:(n.push("行".concat(e+1,": 商品名が入力されていません")),c=!0);break;case"barcode":i&&(l.barcode=i);break;case"price":if(i){let t=parseFloat(i);isNaN(t)||t<0?n.push("行".concat(e+1,": 価格「").concat(i,"」が無効です")):l.price=t}break;case"variation_name":i&&(l.variation_name=i);break;case"tax_type":if(i){let t=i.toLowerCase();"内税"===t||"inclusive"===t?l.tax_type="inclusive":"外税"===t||"exclusive"===t?l.tax_type="exclusive":["inclusive","exclusive"].includes(t)?l.tax_type=t:n.push("行".concat(e+1,": 税区分「").concat(i,"」が無効です（内税/外税 または inclusive/exclusiveのみ）"))}break;case"category_id":i&&(l.category_id=i);break;case"description":i&&(l.description=i)}}),!c&&l.name&&a.push(l)}if(n.length>0)throw Error("CSVに以下のエラーがあります:\n".concat(n.join("\n")));if(0===a.length)throw Error("有効な商品データが見つかりませんでした");return a}catch(e){throw Error("CSV解析エラー: ".concat(e.message))}}static parseCSVLine(e){let t=[],s="",a=!1;for(let n=0;n<e.length;n++){let i=e[n];'"'===i||"'"===i?a&&e[n+1]===i?(s+=i,n++):a=!a:","!==i||a?s+=i:(t.push(s),s="")}return t.push(s),t}static generateCSVTemplate(e){var t;return"id,name,barcode,price,variation_name,tax_type,category_id,description\n"+["","トマト苗","4901234567890","300","通常価格","inclusive",(null===(t=e[0])||void 0===t?void 0:t.id)||"","中玉トマトの苗"].join(",")}static async exportToCSV(){return["id,name,barcode,price,variation_name,tax_type,category_id,description",...(await this.getAllProducts()).map(e=>[e.id,'"'.concat(e.name,'"'),e.barcode||"",e.price,e.variation_name||"",e.tax_type||"",e.category_id||"",'"'.concat(e.description||"",'"')].join(","))].join("\n")}}function D(){let{showSuccess:e,showError:t,showWarning:s}=(0,N.p)(),[i,r]=(0,n.useState)([]),[l,c]=(0,n.useState)(!1),[d,o]=(0,n.useState)("single"),[m,u]=(0,n.useState)(null),[x,h]=(0,n.useState)(""),[g,p]=(0,n.useState)([]),[v,b]=(0,n.useState)(!1),[j,f]=(0,n.useState)({name:"",category_id:"",description:"",price:0,barcode:"",variation_name:"",tax_type:"inclusive",image_url:"",is_available:!0,display_order:0});(0,n.useEffect)(()=>{y()},[]);let y=async()=>{try{let e=await w.getAllCategories();r(e)}catch(e){console.error("カテゴリの取得に失敗しました:",e),t("カテゴリの取得に失敗しました","カテゴリ情報を読み込めませんでした。ページを再読み込みしてください。"),r([])}},_=async s=>{s.preventDefault(),c(!0);try{await w.createProduct({...j,category_id:j.category_id||void 0}),e("商品を追加しました","商品が正常に登録されました。"),f({name:"",category_id:"",description:"",price:0,barcode:"",variation_name:"",tax_type:"inclusive",image_url:"",is_available:!0,display_order:0})}catch(e){console.error("商品の追加に失敗しました:",e),t("商品の追加に失敗しました",(null==e?void 0:e.message)||"商品の登録中にエラーが発生しました。")}finally{c(!1)}},D=async()=>{if(m)try{let e=await m.text();if(h(e),m.size>10485760)throw Error("ファイルサイズが大きすぎます（10MB以下のファイルをアップロードしてください）");if(!m.name.toLowerCase().endsWith(".csv")&&!m.name.toLowerCase().endsWith(".txt"))throw Error("CSVファイル（.csv または .txt）をアップロードしてください");let t=w.parseCSV(e);p(t),b(!0),t.length>0&&console.log("✅ ".concat(t.length,"件の商品データを読み込みました"))}catch(s){console.error("CSVファイルの解析に失敗しました:",s);let e=(null==s?void 0:s.message)||"ファイルの読み込みに失敗しました";t("CSVファイルの解析に失敗しました","".concat(e,"\n\n以下を確認してください:\n- ファイル形式（CSV形式）\n- 文字エンコーディング（UTF-8推奨）\n- 必須列（name）の存在")),p([]),b(!1)}},C=async()=>{if(0!==g.length){c(!0);try{let e=await w.bulkImportProducts(g),t="処理結果:\n成功: ".concat(e.success,"件\n失敗: ").concat(e.failed,"件");e.warnings&&e.warnings.length>0&&(t+="\n\n⚠️ 警告:\n".concat(e.warnings.join("\n"))),e.errors.length>0&&(t+="\n\n❌ エラー:\n".concat(e.errors.join("\n"))),0===e.failed&&0===e.errors.length&&(t+="\n\n✅ すべての商品が正常に処理されました！"),confirm(t+"\n\n処理を完了しますか？")&&(u(null),h(""),p([]),b(!1))}catch(s){console.error("CSV インポートに失敗しました:",s);let e=(null==s?void 0:s.message)||(null==s?void 0:s.toString())||"不明なエラーが発生しました";t("CSV インポートに失敗しました","".concat(e,"\n\nCSVファイルの形式を確認してください。"))}finally{c(!1)}}},k=()=>w.generateCSVTemplate(i),S=async()=>{try{let e=await w.exportToCSV(),t=new Blob([e],{type:"text/csv;charset=utf-8;"}),s=document.createElement("a");s.href=URL.createObjectURL(t),s.download="products_export_".concat(new Date().toISOString().split("T")[0],".csv"),s.click()}catch(e){console.error("CSV エクスポートに失敗しました:",e),t("CSV エクスポートに失敗しました",(null==e?void 0:e.message)||"エクスポート処理中にエラーが発生しました。")}};return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-gray-800",children:"商品追加"}),(0,a.jsx)("p",{className:"text-gray-600",children:"新しい商品を登録または一括アップロードします"})]}),(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsxs)("button",{onClick:()=>{let e=new Blob([k()],{type:"text/csv;charset=utf-8;"}),t=document.createElement("a");t.href=URL.createObjectURL(e),t.download="product_template.csv",t.click()},className:"btn-modern btn-outline-modern flex items-center gap-2",title:"CSV形式のテンプレートファイルをダウンロード",children:[(0,a.jsx)("span",{className:"text-lg",children:"\uD83D\uDCC4"}),"CSVテンプレート"]}),(0,a.jsxs)("button",{onClick:S,className:"btn-modern btn-secondary-modern flex items-center gap-2",title:"現在の商品データをCSV形式でエクスポート",children:[(0,a.jsx)("span",{className:"text-lg",children:"\uD83D\uDCE4"}),"商品エクスポート"]})]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border",children:[(0,a.jsx)("div",{className:"border-b bg-gray-50",children:(0,a.jsxs)("nav",{className:"flex",children:[(0,a.jsxs)("button",{onClick:()=>o("single"),className:"px-6 py-4 text-sm font-medium border-b-2 transition-all duration-200 flex items-center gap-2 ".concat("single"===d?"border-blue-500 text-blue-600 bg-white":"border-transparent text-gray-500 hover:text-gray-700 hover:bg-gray-100"),children:[(0,a.jsx)("span",{className:"text-lg",children:"\uD83D\uDCDD"}),"単一商品追加",(0,a.jsx)("span",{className:"text-xs bg-blue-100 text-blue-600 px-2 py-1 rounded-full",children:"推奨"})]}),(0,a.jsxs)("button",{onClick:()=>o("csv"),className:"px-6 py-4 text-sm font-medium border-b-2 transition-all duration-200 flex items-center gap-2 ".concat("csv"===d?"border-blue-500 text-blue-600 bg-white":"border-transparent text-gray-500 hover:text-gray-700 hover:bg-gray-100"),children:[(0,a.jsx)("span",{className:"text-lg",children:"\uD83D\uDCCA"}),"CSV一括追加",(0,a.jsx)("span",{className:"text-xs bg-orange-100 text-orange-600 px-2 py-1 rounded-full",children:"上級者向け"})]})]})}),(0,a.jsx)("div",{className:"p-6",children:"single"===d?(0,a.jsxs)("form",{onSubmit:_,className:"space-y-6",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"商品名 *"}),(0,a.jsx)("input",{type:"text",value:j.name,onChange:e=>f({...j,name:e.target.value}),required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"カテゴリ"}),(0,a.jsxs)("select",{value:j.category_id,onChange:e=>f({...j,category_id:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,a.jsx)("option",{value:"",children:"カテゴリを選択"}),i.map(e=>(0,a.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"価格 *"}),(0,a.jsx)("input",{type:"number",value:j.price,onChange:e=>f({...j,price:Number(e.target.value)}),required:!0,min:"0",step:"0.01",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"JANコード"}),(0,a.jsx)("input",{type:"text",value:j.barcode,onChange:e=>f({...j,barcode:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"価格バリエーション名"}),(0,a.jsx)("input",{type:"text",value:j.variation_name,onChange:e=>f({...j,variation_name:e.target.value}),placeholder:"例: 通常価格、予約価格",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"税区分"}),(0,a.jsxs)("select",{value:j.tax_type,onChange:e=>f({...j,tax_type:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,a.jsx)("option",{value:"inclusive",children:"税込"}),(0,a.jsx)("option",{value:"exclusive",children:"税抜"})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"商品説明"}),(0,a.jsx)("textarea",{value:j.description,onChange:e=>f({...j,description:e.target.value}),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("input",{type:"checkbox",id:"is_available",checked:j.is_available,onChange:e=>f({...j,is_available:e.target.checked}),className:"mr-2"}),(0,a.jsx)("label",{htmlFor:"is_available",className:"text-sm font-medium text-gray-700",children:"販売中として追加"})]}),(0,a.jsxs)("div",{className:"flex justify-end gap-3",children:[(0,a.jsx)("button",{type:"button",onClick:()=>f({name:"",category_id:"",description:"",price:0,barcode:"",variation_name:"",tax_type:"inclusive",image_url:"",is_available:!0,display_order:0}),className:"btn-modern btn-secondary-modern",children:"リセット"}),(0,a.jsx)("button",{type:"submit",disabled:l,className:"btn-modern btn-success-modern flex items-center gap-2 px-6",children:l?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"追加中..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",{className:"text-lg",children:"✅"}),"商品を追加する"]})})]})]}):(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-blue-800 mb-2",children:"CSV形式について"}),(0,a.jsx)("p",{className:"text-sm text-blue-700 mb-3",children:"以下の列を含むCSVファイルをアップロードしてください："}),(0,a.jsxs)("div",{className:"text-sm text-blue-700 space-y-1",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"id:"})," 既存商品ID（更新時のみ）"]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"name:"})," 商品名（必須）"]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"barcode:"})," JANコード（任意）"]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"price:"})," 価格（任意、デフォルト0）"]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"variation_name:"})," 価格バリエーション名（任意）"]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"tax_type:"})," 税区分（任意、inclusive/exclusive）"]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"category_id:"})," カテゴリID（任意）"]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"description:"})," 商品説明（任意）"]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"CSVファイルをアップロード"}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)("input",{type:"file",accept:".csv,.txt",onChange:e=>{var t;let s=null===(t=e.target.files)||void 0===t?void 0:t[0];s&&(u(s),b(!1),p([]))},className:"hidden",id:"csv-upload"}),(0,a.jsxs)("label",{htmlFor:"csv-upload",className:"btn-modern btn-outline-modern inline-flex items-center gap-2 cursor-pointer",children:[(0,a.jsx)("span",{className:"text-lg",children:"\uD83D\uDCC4"}),m?"ファイルを変更":"CSVファイルを選択"]}),m&&(0,a.jsx)("div",{className:"p-3 bg-blue-50 border border-blue-200 rounded-lg",children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"text-lg",children:"\uD83D\uDCC4"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-medium text-blue-900",children:m.name}),(0,a.jsxs)("div",{className:"text-sm text-blue-600",children:["ファイルサイズ: ",(m.size/1024).toFixed(1)," KB"]})]})]})})]})]}),(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsx)("button",{onClick:D,disabled:!m,className:"btn-modern btn-outline-modern",children:"\uD83D\uDC41️ プレビュー"}),v&&(0,a.jsx)("button",{onClick:C,disabled:l||0===g.length,className:"btn-modern btn-success-modern",children:l?"インポート中...":"".concat(g.length,"件をインポート")})]}),v&&g.length>0&&(0,a.jsxs)("div",{className:"bg-white border rounded-lg overflow-hidden",children:[(0,a.jsx)("div",{className:"bg-gray-50 px-4 py-3 border-b",children:(0,a.jsxs)("h4",{className:"font-medium text-gray-900",children:["プレビュー (",g.length,"件)"]})}),(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"商品名"}),(0,a.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"価格"}),(0,a.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"バリエーション"}),(0,a.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"JANコード"}),(0,a.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"操作"})]})}),(0,a.jsx)("tbody",{className:"divide-y divide-gray-200",children:g.map((e,t)=>(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"px-4 py-2 text-sm",children:e.name}),(0,a.jsxs)("td",{className:"px-4 py-2 text-sm",children:["\xa5",(e.price||0).toLocaleString()]}),(0,a.jsx)("td",{className:"px-4 py-2 text-sm",children:e.variation_name||"-"}),(0,a.jsx)("td",{className:"px-4 py-2 text-sm",children:e.barcode||"-"}),(0,a.jsx)("td",{className:"px-4 py-2 text-sm",children:(0,a.jsx)("span",{className:"inline-flex px-2 py-1 text-xs rounded-full ".concat(e.id?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"),children:e.id?"更新":"新規"})})]},t))})]})})]})]})})]})]})}var C=s(5566);class k{static async sendReservationConfirmation(e){try{var t,s,a,n,i;let{data:r,error:c}=await l.OQ.from("reservations").select("\n          *,\n          customer:customers(*),\n          reservation_items(\n            *,\n            product:products(*)\n          )\n        ").eq("id",e).single();if(c||!r)throw Error("予約データが見つかりません");let d={customerId:r.customer_id,name:(null===(t=r.customer)||void 0===t?void 0:t.full_name)||"顧客",phone:null===(s=r.customer)||void 0===s?void 0:s.phone,email:null===(a=r.customer)||void 0===a?void 0:a.email,lineUserId:null===(n=r.customer)||void 0===n?void 0:n.line_user_id},o={subject:"【予約確定】".concat(r.reservation_number),message:this.generateConfirmationMessage(r),templateData:{reservationNumber:r.reservation_number,customerName:d.name,reservationDate:r.reservation_date,pickupTime:"".concat(r.pickup_time_start||""," - ").concat(r.pickup_time_end||"").trim(),totalAmount:r.final_amount,items:(null===(i=r.reservation_items)||void 0===i?void 0:i.map(e=>{var t;return{name:null===(t=e.product)||void 0===t?void 0:t.name,quantity:e.quantity,price:e.unit_price}}))||[]}},m=await this.sendMultiChannelNotification(d,o);return await this.logNotificationSent(e,"confirmation",m),{success:Object.values(m).some(e=>e.success),results:m}}catch(e){return console.error("予約確定通知の送信に失敗:",e),{success:!1,results:{}}}}static async sendPickupReminder(e){try{var t,s,a,n;let{data:i,error:r}=await l.OQ.from("reservations").select("\n          *,\n          customer:customers(*)\n        ").eq("id",e).single();if(r||!i)throw Error("予約データが見つかりません");let c={customerId:i.customer_id,name:(null===(t=i.customer)||void 0===t?void 0:t.full_name)||"顧客",phone:null===(s=i.customer)||void 0===s?void 0:s.phone,email:null===(a=i.customer)||void 0===a?void 0:a.email,lineUserId:null===(n=i.customer)||void 0===n?void 0:n.line_user_id},d={subject:"【受取リマインダー】".concat(i.reservation_number),message:this.generateReminderMessage(i),templateData:{reservationNumber:i.reservation_number,customerName:c.name,reservationDate:i.reservation_date,pickupTime:"".concat(i.pickup_time_start||""," - ").concat(i.pickup_time_end||"").trim()}},o=await this.sendMultiChannelNotification(c,d);return await l.OQ.from("reservations").update({reminder_sent_at:new Date().toISOString()}).eq("id",e),await this.logNotificationSent(e,"reminder",o),{success:Object.values(o).some(e=>e.success),results:o}}catch(e){return console.error("リマインダー通知の送信に失敗:",e),{success:!1,results:{}}}}static async sendMultiChannelNotification(e,t){let s={};return this.config.lineEnabled&&e.lineUserId&&(s.line=await this.sendLineMessage(e.lineUserId,t)),this.config.emailEnabled&&e.email&&(s.email=await this.sendEmail(e.email,t)),this.config.smsEnabled&&e.phone&&(s.sms=await this.sendSMS(e.phone,t)),s}static async sendLineMessage(e,t){try{if(!this.config.lineAccessToken)return{success:!1,error:"LINE Access Token が設定されていません"};let s=await fetch("https://api.line.me/v2/bot/message/push",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(this.config.lineAccessToken)},body:JSON.stringify({to:e,messages:[{type:"text",text:t.message}]})});if(!s.ok){let e=await s.text();return{success:!1,error:"LINE API Error: ".concat(e)}}return{success:!0}}catch(e){return{success:!1,error:e.message}}}static async sendEmail(e,t){try{return console.log("Email sent to:",e,"Subject:",t.subject),{success:!0}}catch(e){return{success:!1,error:e.message}}}static async sendSMS(e,t){try{return console.log("SMS sent to:",e,"Message:",t.message),{success:!0}}catch(e){return{success:!1,error:e.message}}}static async logNotificationSent(e,t,s){try{console.log("Notification log:",{reservationId:e,type:t,results:s,sentAt:new Date().toISOString()})}catch(e){console.error("通知ログの記録に失敗:",e)}}static generateConfirmationMessage(e){var t,s;let a=(null===(t=e.reservation_items)||void 0===t?void 0:t.map(e=>{var t;return"・".concat(null===(t=e.product)||void 0===t?void 0:t.name," \xd7 ").concat(e.quantity,"個")}).join("\n"))||"";return"【予約確定のお知らせ】\n\n".concat(null===(s=e.customer)||void 0===s?void 0:s.full_name," 様\n\nご予約いただきありがとうございます。\n以下の内容で予約が確定いたしました。\n\n■予約番号: ").concat(e.reservation_number,"\n■受取日: ").concat(new Date(e.reservation_date).toLocaleDateString(),"\n■受取時間: ").concat(e.pickup_time_start||""," - ").concat(e.pickup_time_end||"","\n\n■ご注文内容:\n").concat(a,"\n\n■合計金額: \xa5").concat(e.final_amount.toLocaleString(),"\n\n受取日にお越しください。\nご不明な点がございましたらお気軽にお問い合わせください。\n\n園芸用品予約システム")}static generateReminderMessage(e){var t;return"【受取リマインダー】\n\n".concat(null===(t=e.customer)||void 0===t?void 0:t.full_name," 様\n\n明日は商品の受取日です。\n\n■予約番号: ").concat(e.reservation_number,"\n■受取日: ").concat(new Date(e.reservation_date).toLocaleDateString(),"\n■受取時間: ").concat(e.pickup_time_start||""," - ").concat(e.pickup_time_end||"","\n\nお忘れのないようお気をつけてお越しください。\n\n園芸用品予約システム")}static updateConfig(e){this.config={...this.config,...e}}static getConfig(){return{...this.config}}}k.config={lineEnabled:!0,emailEnabled:!0,smsEnabled:!1,lineAccessToken:C.env.LINE_CHANNEL_ACCESS_TOKEN,emailConfig:{smtpHost:C.env.SMTP_HOST||"smtp.gmail.com",smtpPort:parseInt(C.env.SMTP_PORT||"587"),smtpUser:C.env.SMTP_USER||"",smtpPassword:C.env.SMTP_PASSWORD||"",fromEmail:C.env.FROM_EMAIL||"noreply@nursery.com",fromName:C.env.FROM_NAME||"園芸用品予約システム"}};class S{static async generateReservationPDF(e){try{var t,s,a,n;let{data:i,error:r}=await l.OQ.from("reservations").select("\n          *,\n          customer:customers (\n            full_name,\n            phone,\n            email\n          ),\n          reservation_items (\n            quantity,\n            unit_price,\n            subtotal,\n            product:products (\n              name,\n              price\n            )\n          )\n        ").eq("id",e).single();if(r||!i)throw Error("予約データの取得に失敗しました");let c={id:i.id,reservation_number:i.reservation_number,customer_name:(null===(t=i.customer)||void 0===t?void 0:t.full_name)||"不明",customer_phone:(null===(s=i.customer)||void 0===s?void 0:s.phone)||"",customer_email:null===(a=i.customer)||void 0===a?void 0:a.email,reservation_date:i.reservation_date,pickup_time_start:i.pickup_time_start,pickup_time_end:i.pickup_time_end,status:i.status,items:(null===(n=i.reservation_items)||void 0===n?void 0:n.map(e=>{var t;return{product_name:(null===(t=e.product)||void 0===t?void 0:t.name)||"不明",quantity:e.quantity,unit_price:e.unit_price,subtotal:e.subtotal}}))||[],total_amount:i.total_amount,discount_amount:i.discount_amount,final_amount:i.final_amount,notes:i.notes,admin_notes:i.admin_notes,created_at:i.created_at};return this.generateReservationPDFHTML(c)}catch(e){throw console.error("PDF生成エラー:",e),Error("PDF生成に失敗しました")}}static async generateDailyReportPDF(e){try{let{data:t,error:s}=await l.OQ.from("reservations").select("\n          *,\n          customer:customers (\n            full_name,\n            phone,\n            email\n          ),\n          reservation_items (\n            quantity,\n            unit_price,\n            subtotal,\n            product:products (\n              name,\n              price\n            )\n          )\n        ").eq("reservation_date",e).order("pickup_time_start",{ascending:!0});if(s)throw Error("予約データの取得に失敗しました");let a=(null==t?void 0:t.map(e=>{var t,s,a,n;return{id:e.id,reservation_number:e.reservation_number,customer_name:(null===(t=e.customer)||void 0===t?void 0:t.full_name)||"不明",customer_phone:(null===(s=e.customer)||void 0===s?void 0:s.phone)||"",customer_email:null===(a=e.customer)||void 0===a?void 0:a.email,reservation_date:e.reservation_date,pickup_time_start:e.pickup_time_start,pickup_time_end:e.pickup_time_end,status:e.status,items:(null===(n=e.reservation_items)||void 0===n?void 0:n.map(e=>{var t;return{product_name:(null===(t=e.product)||void 0===t?void 0:t.name)||"不明",quantity:e.quantity,unit_price:e.unit_price,subtotal:e.subtotal}}))||[],total_amount:e.total_amount,discount_amount:e.discount_amount,final_amount:e.final_amount,notes:e.notes,admin_notes:e.admin_notes,created_at:e.created_at}}))||[],n={by_status:a.reduce((e,t)=>(e[t.status]=(e[t.status]||0)+1,e),{}),by_time_slot:a.reduce((e,t)=>{let s=t.pickup_time_start?"".concat(t.pickup_time_start,"-").concat(t.pickup_time_end):"時間未指定";return e[s]=(e[s]||0)+1,e},{})},i={date:e,total_reservations:a.length,total_amount:a.reduce((e,t)=>e+t.final_amount,0),reservations:a,summary:n};return this.generateDailyReportPDFHTML(i)}catch(e){throw console.error("日次レポートPDF生成エラー:",e),Error("日次レポートPDF生成に失敗しました")}}static generateReservationPDFHTML(e){let t={pending:"保留中",confirmed:"確定",ready:"準備完了",completed:"完了",cancelled:"キャンセル"}[e.status]||e.status,s=e.pickup_time_start&&e.pickup_time_end?"".concat(e.pickup_time_start," - ").concat(e.pickup_time_end):"時間未指定";return'\n<!DOCTYPE html>\n<html>\n<head>\n  <meta charset="UTF-8">\n  <title>注文書 - '.concat(e.reservation_number,"</title>\n  <style>\n    body { font-family: 'Helvetica', 'Arial', sans-serif; font-size: 12px; margin: 20px; }\n    .header { text-align: center; margin-bottom: 30px; }\n    .header h1 { font-size: 24px; margin-bottom: 10px; }\n    .info-section { margin-bottom: 20px; }\n    .info-section h2 { font-size: 16px; border-bottom: 2px solid #333; padding-bottom: 5px; }\n    .info-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px; }\n    .info-item { margin-bottom: 10px; }\n    .info-item label { font-weight: bold; margin-right: 10px; }\n    .items-table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }\n    .items-table th, .items-table td { border: 1px solid #ddd; padding: 8px; text-align: left; }\n    .items-table th { background-color: #f5f5f5; font-weight: bold; }\n    .items-table .number { text-align: right; }\n    .total-section { margin-top: 20px; }\n    .total-row { display: flex; justify-content: space-between; margin-bottom: 5px; }\n    .total-row.final { font-weight: bold; font-size: 14px; border-top: 2px solid #333; padding-top: 10px; }\n    .notes { margin-top: 20px; padding: 10px; background-color: #f9f9f9; border-radius: 5px; }\n    .footer { margin-top: 30px; text-align: center; font-size: 10px; color: #666; }\n  </style>\n</head>\n<body>\n  <div class=\"header\">\n    <h1>注文書</h1>\n    <p>予約番号: ").concat(e.reservation_number,'</p>\n  </div>\n\n  <div class="info-grid">\n    <div class="info-section">\n      <h2>顧客情報</h2>\n      <div class="info-item">\n        <label>氏名:</label>\n        <span>').concat(e.customer_name,'</span>\n      </div>\n      <div class="info-item">\n        <label>電話番号:</label>\n        <span>').concat(e.customer_phone,"</span>\n      </div>\n      ").concat(e.customer_email?'\n      <div class="info-item">\n        <label>メールアドレス:</label>\n        <span>'.concat(e.customer_email,"</span>\n      </div>\n      "):"",'\n    </div>\n\n    <div class="info-section">\n      <h2>予約情報</h2>\n      <div class="info-item">\n        <label>受取日:</label>\n        <span>').concat(new Date(e.reservation_date).toLocaleDateString("ja-JP"),'</span>\n      </div>\n      <div class="info-item">\n        <label>受取時間:</label>\n        <span>').concat(s,'</span>\n      </div>\n      <div class="info-item">\n        <label>ステータス:</label>\n        <span>').concat(t,'</span>\n      </div>\n      <div class="info-item">\n        <label>予約日時:</label>\n        <span>').concat(new Date(e.created_at).toLocaleString("ja-JP"),'</span>\n      </div>\n    </div>\n  </div>\n\n  <div class="info-section">\n    <h2>注文内容</h2>\n    <table class="items-table">\n      <thead>\n        <tr>\n          <th>商品名</th>\n          <th class="number">数量</th>\n          <th class="number">単価</th>\n          <th class="number">小計</th>\n        </tr>\n      </thead>\n      <tbody>\n        ').concat(e.items.map(e=>"\n        <tr>\n          <td>".concat(e.product_name,'</td>\n          <td class="number">').concat(e.quantity,'</td>\n          <td class="number">\xa5').concat(e.unit_price.toLocaleString(),'</td>\n          <td class="number">\xa5').concat(e.subtotal.toLocaleString(),"</td>\n        </tr>\n        ")).join(""),'\n      </tbody>\n    </table>\n\n    <div class="total-section">\n      <div class="total-row">\n        <span>小計:</span>\n        <span>\xa5').concat(e.total_amount.toLocaleString(),"</span>\n      </div>\n      ").concat(e.discount_amount>0?'\n      <div class="total-row">\n        <span>割引:</span>\n        <span>-\xa5'.concat(e.discount_amount.toLocaleString(),"</span>\n      </div>\n      "):"",'\n      <div class="total-row final">\n        <span>合計:</span>\n        <span>\xa5').concat(e.final_amount.toLocaleString(),"</span>\n      </div>\n    </div>\n  </div>\n\n  ").concat(e.notes?'\n  <div class="notes">\n    <h3>お客様備考</h3>\n    <p>'.concat(e.notes,"</p>\n  </div>\n  "):"","\n\n  ").concat(e.admin_notes?'\n  <div class="notes">\n    <h3>管理メモ</h3>\n    <p>'.concat(e.admin_notes,"</p>\n  </div>\n  "):"",'\n\n  <div class="footer">\n    <p>種苗店予約システム - 発行日: ').concat(new Date().toLocaleString("ja-JP"),"</p>\n  </div>\n</body>\n</html>\n    ")}static generateDailyReportPDFHTML(e){return'\n<!DOCTYPE html>\n<html>\n<head>\n  <meta charset="UTF-8">\n  <title>日次予約レポート - '.concat(e.date,"</title>\n  <style>\n    body { font-family: 'Helvetica', 'Arial', sans-serif; font-size: 12px; margin: 20px; }\n    .header { text-align: center; margin-bottom: 30px; }\n    .header h1 { font-size: 24px; margin-bottom: 10px; }\n    .summary { margin-bottom: 30px; }\n    .summary-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }\n    .summary-item { background-color: #f5f5f5; padding: 15px; border-radius: 5px; }\n    .summary-item h3 { margin-top: 0; }\n    .reservations-table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }\n    .reservations-table th, .reservations-table td { border: 1px solid #ddd; padding: 8px; text-align: left; font-size: 10px; }\n    .reservations-table th { background-color: #f5f5f5; font-weight: bold; }\n    .reservations-table .number { text-align: right; }\n    .status-badge { padding: 2px 6px; border-radius: 3px; font-size: 9px; }\n    .status-pending { background-color: #fef3c7; color: #92400e; }\n    .status-confirmed { background-color: #d1fae5; color: #065f46; }\n    .status-ready { background-color: #dbeafe; color: #1e40af; }\n    .status-completed { background-color: #f3f4f6; color: #374151; }\n    .status-cancelled { background-color: #fee2e2; color: #991b1b; }\n    .footer { margin-top: 30px; text-align: center; font-size: 10px; color: #666; }\n  </style>\n</head>\n<body>\n  <div class=\"header\">\n    <h1>日次予約レポート</h1>\n    <p>対象日: ").concat(new Date(e.date).toLocaleDateString("ja-JP"),'</p>\n  </div>\n\n  <div class="summary">\n    <div class="summary-grid">\n      <div class="summary-item">\n        <h3>予約概要</h3>\n        <p>総予約数: ').concat(e.total_reservations,"件</p>\n        <p>総金額: \xa5").concat(e.total_amount.toLocaleString(),'</p>\n      </div>\n      <div class="summary-item">\n        <h3>ステータス別</h3>\n        ').concat(Object.entries(e.summary.by_status).map(e=>{let[t,s]=e;return"\n        <p>".concat(t,": ").concat(s,"件</p>\n        ")}).join(""),'\n      </div>\n    </div>\n  </div>\n\n  <table class="reservations-table">\n    <thead>\n      <tr>\n        <th>予約番号</th>\n        <th>顧客名</th>\n        <th>電話番号</th>\n        <th>受取時間</th>\n        <th>ステータス</th>\n        <th>商品数</th>\n        <th class="number">金額</th>\n        <th>備考</th>\n      </tr>\n    </thead>\n    <tbody>\n      ').concat(e.reservations.map(e=>{let t="status-".concat(e.status),s={pending:"保留中",confirmed:"確定",ready:"準備完了",completed:"完了",cancelled:"キャンセル"}[e.status]||e.status,a=e.pickup_time_start&&e.pickup_time_end?"".concat(e.pickup_time_start,"-").concat(e.pickup_time_end):"未指定";return"\n        <tr>\n          <td>".concat(e.reservation_number,"</td>\n          <td>").concat(e.customer_name,"</td>\n          <td>").concat(e.customer_phone,"</td>\n          <td>").concat(a,'</td>\n          <td><span class="status-badge ').concat(t,'">').concat(s,"</span></td>\n          <td>").concat(e.items.length,'</td>\n          <td class="number">\xa5').concat(e.final_amount.toLocaleString(),"</td>\n          <td>").concat(e.notes||e.admin_notes||"","</td>\n        </tr>\n        ")}).join(""),'\n    </tbody>\n  </table>\n\n  <div class="footer">\n    <p>種苗店予約システム - 発行日: ').concat(new Date().toLocaleString("ja-JP"),"</p>\n  </div>\n</body>\n</html>\n    ")}static printHTML(e){let t=window.open("","_blank");t&&(t.document.write(e),t.document.close(),t.focus(),t.print())}}function P(){var e,t,s,i;let{showSuccess:r,showError:c}=(0,N.p)(),[d,o]=(0,n.useState)([]),[m,u]=(0,n.useState)(!0),[x,h]=(0,n.useState)("all"),[g,p]=(0,n.useState)(""),[v,b]=(0,n.useState)(""),[j,f]=(0,n.useState)(null),[y,_]=(0,n.useState)(!1);(0,n.useEffect)(()=>{w()},[]);let w=async()=>{try{let{data:e,error:t}=await l.OQ.from("reservations").select("\n          *,\n          customer:customers(*),\n          reservation_items(\n            *,\n            product:products(*)\n          )\n        ").order("created_at",{ascending:!1});if(t)throw t;o(e||[])}catch(e){console.error("予約データの取得に失敗しました:",e),o([])}finally{u(!1)}},D=async(e,t)=>{try{let{error:s}=await l.OQ.from("reservations").update({status:t,..."confirmed"===t&&{confirmation_sent_at:new Date().toISOString()}}).eq("id",e);if(s)throw s;o(d.map(s=>s.id===e?{...s,status:t}:s)),"confirmed"===t&&await C(e),r("ステータスを更新しました","予約ステータスが正常に更新されました。")}catch(e){console.error("ステータスの更新に失敗しました:",e),c("ステータス更新に失敗しました",(null==e?void 0:e.message)||"ステータスの更新中にエラーが発生しました。")}},C=async e=>{try{var t,s,a,n,i,l;r("通知送信中...","予約確定通知を送信しています");let d=await k.sendReservationConfirmation(e);if(d.success){let e="予約確定通知を送信しました",n=[];(null===(t=d.results.line)||void 0===t?void 0:t.success)&&n.push("LINE"),(null===(s=d.results.email)||void 0===s?void 0:s.success)&&n.push("メール"),(null===(a=d.results.sms)||void 0===a?void 0:a.success)&&n.push("SMS"),n.length>0&&(e+=" (".concat(n.join("、"),")")),r("通知送信完了",e)}else{let e=[];(null===(n=d.results.line)||void 0===n?void 0:n.error)&&e.push("LINE: ".concat(d.results.line.error)),(null===(i=d.results.email)||void 0===i?void 0:i.error)&&e.push("メール: ".concat(d.results.email.error)),(null===(l=d.results.sms)||void 0===l?void 0:l.error)&&e.push("SMS: ".concat(d.results.sms.error)),c("通知送信に失敗しました",e.join("\n")||"通知の送信中にエラーが発生しました")}}catch(e){console.error("通知送信エラー:",e),c("通知送信エラー",e.message||"通知の送信中にエラーが発生しました")}},P=async e=>{try{var t,s,a,n,i,l;r("リマインダー送信中...","受取リマインダーを送信しています");let d=await k.sendPickupReminder(e);if(d.success){let e="受取リマインダーを送信しました",n=[];(null===(t=d.results.line)||void 0===t?void 0:t.success)&&n.push("LINE"),(null===(s=d.results.email)||void 0===s?void 0:s.success)&&n.push("メール"),(null===(a=d.results.sms)||void 0===a?void 0:a.success)&&n.push("SMS"),n.length>0&&(e+=" (".concat(n.join("、"),")")),r("リマインダー送信完了",e)}else{let e=[];(null===(n=d.results.line)||void 0===n?void 0:n.error)&&e.push("LINE: ".concat(d.results.line.error)),(null===(i=d.results.email)||void 0===i?void 0:i.error)&&e.push("メール: ".concat(d.results.email.error)),(null===(l=d.results.sms)||void 0===l?void 0:l.error)&&e.push("SMS: ".concat(d.results.sms.error)),c("リマインダー送信に失敗しました",e.join("\n")||"リマインダーの送信中にエラーが発生しました")}}catch(e){console.error("リマインダー送信エラー:",e),c("リマインダー送信エラー",e.message||"リマインダーの送信中にエラーが発生しました")}},O=async e=>{try{r("PDF生成中...","注文書PDFを生成しています");let t=await S.generateReservationPDF(e);S.printHTML(t),r("PDF生成完了","注文書PDFを生成しました")}catch(e){console.error("PDF生成エラー:",e),c("PDF生成エラー",e.message||"PDFの生成中にエラーが発生しました")}},J=async()=>{try{let e=new Date().toISOString().split("T")[0];r("PDF生成中...","".concat(e,"の予約レポートを生成しています"));let t=await S.generateDailyReportPDF(e);S.printHTML(t),r("PDF生成完了","当日の予約レポートを生成しました")}catch(e){console.error("PDF生成エラー:",e),c("PDF生成エラー",e.message||"PDFの生成中にエラーが発生しました")}},F=e=>{let t={pending:{label:"保留中",className:"bg-yellow-100 text-yellow-800"},confirmed:{label:"確定",className:"bg-green-100 text-green-800"},ready:{label:"準備完了",className:"bg-blue-100 text-blue-800"},completed:{label:"完了",className:"bg-gray-100 text-gray-800"},cancelled:{label:"キャンセル",className:"bg-red-100 text-red-800"}},s=t[e]||t.pending;return(0,a.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(s.className),children:s.label})},L=d.filter(e=>{var t,s;let a="all"===x||e.status===x,n=!g||e.reservation_date===g,i=!v||e.reservation_number.toLowerCase().includes(v.toLowerCase())||(null===(t=e.customer)||void 0===t?void 0:t.full_name.toLowerCase().includes(v.toLowerCase()))||(null===(s=e.customer)||void 0===s?void 0:s.phone.includes(v));return a&&n&&i}),z=e=>{f(e),_(!0)};return m?(0,a.jsx)("div",{className:"flex justify-center items-center h-64",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-gray-800",children:"予約一覧"}),(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsx)("button",{className:"btn-modern btn-success-modern",children:"\uD83D\uDCDD 新規予約追加"}),(0,a.jsx)("button",{onClick:J,className:"btn-modern btn-outline-modern",children:"\uD83D\uDCCA 当日レポートPDF"})]})]}),(0,a.jsx)("div",{className:"bg-white p-4 rounded-lg shadow-sm border",children:(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"ステータス"}),(0,a.jsxs)("select",{value:x,onChange:e=>h(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,a.jsx)("option",{value:"all",children:"すべてのステータス"}),(0,a.jsx)("option",{value:"pending",children:"保留中"}),(0,a.jsx)("option",{value:"confirmed",children:"確定"}),(0,a.jsx)("option",{value:"ready",children:"準備完了"}),(0,a.jsx)("option",{value:"completed",children:"完了"}),(0,a.jsx)("option",{value:"cancelled",children:"キャンセル"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"受取日"}),(0,a.jsx)("input",{type:"date",value:g,onChange:e=>p(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"検索"}),(0,a.jsx)("input",{type:"text",value:v,onChange:e=>b(e.target.value),placeholder:"予約番号、顧客名、電話番号で検索",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,a.jsx)("div",{className:"flex items-end",children:(0,a.jsxs)("div",{className:"text-sm text-gray-600",children:[L.length," 件の予約"]})})]})}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border overflow-hidden",children:[(0,a.jsx)("div",{className:"hidden lg:block overflow-x-auto",children:(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"予約情報"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"顧客情報"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"受取日時"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"金額"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"ステータス"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"アクション"})]})}),(0,a.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:L.map(e=>{var t,s,n;return(0,a.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,a.jsx)("td",{className:"px-6 py-4",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.reservation_number}),(0,a.jsxs)("div",{className:"text-sm text-gray-500",children:["作成: ",new Date(e.created_at).toLocaleDateString()]}),e.notes&&(0,a.jsxs)("div",{className:"text-xs text-gray-400 mt-1",children:["\uD83D\uDCDD ",e.notes]})]})}),(0,a.jsx)("td",{className:"px-6 py-4",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm font-medium text-gray-900",children:null===(t=e.customer)||void 0===t?void 0:t.full_name}),(0,a.jsxs)("div",{className:"text-sm text-gray-500",children:["\uD83D\uDCDE ",null===(s=e.customer)||void 0===s?void 0:s.phone]}),(null===(n=e.customer)||void 0===n?void 0:n.email)&&(0,a.jsxs)("div",{className:"text-sm text-gray-500",children:["\uD83D\uDCE7 ",e.customer.email]})]})}),(0,a.jsxs)("td",{className:"px-6 py-4",children:[(0,a.jsx)("div",{className:"text-sm text-gray-900",children:new Date(e.reservation_date).toLocaleDateString()}),e.pickup_time_start&&e.pickup_time_end&&(0,a.jsxs)("div",{className:"text-sm text-gray-500",children:[e.pickup_time_start," - ",e.pickup_time_end]})]}),(0,a.jsxs)("td",{className:"px-6 py-4",children:[(0,a.jsxs)("div",{className:"text-sm font-medium text-gray-900",children:["\xa5",e.final_amount.toLocaleString()]}),e.discount_amount>0&&(0,a.jsxs)("div",{className:"text-xs text-green-600",children:["割引: -\xa5",e.discount_amount.toLocaleString()]})]}),(0,a.jsx)("td",{className:"px-6 py-4",children:(0,a.jsxs)("select",{value:e.status,onChange:t=>D(e.id,t.target.value),className:"text-xs border border-gray-300 rounded px-2 py-1",children:[(0,a.jsx)("option",{value:"pending",children:"保留中"}),(0,a.jsx)("option",{value:"confirmed",children:"確定"}),(0,a.jsx)("option",{value:"ready",children:"準備完了"}),(0,a.jsx)("option",{value:"completed",children:"完了"}),(0,a.jsx)("option",{value:"cancelled",children:"キャンセル"})]})}),(0,a.jsx)("td",{className:"px-6 py-4",children:(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsx)("button",{onClick:()=>z(e),className:"btn-modern btn-outline-modern btn-sm",children:"\uD83D\uDC41️ 詳細"}),(0,a.jsx)("button",{onClick:()=>O(e.id),className:"btn-modern btn-secondary-modern btn-sm",title:"注文書PDFを生成",children:"\uD83D\uDCC4 PDF"}),"confirmed"===e.status&&!e.reminder_sent_at&&(0,a.jsx)("button",{onClick:()=>P(e.id),className:"btn-modern btn-warning-modern btn-sm",title:"受取リマインダーを送信",children:"\uD83D\uDCE2 リマインダー"}),(0,a.jsx)("button",{className:"btn-modern btn-primary-modern btn-sm",children:"✏️ 編集"})]})})]},e.id)})})]})}),(0,a.jsx)("div",{className:"lg:hidden",children:(0,a.jsx)("div",{className:"divide-y divide-gray-200",children:L.map(e=>{var t,s;return(0,a.jsxs)("div",{className:"p-4 hover:bg-gray-50",children:[(0,a.jsxs)("div",{className:"flex justify-between items-start mb-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.reservation_number}),(0,a.jsx)("div",{className:"text-sm text-gray-500",children:null===(t=e.customer)||void 0===t?void 0:t.full_name})]}),(0,a.jsx)("div",{className:"flex flex-col items-end gap-1",children:F(e.status)})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm mb-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-500",children:"受取日:"}),(0,a.jsx)("div",{className:"font-medium",children:new Date(e.reservation_date).toLocaleDateString()})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-500",children:"金額:"}),(0,a.jsxs)("div",{className:"font-medium",children:["\xa5",e.final_amount.toLocaleString()]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-500",children:"電話:"}),(0,a.jsx)("div",{children:null===(s=e.customer)||void 0===s?void 0:s.phone})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-500",children:"作成:"}),(0,a.jsx)("div",{children:new Date(e.created_at).toLocaleDateString()})]})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("div",{className:"flex-1 mr-3",children:(0,a.jsxs)("select",{value:e.status,onChange:t=>D(e.id,t.target.value),className:"w-full text-xs border border-gray-300 rounded px-2 py-1",children:[(0,a.jsx)("option",{value:"pending",children:"保留中"}),(0,a.jsx)("option",{value:"confirmed",children:"確定"}),(0,a.jsx)("option",{value:"ready",children:"準備完了"}),(0,a.jsx)("option",{value:"completed",children:"完了"}),(0,a.jsx)("option",{value:"cancelled",children:"キャンセル"})]})}),(0,a.jsxs)("div",{className:"flex space-x-1",children:[(0,a.jsx)("button",{onClick:()=>z(e),className:"btn-modern btn-outline-modern btn-sm text-xs px-2 py-1",children:"詳細"}),(0,a.jsx)("button",{onClick:()=>O(e.id),className:"btn-modern btn-secondary-modern btn-sm text-xs px-1 py-1",title:"注文書PDFを生成",children:"\uD83D\uDCC4"}),"confirmed"===e.status&&!e.reminder_sent_at&&(0,a.jsx)("button",{onClick:()=>P(e.id),className:"btn-modern btn-warning-modern btn-sm text-xs px-1 py-1",title:"受取リマインダーを送信",children:"\uD83D\uDCE2"}),(0,a.jsx)("button",{className:"btn-modern btn-primary-modern btn-sm text-xs px-2 py-1",children:"編集"})]})]}),e.notes&&(0,a.jsxs)("div",{className:"mt-2 text-xs text-gray-400 bg-gray-50 p-2 rounded",children:["\uD83D\uDCDD ",e.notes]})]},e.id)})})})]}),0===L.length&&(0,a.jsxs)("div",{className:"text-center py-12",children:[(0,a.jsx)("div",{className:"text-6xl mb-4",children:"\uD83D\uDCC5"}),(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"予約が見つかりません"}),(0,a.jsx)("p",{className:"text-gray-500",children:"検索条件を変更するか、新しい予約を追加してください。"})]}),y&&j&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,a.jsx)("div",{className:"bg-white rounded-lg max-w-sm sm:max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold",children:"予約詳細"}),(0,a.jsx)("button",{onClick:()=>_(!1),className:"btn-modern btn-ghost-modern btn-sm",children:"✕"})]}),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"予約番号"}),(0,a.jsx)("div",{className:"text-sm text-gray-900",children:j.reservation_number})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ステータス"}),(0,a.jsx)("div",{children:F(j.status)})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"受取日"}),(0,a.jsx)("div",{className:"text-sm text-gray-900",children:new Date(j.reservation_date).toLocaleDateString()})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-medium text-gray-900 mb-3",children:"顧客情報"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"氏名"}),(0,a.jsx)("div",{className:"text-sm text-gray-900",children:null===(e=j.customer)||void 0===e?void 0:e.full_name})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"電話番号"}),(0,a.jsx)("div",{className:"text-sm text-gray-900",children:null===(t=j.customer)||void 0===t?void 0:t.phone})]}),(null===(s=j.customer)||void 0===s?void 0:s.email)&&(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"メールアドレス"}),(0,a.jsx)("div",{className:"text-sm text-gray-900",children:j.customer.email})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-medium text-gray-900 mb-3",children:"注文商品"}),(0,a.jsx)("div",{className:"space-y-2",children:null===(i=j.reservation_items)||void 0===i?void 0:i.map((e,t)=>{var s;return(0,a.jsxs)("div",{className:"flex justify-between items-center py-2 border-b",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-medium",children:null===(s=e.product)||void 0===s?void 0:s.name}),(0,a.jsxs)("div",{className:"text-sm text-gray-500",children:["\xa5",e.unit_price.toLocaleString()," \xd7 ",e.quantity]})]}),(0,a.jsxs)("div",{className:"font-medium",children:["\xa5",e.subtotal.toLocaleString()]})]},t)})}),(0,a.jsx)("div",{className:"mt-4 pt-4 border-t",children:(0,a.jsxs)("div",{className:"flex justify-between font-bold",children:[(0,a.jsx)("span",{children:"合計"}),(0,a.jsxs)("span",{children:["\xa5",j.final_amount.toLocaleString()]})]})})]}),(j.notes||j.admin_notes)&&(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-medium text-gray-900 mb-3",children:"備考・メモ"}),j.notes&&(0,a.jsxs)("div",{className:"mb-2",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"お客様備考"}),(0,a.jsx)("div",{className:"text-sm text-gray-900 bg-gray-50 p-2 rounded",children:j.notes})]}),j.admin_notes&&(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"管理メモ"}),(0,a.jsx)("div",{className:"text-sm text-gray-900 bg-yellow-50 p-2 rounded",children:j.admin_notes})]})]})]}),(0,a.jsxs)("div",{className:"mt-6 flex justify-end space-x-3",children:[(0,a.jsx)("button",{onClick:()=>_(!1),className:"btn-modern btn-secondary-modern",children:"閉じる"}),(0,a.jsx)("button",{onClick:()=>O(j.id),className:"btn-modern btn-outline-modern",children:"\uD83D\uDCC4 PDF生成"}),(0,a.jsx)("button",{className:"btn-modern btn-primary-modern",children:"編集"})]})]})})})]})}function O(){let[e,t]=(0,n.useState)([]),[s,i]=(0,n.useState)(null),[r,c]=(0,n.useState)(!1),[d,o]=(0,n.useState)(!1),[m,u]=(0,n.useState)(!0),x=[{value:"reservation_confirmation",label:"予約確定通知",icon:"✅"},{value:"reservation_reminder",label:"予約リマインダー",icon:"⏰"},{value:"payment_confirmation",label:"支払い確認通知",icon:"\uD83D\uDCB0"},{value:"cancellation",label:"キャンセル通知",icon:"❌"}];(0,n.useEffect)(()=>{h()},[]);let h=async()=>{try{let{data:e,error:s}=await l.OQ.from("line_templates").select("*").order("created_at",{ascending:!1});if(s)throw s;t(e||[]),e&&e.length>0&&i(e[0])}catch(e){console.error("テンプレートの取得に失敗しました:",e),t([])}finally{u(!1)}},g=async()=>{if(s)try{let{error:e}=await l.OQ.from("line_templates").update({name:s.name,template_type:s.template_type,subject:s.subject,message:s.message,is_active:s.is_active}).eq("id",s.id);if(e)throw e;await h(),c(!1),alert("テンプレートが保存されました！")}catch(e){console.error("テンプレートの保存に失敗しました:",e),alert("テンプレートの保存に失敗しました。")}},p=async()=>{try{let{data:e,error:t}=await l.OQ.from("line_templates").insert([{name:"新しいテンプレート",template_type:"reservation_confirmation",subject:"",message:"",is_active:!1}]).select().single();if(t)throw t;await h(),i(e),c(!0)}catch(e){console.error("テンプレートの作成に失敗しました:",e),alert("テンプレートの作成に失敗しました。")}},v=async t=>{if(confirm("このテンプレートを削除しますか？"))try{let{error:a}=await l.OQ.from("line_templates").delete().eq("id",t);if(a)throw a;await h(),(null==s?void 0:s.id)===t&&i(e[0]||null),alert("テンプレートが削除されました。")}catch(e){console.error("テンプレートの削除に失敗しました:",e),alert("テンプレートの削除に失敗しました。")}},b=async t=>{let s=e.find(e=>e.id===t);if(s)try{let{error:e}=await l.OQ.from("line_templates").update({is_active:!s.is_active}).eq("id",t);if(e)throw e;await h()}catch(e){console.error("テンプレートの有効/無効の切り替えに失敗しました:",e),alert("テンプレートの有効/無効の切り替えに失敗しました。")}};return m?(0,a.jsx)("div",{className:"flex justify-center items-center h-64",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):(0,a.jsxs)("div",{className:"flex h-full bg-gray-50",children:[(0,a.jsxs)("div",{className:"w-1/3 border-r border-gray-200 bg-white",children:[(0,a.jsx)("div",{className:"p-4 border-b border-gray-200",children:(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,a.jsx)("h3",{className:"font-semibold text-gray-900",children:"LINEテンプレート"}),(0,a.jsx)("button",{onClick:p,className:"btn-modern btn-primary-modern btn-sm",children:"+ 新規作成"})]})}),(0,a.jsx)("div",{className:"p-4 space-y-3",children:e.map(e=>{var t,n;return(0,a.jsxs)("div",{className:"p-4 border rounded-lg cursor-pointer transition-all ".concat((null==s?void 0:s.id)===e.id?"border-blue-500 bg-blue-50":"border-gray-200 hover:bg-gray-50"),onClick:()=>i(e),children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"text-lg",children:null===(t=x.find(t=>t.value===e.template_type))||void 0===t?void 0:t.icon}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-medium text-sm",children:e.name}),(0,a.jsx)("div",{className:"text-xs text-gray-500",children:null===(n=x.find(t=>t.value===e.template_type))||void 0===n?void 0:n.label})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("button",{onClick:t=>{t.stopPropagation(),b(e.id)},className:"btn-modern btn-sm btn-icon-only ".concat(e.is_active?"btn-success-modern":"btn-secondary-modern"),children:e.is_active?"✓":"○"}),(0,a.jsx)("button",{onClick:t=>{t.stopPropagation(),v(e.id)},className:"btn-modern btn-danger-modern btn-sm btn-icon-only",children:"\uD83D\uDDD1️"})]})]}),(0,a.jsxs)("div",{className:"text-xs text-gray-400",children:["最終更新: ",new Date(e.updated_at).toLocaleDateString()]})]},e.id)})})]}),s&&(0,a.jsx)("div",{className:"flex-1 flex",children:(0,a.jsx)("div",{className:"flex-1 p-6",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold",children:"テンプレート編集"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{onClick:()=>o(!d),className:"btn-modern btn-sm ".concat(d?"btn-warning-modern":"btn-secondary-modern"),children:d?"\uD83D\uDCDD 編集":"\uD83D\uDC41️ プレビュー"}),r?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("button",{onClick:g,className:"btn-modern btn-success-modern btn-sm",children:"\uD83D\uDCBE 保存"}),(0,a.jsx)("button",{onClick:()=>c(!1),className:"btn-modern btn-secondary-modern btn-sm",children:"キャンセル"})]}):(0,a.jsx)("button",{onClick:()=>c(!0),className:"btn-modern btn-primary-modern btn-sm",children:"✏️ 編集"})]})]}),d?(0,a.jsx)("div",{className:"space-y-4",children:(0,a.jsxs)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[(0,a.jsx)("h4",{className:"font-medium text-green-800 mb-2",children:"\uD83D\uDCF1 LINEメッセージ プレビュー"}),(0,a.jsxs)("div",{className:"bg-white rounded-lg p-4 border",children:[(0,a.jsxs)("div",{className:"text-sm font-medium text-gray-600 mb-2",children:["件名: ",s.subject]}),(0,a.jsx)("div",{className:"whitespace-pre-line text-sm leading-relaxed",children:(()=>{if(!s)return"";let e=s.message;return Object.entries({customer_name:"山田太郎",reservation_id:"R20240101001",phone_number:"090-1234-5678",reservation_date:"2024年1月15日",pickup_time:"10:00-12:00",product_list:"有機肥料A \xd7 2袋\nトマト苗 \xd7 10株",total_amount:"15,000",payment_amount:"15,000",payment_method:"クレジットカード",payment_date:"2024年1月14日 15:30",cancellation_date:"2024年1月14日 16:00",cancellation_reason:"お客様都合",shop_name:"グリーンファーム種苗店",shop_phone:"03-1234-5678"}).forEach(t=>{let[s,a]=t;e=e.replace(RegExp("{".concat(s,"}"),"g"),a)}),e})()})]})]})}):(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"テンプレート名"}),(0,a.jsx)("input",{type:"text",value:s.name,onChange:e=>i({...s,name:e.target.value}),disabled:!r,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:bg-gray-50"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"テンプレートタイプ"}),(0,a.jsx)("select",{value:s.template_type,onChange:e=>i({...s,template_type:e.target.value}),disabled:!r,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:bg-gray-50",children:x.map(e=>(0,a.jsxs)("option",{value:e.value,children:[e.icon," ",e.label]},e.value))})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"件名"}),(0,a.jsx)("input",{type:"text",value:s.subject,onChange:e=>i({...s,subject:e.target.value}),disabled:!r,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:bg-gray-50",placeholder:"メッセージの件名を入力"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"メッセージ本文"}),(0,a.jsx)("textarea",{value:s.message,onChange:e=>i({...s,message:e.target.value}),disabled:!r,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:bg-gray-50",rows:12,placeholder:"メッセージ本文を入力してください。変数は {variable_name} の形式で使用できます。"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"利用可能な変数"}),(0,a.jsx)("div",{className:"bg-gray-50 rounded-lg p-4",children:(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("code",{className:"bg-blue-100 px-2 py-1 rounded text-blue-800",children:"{customer_name}"})," - お客様名"]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("code",{className:"bg-blue-100 px-2 py-1 rounded text-blue-800",children:"{reservation_id}"})," - 予約番号"]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("code",{className:"bg-blue-100 px-2 py-1 rounded text-blue-800",children:"{phone_number}"})," - 電話番号"]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("code",{className:"bg-blue-100 px-2 py-1 rounded text-blue-800",children:"{reservation_date}"})," - 予約日"]})]}),(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("code",{className:"bg-blue-100 px-2 py-1 rounded text-blue-800",children:"{product_list}"})," - 商品一覧"]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("code",{className:"bg-blue-100 px-2 py-1 rounded text-blue-800",children:"{total_amount}"})," - 合計金額"]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("code",{className:"bg-blue-100 px-2 py-1 rounded text-blue-800",children:"{shop_name}"})," - 店舗名"]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("code",{className:"bg-blue-100 px-2 py-1 rounded text-blue-800",children:"{shop_phone}"})," - 店舗電話"]})]})]})})]}),(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("input",{type:"checkbox",id:"isActive",checked:s.is_active,onChange:e=>i({...s,is_active:e.target.checked}),disabled:!r,className:"mr-2"}),(0,a.jsx)("label",{htmlFor:"isActive",className:"text-sm font-medium text-gray-700",children:"このテンプレートを有効にする"})]})]})]})})})]})}var J=()=>{let[e,t]=(0,n.useState)([]),[s,i]=(0,n.useState)(!0),[c,d]=(0,n.useState)(""),[o,m]=(0,n.useState)(!1),[u,x]=(0,n.useState)(null),[h,g]=(0,n.useState)(null),[p,v]=(0,n.useState)({name:"",description:"",display_order:0,is_active:!0}),[j,f]=(0,n.useState)({}),[y,N]=(0,n.useState)(!1);(0,n.useEffect)(()=>{_()},[]);let _=async()=>{i(!0);try{let{data:e,error:s}=await l.OQ.from("product_categories").select("*").order("display_order",{ascending:!0});if(s)throw s;t(e||[])}catch(e){console.error("カテゴリ情報の取得に失敗しました:",e)}finally{i(!1)}},w=e.filter(e=>{var t;return e.name.toLowerCase().includes(c.toLowerCase())||(null===(t=e.description)||void 0===t?void 0:t.toLowerCase().includes(c.toLowerCase()))}),D=()=>{let e={};return p.name.trim()||(e.name="カテゴリ名は必須です"),p.display_order<0&&(e.display_order="表示順序は0以上の数値を入力してください"),f(e),0===Object.keys(e).length},C=async e=>{if(e.preventDefault(),D()){N(!0);try{let e={name:p.name.trim(),description:p.description.trim()||null,display_order:p.display_order,is_active:p.is_active,updated_at:new Date().toISOString()};if(u){let{error:t}=await l.OQ.from("product_categories").update(e).eq("id",u.id);if(t)throw t}else{let{error:t}=await l.OQ.from("product_categories").insert([e]);if(t)throw t}O(),_()}catch(e){console.error("カテゴリ情報の保存に失敗しました:",e),alert("保存に失敗しました。もう一度お試しください。")}finally{N(!1)}}},k=e=>{x(e),v({name:e.name,description:e.description||"",display_order:e.display_order,is_active:e.is_active}),m(!0)},S=async()=>{if(h)try{let{data:e,error:t}=await l.OQ.from("products").select("id").eq("category_id",h.id).limit(1);if(t)throw t;if(e&&e.length>0){alert("このカテゴリを使用している商品が存在するため、削除できません。"),g(null);return}let{error:s}=await l.OQ.from("product_categories").delete().eq("id",h.id);if(s)throw s;g(null),_()}catch(e){console.error("カテゴリ情報の削除に失敗しました:",e),alert("削除に失敗しました。もう一度お試しください。")}},P=async e=>{try{let{error:t}=await l.OQ.from("product_categories").update({is_active:!e.is_active,updated_at:new Date().toISOString()}).eq("id",e.id);if(t)throw t;_()}catch(e){console.error("カテゴリ状態の更新に失敗しました:",e),alert("状態の更新に失敗しました。")}},O=()=>{v({name:"",description:"",display_order:e.length,is_active:!0}),f({}),x(null),m(!1)},J=e=>t=>{let s="display_order"===e?parseInt(t.target.value)||0:"is_active"===e?t.target.checked:t.target.value;v({...p,[e]:s}),j[e]&&f({...j,[e]:""})};return(0,a.jsxs)("div",{className:"container-fluid py-4",children:[(0,a.jsxs)("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"h3 text-dark fw-bold mb-1",children:"商品カテゴリ管理"}),(0,a.jsx)("p",{className:"text-muted mb-0",children:"商品カテゴリの追加・編集・削除・並び順の管理"})]}),(0,a.jsxs)("button",{onClick:()=>m(!0),className:"btn btn-success d-flex align-items-center",children:[(0,a.jsx)(r.JO,{icon:r.PJ.add,size:"sm",className:"me-2"}),"新規カテゴリ追加"]})]}),(0,a.jsx)("div",{className:"card mb-4",children:(0,a.jsx)("div",{className:"card-body",children:(0,a.jsxs)("div",{className:"position-relative",children:[(0,a.jsx)(r.JO,{icon:r.PJ.search,size:"sm",className:"position-absolute top-50 start-0 translate-middle-y ms-3 text-muted"}),(0,a.jsx)("input",{type:"text",placeholder:"カテゴリ名、説明で検索...",value:c,onChange:e=>d(e.target.value),className:"form-control ps-5"})]})})}),(0,a.jsxs)("div",{className:"card",children:[(0,a.jsx)("div",{className:"card-header bg-light",children:(0,a.jsxs)("h5",{className:"card-title mb-0",children:["カテゴリ一覧 (",w.length,"件)"]})}),(0,a.jsx)("div",{className:"card-body p-0",children:s?(0,a.jsxs)("div",{className:"d-flex align-items-center justify-content-center py-5",children:[(0,a.jsx)(r.JO,{icon:r.PJ.loading,size:"lg",className:"animate-spin text-primary me-2"}),(0,a.jsx)("span",{className:"text-muted",children:"読み込み中..."})]}):w.length>0?(0,a.jsx)("div",{className:"table-responsive",children:(0,a.jsxs)("table",{className:"table table-hover mb-0",children:[(0,a.jsx)("thead",{className:"table-light",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"border-0",children:"表示順"}),(0,a.jsx)("th",{className:"border-0",children:"カテゴリ名"}),(0,a.jsx)("th",{className:"border-0",children:"説明"}),(0,a.jsx)("th",{className:"border-0",children:"状態"}),(0,a.jsx)("th",{className:"border-0",children:"作成日"}),(0,a.jsx)("th",{className:"border-0 text-end",children:"操作"})]})}),(0,a.jsx)("tbody",{children:w.map(e=>(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{children:(0,a.jsx)("span",{className:"badge bg-secondary",children:e.display_order})}),(0,a.jsx)("td",{children:(0,a.jsxs)("div",{className:"d-flex align-items-center",children:[(0,a.jsx)(r.JO,{icon:r.PJ.tag,size:"sm",className:"text-primary me-2"}),(0,a.jsx)("span",{className:"fw-medium",children:e.name})]})}),(0,a.jsx)("td",{children:(0,a.jsx)("span",{className:"text-muted",children:e.description||"説明なし"})}),(0,a.jsx)("td",{children:(0,a.jsxs)("button",{onClick:()=>P(e),className:"btn btn-sm ".concat(e.is_active?"btn-outline-success":"btn-outline-secondary"),children:[(0,a.jsx)(r.JO,{icon:e.is_active?r.PJ.eye:r.PJ.eyeOff,size:"xs",className:"me-1"}),e.is_active?"有効":"無効"]})}),(0,a.jsx)("td",{className:"text-muted",children:new Date(e.created_at).toLocaleDateString("ja-JP")}),(0,a.jsx)("td",{children:(0,a.jsxs)("div",{className:"d-flex justify-content-end gap-1",children:[(0,a.jsx)("button",{onClick:()=>k(e),className:"btn btn-sm btn-outline-primary",title:"編集",children:(0,a.jsx)(r.JO,{icon:r.PJ.edit,size:"xs"})}),(0,a.jsx)("button",{onClick:()=>g(e),className:"btn btn-sm btn-outline-danger",title:"削除",children:(0,a.jsx)(r.JO,{icon:r.PJ.delete,size:"xs"})})]})})]},e.id))})]})}):(0,a.jsxs)("div",{className:"text-center py-5",children:[(0,a.jsx)(r.JO,{icon:r.PJ.tag,size:"xl",className:"text-muted mb-3"}),(0,a.jsx)("p",{className:"text-muted",children:c?"検索条件に合うカテゴリが見つかりません":"登録されているカテゴリがありません"}),!c&&(0,a.jsx)("button",{onClick:()=>m(!0),className:"btn btn-success mt-2",children:"初めてのカテゴリを追加"})]})})]}),o&&(0,a.jsx)("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.5)"},children:(0,a.jsx)("div",{className:"modal-dialog modal-lg",children:(0,a.jsxs)("div",{className:"modal-content",children:[(0,a.jsxs)("div",{className:"modal-header",children:[(0,a.jsx)("h5",{className:"modal-title",children:u?"カテゴリ編集":"新規カテゴリ追加"}),(0,a.jsx)("button",{type:"button",className:"btn-close",onClick:O})]}),(0,a.jsxs)("form",{onSubmit:C,children:[(0,a.jsx)("div",{className:"modal-body",children:(0,a.jsxs)("div",{className:"row g-3",children:[(0,a.jsxs)("div",{className:"col-md-8",children:[(0,a.jsxs)("label",{className:"form-label",children:["カテゴリ名 ",(0,a.jsx)("span",{className:"text-danger",children:"*"})]}),(0,a.jsx)("input",{type:"text",value:p.name,onChange:J("name"),className:"form-control ".concat(j.name?"is-invalid":""),placeholder:"野菜の苗、花の苗など"}),j.name&&(0,a.jsx)("div",{className:"invalid-feedback",children:j.name})]}),(0,a.jsxs)("div",{className:"col-md-4",children:[(0,a.jsx)("label",{className:"form-label",children:"表示順序"}),(0,a.jsx)("input",{type:"number",value:p.display_order,onChange:J("display_order"),className:"form-control ".concat(j.display_order?"is-invalid":""),min:"0"}),j.display_order&&(0,a.jsx)("div",{className:"invalid-feedback",children:j.display_order})]}),(0,a.jsxs)("div",{className:"col-12",children:[(0,a.jsx)("label",{className:"form-label",children:"説明"}),(0,a.jsx)("textarea",{value:p.description,onChange:J("description"),className:"form-control",rows:3,placeholder:"このカテゴリの説明を入力してください"})]}),(0,a.jsx)("div",{className:"col-12",children:(0,a.jsxs)("div",{className:"form-check",children:[(0,a.jsx)("input",{type:"checkbox",id:"is_active",checked:p.is_active,onChange:J("is_active"),className:"form-check-input"}),(0,a.jsx)("label",{htmlFor:"is_active",className:"form-check-label",children:"このカテゴリを有効にする"})]})})]})}),(0,a.jsxs)("div",{className:"modal-footer",children:[(0,a.jsx)("button",{type:"button",onClick:O,className:"btn btn-secondary",children:"キャンセル"}),(0,a.jsx)("button",{type:"submit",disabled:y,className:"btn btn-primary d-flex align-items-center",children:y?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(r.JO,{icon:r.PJ.loading,size:"sm",className:"animate-spin me-2"}),"保存中..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(r.JO,{icon:r.PJ.save,size:"sm",className:"me-2"}),u?"更新":"追加"]})})]})]})]})})}),(0,a.jsx)(b,{isOpen:!!h,title:"カテゴリの削除",itemName:(null==h?void 0:h.name)||"",onConfirm:S,onCancel:()=>g(null)})]})},F=()=>{let[e,t]=(0,n.useState)([]),[s,i]=(0,n.useState)(!0),[c,d]=(0,n.useState)(""),[o,m]=(0,n.useState)(!1),[u,x]=(0,n.useState)(null),[h,g]=(0,n.useState)(null),[p,v]=(0,n.useState)({name:"",furigana:"",email:"",phone:"",postal_code:"",prefecture:"",city:"",address:"",birth_date:"",gender:""}),[j,f]=(0,n.useState)({}),[y,N]=(0,n.useState)(!1);(0,n.useEffect)(()=>{_()},[]);let _=async()=>{i(!0);try{let{data:e,error:s}=await l.OQ.from("customers").select("*").order("created_at",{ascending:!1});if(s)throw s;t(e||[])}catch(e){console.error("顧客情報の取得に失敗しました:",e)}finally{i(!1)}},w=e.filter(e=>{var t,s;return e.name.toLowerCase().includes(c.toLowerCase())||(null===(t=e.phone)||void 0===t?void 0:t.includes(c))||(null===(s=e.email)||void 0===s?void 0:s.toLowerCase().includes(c.toLowerCase()))}),D=()=>{let e={};return p.name.trim()||(e.name="氏名は必須です"),p.phone.trim()?/^[\d\-\+\(\)\s]+$/.test(p.phone)||(e.phone="有効な電話番号を入力してください"):e.phone="電話番号は必須です",p.email&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(p.email)&&(e.email="有効なメールアドレスを入力してください"),p.postal_code&&!/^\d{3}-?\d{4}$/.test(p.postal_code)&&(e.postal_code="有効な郵便番号を入力してください（例: 123-4567）"),f(e),0===Object.keys(e).length},C=async e=>{if(e.preventDefault(),D()){N(!0);try{let e={name:p.name.trim(),furigana:p.furigana.trim()||null,email:p.email.trim()||null,phone:p.phone.trim(),postal_code:p.postal_code.trim()||null,prefecture:p.prefecture.trim()||null,city:p.city.trim()||null,address:p.address.trim()||null,birth_date:p.birth_date||null,gender:p.gender||null,updated_at:new Date().toISOString()};if(u){let{error:t}=await l.OQ.from("customers").update(e).eq("id",u.id);if(t)throw t}else{let{error:t}=await l.OQ.from("customers").insert([e]);if(t)throw t}P(),_()}catch(e){console.error("顧客情報の保存に失敗しました:",e),alert("保存に失敗しました。もう一度お試しください。")}finally{N(!1)}}},k=e=>{x(e),v({name:e.name,furigana:e.furigana||"",email:e.email||"",phone:e.phone||"",postal_code:e.postal_code||"",prefecture:e.prefecture||"",city:e.city||"",address:e.address||"",birth_date:e.birth_date||"",gender:e.gender||""}),m(!0)},S=async()=>{if(h)try{let{error:e}=await l.OQ.from("customers").delete().eq("id",h.id);if(e)throw e;g(null),_()}catch(e){console.error("顧客情報の削除に失敗しました:",e),alert("削除に失敗しました。もう一度お試しください。")}},P=()=>{v({name:"",furigana:"",email:"",phone:"",postal_code:"",prefecture:"",city:"",address:"",birth_date:"",gender:""}),f({}),x(null),m(!1)},O=e=>t=>{v({...p,[e]:t.target.value}),j[e]&&f({...j,[e]:""})};return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-gray-800",children:"顧客管理"}),(0,a.jsx)("p",{className:"text-gray-600",children:"顧客情報の一覧・追加・編集・削除"})]}),(0,a.jsxs)("button",{onClick:()=>m(!0),className:"btn-modern btn-primary-modern flex items-center space-x-2",children:[(0,a.jsx)(r.JO,{icon:r.PJ.add,size:"sm"}),(0,a.jsx)("span",{children:"新規顧客追加"})]})]}),(0,a.jsx)("div",{className:"admin-card",children:(0,a.jsx)("div",{className:"admin-card-content",children:(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,a.jsx)(r.JO,{icon:r.PJ.search,size:"sm",className:"text-gray-400"})}),(0,a.jsx)("input",{type:"text",placeholder:"名前、電話番号、メールアドレスで検索...",value:c,onChange:e=>d(e.target.value),className:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})})}),(0,a.jsxs)("div",{className:"admin-card",children:[(0,a.jsx)("div",{className:"admin-card-header",children:(0,a.jsxs)("h3",{className:"admin-card-title",children:["顧客一覧 (",w.length,"件)"]})}),(0,a.jsx)("div",{className:"admin-card-content",children:s?(0,a.jsxs)("div",{className:"flex items-center justify-center py-12",children:[(0,a.jsx)(r.JO,{icon:r.PJ.loading,size:"lg",className:"animate-spin text-blue-500"}),(0,a.jsx)("span",{className:"ml-2 text-gray-600",children:"読み込み中..."})]}):w.length>0?(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"顧客情報"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"連絡先"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"住所"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"登録日"}),(0,a.jsx)("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"操作"})]})}),(0,a.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:w.map(e=>(0,a.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"flex-shrink-0 h-10 w-10 lg:h-12 lg:w-12",children:(0,a.jsx)("div",{className:"h-10 w-10 lg:h-12 lg:w-12 rounded-full bg-gray-200 flex items-center justify-center",children:(0,a.jsx)(r.JO,{icon:r.PJ.user,size:"sm",className:"text-gray-500 lg:text-base"})})}),(0,a.jsxs)("div",{className:"ml-4",children:[(0,a.jsx)("div",{className:"text-sm lg:text-base font-medium text-gray-900",children:e.name}),e.furigana&&(0,a.jsx)("div",{className:"text-sm lg:text-base text-gray-500",children:e.furigana})]})]})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsxs)("div",{className:"text-sm text-gray-900",children:[e.phone&&(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(r.JO,{icon:r.PJ.phone,size:"xs",className:"text-gray-400 mr-1"}),e.phone]}),e.email&&(0,a.jsxs)("div",{className:"flex items-center mt-1",children:[(0,a.jsx)(r.JO,{icon:r.PJ.mail,size:"xs",className:"text-gray-400 mr-1"}),e.email]})]})}),(0,a.jsx)("td",{className:"px-6 py-4",children:(0,a.jsxs)("div",{className:"text-sm text-gray-900",children:[e.postal_code&&(0,a.jsxs)("div",{children:["〒",e.postal_code]}),(e.prefecture||e.city||e.address)&&(0,a.jsxs)("div",{className:"text-sm text-gray-600",children:[e.prefecture,e.city,e.address]})]})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:new Date(e.created_at).toLocaleDateString("ja-JP")}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:(0,a.jsxs)("div",{className:"flex items-center justify-end space-x-2",children:[(0,a.jsx)("button",{onClick:()=>k(e),className:"text-blue-600 hover:text-blue-900",title:"編集",children:(0,a.jsx)(r.JO,{icon:r.PJ.edit,size:"sm"})}),(0,a.jsx)("button",{onClick:()=>g(e),className:"text-red-600 hover:text-red-900",title:"削除",children:(0,a.jsx)(r.JO,{icon:r.PJ.delete,size:"sm"})})]})})]},e.id))})]})}):(0,a.jsxs)("div",{className:"text-center py-12",children:[(0,a.jsx)(r.JO,{icon:r.PJ.users,size:"xl",className:"text-gray-400 mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-gray-600",children:c?"検索条件に合う顧客が見つかりません":"登録されている顧客がいません"}),!c&&(0,a.jsx)("button",{onClick:()=>m(!0),className:"mt-4 btn-modern btn-primary-modern",children:"初めての顧客を追加"})]})})]}),o&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-hidden",children:[(0,a.jsx)("div",{className:"p-6 border-b border-gray-200",children:(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:u?"顧客情報編集":"新規顧客追加"}),(0,a.jsx)("button",{onClick:P,className:"text-gray-400 hover:text-gray-600",children:(0,a.jsx)(r.JO,{icon:r.PJ.closeIcon,size:"md"})})]})}),(0,a.jsxs)("form",{onSubmit:C,className:"p-6 overflow-y-auto",style:{maxHeight:"calc(90vh - 160px)"},children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["氏名 ",(0,a.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,a.jsx)("input",{type:"text",value:p.name,onChange:O("name"),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 ".concat(j.name?"border-red-300":"border-gray-300"),placeholder:"山田 太郎"}),j.name&&(0,a.jsx)("p",{className:"mt-1 text-sm text-red-600",children:j.name})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"フリガナ"}),(0,a.jsx)("input",{type:"text",value:p.furigana,onChange:O("furigana"),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"ヤマダ タロウ"})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["電話番号 ",(0,a.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,a.jsx)("input",{type:"tel",value:p.phone,onChange:O("phone"),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 ".concat(j.phone?"border-red-300":"border-gray-300"),placeholder:"090-1234-5678"}),j.phone&&(0,a.jsx)("p",{className:"mt-1 text-sm text-red-600",children:j.phone})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"メールアドレス"}),(0,a.jsx)("input",{type:"email",value:p.email,onChange:O("email"),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 ".concat(j.email?"border-red-300":"border-gray-300"),placeholder:"example@email.com"}),j.email&&(0,a.jsx)("p",{className:"mt-1 text-sm text-red-600",children:j.email})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"郵便番号"}),(0,a.jsx)("input",{type:"text",value:p.postal_code,onChange:O("postal_code"),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 ".concat(j.postal_code?"border-red-300":"border-gray-300"),placeholder:"123-4567"}),j.postal_code&&(0,a.jsx)("p",{className:"mt-1 text-sm text-red-600",children:j.postal_code})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"都道府県"}),(0,a.jsx)("input",{type:"text",value:p.prefecture,onChange:O("prefecture"),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"東京都"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"市区町村"}),(0,a.jsx)("input",{type:"text",value:p.city,onChange:O("city"),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"新宿区"})]}),(0,a.jsxs)("div",{className:"md:col-span-2",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"住所"}),(0,a.jsx)("input",{type:"text",value:p.address,onChange:O("address"),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"西新宿1-1-1"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"生年月日"}),(0,a.jsx)("input",{type:"date",value:p.birth_date,onChange:O("birth_date"),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"性別"}),(0,a.jsxs)("select",{value:p.gender,onChange:O("gender"),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,a.jsx)("option",{value:"",children:"選択してください"}),(0,a.jsx)("option",{value:"男性",children:"男性"}),(0,a.jsx)("option",{value:"女性",children:"女性"}),(0,a.jsx)("option",{value:"その他",children:"その他"}),(0,a.jsx)("option",{value:"回答しない",children:"回答しない"})]})]})]}),(0,a.jsxs)("div",{className:"flex justify-end space-x-3 mt-6 pt-6 border-t",children:[(0,a.jsx)("button",{type:"button",onClick:P,className:"px-4 py-2 text-gray-700 bg-gray-200 rounded-lg hover:bg-gray-300 transition-colors",children:"キャンセル"}),(0,a.jsx)("button",{type:"submit",disabled:y,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2",children:y?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(r.JO,{icon:r.PJ.loading,size:"sm",className:"animate-spin"}),(0,a.jsx)("span",{children:"保存中..."})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(r.JO,{icon:r.PJ.save,size:"sm"}),(0,a.jsx)("span",{children:u?"更新":"追加"})]})})]})]})]})}),(0,a.jsx)(b,{isOpen:!!h,title:"顧客情報の削除",itemName:(null==h?void 0:h.name)||"",onConfirm:S,onCancel:()=>g(null)})]})};function L(){let[e,t]=(0,n.useState)(""),[s,r]=(0,n.useState)(""),[l,c]=(0,n.useState)(!1),{signIn:d}=(0,i.a)(),o=async t=>{t.preventDefault(),c(!0);try{await d(e,s)}finally{c(!1)}};return(0,a.jsxs)("div",{className:"min-h-screen flex items-center justify-center relative bg-gradient-to-br from-green-50 to-amber-50 px-4",style:{backgroundImage:"url(/images/login-background.jpg)",backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"},children:[(0,a.jsx)("div",{className:"absolute inset-0 bg-gradient-to-br from-green-900/70 to-amber-900/70 backdrop-blur-sm"}),(0,a.jsxs)("div",{className:"relative z-10 w-full max-w-sm mx-auto space-y-6 bg-white/95 backdrop-blur-md p-6 rounded-2xl shadow-2xl border border-white/20 animate-slideUp",children:[(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"text-5xl mb-3 animate-bounce",children:"\uD83C\uDF31"}),(0,a.jsx)("h2",{className:"text-2xl sm:text-3xl font-bold bg-gradient-to-r from-green-700 to-amber-700 bg-clip-text text-transparent",children:"片桐商店 ベジライス"}),(0,a.jsx)("p",{className:"mt-2 text-gray-600 text-sm sm:text-base",children:"管理システム"})]}),(0,a.jsxs)("form",{className:"space-y-4",onSubmit:o,children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-2",children:"メールアドレス"}),(0,a.jsx)("input",{id:"email",name:"email",type:"email",required:!0,autoComplete:"username",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all duration-200 bg-white/90 text-base",placeholder:"admin@katagiri-shop.com",value:e,onChange:e=>t(e.target.value),disabled:l})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-2",children:"パスワード"}),(0,a.jsx)("input",{id:"password",name:"password",type:"password",required:!0,autoComplete:"current-password",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all duration-200 bg-white/90 text-base",placeholder:"パスワードを入力してください",value:s,onChange:e=>r(e.target.value),disabled:l})]}),(0,a.jsx)("div",{children:(0,a.jsx)("button",{type:"submit",disabled:l,className:"w-full flex justify-center py-3 px-4 border border-transparent text-sm font-medium rounded-lg text-white bg-gradient-to-r from-green-600 to-amber-600 hover:from-green-700 hover:to-amber-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition-all duration-200 transform hover:scale-105 hover:shadow-lg disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none",children:l?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"ログイン中..."]}):(0,a.jsx)(a.Fragment,{children:"\uD83D\uDD13 ログイン"})})}),(0,a.jsx)("div",{className:"text-center text-sm text-gray-500",children:(0,a.jsx)("p",{children:"管理者アカウントでログインしてください"})})]})]})]})}function z(){let{user:e,loading:t,isAdmin:s}=(0,i.a)(),[r,l]=(0,n.useState)("dashboard");return t?(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-green-600 mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-gray-600",children:"認証情報を確認中..."})]})}):e&&s?(0,a.jsx)(m,{currentPage:r,onPageChange:l,children:(()=>{switch(r){case"dashboard":return(0,a.jsx)(h,{onPageChange:l});case"reservation-list":return(0,a.jsx)(P,{});case"reservation-calendar":return(0,a.jsxs)("div",{className:"admin-card",children:[(0,a.jsx)("div",{className:"admin-card-header",children:(0,a.jsx)("h2",{className:"admin-card-title",children:"予約カレンダー"})}),(0,a.jsxs)("div",{className:"text-center py-12",children:[(0,a.jsx)("div",{className:"text-6xl mb-4",children:"\uD83D\uDDD3️"}),(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"予約カレンダー"}),(0,a.jsx)("p",{className:"text-gray-600",children:"カレンダー形式で予約を管理します。"})]})]});case"reservation-search":return(0,a.jsxs)("div",{className:"admin-card",children:[(0,a.jsx)("div",{className:"admin-card-header",children:(0,a.jsx)("h2",{className:"admin-card-title",children:"予約検索"})}),(0,a.jsxs)("div",{className:"text-center py-12",children:[(0,a.jsx)("div",{className:"text-6xl mb-4",children:"\uD83D\uDD0D"}),(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"予約検索"}),(0,a.jsx)("p",{className:"text-gray-600",children:"詳細条件で予約を検索します。"})]})]});case"product-list":return(0,a.jsx)(_,{});case"product-add":return(0,a.jsx)(D,{});case"product-categories":return(0,a.jsx)(J,{});case"customer-list":return(0,a.jsx)(F,{});case"customer-search":return(0,a.jsxs)("div",{className:"admin-card",children:[(0,a.jsx)("div",{className:"admin-card-header",children:(0,a.jsx)("h2",{className:"admin-card-title",children:"顧客検索"})}),(0,a.jsxs)("div",{className:"text-center py-12",children:[(0,a.jsx)("div",{className:"text-6xl mb-4",children:"\uD83D\uDD0D"}),(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"顧客検索"}),(0,a.jsx)("p",{className:"text-gray-600",children:"詳細条件で顧客を検索します。"})]})]});case"form-builder":return(0,a.jsx)(f,{});case"form-list":return(0,a.jsx)(y,{});case"form-settings":return(0,a.jsxs)("div",{className:"admin-card",children:[(0,a.jsx)("div",{className:"admin-card-header",children:(0,a.jsx)("h2",{className:"admin-card-title",children:"フォーム設定"})}),(0,a.jsxs)("div",{className:"text-center py-12",children:[(0,a.jsx)("div",{className:"text-6xl mb-4",children:"⚙️"}),(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"フォーム設定"}),(0,a.jsxs)("p",{className:"text-gray-600",children:["フォーム全体の設定を管理します。",(0,a.jsx)("br",{}),"通知設定、デザイン設定、セキュリティ設定など。"]})]})]});case"business-settings":return(0,a.jsxs)("div",{className:"admin-card",children:[(0,a.jsx)("div",{className:"admin-card-header",children:(0,a.jsx)("h2",{className:"admin-card-title",children:"店舗設定"})}),(0,a.jsxs)("div",{className:"text-center py-12",children:[(0,a.jsx)("div",{className:"text-6xl mb-4",children:"\uD83C\uDFEA"}),(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"店舗設定"}),(0,a.jsx)("p",{className:"text-gray-600",children:"店舗情報、営業時間、連絡先などの基本設定を管理します。"})]})]});case"notification-settings":return(0,a.jsx)(O,{});case"user-management":return(0,a.jsxs)("div",{className:"admin-card",children:[(0,a.jsx)("div",{className:"admin-card-header",children:(0,a.jsx)("h2",{className:"admin-card-title",children:"ユーザー管理"})}),(0,a.jsxs)("div",{className:"text-center py-12",children:[(0,a.jsx)("div",{className:"text-6xl mb-4",children:"\uD83D\uDC68‍\uD83D\uDCBC"}),(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"ユーザー管理"}),(0,a.jsx)("p",{className:"text-gray-600",children:"管理者ユーザーの追加・編集・権限設定を行います。"})]})]});default:return(0,a.jsx)(h,{})}})()}):(0,a.jsx)(L,{})}},7464:function(e,t,s){"use strict";s.d(t,{AuthProvider:function(){return d},a:function(){return c}});var a=s(7437),n=s(2265),i=s(2141),r=s(9703);let l=(0,n.createContext)(void 0),c=()=>{let e=(0,n.useContext)(l);if(!e)throw Error("useAuth must be used within an AuthProvider");return e},d=e=>{var t,s;let{children:c}=e,[d,o]=(0,n.useState)(null),[m,u]=(0,n.useState)(null),[x,h]=(0,n.useState)(!0),{showError:g,showSuccess:p}=(0,r.p)(),v=(null==d?void 0:d.email)==="admin@katagiri-shop.com"||(null==d?void 0:null===(t=d.user_metadata)||void 0===t?void 0:t.role)==="admin"||(null==d?void 0:null===(s=d.app_metadata)||void 0===s?void 0:s.role)==="admin";(0,n.useEffect)(()=>{i.OQ.auth.getSession().then(e=>{var t;let{data:{session:s}}=e;u(s),o(null!==(t=null==s?void 0:s.user)&&void 0!==t?t:null),h(!1)});let{data:{subscription:e}}=i.OQ.auth.onAuthStateChange((e,t)=>{var s;u(t),o(null!==(s=null==t?void 0:t.user)&&void 0!==s?s:null),h(!1)});return()=>e.unsubscribe()},[]);let b=async(e,t)=>{try{h(!0);let{data:n,error:r}=await i.OQ.auth.signInWithPassword({email:e,password:t});if(r)return g("ログインに失敗しました",r.message),!1;if(n.user){var s,a;if(!("admin@katagiri-shop.com"===n.user.email||(null===(s=n.user.user_metadata)||void 0===s?void 0:s.role)==="admin"||(null===(a=n.user.app_metadata)||void 0===a?void 0:a.role)==="admin"))return await i.OQ.auth.signOut(),g("アクセス権限がありません","管理者アカウントでログインしてください"),!1;return p("ログインしました","管理画面へようこそ"),!0}return!1}catch(e){return g("ログインエラー",e.message||"予期しないエラーが発生しました"),!1}finally{h(!1)}},j=async()=>{try{h(!0);let{error:e}=await i.OQ.auth.signOut();e?g("ログアウトに失敗しました",e.message):p("ログアウトしました","")}catch(e){g("ログアウトエラー",e.message)}finally{h(!1)}};return(0,a.jsx)(l.Provider,{value:{user:d,session:m,loading:x,signIn:b,signOut:j,isAdmin:v},children:c})}},9703:function(e,t,s){"use strict";s.d(t,{ToastProvider:function(){return o},p:function(){return d}});var a=s(7437),n=s(2265),i=s(6882);let r=e=>{let{id:t,type:s,title:r,message:l,duration:c=5e3,onClose:d}=e;return(0,n.useEffect)(()=>{let e=setTimeout(()=>{d(t)},c);return()=>clearTimeout(e)},[t,c,d]),(0,a.jsx)("div",{className:"rounded-lg p-4 border shadow-lg max-w-sm w-full transition-all duration-300 ".concat((()=>{switch(s){case"success":return"bg-green-50 border-green-200 text-green-800";case"error":return"bg-red-50 border-red-200 text-red-800";case"warning":return"bg-yellow-50 border-yellow-200 text-yellow-800";case"info":return"bg-blue-50 border-blue-200 text-blue-800";default:return"bg-gray-50 border-gray-200 text-gray-800"}})()),children:(0,a.jsxs)("div",{className:"flex",children:[(0,a.jsx)("div",{className:"flex-shrink-0 ".concat((()=>{switch(s){case"success":return"text-green-500";case"error":return"text-red-500";case"warning":return"text-yellow-500";case"info":return"text-blue-500";default:return"text-gray-500"}})()),children:(0,a.jsx)(i.JO,{icon:(()=>{switch(s){case"success":return i.PJ.success;case"error":return i.PJ.error;case"warning":return i.PJ.warning;default:return i.PJ.info}})(),size:"md"})}),(0,a.jsxs)("div",{className:"ml-3 flex-1",children:[(0,a.jsx)("h3",{className:"text-sm font-medium",children:r}),l&&(0,a.jsx)("p",{className:"text-sm mt-1",children:l})]}),(0,a.jsx)("div",{className:"ml-4 flex-shrink-0",children:(0,a.jsx)("button",{onClick:()=>d(t),className:"inline-flex text-gray-400 hover:text-gray-600 focus:outline-none",children:(0,a.jsx)(i.JO,{icon:i.PJ.cancel,size:"sm"})})})]})})},l=e=>{let{toasts:t,onRemoveToast:s}=e;return(0,a.jsx)("div",{className:"fixed top-4 right-4 z-50 space-y-2",children:t.map(e=>(0,a.jsx)(r,{id:e.id,type:e.type,title:e.title,message:e.message,duration:e.duration,onClose:s},e.id))})},c=(0,n.createContext)(void 0),d=()=>{let e=(0,n.useContext)(c);if(!e)throw Error("useToast must be used within a ToastProvider");return e},o=e=>{let{children:t}=e,[s,i]=(0,n.useState)([]),r=e=>{let t=Math.random().toString(36).substr(2,9),s={...e,id:t};i(e=>[...e,s])};return(0,a.jsxs)(c.Provider,{value:{showToast:r,showSuccess:(e,t)=>{r({type:"success",title:e,message:t})},showError:(e,t)=>{r({type:"error",title:e,message:t})},showWarning:(e,t)=>{r({type:"warning",title:e,message:t})},showInfo:(e,t)=>{r({type:"info",title:e,message:t})}},children:[t,(0,a.jsx)(l,{toasts:s,onRemoveToast:e=>{i(t=>t.filter(t=>t.id!==e))}})]})}}},function(e){e.O(0,[100,880,971,117,744],function(){return e(e.s=9435)}),_N_E=e.O()}]);