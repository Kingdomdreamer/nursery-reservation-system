(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[512],{4499:function(e,t,i){Promise.resolve().then(i.bind(i,3749))},3749:function(e,t,i){"use strict";i.r(t),i.d(t,{default:function(){return n}});var r=i(7437);i(2265);var a=i(1254),c=i(3485);function n(){return(0,r.jsx)(a.Z,{children:(0,r.jsxs)("div",{className:"container-fluid",children:[(0,r.jsx)("div",{className:"row mb-4",children:(0,r.jsx)("div",{className:"col-12",children:(0,r.jsxs)("div",{className:"d-flex justify-content-between align-items-center",children:[(0,r.jsx)("h1",{className:"h2 fw-bold text-dark",children:"新規商品追加"}),(0,r.jsxs)("button",{onClick:()=>window.location.href="/admin/products",className:"btn btn-outline-secondary",children:[(0,r.jsx)("i",{className:"bi bi-arrow-left me-2"}),"商品一覧に戻る"]})]})})}),(0,r.jsx)(c.Z,{})]})})}},9976:function(e,t,i){"use strict";i.d(t,{M:function(){return a}});var r=i(2141);class a{static async getAllProducts(){let{data:e,error:t}=await r.O.from("products").select("*").order("created_at",{ascending:!1});if(t)throw t;return e||[]}static async getActiveProducts(){let{data:e,error:t}=await r.O.from("products").select("*").eq("is_available",!0).order("created_at",{ascending:!1});if(t)throw t;return e||[]}static async getProductsByCategory(e){let{data:t,error:i}=await r.O.from("products").select("*").eq("category_id",e).eq("is_available",!0).order("created_at",{ascending:!1});if(i)throw i;return t||[]}static async createProduct(e){let{data:t,error:i}=await r.O.from("products").insert([{...e,category_id:e.category_id||null,tax_type:e.tax_type||"inclusive",is_available:!1!==e.is_available,display_order:e.display_order||0}]).select();if(i)throw i;return t[0]}static async updateProduct(e,t){let{data:i,error:a}=await r.O.from("products").update({...t,category_id:t.category_id||null}).eq("id",e).select();if(a)throw a;return i[0]}static async deleteProduct(e){let{error:t}=await r.O.from("products").delete().eq("id",e);if(t)throw t;return!0}static async getAllCategories(){let{data:e,error:t}=await r.O.from("product_categories").select("*").eq("is_active",!0).order("display_order",{ascending:!0});if(t)throw t;return e||[]}static async bulkImportProducts(e){let t={success:0,failed:0,errors:[],warnings:[]},i=[];for(let r=0;r<e.length;r++){let a=e[r],c=r+2;if(!a.name||""===a.name.trim()){t.failed++,t.errors.push("行".concat(c,": 商品名が入力されていません"));continue}void 0!==a.price&&(isNaN(Number(a.price))||0>Number(a.price))&&(t.warnings.push("行".concat(c,": 価格が無効です。0に設定されます")),a.price=0),!a.id&&await this.getProductByName(a.name.trim())&&t.warnings.push("行".concat(c,": 商品「").concat(a.name,"」は既に存在します")),i.push({...a,lineNumber:c})}for(let e of i)try{var r,a,c,n,o,s;if(e.id){if(!await this.getProductById(e.id)){t.failed++,t.errors.push("行".concat(e.lineNumber,": ID「").concat(e.id,"」の商品が見つかりません"));continue}await this.updateProduct(e.id,{name:e.name.trim(),barcode:(null===(r=e.barcode)||void 0===r?void 0:r.trim())||void 0,price:e.price||0,variation_name:(null===(a=e.variation_name)||void 0===a?void 0:a.trim())||void 0,tax_type:e.tax_type||"inclusive",category_id:e.category_id||void 0,description:(null===(c=e.description)||void 0===c?void 0:c.trim())||void 0})}else await this.createProduct({name:e.name.trim(),barcode:(null===(n=e.barcode)||void 0===n?void 0:n.trim())||void 0,price:e.price||0,variation_name:(null===(o=e.variation_name)||void 0===o?void 0:o.trim())||void 0,tax_type:e.tax_type||"inclusive",category_id:e.category_id||void 0,description:(null===(s=e.description)||void 0===s?void 0:s.trim())||void 0,is_available:!0,display_order:0});t.success++}catch(r){t.failed++;let i=(null==r?void 0:r.message)||(null==r?void 0:r.toString())||"不明なエラー";t.errors.push("行".concat(e.lineNumber,": 商品「").concat(e.name,"」: ").concat(i))}return t}static async getProductByName(e){let{data:t,error:i}=await r.O.from("products").select("id, name").eq("name",e).limit(1);if(i)throw i;return(null==t?void 0:t[0])||null}static async getProductById(e){let{data:t,error:i}=await r.O.from("products").select("*").eq("id",e).limit(1);if(i)throw i;return(null==t?void 0:t[0])||null}static parseCSV(e){try{let t=e.replace(/\r\n/g,"\n").replace(/\r/g,"\n").trim().split("\n").filter(e=>e.trim());if(t.length<2)throw Error("CSVファイルが空か、ヘッダー行しかありません。最低でもヘッダー行とデータ行が必要です。");let i=t[0].trim();if(!i)throw Error("ヘッダー行が空です");let r=this.parseCSVLine(i).map(e=>e.trim().replace(/^["']|["']$/g,""));if(0===r.length)throw Error("ヘッダー行を解析できませんでした");let a=[],c=[],n=r.map(e=>e.toLowerCase()),o=["name"].filter(e=>!n.includes(e.toLowerCase()));if(o.length>0)throw Error("必須の列が見つかりません: ".concat(o.join(", "),"\n\n検出された列: ").concat(r.join(", "),"\n\n列名は大文字小文字を区別しません。"));for(let e=1;e<t.length;e++){let i=t[e].trim();if(i)try{let t=this.parseCSVLine(i);t.length,r.length;let n={},o=!1;r.forEach((i,r)=>{var a;let s=(null===(a=t[r])||void 0===a?void 0:a.trim().replace(/^["']|["']$/g,""))||"";switch(i.toLowerCase()){case"id":s&&(n.id=s);break;case"name":s?n.name=s:(c.push("行".concat(e+1,": 商品名が入力されていません")),o=!0);break;case"barcode":s&&(n.barcode=s);break;case"price":if(s){let t=parseFloat(s.replace(/[￥,]/g,""));isNaN(t)||t<0?c.push("行".concat(e+1,": 価格「").concat(s,"」が無効です（数値または0以上の値を入力してください）")):n.price=t}break;case"variation_name":s&&(n.variation_name=s);break;case"tax_type":if(s){let t=s.toLowerCase().trim();"内税"===t||"inclusive"===t?n.tax_type="inclusive":"外税"===t||"exclusive"===t?n.tax_type="exclusive":["inclusive","exclusive"].includes(t)?n.tax_type=t:c.push("行".concat(e+1,": 税区分「").concat(s,"」が無効です（内税/外税 または inclusive/exclusiveのみ）"))}break;case"category_id":s&&(n.category_id=s);break;case"description":s&&(n.description=s)}}),!o&&n.name&&a.push(n)}catch(t){c.push("行".concat(e+1,": 行の解析に失敗しました - ").concat(t.message))}}if(c.length>0){let e="CSVファイルに".concat(c.length,"個のエラーがあります:\n\n").concat(c.join("\n"));throw Error(e)}if(0===a.length)throw Error("有効な商品データが見つかりませんでした。\n\n以下を確認してください:\n• name列に値が入力されているか\n• データ行が存在するか\n• ファイル形式が正しいか");return a}catch(t){let e=t.message||"不明なエラーが発生しました";throw Error("CSV解析エラー: ".concat(e))}}static parseCSVLine(e){let t=[],i="",r=!1;for(let a=0;a<e.length;a++){let c=e[a];'"'===c||"'"===c?r&&e[a+1]===c?(i+=c,a++):r=!r:","!==c||r?i+=c:(t.push(i),i="")}return t.push(i),t}static generateCSVTemplate(e){var t;return"id,name,barcode,price,variation_name,tax_type,category_id,description\n"+["","トマト苗","4901234567890","300","通常価格","inclusive",(null===(t=e[0])||void 0===t?void 0:t.id)||"","中玉トマトの苗"].join(",")}static async exportToCSV(){return["id,name,barcode,price,variation_name,tax_type,category_id,description",...(await this.getAllProducts()).map(e=>[e.id,'"'.concat(e.name,'"'),e.barcode||"",e.price,e.variation_name||"",e.tax_type||"",e.category_id||"",'"'.concat(e.description||"",'"')].join(","))].join("\n")}}}},function(e){e.O(0,[454,580,448,760,485,362,744],function(){return e(e.s=4499)}),_N_E=e.O()}]);