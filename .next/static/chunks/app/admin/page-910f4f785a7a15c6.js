(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3],{9435:function(e,s,a){Promise.resolve().then(a.bind(a,3089))},3089:function(e,s,a){"use strict";a.r(s),a.d(s,{default:function(){return _}});var t=a(7437),i=a(2265),l=a(7464),r=a(1254),c=a(2141);function n(e){var s,a;let{onPageChange:l}=e,[r,n]=(0,i.useState)(!1),[d,o]=(0,i.useState)(null),[m,u]=(0,i.useState)(!1),[x,h]=(0,i.useState)([{icon:"bi-calendar-check",label:"今日の予約",value:"0",trend:"+0",trendLabel:"昨日比",trendType:"positive",color:"primary"},{icon:"bi-people",label:"総顧客数",value:"0",trend:"+0",trendLabel:"今月",trendType:"positive",color:"info"},{icon:"bi-file-earmark-text",label:"フォーム数",value:"0",trend:"+0",trendLabel:"今月追加",trendType:"positive",color:"success"}]),[p,j]=(0,i.useState)([]),v=(0,i.useCallback)(async()=>{try{let e=new Date().toISOString().split("T")[0],{data:s,error:a}=await c.O.from("reservations").select("*").gte("created_at","".concat(e,"T00:00:00")).lte("created_at","".concat(e,"T23:59:59")),{data:t,error:i}=await c.O.from("customers").select("*"),{data:l,error:r}=await c.O.from("forms").select("*"),{data:n,error:d}=await c.O.from("reservations").select("\n          id,\n          reservation_number,\n          status,\n          total_amount,\n          created_at,\n          updated_at,\n          customers!fk_reservations_customer_id(full_name)\n        ").order("created_at",{ascending:!1}).limit(5),o=(null==s?void 0:s.length)||0,m=(null==t?void 0:t.length)||0,u=(null==l?void 0:l.length)||0;h(e=>e.map((e,s)=>{switch(s){case 0:return{...e,value:o.toString()};case 1:return{...e,value:m.toString()};case 2:return{...e,value:u.toString()};default:return e}}));let x=(null==n?void 0:n.map(e=>{var s;return{icon:g(e.status),iconColor:f(e.status),text:"".concat((null===(s=e.customers)||void 0===s?void 0:s.full_name)||"匿名"," - ").concat(e.reservation_number),time:b(new Date(e.created_at)),amount:e.total_amount?"\xa5".concat(e.total_amount.toLocaleString()):null}}))||[];j(x)}catch(e){}},[]);(0,i.useEffect)(()=>{v()},[v]);let b=e=>{let s=new Date().getTime()-e.getTime(),a=Math.floor(s/6e4),t=Math.floor(s/36e5),i=Math.floor(s/864e5);return a<1?"たった今":a<60?"".concat(a,"分前"):t<24?"".concat(t,"時間前"):i<7?"".concat(i,"日前"):e.toLocaleDateString("ja-JP")},g=e=>{switch(e){case"confirmed":return"bi-check-circle";case"pending":return"bi-clock";case"completed":return"bi-check-circle-fill";case"cancelled":return"bi-x-circle";default:return"bi-info-circle"}},f=e=>{switch(e){case"confirmed":return"text-primary";case"pending":return"text-warning";case"completed":return"text-success";case"cancelled":return"text-danger";default:return"text-info"}},N=async()=>{u(!0);try{var e;let{data:s,error:a}=await c.O.from("forms").select("*");if(a)throw a;let t={totalForms:(null==s?void 0:s.length)||0,activeForms:(null==s?void 0:null===(e=s.filter(e=>e.is_active))||void 0===e?void 0:e.length)||0,issues:(null==s?void 0:s.length)===0?["フォームが作成されていません"]:[],recommendations:(null==s?void 0:s.length)===0?["最初のフォームを作成してください"]:["フォーム設定は正常です"]};o(t),n(!0)}catch(e){}finally{u(!1)}};return(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"row mb-4",children:(0,t.jsx)("div",{className:"col-12",children:(0,t.jsxs)("div",{className:"d-flex justify-content-between align-items-center",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"h2 fw-bold text-dark mb-1",children:"ダッシュボード"}),(0,t.jsx)("p",{className:"text-muted mb-0",children:"システムの概要と最新の活動状況"})]}),(0,t.jsxs)("button",{className:"btn btn-primary",onClick:v,children:[(0,t.jsx)("i",{className:"bi bi-arrow-clockwise me-2"}),"更新"]})]})})}),(0,t.jsx)("div",{className:"row g-4 mb-4",children:x.map((e,s)=>(0,t.jsx)("div",{className:"col-lg-4 col-md-6",children:(0,t.jsx)("div",{className:"dashboard-widget",children:(0,t.jsxs)("div",{className:"d-flex align-items-center justify-content-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"dashboard-widget-icon bg-".concat(e.color,"-subtle text-").concat(e.color),children:(0,t.jsx)("i",{className:e.icon})}),(0,t.jsx)("div",{className:"dashboard-widget-value",children:e.value}),(0,t.jsx)("div",{className:"dashboard-widget-label",children:e.label})]}),(0,t.jsxs)("div",{className:"text-end",children:[(0,t.jsxs)("span",{className:"badge bg-".concat("positive"===e.trendType?"success":"danger","-subtle text-").concat("positive"===e.trendType?"success":"danger"),children:[(0,t.jsx)("i",{className:"bi bi-arrow-".concat("positive"===e.trendType?"up":"down"," me-1")}),e.trend]}),(0,t.jsx)("div",{className:"text-muted small",children:e.trendLabel})]})]})})},s))}),(0,t.jsxs)("div",{className:"row g-4",children:[(0,t.jsx)("div",{className:"col-lg-8",children:(0,t.jsxs)("div",{className:"card h-100",children:[(0,t.jsxs)("div",{className:"card-header d-flex justify-content-between align-items-center",children:[(0,t.jsxs)("h5",{className:"mb-0",children:[(0,t.jsx)("i",{className:"bi bi-activity me-2"}),"最近のアクティビティ"]}),(0,t.jsxs)("button",{className:"btn btn-sm btn-outline-primary",onClick:()=>null==l?void 0:l("reservation-list"),children:[(0,t.jsx)("i",{className:"bi bi-eye me-1"}),"すべて見る"]})]}),(0,t.jsx)("div",{className:"card-body",children:p.length>0?(0,t.jsx)("div",{className:"d-flex flex-column gap-3",children:p.map((e,s)=>(0,t.jsxs)("div",{className:"d-flex align-items-start",children:[(0,t.jsx)("div",{className:"rounded-circle d-flex align-items-center justify-content-center me-3 ".concat(e.iconColor),style:{width:"40px",height:"40px",backgroundColor:"var(--bs-light)"},children:(0,t.jsx)("i",{className:e.icon})}),(0,t.jsx)("div",{className:"flex-grow-1",children:(0,t.jsxs)("div",{className:"d-flex justify-content-between align-items-start",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"mb-1 fw-medium",children:e.text}),(0,t.jsx)("small",{className:"text-muted",children:e.time})]}),e.amount&&(0,t.jsx)("span",{className:"badge bg-success-subtle text-success",children:e.amount})]})})]},s))}):(0,t.jsxs)("div",{className:"text-center py-4",children:[(0,t.jsx)("i",{className:"bi bi-clock-history text-muted",style:{fontSize:"3rem"}}),(0,t.jsx)("p",{className:"text-muted mt-2",children:"まだアクティビティがありません"})]})})]})}),(0,t.jsx)("div",{className:"col-lg-4",children:(0,t.jsxs)("div",{className:"card h-100",children:[(0,t.jsx)("div",{className:"card-header",children:(0,t.jsxs)("h5",{className:"mb-0",children:[(0,t.jsx)("i",{className:"bi bi-lightning me-2"}),"クイックアクション"]})}),(0,t.jsx)("div",{className:"card-body",children:(0,t.jsxs)("div",{className:"d-grid gap-3",children:[(0,t.jsxs)("button",{className:"btn btn-outline-primary",onClick:()=>null==l?void 0:l("reservation-list"),children:[(0,t.jsx)("i",{className:"bi bi-list-ul me-2"}),"予約一覧を見る"]}),(0,t.jsxs)("button",{className:"btn btn-outline-secondary",onClick:()=>null==l?void 0:l("product-list"),children:[(0,t.jsx)("i",{className:"bi bi-box-seam me-2"}),"商品管理"]}),(0,t.jsxs)("button",{className:"btn btn-outline-info",onClick:()=>null==l?void 0:l("form-list"),children:[(0,t.jsx)("i",{className:"bi bi-file-earmark-text me-2"}),"フォーム管理"]}),(0,t.jsx)("button",{className:"btn btn-outline-success",onClick:N,disabled:m,children:m?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("span",{className:"loading-spinner me-2"}),"チェック中..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("i",{className:"bi bi-gear me-2"}),"フォーム設定確認"]})})]})})]})})]}),r&&(0,t.jsx)("div",{className:"modal fade show d-block",tabIndex:-1,style:{backgroundColor:"rgba(0,0,0,0.5)"},children:(0,t.jsx)("div",{className:"modal-dialog modal-lg",children:(0,t.jsxs)("div",{className:"modal-content",children:[(0,t.jsxs)("div",{className:"modal-header",children:[(0,t.jsxs)("h5",{className:"modal-title",children:[(0,t.jsx)("i",{className:"bi bi-gear me-2"}),"フォーム設定診断結果"]}),(0,t.jsx)("button",{type:"button",className:"btn-close",onClick:()=>n(!1)})]}),(0,t.jsx)("div",{className:"modal-body",children:d&&(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"alert alert-info",children:[(0,t.jsx)("h6",{children:"診断概要"}),(0,t.jsxs)("p",{className:"mb-0",children:["総フォーム数: ",d.totalForms]}),(0,t.jsxs)("p",{className:"mb-0",children:["有効フォーム数: ",d.activeForms]})]}),(null===(s=d.issues)||void 0===s?void 0:s.length)>0&&(0,t.jsxs)("div",{className:"alert alert-warning",children:[(0,t.jsx)("h6",{children:"検出された問題"}),(0,t.jsx)("ul",{className:"mb-0",children:d.issues.map((e,s)=>(0,t.jsx)("li",{children:e},s))})]}),(null===(a=d.recommendations)||void 0===a?void 0:a.length)>0&&(0,t.jsxs)("div",{className:"alert alert-success",children:[(0,t.jsx)("h6",{children:"推奨事項"}),(0,t.jsx)("ul",{className:"mb-0",children:d.recommendations.map((e,s)=>(0,t.jsx)("li",{children:e},s))})]})]})}),(0,t.jsx)("div",{className:"modal-footer",children:(0,t.jsx)("button",{type:"button",className:"btn btn-secondary",onClick:()=>n(!1),children:"閉じる"})})]})})})]})}var d=a(3145),o=a(7755),m=a(6882),u=e=>{let{isOpen:s,onClose:a,onProductSelect:l,excludeProductIds:r=[]}=e,[n,d]=(0,i.useState)([]),[o,u]=(0,i.useState)([]),[x,h]=(0,i.useState)(""),[p,j]=(0,i.useState)("all"),[v,b]=(0,i.useState)(!1),[g,f]=(0,i.useState)(null),[N,y]=(0,i.useState)(""),[w,_]=(0,i.useState)(0),[k,C]=(0,i.useState)(1),[O,S]=(0,i.useState)(!1);(0,i.useEffect)(()=>{s&&(J(),P())},[s]);let J=async()=>{b(!0);try{let{data:e,error:s}=await c.O.from("products").select("\n          *,\n          category:product_categories(*),\n          variations:product_variations(*)\n        ").eq("is_available",!0).order("display_order",{ascending:!0});if(s)throw s;d(e||[])}catch(e){}finally{b(!1)}},P=async()=>{try{let{data:e,error:s}=await c.O.from("product_categories").select("*").eq("is_active",!0).order("display_order",{ascending:!0});if(s)throw s;u(e||[])}catch(e){}},q=n.filter(e=>{var s;let a="all"===p||e.category_id===p,t=e.name.toLowerCase().includes(x.toLowerCase())||(null===(s=e.description)||void 0===s?void 0:s.toLowerCase().includes(x.toLowerCase())),i=!r.includes(e.id);return a&&t&&i}),D=e=>{e.variations&&e.variations.length>0?(f(e),y(e.variations[0].id),_(e.variations[0].price),C(1),S(!0)):z(e)},z=(e,s,a,t)=>{l(e,a||e.price,s,t||1),I()},I=()=>{h(""),j("all"),f(null),y(""),_(0),C(1),S(!1),a()},F=e=>{var s;y(e);let a=null==g?void 0:null===(s=g.variations)||void 0===s?void 0:s.find(s=>s.id===e);a&&_(a.price)};return s?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,t.jsxs)("div",{className:"bg-white rounded-lg max-w-5xl w-full max-h-[90vh] overflow-hidden",children:[(0,t.jsxs)("div",{className:"p-6 border-b border-gray-200",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,t.jsxs)("h3",{className:"text-xl font-semibold text-gray-900 flex items-center space-x-2",children:[(0,t.jsx)(m.JO,{icon:m.PJ.packageIcon,size:"lg"}),(0,t.jsx)("span",{children:"商品を選択"})]}),(0,t.jsx)("button",{onClick:I,className:"p-2 text-gray-400 hover:text-gray-600 transition-colors",children:(0,t.jsx)(m.JO,{icon:m.PJ.closeIcon,size:"md"})})]}),(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4",children:[(0,t.jsxs)("div",{className:"flex-1 relative",children:[(0,t.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,t.jsx)(m.JO,{icon:m.PJ.searchIcon,size:"sm",className:"text-gray-400"})}),(0,t.jsx)("input",{type:"text",placeholder:"商品名で検索...",value:x,onChange:e=>h(e.target.value),className:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),(0,t.jsxs)("select",{value:p,onChange:e=>j(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[(0,t.jsx)("option",{value:"all",children:"全カテゴリ"}),o.map(e=>(0,t.jsx)("option",{value:e.id,children:e.name},e.id))]}),(0,t.jsx)("button",{onClick:J,disabled:v,className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors disabled:opacity-50",children:(0,t.jsx)(m.JO,{icon:m.PJ.refresh,size:"sm"})})]})]}),(0,t.jsx)("div",{className:"p-6 overflow-y-auto",style:{maxHeight:"calc(90vh - 200px)"},children:v?(0,t.jsxs)("div",{className:"flex items-center justify-center py-12",children:[(0,t.jsx)(m.JO,{icon:m.PJ.loading,size:"lg",className:"animate-spin text-blue-500"}),(0,t.jsx)("span",{className:"ml-2 text-gray-600",children:"商品を読み込み中..."})]}):q.length>0?(0,t.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:q.map(e=>{var s;return(0,t.jsxs)("div",{className:"border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow cursor-pointer",onClick:()=>D(e),children:[(0,t.jsx)("div",{className:"w-full h-32 bg-gray-100 rounded-lg mb-3 flex items-center justify-center",children:(0,t.jsx)(m.JO,{icon:m.PJ.packageIcon,size:"xl",className:"text-gray-400"})}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("h4",{className:"font-medium text-gray-900 line-clamp-2",children:e.name}),(0,t.jsx)("p",{className:"text-sm text-gray-500",children:null===(s=e.category)||void 0===s?void 0:s.name}),e.description&&(0,t.jsx)("p",{className:"text-sm text-gray-600 line-clamp-2",children:e.description}),(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"text-lg font-bold text-blue-600",children:["\xa5",e.price.toLocaleString()]}),e.variations&&e.variations.length>0&&(0,t.jsxs)("div",{className:"text-xs text-gray-500",children:[e.variations.length,"種類の選択肢"]})]}),(0,t.jsx)("div",{className:"flex items-center space-x-2",children:void 0!==e.stock_quantity&&null!==e.stock_quantity&&(0,t.jsxs)("span",{className:"text-xs px-2 py-1 rounded ".concat(e.stock_quantity>10?"bg-green-100 text-green-800":e.stock_quantity>0?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"),children:["在庫: ",e.stock_quantity]})})]}),(0,t.jsx)("button",{className:"w-full bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium",onClick:s=>{s.stopPropagation(),D(e)},children:e.variations&&e.variations.length>0?"詳細設定":"追加"})]})]},e.id)})}):(0,t.jsxs)("div",{className:"text-center py-12",children:[(0,t.jsx)(m.JO,{icon:m.PJ.searchIcon,size:"xl",className:"text-gray-400 mx-auto mb-4"}),(0,t.jsx)("p",{className:"text-gray-600",children:"条件に合う商品が見つかりません"}),(0,t.jsx)("p",{className:"text-sm text-gray-500 mt-2",children:"検索条件を変更してお試しください"})]})})]})}),O&&g&&(0,t.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-60 p-4",children:(0,t.jsxs)("div",{className:"bg-white rounded-lg max-w-md w-full",children:[(0,t.jsx)("div",{className:"p-6 border-b border-gray-200",children:(0,t.jsx)("h4",{className:"text-lg font-semibold text-gray-900",children:"商品設定"})}),(0,t.jsxs)("div",{className:"p-6 space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h5",{className:"font-medium text-gray-900 mb-2",children:g.name}),(0,t.jsx)("p",{className:"text-sm text-gray-600",children:g.description})]}),g.variations&&g.variations.length>0&&(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"バリエーション"}),(0,t.jsx)("select",{value:N,onChange:e=>F(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:g.variations.map(e=>(0,t.jsxs)("option",{value:e.id,children:[e.name," - \xa5",e.price.toLocaleString()]},e.id))})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"価格"}),(0,t.jsx)("input",{type:"number",value:w,onChange:e=>_(Number(e.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",min:"0"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"デフォルト数量"}),(0,t.jsx)("input",{type:"number",value:k,onChange:e=>C(Number(e.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",min:"1"})]})]}),(0,t.jsxs)("div",{className:"p-6 pt-0 flex justify-end space-x-3",children:[(0,t.jsx)("button",{onClick:()=>S(!1),className:"px-4 py-2 text-gray-700 bg-gray-200 rounded-lg hover:bg-gray-300 transition-colors",children:"キャンセル"}),(0,t.jsx)("button",{onClick:()=>{if(g){var e;let s=null===(e=g.variations)||void 0===e?void 0:e.find(e=>e.id===N);z(g,null==s?void 0:s.name,w,k)}S(!1)},className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"追加"})]})]})})]}):null},x=a(1463);let h={customer_name:{id:"customer_name",type:"text",label:"氏名",placeholder:"山田 太郎",required:!0,description:"フルネームでご記入ください",category:"customer"},customer_furigana:{id:"customer_furigana",type:"text",label:"フリガナ",placeholder:"ヤマダ タロウ",required:!1,description:"カタカナでご記入ください",category:"customer"},customer_phone:{id:"customer_phone",type:"tel",label:"電話番号",placeholder:"090-1234-5678",required:!0,description:"緊急時のご連絡先",category:"customer"},customer_postal_code:{id:"customer_postal_code",type:"text",label:"郵便番号",placeholder:"123-4567",required:!1,category:"customer"},customer_address:{id:"customer_address",type:"textarea",label:"住所",placeholder:"東京都渋谷区...",required:!1,category:"customer"},customer_birth_date:{id:"customer_birth_date",type:"date",label:"生年月日",required:!1,category:"customer"},customer_gender:{id:"customer_gender",type:"radio",label:"性別",required:!1,options:["男性","女性","その他","回答しない"],category:"customer"},reservation_date:{id:"reservation_date",type:"date",label:"受取希望日",required:!0,description:"商品をお受け取りいただく日をお選びください",category:"reservation"},special_requests:{id:"special_requests",type:"textarea",label:"ご要望・備考",placeholder:"その他ご要望がございましたらご記入ください",required:!1,category:"other"}};function p(){var e;let{formId:s,onFormSaved:a}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},[l,r]=(0,i.useState)({id:s||"form-".concat(Date.now()),name:"商品予約フォーム",description:"片桐商店 ベジライスの商品予約を承ります",fields:Object.values(h).map(e=>({...e,enabled:!0})),products:[],settings:{showProgress:!0,allowEdit:!0,confirmationMessage:"ご予約ありがとうございました。確認のお電話をさせていただきます。",businessName:"片桐商店 ベジライス",validFrom:void 0,validTo:void 0,isActive:!0}}),[n,p]=(0,i.useState)(!1),[j,v]=(0,i.useState)([]),[b,g]=(0,i.useState)([]),[f,N]=(0,i.useState)(!1),[y,w]=(0,i.useState)(!1),[_,k]=(0,i.useState)(""),[C,O]=(0,i.useState)("all"),[S,J]=(0,i.useState)(null);(0,i.useEffect)(()=>{q(),D(),s&&P()},[s]);let P=async()=>{if(s)try{let{data:e,error:a}=await c.O.from("forms").select("\n          *,\n          form_fields(*),\n          form_products(\n            *,\n            product:products(\n              *,\n              category:product_categories(*)\n            )\n          )\n        ").eq("id",s).single();if(a)throw a;if(e){let s={id:e.id,name:e.name,description:e.description,fields:(e.form_fields||[]).map(e=>({id:e.field_id,type:e.field_type,label:e.label,placeholder:e.placeholder,required:e.is_required,options:e.options,description:e.description,category:e.category||"other",enabled:e.is_enabled})),products:(e.form_products||[]).map(e=>{var s;return{id:e.product.id,name:e.product.name,category_name:null===(s=e.product.category)||void 0===s?void 0:s.name,price:e.product.price,variation_name:e.variation_name,selected_price:e.selected_price||e.product.price,selected_variation:e.variation_name}}),settings:{showProgress:e.show_progress||!0,allowEdit:e.allow_edit||!0,confirmationMessage:e.confirmation_message||"ご予約ありがとうございました。",businessName:e.business_name||"",validFrom:e.valid_from,validTo:e.valid_to,isActive:e.is_active}};r(s)}}catch(e){}},q=async()=>{try{let{data:e,error:s}=await c.O.from("products").select("\n          *,\n          category:product_categories(*)\n        ").eq("is_available",!0).order("display_order",{ascending:!0});if(s)throw s;v(e||[])}catch(e){}},D=async()=>{try{let{data:e,error:s}=await c.O.from("product_categories").select("*").eq("is_active",!0).order("display_order",{ascending:!0});if(s)throw s;g(e||[])}catch(e){}},z=e=>{r({...l,fields:l.fields.map(s=>s.id===e?{...s,enabled:!s.enabled}:s)})},I=e=>{J(e)},F=async()=>{p(!0);try{let{data:e,error:s}=await c.O.from("forms").upsert({id:l.id,name:l.name,description:l.description,show_progress:l.settings.showProgress,allow_edit:l.settings.allowEdit,confirmation_message:l.settings.confirmationMessage,business_name:l.settings.businessName,valid_from:l.settings.validFrom||null,valid_to:l.settings.validTo||null,is_active:l.settings.isActive,updated_at:new Date().toISOString()}).select().single();if(s)throw s;if(await c.O.from("form_fields").delete().eq("form_id",l.id),await c.O.from("form_products").delete().eq("form_id",l.id),l.fields.length>0){let e=l.fields.map((e,s)=>({form_id:l.id,field_id:e.id,field_type:e.type,label:e.label,placeholder:e.placeholder,is_required:e.required,options:e.options,description:e.description,category:e.category,is_enabled:e.enabled,display_order:s})),{error:s}=await c.O.from("form_fields").insert(e);if(s)throw s}if(l.products.length>0){let e=l.products.map((e,s)=>({form_id:l.id,product_id:e.id,selected_price:e.selected_price,variation_name:e.selected_variation,display_order:s})),{error:s}=await c.O.from("form_products").insert(e);if(s)throw s}a&&a(l.id),alert("フォーム設定を保存しました")}catch(e){alert("フォーム設定の保存に失敗しました。もう一度お試しください。")}finally{p(!1)}};j.filter(e=>{let s="all"===C||e.category_id===C,a=e.name.toLowerCase().includes(_.toLowerCase()),t=!l.products.find(s=>s.id===e.id);return s&&a&&t});let L={customer:{title:"顧客情報",icon:m.PJ.customerInfo},reservation:{title:"予約情報",icon:m.PJ.reservationInfo},other:{title:"その他",icon:m.PJ.otherInfo}},E=()=>{let e=window.location.origin;return"".concat(e,"/form/").concat(l.id)};return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-2xl font-bold text-gray-800",children:"予約フォーム設定"}),(0,t.jsx)("p",{className:"text-gray-600",children:"フォーム項目と予約対象商品を設定します"})]}),(0,t.jsxs)("div",{className:"flex gap-3",children:[(0,t.jsxs)("button",{onClick:()=>w(!y),className:"btn-modern btn-outline-modern flex items-center space-x-2",children:[(0,t.jsx)(m.JO,{icon:m.PJ.qrIcon,size:"sm"}),(0,t.jsx)("span",{children:"QRコード表示"})]}),(0,t.jsx)("button",{onClick:F,disabled:n,className:"btn-modern btn-success-modern flex items-center space-x-2 disabled:opacity-50 disabled:cursor-not-allowed",children:n?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(m.JO,{icon:m.PJ.loading,size:"sm",className:"animate-spin"}),(0,t.jsx)("span",{children:"保存中..."})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(m.JO,{icon:m.PJ.saveIcon,size:"sm"}),(0,t.jsx)("span",{children:"設定を保存"})]})})]})]}),y&&(0,t.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,t.jsxs)("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold",children:"フォームQRコード"}),(0,t.jsx)("button",{onClick:()=>w(!1),className:"btn-modern btn-ghost-modern btn-sm",children:(0,t.jsx)(m.JO,{icon:m.PJ.closeIcon,size:"sm"})})]}),(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)(d.default,{src:(()=>{let e=E();return"https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=".concat(encodeURIComponent(e))})(),alt:"フォームQRコード",width:200,height:200,className:"mx-auto mb-4",unoptimized:!0}),(0,t.jsx)("p",{className:"text-sm text-gray-600 mb-3",children:"このQRコードで予約フォームにアクセスできます"}),(0,t.jsx)("div",{className:"text-xs bg-gray-100 p-2 rounded break-all",children:E()}),(0,t.jsx)("button",{onClick:()=>navigator.clipboard.writeText(E()),className:"btn-modern btn-secondary-modern mt-3",children:"URLをコピー"})]})]})}),(0,t.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"admin-card",children:[(0,t.jsx)("div",{className:"admin-card-header",children:(0,t.jsx)("h3",{className:"admin-card-title",children:"基本設定"})}),(0,t.jsxs)("div",{className:"admin-card-content space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"フォーム名"}),(0,t.jsx)("input",{type:"text",value:l.name,onChange:e=>r({...l,name:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"説明文"}),(0,t.jsx)("textarea",{value:l.description,onChange:e=>r({...l,description:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",rows:3})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"受付開始日時"}),(0,t.jsx)("input",{type:"datetime-local",value:l.settings.validFrom||"",onChange:e=>r({...l,settings:{...l.settings,validFrom:e.target.value||void 0}}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"受付終了日時"}),(0,t.jsx)("input",{type:"datetime-local",value:l.settings.validTo||"",onChange:e=>r({...l,settings:{...l.settings,validTo:e.target.value||void 0}}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("label",{className:"flex items-center",children:[(0,t.jsx)("input",{type:"checkbox",checked:l.settings.isActive,onChange:e=>r({...l,settings:{...l.settings,isActive:e.target.checked}}),className:"mr-2"}),"フォームを有効にする"]}),(0,t.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:"無効にするとフォームにアクセスできなくなります"})]})]})]}),(0,t.jsxs)("div",{className:"admin-card",children:[(0,t.jsx)("div",{className:"admin-card-header",children:(0,t.jsx)("h3",{className:"admin-card-title",children:"フォーム項目設定"})}),(0,t.jsx)("div",{className:"admin-card-content",children:Object.entries(L).map(e=>{let[s,a]=e;return(0,t.jsxs)("div",{className:"mb-6",children:[(0,t.jsxs)("h4",{className:"flex items-center gap-2 font-medium text-gray-900 mb-3",children:[(0,t.jsx)(m.JO,{icon:a.icon,size:"sm"}),a.title]}),(0,t.jsx)("div",{className:"space-y-2",children:l.fields.filter(e=>e.category===s).map(e=>(0,t.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"font-medium",children:e.label}),(0,t.jsxs)("div",{className:"text-sm text-gray-500",children:[e.type," ",e.required&&"(必須)"]})]}),(0,t.jsxs)("label",{className:"relative inline-flex items-center cursor-pointer",children:[(0,t.jsx)("input",{type:"checkbox",checked:e.enabled,onChange:()=>z(e.id),className:"sr-only peer"}),(0,t.jsx)("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})]},e.id))})]},s)})})]}),(0,t.jsxs)("div",{className:"admin-card",children:[(0,t.jsx)("div",{className:"admin-card-header",children:(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)("h3",{className:"admin-card-title",children:"予約対象商品"}),(0,t.jsxs)("button",{onClick:()=>N(!0),className:"btn-modern btn-primary-modern btn-sm flex items-center space-x-2",children:[(0,t.jsx)(m.JO,{icon:m.PJ.packageIcon,size:"sm"}),(0,t.jsx)("span",{children:"商品を追加"})]})]})}),(0,t.jsx)("div",{className:"admin-card-content",children:l.products.length>0?(0,t.jsx)("div",{className:"space-y-3",children:l.products.map(e=>{var s;return(0,t.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"font-medium",children:e.name}),(0,t.jsxs)("div",{className:"text-sm text-gray-500",children:["\xa5",null===(s=e.selected_price)||void 0===s?void 0:s.toLocaleString(),e.selected_variation&&" (".concat(e.selected_variation,")"),e.category_name&&" - ".concat(e.category_name)]})]}),(0,t.jsx)("button",{onClick:()=>I(e.id),className:"btn-modern btn-danger-modern btn-sm btn-icon-only",children:(0,t.jsx)(m.JO,{icon:m.PJ.deleteIcon,size:"sm"})})]},e.id)})}):(0,t.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,t.jsx)("div",{className:"mb-4",children:(0,t.jsx)(m.JO,{icon:m.PJ.packageIcon,size:"xl",className:"mx-auto text-gray-400"})}),(0,t.jsx)("p",{children:"予約対象商品が設定されていません"}),(0,t.jsx)("p",{className:"text-sm",children:"「商品を追加」ボタンから商品を選択してください"})]})})]})]}),(0,t.jsxs)("div",{className:"admin-card",children:[(0,t.jsxs)("div",{className:"admin-card-header",children:[(0,t.jsx)("h3",{className:"admin-card-title",children:"フォームプレビュー"}),(0,t.jsx)("p",{className:"text-sm text-gray-600",children:"実際のフォーム画面と同じ表示・機能です"})]}),(0,t.jsx)("div",{className:"admin-card-content",children:(0,t.jsx)(o.Z,{formConfig:l})})]})]}),(0,t.jsx)(u,{isOpen:f,onClose:()=>N(!1),onProductSelect:(e,s,a,t)=>{var i;let c={id:e.id,name:e.name,category_name:null===(i=e.category)||void 0===i?void 0:i.name,price:e.price,variation_name:e.variation_name,selected_price:s||e.price,selected_variation:a||e.variation_name};r({...l,products:[...l.products,c]}),N(!1)},excludeProductIds:l.products.map(e=>e.id)}),(0,t.jsx)(x.$,{isOpen:!!S,title:"商品の削除",itemName:S?(null===(e=l.products.find(e=>e.id===S))||void 0===e?void 0:e.name)||"選択された商品":"",onConfirm:()=>{S&&(r({...l,products:l.products.filter(e=>e.id!==S)}),J(null))},onCancel:()=>J(null)})]})}var j=a(4135),v=a(7330),b=a(8737),g=a(5496),f=a(5120),N=()=>{let[e,s]=(0,i.useState)([]),[a,l]=(0,i.useState)(!0),[r,n]=(0,i.useState)(""),[d,o]=(0,i.useState)(!1),[u,h]=(0,i.useState)(null),[p,j]=(0,i.useState)(null),[v,b]=(0,i.useState)({name:"",description:"",display_order:0,is_active:!0}),[g,f]=(0,i.useState)({}),[N,y]=(0,i.useState)(!1);(0,i.useEffect)(()=>{w()},[]);let w=async()=>{l(!0);try{let{data:e,error:a}=await c.O.from("product_categories").select("*").order("display_order",{ascending:!0});if(a)throw a;s(e||[])}catch(e){}finally{l(!1)}},_=e.filter(e=>{var s;return e.name.toLowerCase().includes(r.toLowerCase())||(null===(s=e.description)||void 0===s?void 0:s.toLowerCase().includes(r.toLowerCase()))}),k=()=>{let e={};return v.name.trim()||(e.name="カテゴリ名は必須です"),v.display_order<0&&(e.display_order="表示順序は0以上の数値を入力してください"),f(e),0===Object.keys(e).length},C=async e=>{if(e.preventDefault(),k()){y(!0);try{let e={name:v.name.trim(),description:v.description.trim()||null,display_order:v.display_order,is_active:v.is_active,updated_at:new Date().toISOString()};if(u){let{error:s}=await c.O.from("product_categories").update(e).eq("id",u.id);if(s)throw s}else{let{error:s}=await c.O.from("product_categories").insert([e]);if(s)throw s}P(),w()}catch(e){alert("保存に失敗しました。もう一度お試しください。")}finally{y(!1)}}},O=e=>{h(e),b({name:e.name,description:e.description||"",display_order:e.display_order,is_active:e.is_active}),o(!0)},S=async()=>{if(p)try{let{data:e,error:s}=await c.O.from("products").select("id").eq("category_id",p.id).limit(1);if(s)throw s;if(e&&e.length>0){alert("このカテゴリを使用している商品が存在するため、削除できません。"),j(null);return}let{error:a}=await c.O.from("product_categories").delete().eq("id",p.id);if(a)throw a;j(null),w()}catch(e){alert("削除に失敗しました。もう一度お試しください。")}},J=async e=>{try{let{error:s}=await c.O.from("product_categories").update({is_active:!e.is_active,updated_at:new Date().toISOString()}).eq("id",e.id);if(s)throw s;w()}catch(e){alert("状態の更新に失敗しました。")}},P=()=>{b({name:"",description:"",display_order:e.length,is_active:!0}),f({}),h(null),o(!1)},q=e=>s=>{let a="display_order"===e?parseInt(s.target.value)||0:"is_active"===e?s.target.checked:s.target.value;b({...v,[e]:a}),g[e]&&f({...g,[e]:""})};return(0,t.jsxs)("div",{className:"container-fluid py-4",children:[(0,t.jsxs)("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"h3 text-dark fw-bold mb-1",children:"商品カテゴリ管理"}),(0,t.jsx)("p",{className:"text-muted mb-0",children:"商品カテゴリの追加・編集・削除・並び順の管理"})]}),(0,t.jsxs)("button",{onClick:()=>o(!0),className:"btn btn-success d-flex align-items-center",children:[(0,t.jsx)(m.JO,{icon:m.PJ.add,size:"sm",className:"me-2"}),"新規カテゴリ追加"]})]}),(0,t.jsx)("div",{className:"card mb-4",children:(0,t.jsx)("div",{className:"card-body",children:(0,t.jsxs)("div",{className:"position-relative",children:[(0,t.jsx)(m.JO,{icon:m.PJ.search,size:"sm",className:"position-absolute top-50 start-0 translate-middle-y ms-3 text-muted"}),(0,t.jsx)("input",{type:"text",placeholder:"カテゴリ名、説明で検索...",value:r,onChange:e=>n(e.target.value),className:"form-control ps-5"})]})})}),(0,t.jsxs)("div",{className:"card",children:[(0,t.jsx)("div",{className:"card-header bg-light",children:(0,t.jsxs)("h5",{className:"card-title mb-0",children:["カテゴリ一覧 (",_.length,"件)"]})}),(0,t.jsx)("div",{className:"card-body p-0",children:a?(0,t.jsxs)("div",{className:"d-flex align-items-center justify-content-center py-5",children:[(0,t.jsx)(m.JO,{icon:m.PJ.loading,size:"lg",className:"animate-spin text-primary me-2"}),(0,t.jsx)("span",{className:"text-muted",children:"読み込み中..."})]}):_.length>0?(0,t.jsx)("div",{className:"table-responsive",children:(0,t.jsxs)("table",{className:"table table-hover mb-0",children:[(0,t.jsx)("thead",{className:"table-light",children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{className:"border-0",children:"表示順"}),(0,t.jsx)("th",{className:"border-0",children:"カテゴリ名"}),(0,t.jsx)("th",{className:"border-0",children:"説明"}),(0,t.jsx)("th",{className:"border-0",children:"状態"}),(0,t.jsx)("th",{className:"border-0",children:"作成日"}),(0,t.jsx)("th",{className:"border-0 text-end",children:"操作"})]})}),(0,t.jsx)("tbody",{children:_.map(e=>(0,t.jsxs)("tr",{children:[(0,t.jsx)("td",{children:(0,t.jsx)("span",{className:"badge bg-secondary",children:e.display_order})}),(0,t.jsx)("td",{children:(0,t.jsxs)("div",{className:"d-flex align-items-center",children:[(0,t.jsx)(m.JO,{icon:m.PJ.tag,size:"sm",className:"text-primary me-2"}),(0,t.jsx)("span",{className:"fw-medium",children:e.name})]})}),(0,t.jsx)("td",{children:(0,t.jsx)("span",{className:"text-muted",children:e.description||"説明なし"})}),(0,t.jsx)("td",{children:(0,t.jsxs)("button",{onClick:()=>J(e),className:"btn btn-sm ".concat(e.is_active?"btn-outline-success":"btn-outline-secondary"),children:[(0,t.jsx)(m.JO,{icon:e.is_active?m.PJ.eye:m.PJ.eyeOff,size:"xs",className:"me-1"}),e.is_active?"有効":"無効"]})}),(0,t.jsx)("td",{className:"text-muted",children:new Date(e.created_at).toLocaleDateString("ja-JP")}),(0,t.jsx)("td",{children:(0,t.jsxs)("div",{className:"d-flex justify-content-end gap-1",children:[(0,t.jsx)("button",{onClick:()=>O(e),className:"btn btn-sm btn-outline-primary",title:"編集",children:(0,t.jsx)(m.JO,{icon:m.PJ.edit,size:"xs"})}),(0,t.jsx)("button",{onClick:()=>j(e),className:"btn btn-sm btn-outline-danger",title:"削除",children:(0,t.jsx)(m.JO,{icon:m.PJ.delete,size:"xs"})})]})})]},e.id))})]})}):(0,t.jsxs)("div",{className:"text-center py-5",children:[(0,t.jsx)(m.JO,{icon:m.PJ.tag,size:"xl",className:"text-muted mb-3"}),(0,t.jsx)("p",{className:"text-muted",children:r?"検索条件に合うカテゴリが見つかりません":"登録されているカテゴリがありません"}),!r&&(0,t.jsx)("button",{onClick:()=>o(!0),className:"btn btn-success mt-2",children:"初めてのカテゴリを追加"})]})})]}),d&&(0,t.jsx)("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.5)"},children:(0,t.jsx)("div",{className:"modal-dialog modal-lg",children:(0,t.jsxs)("div",{className:"modal-content",children:[(0,t.jsxs)("div",{className:"modal-header",children:[(0,t.jsx)("h5",{className:"modal-title",children:u?"カテゴリ編集":"新規カテゴリ追加"}),(0,t.jsx)("button",{type:"button",className:"btn-close",onClick:P})]}),(0,t.jsxs)("form",{onSubmit:C,children:[(0,t.jsx)("div",{className:"modal-body",children:(0,t.jsxs)("div",{className:"row g-3",children:[(0,t.jsxs)("div",{className:"col-md-8",children:[(0,t.jsxs)("label",{className:"form-label",children:["カテゴリ名 ",(0,t.jsx)("span",{className:"text-danger",children:"*"})]}),(0,t.jsx)("input",{type:"text",value:v.name,onChange:q("name"),className:"form-control ".concat(g.name?"is-invalid":""),placeholder:"野菜の苗、花の苗など"}),g.name&&(0,t.jsx)("div",{className:"invalid-feedback",children:g.name})]}),(0,t.jsxs)("div",{className:"col-md-4",children:[(0,t.jsx)("label",{className:"form-label",children:"表示順序"}),(0,t.jsx)("input",{type:"number",value:v.display_order,onChange:q("display_order"),className:"form-control ".concat(g.display_order?"is-invalid":""),min:"0"}),g.display_order&&(0,t.jsx)("div",{className:"invalid-feedback",children:g.display_order})]}),(0,t.jsxs)("div",{className:"col-12",children:[(0,t.jsx)("label",{className:"form-label",children:"説明"}),(0,t.jsx)("textarea",{value:v.description,onChange:q("description"),className:"form-control",rows:3,placeholder:"このカテゴリの説明を入力してください"})]}),(0,t.jsx)("div",{className:"col-12",children:(0,t.jsxs)("div",{className:"form-check",children:[(0,t.jsx)("input",{type:"checkbox",id:"is_active",checked:v.is_active,onChange:q("is_active"),className:"form-check-input"}),(0,t.jsx)("label",{htmlFor:"is_active",className:"form-check-label",children:"このカテゴリを有効にする"})]})})]})}),(0,t.jsxs)("div",{className:"modal-footer",children:[(0,t.jsx)("button",{type:"button",onClick:P,className:"btn btn-secondary",children:"キャンセル"}),(0,t.jsx)("button",{type:"submit",disabled:N,className:"btn btn-primary d-flex align-items-center",children:N?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(m.JO,{icon:m.PJ.loading,size:"sm",className:"animate-spin me-2"}),"保存中..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(m.JO,{icon:m.PJ.save,size:"sm",className:"me-2"}),u?"更新":"追加"]})})]})]})]})})}),(0,t.jsx)(x.$,{isOpen:!!p,title:"カテゴリの削除",itemName:(null==p?void 0:p.name)||"",onConfirm:S,onCancel:()=>j(null)})]})},y=a(1155);function w(){let[e,s]=(0,i.useState)(""),[a,r]=(0,i.useState)(""),[c,n]=(0,i.useState)(!1),{signIn:d}=(0,l.a)(),o=async s=>{s.preventDefault(),n(!0);try{await d(e,a)}finally{n(!1)}};return(0,t.jsxs)("div",{className:"min-vh-100 d-flex align-items-center justify-content-center bg-light position-relative",children:[(0,t.jsx)("div",{className:"position-absolute w-100 h-100 opacity-25",style:{backgroundImage:"url(\"data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%2322c55e' fill-opacity='0.1'%3E%3Ccircle cx='6' cy='6' r='6'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E\")"}}),(0,t.jsx)("div",{className:"container",children:(0,t.jsx)("div",{className:"row justify-content-center",children:(0,t.jsx)("div",{className:"col-md-6 col-lg-4",children:(0,t.jsx)("div",{className:"card shadow-lg border-0 fade-in",children:(0,t.jsxs)("div",{className:"card-body p-5",children:[(0,t.jsxs)("div",{className:"text-center mb-4",children:[(0,t.jsx)("div",{className:"display-4 mb-3",children:"\uD83C\uDF31"}),(0,t.jsx)("h2",{className:"h3 fw-bold text-primary mb-1",children:"ベジライス管理システム"}),(0,t.jsx)("p",{className:"text-muted",children:"管理者ログイン"})]}),(0,t.jsxs)("form",{onSubmit:o,children:[(0,t.jsxs)("div",{className:"mb-3",children:[(0,t.jsx)("label",{htmlFor:"email",className:"form-label",children:"メールアドレス"}),(0,t.jsx)("input",{id:"email",name:"email",type:"email",required:!0,autoComplete:"username",className:"form-control form-control-lg",placeholder:"admin@example.com",value:e,onChange:e=>s(e.target.value),disabled:c})]}),(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)("label",{htmlFor:"password",className:"form-label",children:"パスワード"}),(0,t.jsx)("input",{id:"password",name:"password",type:"password",required:!0,autoComplete:"current-password",className:"form-control form-control-lg",placeholder:"パスワードを入力してください",value:a,onChange:e=>r(e.target.value),disabled:c})]}),(0,t.jsx)("div",{className:"d-grid mb-3",children:(0,t.jsx)("button",{type:"submit",disabled:c,className:"btn btn-primary btn-lg",children:c?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("span",{className:"loading-spinner me-2"}),"ログイン中..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("i",{className:"bi bi-box-arrow-in-right me-2"}),"ログイン"]})})}),(0,t.jsx)("div",{className:"text-center",children:(0,t.jsx)("small",{className:"text-muted",children:"管理者アカウントでログインしてください"})})]})]})})})})})]})}function _(){let{user:e,loading:s,isAdmin:a}=(0,l.a)(),[c,d]=(0,i.useState)("dashboard");return s?(0,t.jsx)("div",{className:"min-vh-100 d-flex align-items-center justify-content-center",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"loading-spinner mb-3"}),(0,t.jsx)("p",{className:"text-muted",children:"認証情報を確認中..."})]})}):e&&a?(0,t.jsx)(r.Z,{children:(()=>{switch(c){case"dashboard":default:return(0,t.jsx)(n,{});case"reservation-list":return(0,t.jsx)(g.Z,{});case"reservation-calendar":return(0,t.jsxs)("div",{className:"card",children:[(0,t.jsx)("div",{className:"card-header",children:(0,t.jsx)("h2",{className:"card-title h4 mb-0",children:"予約カレンダー"})}),(0,t.jsx)("div",{className:"card-body",children:(0,t.jsxs)("div",{className:"text-center py-5",children:[(0,t.jsx)("div",{className:"display-1 mb-4",children:"\uD83D\uDDD3️"}),(0,t.jsx)("h3",{className:"h5 fw-medium text-dark mb-3",children:"予約カレンダー"}),(0,t.jsx)("p",{className:"text-muted",children:"カレンダー形式で予約を管理します。"})]})})]});case"reservation-search":return(0,t.jsxs)("div",{className:"card",children:[(0,t.jsx)("div",{className:"card-header",children:(0,t.jsx)("h2",{className:"card-title h4 mb-0",children:"予約検索"})}),(0,t.jsx)("div",{className:"card-body",children:(0,t.jsxs)("div",{className:"text-center py-5",children:[(0,t.jsx)("div",{className:"display-1 mb-4",children:"\uD83D\uDD0D"}),(0,t.jsx)("h3",{className:"h5 fw-medium text-dark mb-3",children:"予約検索"}),(0,t.jsx)("p",{className:"text-muted",children:"詳細条件で予約を検索します。"})]})})]});case"product-list":return(0,t.jsx)(v.Z,{});case"product-add":return(0,t.jsx)(b.Z,{});case"product-categories":return(0,t.jsx)(N,{});case"customer-list":return(0,t.jsx)(y.Z,{});case"customer-search":return(0,t.jsxs)("div",{className:"card",children:[(0,t.jsx)("div",{className:"card-header",children:(0,t.jsx)("h2",{className:"card-title h4 mb-0",children:"顧客検索"})}),(0,t.jsx)("div",{className:"card-body",children:(0,t.jsxs)("div",{className:"text-center py-5",children:[(0,t.jsx)("div",{className:"display-1 mb-4",children:"\uD83D\uDD0D"}),(0,t.jsx)("h3",{className:"h5 fw-medium text-dark mb-3",children:"顧客検索"}),(0,t.jsx)("p",{className:"text-muted",children:"詳細条件で顧客を検索します。"})]})})]});case"form-builder":return(0,t.jsx)(p,{});case"form-list":return(0,t.jsx)(j.Z,{});case"form-settings":return(0,t.jsxs)("div",{className:"card",children:[(0,t.jsx)("div",{className:"card-header",children:(0,t.jsx)("h2",{className:"card-title h4 mb-0",children:"フォーム設定"})}),(0,t.jsx)("div",{className:"card-body",children:(0,t.jsxs)("div",{className:"text-center py-5",children:[(0,t.jsx)("div",{className:"display-1 mb-4",children:"⚙️"}),(0,t.jsx)("h3",{className:"h5 fw-medium text-dark mb-3",children:"フォーム設定"}),(0,t.jsxs)("p",{className:"text-muted",children:["フォーム全体の設定を管理します。",(0,t.jsx)("br",{}),"通知設定、デザイン設定、セキュリティ設定など。"]})]})})]});case"business-settings":return(0,t.jsxs)("div",{className:"card",children:[(0,t.jsx)("div",{className:"card-header",children:(0,t.jsx)("h2",{className:"card-title h4 mb-0",children:"店舗設定"})}),(0,t.jsx)("div",{className:"card-body",children:(0,t.jsxs)("div",{className:"text-center py-5",children:[(0,t.jsx)("div",{className:"display-1 mb-4",children:"\uD83C\uDFEA"}),(0,t.jsx)("h3",{className:"h5 fw-medium text-dark mb-3",children:"店舗設定"}),(0,t.jsx)("p",{className:"text-muted",children:"店舗情報、営業時間、連絡先などの基本設定を管理します。"})]})})]});case"notification-settings":return(0,t.jsx)(f.Z,{});case"user-management":return(0,t.jsxs)("div",{className:"card",children:[(0,t.jsx)("div",{className:"card-header",children:(0,t.jsx)("h2",{className:"card-title h4 mb-0",children:"ユーザー管理"})}),(0,t.jsx)("div",{className:"card-body",children:(0,t.jsxs)("div",{className:"text-center py-5",children:[(0,t.jsx)("div",{className:"display-1 mb-4",children:"\uD83D\uDC68‍\uD83D\uDCBC"}),(0,t.jsx)("h3",{className:"h5 fw-medium text-dark mb-3",children:"ユーザー管理"}),(0,t.jsx)("p",{className:"text-muted",children:"管理者ユーザーの追加・編集・権限設定を行います。"})]})})]})}})()}):(0,t.jsx)(w,{})}},7464:function(e,s,a){"use strict";a.d(s,{AuthProvider:function(){return d},a:function(){return n}});var t=a(7437),i=a(2265),l=a(2141),r=a(9703);let c=(0,i.createContext)(void 0),n=()=>{let e=(0,i.useContext)(c);if(!e)throw Error("useAuth must be used within an AuthProvider");return e},d=e=>{var s,a;let{children:n}=e,[d,o]=(0,i.useState)(null),[m,u]=(0,i.useState)(null),[x,h]=(0,i.useState)(!0),{showError:p,showSuccess:j}=(0,r.p)(),v=(null==d?void 0:d.email)==="admin@katagiri-shop.com"||(null==d?void 0:null===(s=d.user_metadata)||void 0===s?void 0:s.role)==="admin"||(null==d?void 0:null===(a=d.app_metadata)||void 0===a?void 0:a.role)==="admin";(0,i.useEffect)(()=>{l.O.auth.getSession().then(e=>{var s;let{data:{session:a}}=e;u(a),o(null!==(s=null==a?void 0:a.user)&&void 0!==s?s:null),h(!1)});let{data:{subscription:e}}=l.O.auth.onAuthStateChange((e,s)=>{var a;u(s),o(null!==(a=null==s?void 0:s.user)&&void 0!==a?a:null),h(!1)});return()=>e.unsubscribe()},[]);let b=async(e,s)=>{try{h(!0);let{data:i,error:r}=await l.O.auth.signInWithPassword({email:e,password:s});if(r)return p("ログインに失敗しました",r.message),!1;if(i.user){var a,t;if(!("admin@katagiri-shop.com"===i.user.email||(null===(a=i.user.user_metadata)||void 0===a?void 0:a.role)==="admin"||(null===(t=i.user.app_metadata)||void 0===t?void 0:t.role)==="admin"))return await l.O.auth.signOut(),p("アクセス権限がありません","管理者アカウントでログインしてください"),!1;return j("ログインしました","管理画面へようこそ"),!0}return!1}catch(e){return p("ログインエラー",e.message||"予期しないエラーが発生しました"),!1}finally{h(!1)}},g=async()=>{try{h(!0);let{error:e}=await l.O.auth.signOut();e?p("ログアウトに失敗しました",e.message):j("ログアウトしました","")}catch(e){p("ログアウトエラー",e.message)}finally{h(!1)}};return(0,t.jsx)(c.Provider,{value:{user:d,session:m,loading:x,signIn:b,signOut:g,isAdmin:v},children:n})}}},function(e){e.O(0,[454,580,448,145,254,135,496,155,737,330,120,755,362,744],function(){return e(e.s=9435)}),_N_E=e.O()}]);