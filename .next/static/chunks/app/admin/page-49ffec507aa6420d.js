(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3],{9435:function(e,s,t){Promise.resolve().then(t.bind(t,2204))},2204:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return k}});var a=t(7437),r=t(2265),i=t(7464),l=t(4282),n=t(2141);function c(e){var s,t;let{onPageChange:i}=e,[l,c]=(0,r.useState)(!1),[d,o]=(0,r.useState)(null),[m,u]=(0,r.useState)(!1),[x,h]=(0,r.useState)([{icon:"bi-calendar-check",label:"今日の予約",value:"0",trend:"+0",trendLabel:"昨日比",trendType:"positive",color:"primary"},{icon:"bi-people",label:"総顧客数",value:"0",trend:"+0",trendLabel:"今月",trendType:"positive",color:"info"},{icon:"bi-file-earmark-text",label:"フォーム数",value:"0",trend:"+0",trendLabel:"今月追加",trendType:"positive",color:"success"},{icon:"bi-currency-yen",label:"今月売上",value:"\xa50",trend:"+0%",trendLabel:"先月比",trendType:"positive",color:"warning"}]),[p,g]=(0,r.useState)([]),b=(0,r.useCallback)(async()=>{try{let e=new Date().toISOString().split("T")[0],{data:s,error:t}=await n.OQ.from("reservations").select("*").gte("created_at","".concat(e,"T00:00:00")).lte("created_at","".concat(e,"T23:59:59")),{data:a,error:r}=await n.OQ.from("customers").select("*"),{data:i,error:l}=await n.OQ.from("forms").select("*"),{data:c,error:d}=await n.OQ.from("reservations").select("\n          id,\n          reservation_number,\n          status,\n          total_amount,\n          created_at,\n          updated_at,\n          customers(name)\n        ").order("created_at",{ascending:!1}).limit(5);t&&console.error("予約データ取得エラー:",t),r&&console.error("顧客データ取得エラー:",r),l&&console.error("フォームデータ取得エラー:",l),d&&console.error("アクティビティデータ取得エラー:",d);let o=(null==s?void 0:s.length)||0,m=(null==a?void 0:a.length)||0,u=(null==i?void 0:i.length)||0;h(e=>e.map((e,s)=>{switch(s){case 0:return{...e,value:o.toString()};case 1:return{...e,value:m.toString()};case 2:return{...e,value:u.toString()};default:return e}}));let x=(null==c?void 0:c.map(e=>{var s;return{icon:j(e.status),iconColor:f(e.status),text:"".concat((null===(s=e.customers)||void 0===s?void 0:s.name)||"匿名"," - ").concat(e.reservation_number),time:v(new Date(e.created_at)),amount:e.total_amount?"\xa5".concat(e.total_amount.toLocaleString()):null}}))||[];g(x)}catch(e){console.error("ダッシュボードデータの取得に失敗しました:",e)}},[]);(0,r.useEffect)(()=>{b()},[b]);let v=e=>{let s=new Date().getTime()-e.getTime(),t=Math.floor(s/6e4),a=Math.floor(s/36e5),r=Math.floor(s/864e5);return t<1?"たった今":t<60?"".concat(t,"分前"):a<24?"".concat(a,"時間前"):r<7?"".concat(r,"日前"):e.toLocaleDateString("ja-JP")},j=e=>{switch(e){case"confirmed":return"bi-check-circle";case"pending":return"bi-clock";case"completed":return"bi-check-circle-fill";case"cancelled":return"bi-x-circle";default:return"bi-info-circle"}},f=e=>{switch(e){case"confirmed":return"text-primary";case"pending":return"text-warning";case"completed":return"text-success";case"cancelled":return"text-danger";default:return"text-info"}},y=async()=>{u(!0);try{var e;let{data:s,error:t}=await n.OQ.from("forms").select("*");if(t)throw t;let a={totalForms:(null==s?void 0:s.length)||0,activeForms:(null==s?void 0:null===(e=s.filter(e=>e.is_active))||void 0===e?void 0:e.length)||0,issues:(null==s?void 0:s.length)===0?["フォームが作成されていません"]:[],recommendations:(null==s?void 0:s.length)===0?["最初のフォームを作成してください"]:["フォーム設定は正常です"]};o(a),c(!0)}catch(e){console.error("フォーム設定チェックに失敗しました:",e)}finally{u(!1)}};return(0,a.jsxs)("div",{className:"container-fluid py-4",children:[(0,a.jsx)("div",{className:"row mb-4",children:(0,a.jsx)("div",{className:"col-12",children:(0,a.jsxs)("div",{className:"d-flex justify-content-between align-items-center",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"h2 fw-bold text-dark mb-1",children:"ダッシュボード"}),(0,a.jsx)("p",{className:"text-muted mb-0",children:"システムの概要と最新の活動状況"})]}),(0,a.jsxs)("button",{className:"btn btn-primary",onClick:b,children:[(0,a.jsx)("i",{className:"bi bi-arrow-clockwise me-2"}),"更新"]})]})})}),(0,a.jsx)("div",{className:"row g-4 mb-4",children:x.map((e,s)=>(0,a.jsx)("div",{className:"col-xl-3 col-md-6",children:(0,a.jsx)("div",{className:"dashboard-widget",children:(0,a.jsxs)("div",{className:"d-flex align-items-center justify-content-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"dashboard-widget-icon bg-".concat(e.color,"-subtle text-").concat(e.color),children:(0,a.jsx)("i",{className:e.icon})}),(0,a.jsx)("div",{className:"dashboard-widget-value",children:e.value}),(0,a.jsx)("div",{className:"dashboard-widget-label",children:e.label})]}),(0,a.jsxs)("div",{className:"text-end",children:[(0,a.jsxs)("span",{className:"badge bg-".concat("positive"===e.trendType?"success":"danger","-subtle text-").concat("positive"===e.trendType?"success":"danger"),children:[(0,a.jsx)("i",{className:"bi bi-arrow-".concat("positive"===e.trendType?"up":"down"," me-1")}),e.trend]}),(0,a.jsx)("div",{className:"text-muted small",children:e.trendLabel})]})]})})},s))}),(0,a.jsxs)("div",{className:"row g-4",children:[(0,a.jsx)("div",{className:"col-lg-8",children:(0,a.jsxs)("div",{className:"card h-100",children:[(0,a.jsxs)("div",{className:"card-header d-flex justify-content-between align-items-center",children:[(0,a.jsxs)("h5",{className:"mb-0",children:[(0,a.jsx)("i",{className:"bi bi-activity me-2"}),"最近のアクティビティ"]}),(0,a.jsxs)("button",{className:"btn btn-sm btn-outline-primary",onClick:()=>null==i?void 0:i("reservation-list"),children:[(0,a.jsx)("i",{className:"bi bi-eye me-1"}),"すべて見る"]})]}),(0,a.jsx)("div",{className:"card-body",children:p.length>0?(0,a.jsx)("div",{className:"d-flex flex-column gap-3",children:p.map((e,s)=>(0,a.jsxs)("div",{className:"d-flex align-items-start",children:[(0,a.jsx)("div",{className:"rounded-circle d-flex align-items-center justify-content-center me-3 ".concat(e.iconColor),style:{width:"40px",height:"40px",backgroundColor:"var(--bs-light)"},children:(0,a.jsx)("i",{className:e.icon})}),(0,a.jsx)("div",{className:"flex-grow-1",children:(0,a.jsxs)("div",{className:"d-flex justify-content-between align-items-start",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"mb-1 fw-medium",children:e.text}),(0,a.jsx)("small",{className:"text-muted",children:e.time})]}),e.amount&&(0,a.jsx)("span",{className:"badge bg-success-subtle text-success",children:e.amount})]})})]},s))}):(0,a.jsxs)("div",{className:"text-center py-4",children:[(0,a.jsx)("i",{className:"bi bi-clock-history text-muted",style:{fontSize:"3rem"}}),(0,a.jsx)("p",{className:"text-muted mt-2",children:"まだアクティビティがありません"})]})})]})}),(0,a.jsx)("div",{className:"col-lg-4",children:(0,a.jsxs)("div",{className:"card h-100",children:[(0,a.jsx)("div",{className:"card-header",children:(0,a.jsxs)("h5",{className:"mb-0",children:[(0,a.jsx)("i",{className:"bi bi-lightning me-2"}),"クイックアクション"]})}),(0,a.jsx)("div",{className:"card-body",children:(0,a.jsxs)("div",{className:"d-grid gap-3",children:[(0,a.jsxs)("button",{className:"btn btn-outline-primary",onClick:()=>null==i?void 0:i("reservation-list"),children:[(0,a.jsx)("i",{className:"bi bi-calendar-check me-2"}),"予約管理"]}),(0,a.jsxs)("button",{className:"btn btn-outline-secondary",onClick:()=>null==i?void 0:i("product-list"),children:[(0,a.jsx)("i",{className:"bi bi-box-seam me-2"}),"商品管理"]}),(0,a.jsxs)("button",{className:"btn btn-outline-info",onClick:()=>null==i?void 0:i("form-list"),children:[(0,a.jsx)("i",{className:"bi bi-file-earmark-text me-2"}),"フォーム管理"]}),(0,a.jsx)("button",{className:"btn btn-outline-success",onClick:y,disabled:m,children:m?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",{className:"loading-spinner me-2"}),"チェック中..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("i",{className:"bi bi-gear me-2"}),"フォーム設定確認"]})})]})})]})})]}),l&&(0,a.jsx)("div",{className:"modal fade show d-block",tabIndex:-1,style:{backgroundColor:"rgba(0,0,0,0.5)"},children:(0,a.jsx)("div",{className:"modal-dialog modal-lg",children:(0,a.jsxs)("div",{className:"modal-content",children:[(0,a.jsxs)("div",{className:"modal-header",children:[(0,a.jsxs)("h5",{className:"modal-title",children:[(0,a.jsx)("i",{className:"bi bi-gear me-2"}),"フォーム設定診断結果"]}),(0,a.jsx)("button",{type:"button",className:"btn-close",onClick:()=>c(!1)})]}),(0,a.jsx)("div",{className:"modal-body",children:d&&(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"alert alert-info",children:[(0,a.jsx)("h6",{children:"診断概要"}),(0,a.jsxs)("p",{className:"mb-0",children:["総フォーム数: ",d.totalForms]}),(0,a.jsxs)("p",{className:"mb-0",children:["有効フォーム数: ",d.activeForms]})]}),(null===(s=d.issues)||void 0===s?void 0:s.length)>0&&(0,a.jsxs)("div",{className:"alert alert-warning",children:[(0,a.jsx)("h6",{children:"検出された問題"}),(0,a.jsx)("ul",{className:"mb-0",children:d.issues.map((e,s)=>(0,a.jsx)("li",{children:e},s))})]}),(null===(t=d.recommendations)||void 0===t?void 0:t.length)>0&&(0,a.jsxs)("div",{className:"alert alert-success",children:[(0,a.jsx)("h6",{children:"推奨事項"}),(0,a.jsx)("ul",{className:"mb-0",children:d.recommendations.map((e,s)=>(0,a.jsx)("li",{children:e},s))})]})]})}),(0,a.jsx)("div",{className:"modal-footer",children:(0,a.jsx)("button",{type:"button",className:"btn btn-secondary",onClick:()=>c(!1),children:"閉じる"})})]})})})]})}var d=t(3145),o=t(7755),m=t(6882),u=e=>{let{isOpen:s,onClose:t,onProductSelect:i,excludeProductIds:l=[]}=e,[c,d]=(0,r.useState)([]),[o,u]=(0,r.useState)([]),[x,h]=(0,r.useState)(""),[p,g]=(0,r.useState)("all"),[b,v]=(0,r.useState)(!1),[j,f]=(0,r.useState)(null),[y,N]=(0,r.useState)(""),[w,_]=(0,r.useState)(0),[C,k]=(0,r.useState)(1),[S,O]=(0,r.useState)(!1);(0,r.useEffect)(()=>{s&&(D(),J())},[s]);let D=async()=>{v(!0);try{let{data:e,error:s}=await n.OQ.from("products").select("\n          *,\n          category:product_categories(*),\n          variations:product_variations(*)\n        ").eq("is_available",!0).order("display_order",{ascending:!0});if(s)throw s;d(e||[])}catch(e){console.error("商品の取得に失敗しました:",e)}finally{v(!1)}},J=async()=>{try{let{data:e,error:s}=await n.OQ.from("product_categories").select("*").eq("is_active",!0).order("display_order",{ascending:!0});if(s)throw s;u(e||[])}catch(e){console.error("カテゴリの取得に失敗しました:",e)}},P=c.filter(e=>{var s;let t="all"===p||e.category_id===p,a=e.name.toLowerCase().includes(x.toLowerCase())||(null===(s=e.description)||void 0===s?void 0:s.toLowerCase().includes(x.toLowerCase())),r=!l.includes(e.id);return t&&a&&r}),q=e=>{e.variations&&e.variations.length>0?(f(e),N(e.variations[0].id),_(e.variations[0].price),k(1),O(!0)):Q(e)},Q=(e,s,t,a)=>{i(e,t||e.price,s,a||1),z()},z=()=>{h(""),g("all"),f(null),N(""),_(0),k(1),O(!1),t()},L=e=>{var s;N(e);let t=null==j?void 0:null===(s=j.variations)||void 0===s?void 0:s.find(s=>s.id===e);t&&_(t.price)};return s?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg max-w-5xl w-full max-h-[90vh] overflow-hidden",children:[(0,a.jsxs)("div",{className:"p-6 border-b border-gray-200",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,a.jsxs)("h3",{className:"text-xl font-semibold text-gray-900 flex items-center space-x-2",children:[(0,a.jsx)(m.JO,{icon:m.PJ.packageIcon,size:"lg"}),(0,a.jsx)("span",{children:"商品を選択"})]}),(0,a.jsx)("button",{onClick:z,className:"p-2 text-gray-400 hover:text-gray-600 transition-colors",children:(0,a.jsx)(m.JO,{icon:m.PJ.closeIcon,size:"md"})})]}),(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4",children:[(0,a.jsxs)("div",{className:"flex-1 relative",children:[(0,a.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,a.jsx)(m.JO,{icon:m.PJ.searchIcon,size:"sm",className:"text-gray-400"})}),(0,a.jsx)("input",{type:"text",placeholder:"商品名で検索...",value:x,onChange:e=>h(e.target.value),className:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),(0,a.jsxs)("select",{value:p,onChange:e=>g(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[(0,a.jsx)("option",{value:"all",children:"全カテゴリ"}),o.map(e=>(0,a.jsx)("option",{value:e.id,children:e.name},e.id))]}),(0,a.jsx)("button",{onClick:D,disabled:b,className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors disabled:opacity-50",children:(0,a.jsx)(m.JO,{icon:m.PJ.refresh,size:"sm"})})]})]}),(0,a.jsx)("div",{className:"p-6 overflow-y-auto",style:{maxHeight:"calc(90vh - 200px)"},children:b?(0,a.jsxs)("div",{className:"flex items-center justify-center py-12",children:[(0,a.jsx)(m.JO,{icon:m.PJ.loading,size:"lg",className:"animate-spin text-blue-500"}),(0,a.jsx)("span",{className:"ml-2 text-gray-600",children:"商品を読み込み中..."})]}):P.length>0?(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:P.map(e=>{var s;return(0,a.jsxs)("div",{className:"border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow cursor-pointer",onClick:()=>q(e),children:[(0,a.jsx)("div",{className:"w-full h-32 bg-gray-100 rounded-lg mb-3 flex items-center justify-center",children:(0,a.jsx)(m.JO,{icon:m.PJ.packageIcon,size:"xl",className:"text-gray-400"})}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("h4",{className:"font-medium text-gray-900 line-clamp-2",children:e.name}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:null===(s=e.category)||void 0===s?void 0:s.name}),e.description&&(0,a.jsx)("p",{className:"text-sm text-gray-600 line-clamp-2",children:e.description}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"text-lg font-bold text-blue-600",children:["\xa5",e.price.toLocaleString()]}),e.variations&&e.variations.length>0&&(0,a.jsxs)("div",{className:"text-xs text-gray-500",children:[e.variations.length,"種類の選択肢"]})]}),(0,a.jsx)("div",{className:"flex items-center space-x-2",children:void 0!==e.stock_quantity&&null!==e.stock_quantity&&(0,a.jsxs)("span",{className:"text-xs px-2 py-1 rounded ".concat(e.stock_quantity>10?"bg-green-100 text-green-800":e.stock_quantity>0?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"),children:["在庫: ",e.stock_quantity]})})]}),(0,a.jsx)("button",{className:"w-full bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium",onClick:s=>{s.stopPropagation(),q(e)},children:e.variations&&e.variations.length>0?"詳細設定":"追加"})]})]},e.id)})}):(0,a.jsxs)("div",{className:"text-center py-12",children:[(0,a.jsx)(m.JO,{icon:m.PJ.searchIcon,size:"xl",className:"text-gray-400 mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-gray-600",children:"条件に合う商品が見つかりません"}),(0,a.jsx)("p",{className:"text-sm text-gray-500 mt-2",children:"検索条件を変更してお試しください"})]})})]})}),S&&j&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-60 p-4",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg max-w-md w-full",children:[(0,a.jsx)("div",{className:"p-6 border-b border-gray-200",children:(0,a.jsx)("h4",{className:"text-lg font-semibold text-gray-900",children:"商品設定"})}),(0,a.jsxs)("div",{className:"p-6 space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h5",{className:"font-medium text-gray-900 mb-2",children:j.name}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:j.description})]}),j.variations&&j.variations.length>0&&(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"バリエーション"}),(0,a.jsx)("select",{value:y,onChange:e=>L(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:j.variations.map(e=>(0,a.jsxs)("option",{value:e.id,children:[e.name," - \xa5",e.price.toLocaleString()]},e.id))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"価格"}),(0,a.jsx)("input",{type:"number",value:w,onChange:e=>_(Number(e.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",min:"0"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"デフォルト数量"}),(0,a.jsx)("input",{type:"number",value:C,onChange:e=>k(Number(e.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",min:"1"})]})]}),(0,a.jsxs)("div",{className:"p-6 pt-0 flex justify-end space-x-3",children:[(0,a.jsx)("button",{onClick:()=>O(!1),className:"px-4 py-2 text-gray-700 bg-gray-200 rounded-lg hover:bg-gray-300 transition-colors",children:"キャンセル"}),(0,a.jsx)("button",{onClick:()=>{if(j){var e;let s=null===(e=j.variations)||void 0===e?void 0:e.find(e=>e.id===y);Q(j,null==s?void 0:s.name,w,C)}O(!1)},className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"追加"})]})]})})]}):null},x=t(1463);let h={customer_name:{id:"customer_name",type:"text",label:"氏名",placeholder:"山田 太郎",required:!0,description:"フルネームでご記入ください",category:"customer"},customer_furigana:{id:"customer_furigana",type:"text",label:"フリガナ",placeholder:"ヤマダ タロウ",required:!1,description:"カタカナでご記入ください",category:"customer"},customer_phone:{id:"customer_phone",type:"tel",label:"電話番号",placeholder:"090-1234-5678",required:!0,description:"緊急時のご連絡先",category:"customer"},customer_postal_code:{id:"customer_postal_code",type:"text",label:"郵便番号",placeholder:"123-4567",required:!1,category:"customer"},customer_address:{id:"customer_address",type:"textarea",label:"住所",placeholder:"東京都渋谷区...",required:!1,category:"customer"},customer_birth_date:{id:"customer_birth_date",type:"date",label:"生年月日",required:!1,category:"customer"},customer_gender:{id:"customer_gender",type:"radio",label:"性別",required:!1,options:["男性","女性","その他","回答しない"],category:"customer"},reservation_date:{id:"reservation_date",type:"date",label:"受取希望日",required:!0,description:"商品をお受け取りいただく日をお選びください",category:"reservation"},special_requests:{id:"special_requests",type:"textarea",label:"ご要望・備考",placeholder:"その他ご要望がございましたらご記入ください",required:!1,category:"other"}};function p(){var e;let{formId:s,onFormSaved:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},[i,l]=(0,r.useState)({id:s||"form-".concat(Date.now()),name:"商品予約フォーム",description:"片桐商店 ベジライスの商品予約を承ります",fields:Object.values(h).map(e=>({...e,enabled:!0})),products:[],settings:{showProgress:!0,allowEdit:!0,confirmationMessage:"ご予約ありがとうございました。確認のお電話をさせていただきます。",businessName:"片桐商店 ベジライス",validFrom:void 0,validTo:void 0,isActive:!0}}),[c,p]=(0,r.useState)(!1),[g,b]=(0,r.useState)([]),[v,j]=(0,r.useState)([]),[f,y]=(0,r.useState)(!1),[N,w]=(0,r.useState)(!1),[_,C]=(0,r.useState)(""),[k,S]=(0,r.useState)("all"),[O,D]=(0,r.useState)(null);(0,r.useEffect)(()=>{P(),q(),s&&J()},[s]);let J=async()=>{if(s)try{let{data:e,error:t}=await n.OQ.from("forms").select("\n          *,\n          form_fields(*),\n          form_products(\n            *,\n            product:products(\n              *,\n              category:product_categories(*)\n            )\n          )\n        ").eq("id",s).single();if(t)throw t;if(e){let s={id:e.id,name:e.name,description:e.description,fields:(e.form_fields||[]).map(e=>({id:e.field_id,type:e.field_type,label:e.label,placeholder:e.placeholder,required:e.is_required,options:e.options,description:e.description,category:e.category||"other",enabled:e.is_enabled})),products:(e.form_products||[]).map(e=>{var s;return{id:e.product.id,name:e.product.name,category_name:null===(s=e.product.category)||void 0===s?void 0:s.name,price:e.product.price,variation_name:e.variation_name,selected_price:e.selected_price||e.product.price,selected_variation:e.variation_name}}),settings:{showProgress:e.show_progress||!0,allowEdit:e.allow_edit||!0,confirmationMessage:e.confirmation_message||"ご予約ありがとうございました。",businessName:e.business_name||"",validFrom:e.valid_from,validTo:e.valid_to,isActive:e.is_active}};l(s)}}catch(e){console.error("フォーム設定の読み込みに失敗しました:",e)}},P=async()=>{try{let{data:e,error:s}=await n.OQ.from("products").select("\n          *,\n          category:product_categories(*)\n        ").eq("is_available",!0).order("display_order",{ascending:!0});if(s)throw s;b(e||[])}catch(e){console.error("商品の取得に失敗しました:",e)}},q=async()=>{try{let{data:e,error:s}=await n.OQ.from("product_categories").select("*").eq("is_active",!0).order("display_order",{ascending:!0});if(s)throw s;j(e||[])}catch(e){console.error("カテゴリの取得に失敗しました:",e)}},Q=e=>{l({...i,fields:i.fields.map(s=>s.id===e?{...s,enabled:!s.enabled}:s)})},z=e=>{D(e)},L=async()=>{p(!0);try{let{data:e,error:s}=await n.OQ.from("forms").upsert({id:i.id,name:i.name,description:i.description,show_progress:i.settings.showProgress,allow_edit:i.settings.allowEdit,confirmation_message:i.settings.confirmationMessage,business_name:i.settings.businessName,valid_from:i.settings.validFrom||null,valid_to:i.settings.validTo||null,is_active:i.settings.isActive,updated_at:new Date().toISOString()}).select().single();if(s)throw s;if(await n.OQ.from("form_fields").delete().eq("form_id",i.id),await n.OQ.from("form_products").delete().eq("form_id",i.id),i.fields.length>0){let e=i.fields.map((e,s)=>({form_id:i.id,field_id:e.id,field_type:e.type,label:e.label,placeholder:e.placeholder,is_required:e.required,options:e.options,description:e.description,category:e.category,is_enabled:e.enabled,display_order:s})),{error:s}=await n.OQ.from("form_fields").insert(e);if(s)throw s}if(i.products.length>0){let e=i.products.map((e,s)=>({form_id:i.id,product_id:e.id,selected_price:e.selected_price,variation_name:e.selected_variation,display_order:s})),{error:s}=await n.OQ.from("form_products").insert(e);if(s)throw s}t&&t(i.id),alert("フォーム設定を保存しました")}catch(e){console.error("フォーム設定の保存に失敗しました:",e),alert("フォーム設定の保存に失敗しました。もう一度お試しください。")}finally{p(!1)}};g.filter(e=>{let s="all"===k||e.category_id===k,t=e.name.toLowerCase().includes(_.toLowerCase()),a=!i.products.find(s=>s.id===e.id);return s&&t&&a});let E={customer:{title:"顧客情報",icon:m.PJ.customerInfo},reservation:{title:"予約情報",icon:m.PJ.reservationInfo},other:{title:"その他",icon:m.PJ.otherInfo}},I=()=>{let e=window.location.origin;return"".concat(e,"/form/").concat(i.id)};return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-gray-800",children:"予約フォーム設定"}),(0,a.jsx)("p",{className:"text-gray-600",children:"フォーム項目と予約対象商品を設定します"})]}),(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsxs)("button",{onClick:()=>w(!N),className:"btn-modern btn-outline-modern flex items-center space-x-2",children:[(0,a.jsx)(m.JO,{icon:m.PJ.qrIcon,size:"sm"}),(0,a.jsx)("span",{children:"QRコード表示"})]}),(0,a.jsx)("button",{onClick:L,disabled:c,className:"btn-modern btn-success-modern flex items-center space-x-2 disabled:opacity-50 disabled:cursor-not-allowed",children:c?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(m.JO,{icon:m.PJ.loading,size:"sm",className:"animate-spin"}),(0,a.jsx)("span",{children:"保存中..."})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(m.JO,{icon:m.PJ.saveIcon,size:"sm"}),(0,a.jsx)("span",{children:"設定を保存"})]})})]})]}),N&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold",children:"フォームQRコード"}),(0,a.jsx)("button",{onClick:()=>w(!1),className:"btn-modern btn-ghost-modern btn-sm",children:(0,a.jsx)(m.JO,{icon:m.PJ.closeIcon,size:"sm"})})]}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)(d.default,{src:(()=>{let e=I();return"https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=".concat(encodeURIComponent(e))})(),alt:"フォームQRコード",width:200,height:200,className:"mx-auto mb-4",unoptimized:!0}),(0,a.jsx)("p",{className:"text-sm text-gray-600 mb-3",children:"このQRコードで予約フォームにアクセスできます"}),(0,a.jsx)("div",{className:"text-xs bg-gray-100 p-2 rounded break-all",children:I()}),(0,a.jsx)("button",{onClick:()=>navigator.clipboard.writeText(I()),className:"btn-modern btn-secondary-modern mt-3",children:"URLをコピー"})]})]})}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"admin-card",children:[(0,a.jsx)("div",{className:"admin-card-header",children:(0,a.jsx)("h3",{className:"admin-card-title",children:"基本設定"})}),(0,a.jsxs)("div",{className:"admin-card-content space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"フォーム名"}),(0,a.jsx)("input",{type:"text",value:i.name,onChange:e=>l({...i,name:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"説明文"}),(0,a.jsx)("textarea",{value:i.description,onChange:e=>l({...i,description:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",rows:3})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"受付開始日時"}),(0,a.jsx)("input",{type:"datetime-local",value:i.settings.validFrom||"",onChange:e=>l({...i,settings:{...i.settings,validFrom:e.target.value||void 0}}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"受付終了日時"}),(0,a.jsx)("input",{type:"datetime-local",value:i.settings.validTo||"",onChange:e=>l({...i,settings:{...i.settings,validTo:e.target.value||void 0}}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"flex items-center",children:[(0,a.jsx)("input",{type:"checkbox",checked:i.settings.isActive,onChange:e=>l({...i,settings:{...i.settings,isActive:e.target.checked}}),className:"mr-2"}),"フォームを有効にする"]}),(0,a.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:"無効にするとフォームにアクセスできなくなります"})]})]})]}),(0,a.jsxs)("div",{className:"admin-card",children:[(0,a.jsx)("div",{className:"admin-card-header",children:(0,a.jsx)("h3",{className:"admin-card-title",children:"フォーム項目設定"})}),(0,a.jsx)("div",{className:"admin-card-content",children:Object.entries(E).map(e=>{let[s,t]=e;return(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsxs)("h4",{className:"flex items-center gap-2 font-medium text-gray-900 mb-3",children:[(0,a.jsx)(m.JO,{icon:t.icon,size:"sm"}),t.title]}),(0,a.jsx)("div",{className:"space-y-2",children:i.fields.filter(e=>e.category===s).map(e=>(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-medium",children:e.label}),(0,a.jsxs)("div",{className:"text-sm text-gray-500",children:[e.type," ",e.required&&"(必須)"]})]}),(0,a.jsxs)("label",{className:"relative inline-flex items-center cursor-pointer",children:[(0,a.jsx)("input",{type:"checkbox",checked:e.enabled,onChange:()=>Q(e.id),className:"sr-only peer"}),(0,a.jsx)("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})]},e.id))})]},s)})})]}),(0,a.jsxs)("div",{className:"admin-card",children:[(0,a.jsx)("div",{className:"admin-card-header",children:(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("h3",{className:"admin-card-title",children:"予約対象商品"}),(0,a.jsxs)("button",{onClick:()=>y(!0),className:"btn-modern btn-primary-modern btn-sm flex items-center space-x-2",children:[(0,a.jsx)(m.JO,{icon:m.PJ.packageIcon,size:"sm"}),(0,a.jsx)("span",{children:"商品を追加"})]})]})}),(0,a.jsx)("div",{className:"admin-card-content",children:i.products.length>0?(0,a.jsx)("div",{className:"space-y-3",children:i.products.map(e=>{var s;return(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-medium",children:e.name}),(0,a.jsxs)("div",{className:"text-sm text-gray-500",children:["\xa5",null===(s=e.selected_price)||void 0===s?void 0:s.toLocaleString(),e.selected_variation&&" (".concat(e.selected_variation,")"),e.category_name&&" - ".concat(e.category_name)]})]}),(0,a.jsx)("button",{onClick:()=>z(e.id),className:"btn-modern btn-danger-modern btn-sm btn-icon-only",children:(0,a.jsx)(m.JO,{icon:m.PJ.deleteIcon,size:"sm"})})]},e.id)})}):(0,a.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,a.jsx)("div",{className:"mb-4",children:(0,a.jsx)(m.JO,{icon:m.PJ.packageIcon,size:"xl",className:"mx-auto text-gray-400"})}),(0,a.jsx)("p",{children:"予約対象商品が設定されていません"}),(0,a.jsx)("p",{className:"text-sm",children:"「商品を追加」ボタンから商品を選択してください"})]})})]})]}),(0,a.jsxs)("div",{className:"admin-card",children:[(0,a.jsxs)("div",{className:"admin-card-header",children:[(0,a.jsx)("h3",{className:"admin-card-title",children:"フォームプレビュー"}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"実際のフォーム画面と同じ表示・機能です"})]}),(0,a.jsx)("div",{className:"admin-card-content",children:(0,a.jsx)(o.Z,{formConfig:i})})]})]}),(0,a.jsx)(u,{isOpen:f,onClose:()=>y(!1),onProductSelect:(e,s,t,a)=>{var r;let n={id:e.id,name:e.name,category_name:null===(r=e.category)||void 0===r?void 0:r.name,price:e.price,variation_name:e.variation_name,selected_price:s||e.price,selected_variation:t||e.variation_name};l({...i,products:[...i.products,n]}),y(!1)},excludeProductIds:i.products.map(e=>e.id)}),(0,a.jsx)(x.$,{isOpen:!!O,title:"商品の削除",itemName:O?(null===(e=i.products.find(e=>e.id===O))||void 0===e?void 0:e.name)||"選択された商品":"",onConfirm:()=>{O&&(l({...i,products:i.products.filter(e=>e.id!==O)}),D(null))},onCancel:()=>D(null)})]})}var g=t(2172),b=t(7330);class v{static async getAllProducts(){let{data:e,error:s}=await n.OQ.from("products").select("\n        *,\n        product_categories (\n          id,\n          name,\n          color\n        )\n      ").order("created_at",{ascending:!1});if(s)throw s;return e||[]}static async getActiveProducts(){let{data:e,error:s}=await n.OQ.from("products").select("\n        *,\n        product_categories (\n          id,\n          name,\n          color\n        )\n      ").eq("is_available",!0).order("display_order",{ascending:!0});if(s)throw s;return e||[]}static async getProductsByCategory(e){let{data:s,error:t}=await n.OQ.from("products").select("\n        *,\n        product_categories (\n          id,\n          name,\n          color\n        )\n      ").eq("category_id",e).eq("is_available",!0).order("display_order",{ascending:!0});if(t)throw t;return s||[]}static async createProduct(e){let{data:s,error:t}=await n.OQ.from("products").insert([{...e,category_id:e.category_id||null,tax_type:e.tax_type||"inclusive",is_available:!1!==e.is_available,display_order:e.display_order||0}]).select();if(t)throw t;return s[0]}static async updateProduct(e,s){let{data:t,error:a}=await n.OQ.from("products").update({...s,category_id:s.category_id||null}).eq("id",e).select();if(a)throw a;return t[0]}static async deleteProduct(e){let{error:s}=await n.OQ.from("products").delete().eq("id",e);if(s)throw s;return!0}static async getAllCategories(){let{data:e,error:s}=await n.OQ.from("product_categories").select("*").eq("is_active",!0).order("display_order",{ascending:!0});if(s)throw s;return e||[]}static async bulkImportProducts(e){let s={success:0,failed:0,errors:[],warnings:[]},t=[];for(let a=0;a<e.length;a++){let r=e[a],i=a+2;if(!r.name||""===r.name.trim()){s.failed++,s.errors.push("行".concat(i,": 商品名が入力されていません"));continue}void 0!==r.price&&(isNaN(Number(r.price))||0>Number(r.price))&&(s.warnings.push("行".concat(i,": 価格が無効です。0に設定されます")),r.price=0),!r.id&&await this.getProductByName(r.name.trim())&&s.warnings.push("行".concat(i,": 商品「").concat(r.name,"」は既に存在します")),t.push({...r,lineNumber:i})}for(let e of t)try{var a,r,i,l,n,c;if(e.id){if(!await this.getProductById(e.id)){s.failed++,s.errors.push("行".concat(e.lineNumber,": ID「").concat(e.id,"」の商品が見つかりません"));continue}await this.updateProduct(e.id,{name:e.name.trim(),barcode:(null===(a=e.barcode)||void 0===a?void 0:a.trim())||void 0,price:e.price||0,variation_name:(null===(r=e.variation_name)||void 0===r?void 0:r.trim())||void 0,tax_type:e.tax_type||"inclusive",category_id:e.category_id||void 0,description:(null===(i=e.description)||void 0===i?void 0:i.trim())||void 0})}else await this.createProduct({name:e.name.trim(),barcode:(null===(l=e.barcode)||void 0===l?void 0:l.trim())||void 0,price:e.price||0,variation_name:(null===(n=e.variation_name)||void 0===n?void 0:n.trim())||void 0,tax_type:e.tax_type||"inclusive",category_id:e.category_id||void 0,description:(null===(c=e.description)||void 0===c?void 0:c.trim())||void 0,is_available:!0,display_order:0});s.success++}catch(a){s.failed++;let t=(null==a?void 0:a.message)||(null==a?void 0:a.toString())||"不明なエラー";s.errors.push("行".concat(e.lineNumber,": 商品「").concat(e.name,"」: ").concat(t))}return s}static async getProductByName(e){let{data:s,error:t}=await n.OQ.from("products").select("id, name").eq("name",e).limit(1);if(t)throw t;return(null==s?void 0:s[0])||null}static async getProductById(e){let{data:s,error:t}=await n.OQ.from("products").select("*").eq("id",e).limit(1);if(t)throw t;return(null==s?void 0:s[0])||null}static parseCSV(e){try{let s=e.trim().split("\n");if(s.length<2)throw Error("CSVファイルが空か、ヘッダー行しかありません");let t=s[0].split(",").map(e=>e.trim().replace(/^["']|["']$/g,"")),a=[],r=[],i=["name"].filter(e=>!t.some(s=>s.toLowerCase()===e.toLowerCase()));if(i.length>0)throw Error("必須の列が見つかりません: ".concat(i.join(", ")));for(let e=1;e<s.length;e++){let i=s[e].trim();if(!i)continue;let l=this.parseCSVLine(i),n={},c=!1;t.forEach((s,t)=>{var a;let i=(null===(a=l[t])||void 0===a?void 0:a.trim().replace(/^["']|["']$/g,""))||"";switch(s.toLowerCase()){case"id":i&&(n.id=i);break;case"name":i?n.name=i:(r.push("行".concat(e+1,": 商品名が入力されていません")),c=!0);break;case"barcode":i&&(n.barcode=i);break;case"price":if(i){let s=parseFloat(i);isNaN(s)||s<0?r.push("行".concat(e+1,": 価格「").concat(i,"」が無効です")):n.price=s}break;case"variation_name":i&&(n.variation_name=i);break;case"tax_type":if(i){let s=i.toLowerCase();"内税"===s||"inclusive"===s?n.tax_type="inclusive":"外税"===s||"exclusive"===s?n.tax_type="exclusive":["inclusive","exclusive"].includes(s)?n.tax_type=s:r.push("行".concat(e+1,": 税区分「").concat(i,"」が無効です（内税/外税 または inclusive/exclusiveのみ）"))}break;case"category_id":i&&(n.category_id=i);break;case"description":i&&(n.description=i)}}),!c&&n.name&&a.push(n)}if(r.length>0)throw Error("CSVに以下のエラーがあります:\n".concat(r.join("\n")));if(0===a.length)throw Error("有効な商品データが見つかりませんでした");return a}catch(e){throw Error("CSV解析エラー: ".concat(e.message))}}static parseCSVLine(e){let s=[],t="",a=!1;for(let r=0;r<e.length;r++){let i=e[r];'"'===i||"'"===i?a&&e[r+1]===i?(t+=i,r++):a=!a:","!==i||a?t+=i:(s.push(t),t="")}return s.push(t),s}static generateCSVTemplate(e){var s;return"id,name,barcode,price,variation_name,tax_type,category_id,description\n"+["","トマト苗","4901234567890","300","通常価格","inclusive",(null===(s=e[0])||void 0===s?void 0:s.id)||"","中玉トマトの苗"].join(",")}static async exportToCSV(){return["id,name,barcode,price,variation_name,tax_type,category_id,description",...(await this.getAllProducts()).map(e=>[e.id,'"'.concat(e.name,'"'),e.barcode||"",e.price,e.variation_name||"",e.tax_type||"",e.category_id||"",'"'.concat(e.description||"",'"')].join(","))].join("\n")}}var j=t(9703);function f(){let{showSuccess:e,showError:s,showWarning:t}=(0,j.p)(),[i,l]=(0,r.useState)([]),[n,c]=(0,r.useState)(!1),[d,o]=(0,r.useState)("single"),[m,u]=(0,r.useState)(null),[x,h]=(0,r.useState)(""),[p,g]=(0,r.useState)([]),[b,f]=(0,r.useState)(!1),[y,N]=(0,r.useState)({name:"",category_id:"",description:"",price:0,barcode:"",variation_name:"",tax_type:"inclusive",image_url:"",is_available:!0,display_order:0}),w=(0,r.useCallback)(async()=>{try{let e=await v.getAllCategories();l(e)}catch(e){console.error("カテゴリの取得に失敗しました:",e),s("カテゴリの取得に失敗しました","カテゴリ情報を読み込めませんでした。ページを再読み込みしてください。"),l([])}},[]);(0,r.useEffect)(()=>{w()},[w]);let _=async t=>{t.preventDefault(),c(!0);try{await v.createProduct({...y,category_id:y.category_id||void 0}),e("商品を追加しました","商品が正常に登録されました。"),N({name:"",category_id:"",description:"",price:0,barcode:"",variation_name:"",tax_type:"inclusive",image_url:"",is_available:!0,display_order:0})}catch(e){console.error("商品の追加に失敗しました:",e),s("商品の追加に失敗しました",(null==e?void 0:e.message)||"商品の登録中にエラーが発生しました。")}finally{c(!1)}},C=async()=>{if(m)try{let e=await m.text();if(h(e),m.size>10485760)throw Error("ファイルサイズが大きすぎます（10MB以下のファイルをアップロードしてください）");if(!m.name.toLowerCase().endsWith(".csv")&&!m.name.toLowerCase().endsWith(".txt"))throw Error("CSVファイル（.csv または .txt）をアップロードしてください");let s=v.parseCSV(e);g(s),f(!0),s.length>0&&console.log("✅ ".concat(s.length,"件の商品データを読み込みました"))}catch(t){console.error("CSVファイルの解析に失敗しました:",t);let e=(null==t?void 0:t.message)||"ファイルの読み込みに失敗しました";s("CSVファイルの解析に失敗しました","".concat(e,"\n\n以下を確認してください:\n- ファイル形式（CSV形式）\n- 文字エンコーディング（UTF-8推奨）\n- 必須列（name）の存在")),g([]),f(!1)}},k=async()=>{if(0!==p.length){c(!0);try{let e=await v.bulkImportProducts(p),s="処理結果:\n成功: ".concat(e.success,"件\n失敗: ").concat(e.failed,"件");e.warnings&&e.warnings.length>0&&(s+="\n\n⚠️ 警告:\n".concat(e.warnings.join("\n"))),e.errors.length>0&&(s+="\n\n❌ エラー:\n".concat(e.errors.join("\n"))),0===e.failed&&0===e.errors.length&&(s+="\n\n✅ すべての商品が正常に処理されました！"),confirm(s+"\n\n処理を完了しますか？")&&(u(null),h(""),g([]),f(!1))}catch(t){console.error("CSV インポートに失敗しました:",t);let e=(null==t?void 0:t.message)||(null==t?void 0:t.toString())||"不明なエラーが発生しました";s("CSV インポートに失敗しました","".concat(e,"\n\nCSVファイルの形式を確認してください。"))}finally{c(!1)}}},S=()=>v.generateCSVTemplate(i),O=async()=>{try{let e=await v.exportToCSV(),s=new Blob([e],{type:"text/csv;charset=utf-8;"}),t=document.createElement("a");t.href=URL.createObjectURL(s),t.download="products_export_".concat(new Date().toISOString().split("T")[0],".csv"),t.click()}catch(e){console.error("CSV エクスポートに失敗しました:",e),s("CSV エクスポートに失敗しました",(null==e?void 0:e.message)||"エクスポート処理中にエラーが発生しました。")}};return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-gray-800",children:"商品追加"}),(0,a.jsx)("p",{className:"text-gray-600",children:"新しい商品を登録または一括アップロードします"})]}),(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsxs)("button",{onClick:()=>{let e=new Blob([S()],{type:"text/csv;charset=utf-8;"}),s=document.createElement("a");s.href=URL.createObjectURL(e),s.download="product_template.csv",s.click()},className:"btn-modern btn-outline-modern flex items-center gap-2",title:"CSV形式のテンプレートファイルをダウンロード",children:[(0,a.jsx)("span",{className:"text-lg",children:"\uD83D\uDCC4"}),"CSVテンプレート"]}),(0,a.jsxs)("button",{onClick:O,className:"btn-modern btn-secondary-modern flex items-center gap-2",title:"現在の商品データをCSV形式でエクスポート",children:[(0,a.jsx)("span",{className:"text-lg",children:"\uD83D\uDCE4"}),"商品エクスポート"]})]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border",children:[(0,a.jsx)("div",{className:"border-b bg-gray-50",children:(0,a.jsxs)("nav",{className:"flex",children:[(0,a.jsxs)("button",{onClick:()=>o("single"),className:"px-6 py-4 text-sm font-medium border-b-2 transition-all duration-200 flex items-center gap-2 ".concat("single"===d?"border-blue-500 text-blue-600 bg-white":"border-transparent text-gray-500 hover:text-gray-700 hover:bg-gray-100"),children:[(0,a.jsx)("span",{className:"text-lg",children:"\uD83D\uDCDD"}),"単一商品追加",(0,a.jsx)("span",{className:"text-xs bg-blue-100 text-blue-600 px-2 py-1 rounded-full",children:"推奨"})]}),(0,a.jsxs)("button",{onClick:()=>o("csv"),className:"px-6 py-4 text-sm font-medium border-b-2 transition-all duration-200 flex items-center gap-2 ".concat("csv"===d?"border-blue-500 text-blue-600 bg-white":"border-transparent text-gray-500 hover:text-gray-700 hover:bg-gray-100"),children:[(0,a.jsx)("span",{className:"text-lg",children:"\uD83D\uDCCA"}),"CSV一括追加",(0,a.jsx)("span",{className:"text-xs bg-orange-100 text-orange-600 px-2 py-1 rounded-full",children:"上級者向け"})]})]})}),(0,a.jsx)("div",{className:"p-6",children:"single"===d?(0,a.jsxs)("form",{onSubmit:_,className:"space-y-6",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"商品名 *"}),(0,a.jsx)("input",{type:"text",value:y.name,onChange:e=>N({...y,name:e.target.value}),required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"カテゴリ"}),(0,a.jsxs)("select",{value:y.category_id,onChange:e=>N({...y,category_id:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,a.jsx)("option",{value:"",children:"カテゴリを選択"}),i.map(e=>(0,a.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"価格 *"}),(0,a.jsx)("input",{type:"number",value:y.price,onChange:e=>N({...y,price:Number(e.target.value)}),required:!0,min:"0",step:"0.01",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"JANコード"}),(0,a.jsx)("input",{type:"text",value:y.barcode,onChange:e=>N({...y,barcode:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"価格バリエーション名"}),(0,a.jsx)("input",{type:"text",value:y.variation_name,onChange:e=>N({...y,variation_name:e.target.value}),placeholder:"例: 通常価格、予約価格",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"税区分"}),(0,a.jsxs)("select",{value:y.tax_type,onChange:e=>N({...y,tax_type:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,a.jsx)("option",{value:"inclusive",children:"税込"}),(0,a.jsx)("option",{value:"exclusive",children:"税抜"})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"商品説明"}),(0,a.jsx)("textarea",{value:y.description,onChange:e=>N({...y,description:e.target.value}),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("input",{type:"checkbox",id:"is_available",checked:y.is_available,onChange:e=>N({...y,is_available:e.target.checked}),className:"mr-2"}),(0,a.jsx)("label",{htmlFor:"is_available",className:"text-sm font-medium text-gray-700",children:"販売中として追加"})]}),(0,a.jsxs)("div",{className:"flex justify-end gap-3",children:[(0,a.jsx)("button",{type:"button",onClick:()=>N({name:"",category_id:"",description:"",price:0,barcode:"",variation_name:"",tax_type:"inclusive",image_url:"",is_available:!0,display_order:0}),className:"btn-modern btn-secondary-modern",children:"リセット"}),(0,a.jsx)("button",{type:"submit",disabled:n,className:"btn-modern btn-success-modern flex items-center gap-2 px-6",children:n?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"追加中..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",{className:"text-lg",children:"✅"}),"商品を追加する"]})})]})]}):(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-blue-800 mb-2",children:"CSV形式について"}),(0,a.jsx)("p",{className:"text-sm text-blue-700 mb-3",children:"以下の列を含むCSVファイルをアップロードしてください："}),(0,a.jsxs)("div",{className:"text-sm text-blue-700 space-y-1",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"id:"})," 既存商品ID（更新時のみ）"]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"name:"})," 商品名（必須）"]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"barcode:"})," JANコード（任意）"]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"price:"})," 価格（任意、デフォルト0）"]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"variation_name:"})," 価格バリエーション名（任意）"]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"tax_type:"})," 税区分（任意、inclusive/exclusive）"]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"category_id:"})," カテゴリID（任意）"]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"description:"})," 商品説明（任意）"]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"CSVファイルをアップロード"}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)("input",{type:"file",accept:".csv,.txt",onChange:e=>{var s;let t=null===(s=e.target.files)||void 0===s?void 0:s[0];t&&(u(t),f(!1),g([]))},className:"hidden",id:"csv-upload"}),(0,a.jsxs)("label",{htmlFor:"csv-upload",className:"btn-modern btn-outline-modern inline-flex items-center gap-2 cursor-pointer",children:[(0,a.jsx)("span",{className:"text-lg",children:"\uD83D\uDCC4"}),m?"ファイルを変更":"CSVファイルを選択"]}),m&&(0,a.jsx)("div",{className:"p-3 bg-blue-50 border border-blue-200 rounded-lg",children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"text-lg",children:"\uD83D\uDCC4"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-medium text-blue-900",children:m.name}),(0,a.jsxs)("div",{className:"text-sm text-blue-600",children:["ファイルサイズ: ",(m.size/1024).toFixed(1)," KB"]})]})]})})]})]}),(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsx)("button",{onClick:C,disabled:!m,className:"btn-modern btn-outline-modern",children:"\uD83D\uDC41️ プレビュー"}),b&&(0,a.jsx)("button",{onClick:k,disabled:n||0===p.length,className:"btn-modern btn-success-modern",children:n?"インポート中...":"".concat(p.length,"件をインポート")})]}),b&&p.length>0&&(0,a.jsxs)("div",{className:"bg-white border rounded-lg overflow-hidden",children:[(0,a.jsx)("div",{className:"bg-gray-50 px-4 py-3 border-b",children:(0,a.jsxs)("h4",{className:"font-medium text-gray-900",children:["プレビュー (",p.length,"件)"]})}),(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"商品名"}),(0,a.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"価格"}),(0,a.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"バリエーション"}),(0,a.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"JANコード"}),(0,a.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"操作"})]})}),(0,a.jsx)("tbody",{className:"divide-y divide-gray-200",children:p.map((e,s)=>(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"px-4 py-2 text-sm",children:e.name}),(0,a.jsxs)("td",{className:"px-4 py-2 text-sm",children:["\xa5",(e.price||0).toLocaleString()]}),(0,a.jsx)("td",{className:"px-4 py-2 text-sm",children:e.variation_name||"-"}),(0,a.jsx)("td",{className:"px-4 py-2 text-sm",children:e.barcode||"-"}),(0,a.jsx)("td",{className:"px-4 py-2 text-sm",children:(0,a.jsx)("span",{className:"inline-flex px-2 py-1 text-xs rounded-full ".concat(e.id?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"),children:e.id?"更新":"新規"})})]},s))})]})})]})]})})]})]})}var y=t(2549),N=t(5120),w=()=>{let[e,s]=(0,r.useState)([]),[t,i]=(0,r.useState)(!0),[l,c]=(0,r.useState)(""),[d,o]=(0,r.useState)(!1),[u,h]=(0,r.useState)(null),[p,g]=(0,r.useState)(null),[b,v]=(0,r.useState)({name:"",description:"",display_order:0,is_active:!0}),[j,f]=(0,r.useState)({}),[y,N]=(0,r.useState)(!1);(0,r.useEffect)(()=>{w()},[]);let w=async()=>{i(!0);try{let{data:e,error:t}=await n.OQ.from("product_categories").select("*").order("display_order",{ascending:!0});if(t)throw t;s(e||[])}catch(e){console.error("カテゴリ情報の取得に失敗しました:",e)}finally{i(!1)}},_=e.filter(e=>{var s;return e.name.toLowerCase().includes(l.toLowerCase())||(null===(s=e.description)||void 0===s?void 0:s.toLowerCase().includes(l.toLowerCase()))}),C=()=>{let e={};return b.name.trim()||(e.name="カテゴリ名は必須です"),b.display_order<0&&(e.display_order="表示順序は0以上の数値を入力してください"),f(e),0===Object.keys(e).length},k=async e=>{if(e.preventDefault(),C()){N(!0);try{let e={name:b.name.trim(),description:b.description.trim()||null,display_order:b.display_order,is_active:b.is_active,updated_at:new Date().toISOString()};if(u){let{error:s}=await n.OQ.from("product_categories").update(e).eq("id",u.id);if(s)throw s}else{let{error:s}=await n.OQ.from("product_categories").insert([e]);if(s)throw s}J(),w()}catch(e){console.error("カテゴリ情報の保存に失敗しました:",e),alert("保存に失敗しました。もう一度お試しください。")}finally{N(!1)}}},S=e=>{h(e),v({name:e.name,description:e.description||"",display_order:e.display_order,is_active:e.is_active}),o(!0)},O=async()=>{if(p)try{let{data:e,error:s}=await n.OQ.from("products").select("id").eq("category_id",p.id).limit(1);if(s)throw s;if(e&&e.length>0){alert("このカテゴリを使用している商品が存在するため、削除できません。"),g(null);return}let{error:t}=await n.OQ.from("product_categories").delete().eq("id",p.id);if(t)throw t;g(null),w()}catch(e){console.error("カテゴリ情報の削除に失敗しました:",e),alert("削除に失敗しました。もう一度お試しください。")}},D=async e=>{try{let{error:s}=await n.OQ.from("product_categories").update({is_active:!e.is_active,updated_at:new Date().toISOString()}).eq("id",e.id);if(s)throw s;w()}catch(e){console.error("カテゴリ状態の更新に失敗しました:",e),alert("状態の更新に失敗しました。")}},J=()=>{v({name:"",description:"",display_order:e.length,is_active:!0}),f({}),h(null),o(!1)},P=e=>s=>{let t="display_order"===e?parseInt(s.target.value)||0:"is_active"===e?s.target.checked:s.target.value;v({...b,[e]:t}),j[e]&&f({...j,[e]:""})};return(0,a.jsxs)("div",{className:"container-fluid py-4",children:[(0,a.jsxs)("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"h3 text-dark fw-bold mb-1",children:"商品カテゴリ管理"}),(0,a.jsx)("p",{className:"text-muted mb-0",children:"商品カテゴリの追加・編集・削除・並び順の管理"})]}),(0,a.jsxs)("button",{onClick:()=>o(!0),className:"btn btn-success d-flex align-items-center",children:[(0,a.jsx)(m.JO,{icon:m.PJ.add,size:"sm",className:"me-2"}),"新規カテゴリ追加"]})]}),(0,a.jsx)("div",{className:"card mb-4",children:(0,a.jsx)("div",{className:"card-body",children:(0,a.jsxs)("div",{className:"position-relative",children:[(0,a.jsx)(m.JO,{icon:m.PJ.search,size:"sm",className:"position-absolute top-50 start-0 translate-middle-y ms-3 text-muted"}),(0,a.jsx)("input",{type:"text",placeholder:"カテゴリ名、説明で検索...",value:l,onChange:e=>c(e.target.value),className:"form-control ps-5"})]})})}),(0,a.jsxs)("div",{className:"card",children:[(0,a.jsx)("div",{className:"card-header bg-light",children:(0,a.jsxs)("h5",{className:"card-title mb-0",children:["カテゴリ一覧 (",_.length,"件)"]})}),(0,a.jsx)("div",{className:"card-body p-0",children:t?(0,a.jsxs)("div",{className:"d-flex align-items-center justify-content-center py-5",children:[(0,a.jsx)(m.JO,{icon:m.PJ.loading,size:"lg",className:"animate-spin text-primary me-2"}),(0,a.jsx)("span",{className:"text-muted",children:"読み込み中..."})]}):_.length>0?(0,a.jsx)("div",{className:"table-responsive",children:(0,a.jsxs)("table",{className:"table table-hover mb-0",children:[(0,a.jsx)("thead",{className:"table-light",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"border-0",children:"表示順"}),(0,a.jsx)("th",{className:"border-0",children:"カテゴリ名"}),(0,a.jsx)("th",{className:"border-0",children:"説明"}),(0,a.jsx)("th",{className:"border-0",children:"状態"}),(0,a.jsx)("th",{className:"border-0",children:"作成日"}),(0,a.jsx)("th",{className:"border-0 text-end",children:"操作"})]})}),(0,a.jsx)("tbody",{children:_.map(e=>(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{children:(0,a.jsx)("span",{className:"badge bg-secondary",children:e.display_order})}),(0,a.jsx)("td",{children:(0,a.jsxs)("div",{className:"d-flex align-items-center",children:[(0,a.jsx)(m.JO,{icon:m.PJ.tag,size:"sm",className:"text-primary me-2"}),(0,a.jsx)("span",{className:"fw-medium",children:e.name})]})}),(0,a.jsx)("td",{children:(0,a.jsx)("span",{className:"text-muted",children:e.description||"説明なし"})}),(0,a.jsx)("td",{children:(0,a.jsxs)("button",{onClick:()=>D(e),className:"btn btn-sm ".concat(e.is_active?"btn-outline-success":"btn-outline-secondary"),children:[(0,a.jsx)(m.JO,{icon:e.is_active?m.PJ.eye:m.PJ.eyeOff,size:"xs",className:"me-1"}),e.is_active?"有効":"無効"]})}),(0,a.jsx)("td",{className:"text-muted",children:new Date(e.created_at).toLocaleDateString("ja-JP")}),(0,a.jsx)("td",{children:(0,a.jsxs)("div",{className:"d-flex justify-content-end gap-1",children:[(0,a.jsx)("button",{onClick:()=>S(e),className:"btn btn-sm btn-outline-primary",title:"編集",children:(0,a.jsx)(m.JO,{icon:m.PJ.edit,size:"xs"})}),(0,a.jsx)("button",{onClick:()=>g(e),className:"btn btn-sm btn-outline-danger",title:"削除",children:(0,a.jsx)(m.JO,{icon:m.PJ.delete,size:"xs"})})]})})]},e.id))})]})}):(0,a.jsxs)("div",{className:"text-center py-5",children:[(0,a.jsx)(m.JO,{icon:m.PJ.tag,size:"xl",className:"text-muted mb-3"}),(0,a.jsx)("p",{className:"text-muted",children:l?"検索条件に合うカテゴリが見つかりません":"登録されているカテゴリがありません"}),!l&&(0,a.jsx)("button",{onClick:()=>o(!0),className:"btn btn-success mt-2",children:"初めてのカテゴリを追加"})]})})]}),d&&(0,a.jsx)("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.5)"},children:(0,a.jsx)("div",{className:"modal-dialog modal-lg",children:(0,a.jsxs)("div",{className:"modal-content",children:[(0,a.jsxs)("div",{className:"modal-header",children:[(0,a.jsx)("h5",{className:"modal-title",children:u?"カテゴリ編集":"新規カテゴリ追加"}),(0,a.jsx)("button",{type:"button",className:"btn-close",onClick:J})]}),(0,a.jsxs)("form",{onSubmit:k,children:[(0,a.jsx)("div",{className:"modal-body",children:(0,a.jsxs)("div",{className:"row g-3",children:[(0,a.jsxs)("div",{className:"col-md-8",children:[(0,a.jsxs)("label",{className:"form-label",children:["カテゴリ名 ",(0,a.jsx)("span",{className:"text-danger",children:"*"})]}),(0,a.jsx)("input",{type:"text",value:b.name,onChange:P("name"),className:"form-control ".concat(j.name?"is-invalid":""),placeholder:"野菜の苗、花の苗など"}),j.name&&(0,a.jsx)("div",{className:"invalid-feedback",children:j.name})]}),(0,a.jsxs)("div",{className:"col-md-4",children:[(0,a.jsx)("label",{className:"form-label",children:"表示順序"}),(0,a.jsx)("input",{type:"number",value:b.display_order,onChange:P("display_order"),className:"form-control ".concat(j.display_order?"is-invalid":""),min:"0"}),j.display_order&&(0,a.jsx)("div",{className:"invalid-feedback",children:j.display_order})]}),(0,a.jsxs)("div",{className:"col-12",children:[(0,a.jsx)("label",{className:"form-label",children:"説明"}),(0,a.jsx)("textarea",{value:b.description,onChange:P("description"),className:"form-control",rows:3,placeholder:"このカテゴリの説明を入力してください"})]}),(0,a.jsx)("div",{className:"col-12",children:(0,a.jsxs)("div",{className:"form-check",children:[(0,a.jsx)("input",{type:"checkbox",id:"is_active",checked:b.is_active,onChange:P("is_active"),className:"form-check-input"}),(0,a.jsx)("label",{htmlFor:"is_active",className:"form-check-label",children:"このカテゴリを有効にする"})]})})]})}),(0,a.jsxs)("div",{className:"modal-footer",children:[(0,a.jsx)("button",{type:"button",onClick:J,className:"btn btn-secondary",children:"キャンセル"}),(0,a.jsx)("button",{type:"submit",disabled:y,className:"btn btn-primary d-flex align-items-center",children:y?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(m.JO,{icon:m.PJ.loading,size:"sm",className:"animate-spin me-2"}),"保存中..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(m.JO,{icon:m.PJ.save,size:"sm",className:"me-2"}),u?"更新":"追加"]})})]})]})]})})}),(0,a.jsx)(x.$,{isOpen:!!p,title:"カテゴリの削除",itemName:(null==p?void 0:p.name)||"",onConfirm:O,onCancel:()=>g(null)})]})},_=t(5097);function C(){let[e,s]=(0,r.useState)(""),[t,l]=(0,r.useState)(""),[n,c]=(0,r.useState)(!1),{signIn:d}=(0,i.a)(),o=async s=>{s.preventDefault(),c(!0);try{await d(e,t)}finally{c(!1)}};return(0,a.jsxs)("div",{className:"min-vh-100 d-flex align-items-center justify-content-center bg-light position-relative",children:[(0,a.jsx)("div",{className:"position-absolute w-100 h-100 opacity-25",style:{backgroundImage:"url(\"data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%2322c55e' fill-opacity='0.1'%3E%3Ccircle cx='6' cy='6' r='6'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E\")"}}),(0,a.jsx)("div",{className:"container",children:(0,a.jsx)("div",{className:"row justify-content-center",children:(0,a.jsx)("div",{className:"col-md-6 col-lg-4",children:(0,a.jsx)("div",{className:"card shadow-lg border-0 fade-in",children:(0,a.jsxs)("div",{className:"card-body p-5",children:[(0,a.jsxs)("div",{className:"text-center mb-4",children:[(0,a.jsx)("div",{className:"display-4 mb-3",children:"\uD83C\uDF31"}),(0,a.jsx)("h2",{className:"h3 fw-bold text-primary mb-1",children:"種苗店管理システム"}),(0,a.jsx)("p",{className:"text-muted",children:"管理者ログイン"})]}),(0,a.jsxs)("form",{onSubmit:o,children:[(0,a.jsxs)("div",{className:"mb-3",children:[(0,a.jsx)("label",{htmlFor:"email",className:"form-label",children:"メールアドレス"}),(0,a.jsx)("input",{id:"email",name:"email",type:"email",required:!0,autoComplete:"username",className:"form-control form-control-lg",placeholder:"admin@example.com",value:e,onChange:e=>s(e.target.value),disabled:n})]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{htmlFor:"password",className:"form-label",children:"パスワード"}),(0,a.jsx)("input",{id:"password",name:"password",type:"password",required:!0,autoComplete:"current-password",className:"form-control form-control-lg",placeholder:"パスワードを入力してください",value:t,onChange:e=>l(e.target.value),disabled:n})]}),(0,a.jsx)("div",{className:"d-grid mb-3",children:(0,a.jsx)("button",{type:"submit",disabled:n,className:"btn btn-primary btn-lg",children:n?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",{className:"loading-spinner me-2"}),"ログイン中..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("i",{className:"bi bi-box-arrow-in-right me-2"}),"ログイン"]})})}),(0,a.jsx)("div",{className:"text-center",children:(0,a.jsx)("small",{className:"text-muted",children:"管理者アカウントでログインしてください"})})]})]})})})})})]})}function k(){let{user:e,loading:s,isAdmin:t}=(0,i.a)(),[n,d]=(0,r.useState)("dashboard");return s?(0,a.jsx)("div",{className:"min-vh-100 d-flex align-items-center justify-content-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"loading-spinner mb-3"}),(0,a.jsx)("p",{className:"text-muted",children:"認証情報を確認中..."})]})}):e&&t?(0,a.jsx)(l.Z,{children:(()=>{switch(n){case"dashboard":default:return(0,a.jsx)(c,{});case"reservation-list":return(0,a.jsx)(y.Z,{});case"reservation-calendar":return(0,a.jsxs)("div",{className:"admin-card",children:[(0,a.jsx)("div",{className:"admin-card-header",children:(0,a.jsx)("h2",{className:"admin-card-title",children:"予約カレンダー"})}),(0,a.jsxs)("div",{className:"text-center py-12",children:[(0,a.jsx)("div",{className:"text-6xl mb-4",children:"\uD83D\uDDD3️"}),(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"予約カレンダー"}),(0,a.jsx)("p",{className:"text-gray-600",children:"カレンダー形式で予約を管理します。"})]})]});case"reservation-search":return(0,a.jsxs)("div",{className:"admin-card",children:[(0,a.jsx)("div",{className:"admin-card-header",children:(0,a.jsx)("h2",{className:"admin-card-title",children:"予約検索"})}),(0,a.jsxs)("div",{className:"text-center py-12",children:[(0,a.jsx)("div",{className:"text-6xl mb-4",children:"\uD83D\uDD0D"}),(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"予約検索"}),(0,a.jsx)("p",{className:"text-gray-600",children:"詳細条件で予約を検索します。"})]})]});case"product-list":return(0,a.jsx)(b.Z,{});case"product-add":return(0,a.jsx)(f,{});case"product-categories":return(0,a.jsx)(w,{});case"customer-list":return(0,a.jsx)(_.Z,{});case"customer-search":return(0,a.jsxs)("div",{className:"admin-card",children:[(0,a.jsx)("div",{className:"admin-card-header",children:(0,a.jsx)("h2",{className:"admin-card-title",children:"顧客検索"})}),(0,a.jsxs)("div",{className:"text-center py-12",children:[(0,a.jsx)("div",{className:"text-6xl mb-4",children:"\uD83D\uDD0D"}),(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"顧客検索"}),(0,a.jsx)("p",{className:"text-gray-600",children:"詳細条件で顧客を検索します。"})]})]});case"form-builder":return(0,a.jsx)(p,{});case"form-list":return(0,a.jsx)(g.Z,{});case"form-settings":return(0,a.jsxs)("div",{className:"admin-card",children:[(0,a.jsx)("div",{className:"admin-card-header",children:(0,a.jsx)("h2",{className:"admin-card-title",children:"フォーム設定"})}),(0,a.jsxs)("div",{className:"text-center py-12",children:[(0,a.jsx)("div",{className:"text-6xl mb-4",children:"⚙️"}),(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"フォーム設定"}),(0,a.jsxs)("p",{className:"text-gray-600",children:["フォーム全体の設定を管理します。",(0,a.jsx)("br",{}),"通知設定、デザイン設定、セキュリティ設定など。"]})]})]});case"business-settings":return(0,a.jsxs)("div",{className:"admin-card",children:[(0,a.jsx)("div",{className:"admin-card-header",children:(0,a.jsx)("h2",{className:"admin-card-title",children:"店舗設定"})}),(0,a.jsxs)("div",{className:"text-center py-12",children:[(0,a.jsx)("div",{className:"text-6xl mb-4",children:"\uD83C\uDFEA"}),(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"店舗設定"}),(0,a.jsx)("p",{className:"text-gray-600",children:"店舗情報、営業時間、連絡先などの基本設定を管理します。"})]})]});case"notification-settings":return(0,a.jsx)(N.Z,{});case"user-management":return(0,a.jsxs)("div",{className:"admin-card",children:[(0,a.jsx)("div",{className:"admin-card-header",children:(0,a.jsx)("h2",{className:"admin-card-title",children:"ユーザー管理"})}),(0,a.jsxs)("div",{className:"text-center py-12",children:[(0,a.jsx)("div",{className:"text-6xl mb-4",children:"\uD83D\uDC68‍\uD83D\uDCBC"}),(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"ユーザー管理"}),(0,a.jsx)("p",{className:"text-gray-600",children:"管理者ユーザーの追加・編集・権限設定を行います。"})]})]})}})()}):(0,a.jsx)(C,{})}},7755:function(e,s,t){"use strict";t.d(s,{Z:function(){return l}});var a=t(7437),r=t(2265);async function i(e){try{let s=await fetch("https://zipcloud.ibsnet.co.jp/api/search?zipcode=".concat(e)),t=await s.json();if(200===t.status&&t.results&&t.results.length>0){let e=t.results[0];return{prefecture:e.address1,city:e.address2,town:e.address3,fullAddress:"".concat(e.address1).concat(e.address2).concat(e.address3)}}return null}catch(e){return console.error("住所検索エラー:",e),null}}function l(e){let{formConfig:s}=e,[t,l]=(0,r.useState)({}),[n,c]=(0,r.useState)(new Set),[d,o]=(0,r.useState)(!1),m=e=>s=>{l({...t,[e]:s.target.value})},u=e=>{let s=function(e){let s=e.replace(/[^0-9]/g,"");return s.length<=3?s:"".concat(s.slice(0,3),"-").concat(s.slice(3,7))}(e.target.value);l({...t,postal_code:s}),s.replace(/[^0-9]/g,"").length<7&&n.size>0&&(l(e=>({...e,prefecture:"",city:"",address:""})),c(new Set))},x=async()=>{let e=(t.postal_code||"").replace(/[^0-9]/g,"");if(7===e.length){o(!0);try{let s=await i(e);s&&(l(e=>({...e,prefecture:s.prefecture||"",city:s.city||"",address:s.town||""})),c(new Set(["prefecture","city"])))}catch(e){console.error("住所検索エラー:",e)}finally{o(!1)}}},h=()=>{l(e=>({...e,prefecture:"",city:"",address:""})),c(new Set)},p=e=>n.has(e)&&("prefecture"===e||"city"===e)?"w-full px-3 py-2 border border-green-300 bg-green-50 rounded-md text-sm":"w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",g=e=>n.has(e)&&("prefecture"===e||"city"===e),b=()=>{let e=(t.postal_code||"").replace(/[^0-9]/g,"");return 0===e.length?"郵便番号を入力してください":e.length<7?"あと".concat(7-e.length,"桁入力してください"):7===e.length?"タップして住所を検索":""},v=s.fields.filter(e=>!1!==e.enabled);return(0,a.jsxs)("div",{className:"max-w-lg mx-auto bg-white border rounded-lg p-6 space-y-6",children:[(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("h2",{className:"text-xl font-bold text-gray-900 mb-2",children:s.name}),(0,a.jsx)("p",{className:"text-gray-600 text-sm",children:s.description})]}),(0,a.jsxs)("form",{className:"space-y-6",children:[v.map(e=>{var s,r,i;let l=t[e.id]||"";return"postal_code"===e.id?(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700",children:[e.label,e.required&&(0,a.jsx)("span",{className:"text-red-500 ml-1",children:"*"}),d&&(0,a.jsx)("span",{className:"text-sm text-blue-600 ml-2",children:"住所を検索中..."})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("input",{type:"text",value:l,onChange:u,className:"flex-1 px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:e.placeholder||"例: 123-4567",maxLength:8}),(0,a.jsx)("button",{type:"button",onClick:x,disabled:d||7!==l.replace(/[^0-9]/g,"").length,title:b(),className:"px-4 py-2 text-sm font-medium rounded-md transition-colors ".concat(d||7!==l.replace(/[^0-9]/g,"").length?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700"),children:d?"検索中...":"住所検索"}),n.size>0&&(0,a.jsx)("button",{type:"button",onClick:h,className:"px-3 py-2 text-sm bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300",children:"クリア"})]}),(0,a.jsxs)("div",{className:"text-sm text-gray-600 space-y-1",children:[(0,a.jsx)("p",{children:"\uD83D\uDCCD 郵便番号を7桁入力後、「住所検索」ボタンをタップで住所が自動入力されます"}),(0,a.jsx)("p",{children:"\uD83D\uDD12 都道府県・市区町村は自動入力、町名以降は編集できます"})]})]},e.id):"prefecture"===e.id||"city"===e.id?(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700",children:[e.label,e.required&&(0,a.jsx)("span",{className:"text-red-500 ml-1",children:"*"}),n.has(e.id)&&(0,a.jsx)("span",{className:"text-xs text-gray-500 ml-2",children:"(自動入力)"})]}),(0,a.jsx)("input",{type:"text",value:l,onChange:m(e.id),className:p(e.id),placeholder:e.placeholder,readOnly:g(e.id)})]},e.id):(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700",children:[e.label,e.required&&(0,a.jsx)("span",{className:"text-red-500 ml-1",children:"*"})]}),"textarea"===e.type?(0,a.jsx)("textarea",{value:l,onChange:m(e.id),placeholder:e.placeholder,className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",rows:3}):"select"===e.type?(0,a.jsxs)("select",{value:l,onChange:m(e.id),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,a.jsx)("option",{value:"",children:"選択してください"}),null===(s=e.options)||void 0===s?void 0:s.map((e,s)=>(0,a.jsx)("option",{value:e,children:e},s))]}):"radio"===e.type?(0,a.jsx)("div",{className:"space-y-2",children:null===(r=e.options)||void 0===r?void 0:r.map((s,t)=>(0,a.jsxs)("label",{className:"flex items-center",children:[(0,a.jsx)("input",{type:"radio",name:e.id,value:s,checked:l===s,onChange:m(e.id),className:"mr-2"}),s]},t))}):"checkbox"===e.type?(0,a.jsx)("div",{className:"space-y-2",children:null===(i=e.options)||void 0===i?void 0:i.map((e,s)=>(0,a.jsxs)("label",{className:"flex items-center",children:[(0,a.jsx)("input",{type:"checkbox",value:e,className:"mr-2"}),e]},s))}):(0,a.jsx)("input",{type:e.type,value:l,onChange:m(e.id),placeholder:e.placeholder,className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"})]},e.id)}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"商品選択"}),(0,a.jsx)("div",{className:"bg-gray-50 p-4 rounded-lg",children:(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"選択された商品がここに表示されます"})})]}),(0,a.jsx)("div",{className:"text-right",children:(0,a.jsxs)("div",{className:"text-lg font-semibold",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"小計: "}),(0,a.jsx)("span",{className:"text-gray-900",children:"\xa50"})]})})]}),(0,a.jsx)("button",{type:"button",className:"w-full bg-green-600 text-white py-3 px-4 rounded-lg font-medium hover:bg-green-700 transition-colors",disabled:!0,children:"予約内容を確認する"})]}),(0,a.jsx)("div",{className:"text-center text-xs text-gray-500",children:"※ これはプレビューです。実際の予約はできません。"})]})}},7464:function(e,s,t){"use strict";t.d(s,{AuthProvider:function(){return d},a:function(){return c}});var a=t(7437),r=t(2265),i=t(2141),l=t(9703);let n=(0,r.createContext)(void 0),c=()=>{let e=(0,r.useContext)(n);if(!e)throw Error("useAuth must be used within an AuthProvider");return e},d=e=>{var s,t;let{children:c}=e,[d,o]=(0,r.useState)(null),[m,u]=(0,r.useState)(null),[x,h]=(0,r.useState)(!0),{showError:p,showSuccess:g}=(0,l.p)(),b=(null==d?void 0:d.email)==="admin@katagiri-shop.com"||(null==d?void 0:null===(s=d.user_metadata)||void 0===s?void 0:s.role)==="admin"||(null==d?void 0:null===(t=d.app_metadata)||void 0===t?void 0:t.role)==="admin";(0,r.useEffect)(()=>{i.OQ.auth.getSession().then(e=>{var s;let{data:{session:t}}=e;u(t),o(null!==(s=null==t?void 0:t.user)&&void 0!==s?s:null),h(!1)});let{data:{subscription:e}}=i.OQ.auth.onAuthStateChange((e,s)=>{var t;u(s),o(null!==(t=null==s?void 0:s.user)&&void 0!==t?t:null),h(!1)});return()=>e.unsubscribe()},[]);let v=async(e,s)=>{try{h(!0);let{data:r,error:l}=await i.OQ.auth.signInWithPassword({email:e,password:s});if(l)return p("ログインに失敗しました",l.message),!1;if(r.user){var t,a;if(!("admin@katagiri-shop.com"===r.user.email||(null===(t=r.user.user_metadata)||void 0===t?void 0:t.role)==="admin"||(null===(a=r.user.app_metadata)||void 0===a?void 0:a.role)==="admin"))return await i.OQ.auth.signOut(),p("アクセス権限がありません","管理者アカウントでログインしてください"),!1;return g("ログインしました","管理画面へようこそ"),!0}return!1}catch(e){return p("ログインエラー",e.message||"予期しないエラーが発生しました"),!1}finally{h(!1)}},j=async()=>{try{h(!0);let{error:e}=await i.OQ.auth.signOut();e?p("ログアウトに失敗しました",e.message):g("ログアウトしました","")}catch(e){p("ログアウトエラー",e.message)}finally{h(!1)}};return(0,a.jsx)(n.Provider,{value:{user:d,session:m,loading:x,signIn:v,signOut:j,isAdmin:b},children:c})}}},function(e){e.O(0,[789,448,901,145,532,97,330,120,172,971,117,744],function(){return e(e.s=9435)}),_N_E=e.O()}]);