"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[330],{7330:function(e,s,a){a.d(s,{Z:function(){return n}});var l=a(7437),i=a(2265),t=a(3145),c=a(2141),d=a(9703);function n(){let{showSuccess:e,showError:s}=(0,d.p)(),[a,n]=(0,i.useState)([]),[r,m]=(0,i.useState)([]),[o,x]=(0,i.useState)(!0),[h,u]=(0,i.useState)("all"),[j,b]=(0,i.useState)(""),[N,p]=(0,i.useState)(!1);(0,i.useEffect)(()=>{v(),g()},[]);let v=async()=>{try{let{data:e,error:s}=await c.OQ.from("products").select("\n          *,\n          category:product_categories(*)\n        ").order("display_order",{ascending:!0});if(s)throw s;n(e||[])}catch(e){console.error("商品の取得に失敗しました:",e),n([])}finally{x(!1)}},g=async()=>{try{let{data:e,error:s}=await c.OQ.from("product_categories").select("*").eq("is_active",!0).order("display_order",{ascending:!0});if(s)throw s;m(e||[])}catch(e){console.error("カテゴリの取得に失敗しました:",e),m([])}},f=async(e,l)=>{try{let{error:s}=await c.OQ.from("products").update({is_available:!l}).eq("id",e);if(s)throw s;n(a.map(s=>s.id===e?{...s,is_available:!l}:s))}catch(e){console.error("商品ステータスの更新に失敗しました:",e),s("ステータス更新に失敗しました",(null==e?void 0:e.message)||"商品ステータスの更新中にエラーが発生しました。")}},w=async l=>{if(confirm("この商品を削除しますか？"))try{let{error:s}=await c.OQ.from("products").delete().eq("id",l);if(s)throw s;n(a.filter(e=>e.id!==l)),e("商品を削除しました","商品が正常に削除されました。")}catch(e){console.error("商品の削除に失敗しました:",e),s("商品の削除に失敗しました",(null==e?void 0:e.message)||"商品の削除中にエラーが発生しました。")}},y=a.filter(e=>{let s="all"===h||e.category_id===h,a=e.name.toLowerCase().includes(j.toLowerCase())||e.description&&e.description.toLowerCase().includes(j.toLowerCase());return s&&a});return o?(0,l.jsx)("div",{className:"d-flex justify-content-center align-items-center",style:{height:"256px"},children:(0,l.jsx)("div",{className:"loading-spinner"})}):(0,l.jsxs)("div",{className:"container-fluid py-4",children:[(0,l.jsx)("div",{className:"row mb-4",children:(0,l.jsx)("div",{className:"col-12",children:(0,l.jsxs)("div",{className:"d-flex justify-content-between align-items-center",children:[(0,l.jsx)("h2",{className:"h2 fw-bold text-dark",children:"商品一覧"}),(0,l.jsx)("div",{className:"d-flex gap-3",children:(0,l.jsxs)("button",{onClick:()=>window.location.href="/admin/products/add",className:"btn btn-success",children:[(0,l.jsx)("i",{className:"bi bi-plus-circle me-2"}),"新規商品追加"]})})]})})}),(0,l.jsx)("div",{className:"row mb-4",children:(0,l.jsx)("div",{className:"col-12",children:(0,l.jsx)("div",{className:"card",children:(0,l.jsx)("div",{className:"card-body",children:(0,l.jsxs)("div",{className:"row g-3",children:[(0,l.jsxs)("div",{className:"col-lg-4 col-md-6",children:[(0,l.jsx)("label",{className:"form-label fw-medium",children:"カテゴリ"}),(0,l.jsxs)("select",{value:h,onChange:e=>u(e.target.value),className:"form-select",children:[(0,l.jsx)("option",{value:"all",children:"すべてのカテゴリ"}),r.map(e=>(0,l.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,l.jsxs)("div",{className:"col-lg-4 col-md-6",children:[(0,l.jsx)("label",{className:"form-label fw-medium",children:"商品検索"}),(0,l.jsx)("input",{type:"text",value:j,onChange:e=>b(e.target.value),placeholder:"商品名で検索...",className:"form-control"})]}),(0,l.jsx)("div",{className:"col-lg-4 col-md-6 d-flex align-items-end",children:(0,l.jsxs)("div",{className:"text-muted small",children:[y.length," 件の商品"]})})]})})})})}),(0,l.jsx)("div",{className:"row",children:(0,l.jsx)("div",{className:"col-12",children:(0,l.jsxs)("div",{className:"card",children:[(0,l.jsx)("div",{className:"d-none d-lg-block",children:(0,l.jsx)("div",{className:"table-responsive",children:(0,l.jsxs)("table",{className:"table table-hover",children:[(0,l.jsx)("thead",{className:"table-light",children:(0,l.jsxs)("tr",{children:[(0,l.jsx)("th",{className:"fw-medium text-muted text-uppercase small",children:"商品情報"}),(0,l.jsx)("th",{className:"fw-medium text-muted text-uppercase small",children:"カテゴリ"}),(0,l.jsx)("th",{className:"fw-medium text-muted text-uppercase small",children:"価格・単位"}),(0,l.jsx)("th",{className:"fw-medium text-muted text-uppercase small",children:"ステータス"}),(0,l.jsx)("th",{className:"fw-medium text-muted text-uppercase small",children:"アクション"})]})}),(0,l.jsx)("tbody",{children:y.map(e=>{var s;return(0,l.jsxs)("tr",{children:[(0,l.jsx)("td",{className:"px-3 py-3",children:(0,l.jsxs)("div",{className:"d-flex align-items-center",children:[e.image_url?(0,l.jsx)(t.default,{src:e.image_url,alt:e.name,width:64,height:64,className:"rounded me-3",style:{width:"64px",height:"64px",objectFit:"cover"},unoptimized:!0}):(0,l.jsx)("div",{className:"bg-light rounded d-flex align-items-center justify-content-center me-3",style:{width:"64px",height:"64px"},children:(0,l.jsx)("i",{className:"bi bi-box text-muted",style:{fontSize:"1.5rem"}})}),(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"fw-medium text-dark",children:e.name}),e.description&&(0,l.jsx)("div",{className:"small text-muted text-truncate",style:{maxWidth:"200px"},children:e.description}),e.barcode&&(0,l.jsxs)("div",{className:"small text-muted",children:["JAN: ",e.barcode]})]})]})}),(0,l.jsx)("td",{className:"px-3 py-3",children:(0,l.jsx)("span",{className:"badge bg-primary-subtle text-primary",children:(null===(s=e.category)||void 0===s?void 0:s.name)||"未分類"})}),(0,l.jsxs)("td",{className:"px-3 py-3",children:[(0,l.jsxs)("div",{className:"fw-medium text-dark",children:["\xa5",e.price.toLocaleString()]}),(0,l.jsx)("div",{className:"small text-muted",children:e.unit}),e.variation_name&&(0,l.jsx)("div",{className:"small text-muted",children:e.variation_name})]}),(0,l.jsx)("td",{className:"px-3 py-3",children:(0,l.jsx)("button",{onClick:()=>f(e.id,e.is_available),className:"btn btn-sm ".concat(e.is_available?"btn-outline-success":"btn-outline-danger"),children:e.is_available?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("i",{className:"bi bi-check-circle me-1"}),"販売中"]}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("i",{className:"bi bi-x-circle me-1"}),"停止中"]})})}),(0,l.jsx)("td",{className:"px-3 py-3",children:(0,l.jsxs)("div",{className:"d-flex gap-1",children:[(0,l.jsxs)("button",{onClick:()=>window.location.href="/admin/products/edit/".concat(e.id),className:"btn btn-outline-primary btn-sm",children:[(0,l.jsx)("i",{className:"bi bi-pencil me-1"}),"編集"]}),(0,l.jsx)("button",{onClick:()=>w(e.id),className:"btn btn-outline-danger btn-sm",children:(0,l.jsx)("i",{className:"bi bi-trash"})})]})})]},e.id)})})]})})}),(0,l.jsx)("div",{className:"d-lg-none",children:(0,l.jsx)("div",{className:"card-body p-0",children:y.map(e=>{var s;return(0,l.jsxs)("div",{className:"border-bottom p-3",children:[(0,l.jsxs)("div",{className:"d-flex align-items-center mb-3",children:[e.image_url?(0,l.jsx)(t.default,{src:e.image_url,alt:e.name,width:56,height:56,className:"rounded me-3",style:{width:"56px",height:"56px",objectFit:"cover"},unoptimized:!0}):(0,l.jsx)("div",{className:"bg-light rounded d-flex align-items-center justify-content-center me-3",style:{width:"56px",height:"56px"},children:(0,l.jsx)("i",{className:"bi bi-box text-muted",style:{fontSize:"1.25rem"}})}),(0,l.jsxs)("div",{className:"flex-grow-1",children:[(0,l.jsx)("div",{className:"fw-medium text-dark",children:e.name}),e.description&&(0,l.jsx)("div",{className:"small text-muted text-truncate",children:e.description}),(0,l.jsxs)("div",{className:"d-flex align-items-center gap-2 mt-1",children:[(0,l.jsx)("span",{className:"badge bg-primary-subtle text-primary",children:(null===(s=e.category)||void 0===s?void 0:s.name)||"未分類"}),(0,l.jsx)("button",{onClick:()=>f(e.id,e.is_available),className:"btn btn-sm ".concat(e.is_available?"btn-outline-success":"btn-outline-danger"),children:e.is_available?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("i",{className:"bi bi-check-circle me-1"}),"販売中"]}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("i",{className:"bi bi-x-circle me-1"}),"停止中"]})})]})]})]}),(0,l.jsxs)("div",{className:"row g-3 mb-3 small",children:[(0,l.jsxs)("div",{className:"col-6",children:[(0,l.jsx)("span",{className:"text-muted",children:"価格:"}),(0,l.jsxs)("div",{className:"fw-medium",children:["\xa5",e.price.toLocaleString()]})]}),(0,l.jsxs)("div",{className:"col-6",children:[(0,l.jsx)("span",{className:"text-muted",children:"単位:"}),(0,l.jsx)("div",{children:e.unit})]}),e.barcode&&(0,l.jsxs)("div",{className:"col-12",children:[(0,l.jsx)("span",{className:"text-muted",children:"JAN:"}),(0,l.jsx)("div",{className:"small",children:e.barcode})]}),e.variation_name&&(0,l.jsxs)("div",{className:"col-12",children:[(0,l.jsx)("span",{className:"text-muted",children:"バリエーション:"}),(0,l.jsx)("div",{className:"small",children:e.variation_name})]})]}),(0,l.jsxs)("div",{className:"d-flex justify-content-end gap-1",children:[(0,l.jsx)("button",{onClick:()=>window.location.href="/admin/products/edit/".concat(e.id),className:"btn btn-outline-primary btn-sm",children:"編集"}),(0,l.jsx)("button",{onClick:()=>w(e.id),className:"btn btn-outline-danger btn-sm",children:(0,l.jsx)("i",{className:"bi bi-trash"})})]})]},e.id)})})})]})})}),0===y.length&&(0,l.jsx)("div",{className:"row",children:(0,l.jsx)("div",{className:"col-12",children:(0,l.jsxs)("div",{className:"text-center py-5",children:[(0,l.jsx)("i",{className:"bi bi-box text-muted",style:{fontSize:"4rem"}}),(0,l.jsx)("h3",{className:"h5 fw-medium text-dark mt-3 mb-2",children:"商品が見つかりません"}),(0,l.jsx)("p",{className:"text-muted",children:"検索条件を変更するか、新しい商品を追加してください。"})]})})})]})}}}]);