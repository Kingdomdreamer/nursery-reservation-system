"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[755],{7755:function(e,s,t){t.d(s,{Z:function(){return n}});var a=t(7437),l=t(2265);async function r(e){try{let s=await fetch("https://zipcloud.ibsnet.co.jp/api/search?zipcode=".concat(e)),t=await s.json();if(200===t.status&&t.results&&t.results.length>0){let e=t.results[0];return{prefecture:e.address1,city:e.address2,town:e.address3,fullAddress:"".concat(e.address1).concat(e.address2).concat(e.address3)}}return null}catch(e){return null}}var c=t(3123);function n(e){let{formConfig:s,liffProfile:t,isLiffReady:n}=e,[d,i]=(0,l.useState)({}),[o,u]=(0,l.useState)(new Set),[m,x]=(0,l.useState)(!1),[p,h]=(0,l.useState)(!1),[g,y]=(0,l.useState)(null);l.useEffect(()=>{if(t&&n){let e={};if(t.displayName){let a=s.fields.find(e=>"full_name"===e.id||"name"===e.id);a&&!d[a.id]&&(e[a.id]=t.displayName)}Object.keys(e).length>0&&(i(s=>({...s,...e})),u(new Set(Object.keys(e))))}},[t,n,s.fields]);let f=e=>s=>{i({...d,[e]:s.target.value})},b=e=>{let s=function(e){let s=e.replace(/[^0-9]/g,"");return s.length<=3?s:"".concat(s.slice(0,3),"-").concat(s.slice(3,7))}(e.target.value);i({...d,postal_code:s}),s.replace(/[^0-9]/g,"").length<7&&o.size>0&&(i(e=>({...e,prefecture:"",city:"",address:""})),u(new Set))},j=async()=>{let e=(d.postal_code||"").replace(/[^0-9]/g,"");if(7===e.length){x(!0);try{let s=await r(e);s&&(i(e=>({...e,prefecture:s.prefecture||"",city:s.city||"",address:s.town||""})),u(new Set(["prefecture","city"])))}catch(e){}finally{x(!1)}}},N=()=>{i(e=>({...e,prefecture:"",city:"",address:""})),u(new Set)},v=e=>o.has(e)&&("prefecture"===e||"city"===e)?"w-full px-3 py-2 border border-green-300 bg-green-50 rounded-md text-sm":"w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",w=e=>o.has(e)&&("prefecture"===e||"city"===e),_=()=>{let e=(d.postal_code||"").replace(/[^0-9]/g,"");return 0===e.length?"郵便番号を入力してください":e.length<7?"あと".concat(7-e.length,"桁入力してください"):7===e.length?"タップして住所を検索":""},k=s.fields.filter(e=>!1!==e.enabled),C=async()=>{if(!p){h(!0),y(null);try{let e=k.filter(e=>e.required).filter(e=>{var s;return!(null===(s=d[e.id])||void 0===s?void 0:s.trim())});if(e.length>0){y("必須項目が未入力です: ".concat(e.map(e=>e.label).join(", ")));return}let s={name:d.customer_name||d.name||d.full_name||"",furigana:d.customer_furigana||d.furigana||"",email:d.customer_email||d.email||"",phone:d.customer_phone||d.phone||"",postal_code:d.postal_code||"",prefecture:d.prefecture||"",city:d.city||"",address:d.address||"",birth_date:d.customer_birth_date||d.birth_date||"",gender:d.customer_gender||d.gender||""};if((null==t?void 0:t.userId)&&n)try{await c.r.autoLinkExistingCustomer(t.userId,{userId:t.userId,displayName:t.displayName||"",pictureUrl:t.pictureUrl,statusMessage:t.statusMessage},s)}catch(e){}alert("予約が完了しました！")}catch(e){y("予約処理中にエラーが発生しました。もう一度お試しください。")}finally{h(!1)}}};return(0,a.jsxs)("div",{className:"max-w-lg mx-auto bg-white border rounded-lg p-6 space-y-6",children:[(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("h2",{className:"text-xl font-bold text-gray-900 mb-2",children:s.name}),(0,a.jsx)("p",{className:"text-gray-600 text-sm",children:s.description})]}),(0,a.jsxs)("form",{className:"space-y-6",children:[k.map(e=>{var s,t,l;let r=d[e.id]||"";return"postal_code"===e.id?(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700",children:[e.label,e.required&&(0,a.jsx)("span",{className:"text-red-500 ml-1",children:"*"}),m&&(0,a.jsx)("span",{className:"text-sm text-blue-600 ml-2",children:"住所を検索中..."})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("input",{type:"text",value:r,onChange:b,className:"flex-1 px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:e.placeholder||"例: 123-4567",maxLength:8}),(0,a.jsx)("button",{type:"button",onClick:j,disabled:m||7!==r.replace(/[^0-9]/g,"").length,title:_(),className:"px-4 py-2 text-sm font-medium rounded-md transition-colors ".concat(m||7!==r.replace(/[^0-9]/g,"").length?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700"),children:m?"検索中...":"住所検索"}),o.size>0&&(0,a.jsx)("button",{type:"button",onClick:N,className:"px-3 py-2 text-sm bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300",children:"クリア"})]}),(0,a.jsxs)("div",{className:"text-sm text-gray-600 space-y-1",children:[(0,a.jsx)("p",{children:"\uD83D\uDCCD 郵便番号を7桁入力後、「住所検索」ボタンをタップで住所が自動入力されます"}),(0,a.jsx)("p",{children:"\uD83D\uDD12 都道府県・市区町村は自動入力、町名以降は編集できます"})]})]},e.id):"prefecture"===e.id||"city"===e.id?(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700",children:[e.label,e.required&&(0,a.jsx)("span",{className:"text-red-500 ml-1",children:"*"}),o.has(e.id)&&(0,a.jsx)("span",{className:"text-xs text-gray-500 ml-2",children:"(自動入力)"})]}),(0,a.jsx)("input",{type:"text",value:r,onChange:f(e.id),className:v(e.id),placeholder:e.placeholder,readOnly:w(e.id)})]},e.id):(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700",children:[e.label,e.required&&(0,a.jsx)("span",{className:"text-red-500 ml-1",children:"*"})]}),"textarea"===e.type?(0,a.jsx)("textarea",{value:r,onChange:f(e.id),placeholder:e.placeholder,className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",rows:3}):"select"===e.type?(0,a.jsxs)("select",{value:r,onChange:f(e.id),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,a.jsx)("option",{value:"",children:"選択してください"}),null===(s=e.options)||void 0===s?void 0:s.map((e,s)=>(0,a.jsx)("option",{value:e,children:e},s))]}):"radio"===e.type?(0,a.jsx)("div",{className:"space-y-2",children:null===(t=e.options)||void 0===t?void 0:t.map((s,t)=>(0,a.jsxs)("label",{className:"flex items-center",children:[(0,a.jsx)("input",{type:"radio",name:e.id,value:s,checked:r===s,onChange:f(e.id),className:"mr-2"}),s]},t))}):"checkbox"===e.type?(0,a.jsx)("div",{className:"space-y-2",children:null===(l=e.options)||void 0===l?void 0:l.map((e,s)=>(0,a.jsxs)("label",{className:"flex items-center",children:[(0,a.jsx)("input",{type:"checkbox",value:e,className:"mr-2"}),e]},s))}):(0,a.jsx)("input",{type:e.type,value:r,onChange:f(e.id),placeholder:e.placeholder,className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"})]},e.id)}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"商品選択"}),(0,a.jsx)("div",{className:"bg-gray-50 p-4 rounded-lg",children:(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"選択された商品がここに表示されます"})})]}),(0,a.jsx)("div",{className:"text-right",children:(0,a.jsxs)("div",{className:"text-lg font-semibold",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"小計: "}),(0,a.jsx)("span",{className:"text-gray-900",children:"\xa50"})]})})]}),g&&(0,a.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"flex-shrink-0",children:(0,a.jsx)("span",{className:"text-red-400",children:"⚠️"})}),(0,a.jsx)("div",{className:"ml-3",children:(0,a.jsx)("p",{className:"text-sm text-red-700",children:g})})]})}),(0,a.jsx)("button",{type:"button",onClick:C,disabled:p,className:"w-full py-3 px-4 rounded-lg font-medium transition-colors ".concat(p?"bg-gray-400 text-gray-600 cursor-not-allowed":"bg-green-600 text-white hover:bg-green-700"),children:p?"送信中...":"予約内容を確認する"})]}),(0,a.jsx)("div",{className:"text-center text-xs text-gray-500",children:"※ これはプレビューです。実際の予約はできません。"})]})}}}]);