"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[172],{2172:function(e,t,i){i.d(t,{Z:function(){return c}});var a=i(7437),s=i(2265),n=i(2141);class l{static getStatusBadgeClasses(e){let t={active:{bg:"bg-green-100",text:"text-green-800",label:"アクティブ"},inactive:{bg:"bg-gray-100",text:"text-gray-800",label:"無効"},pending:{bg:"bg-blue-100",text:"text-blue-800",label:"保留中"},confirmed:{bg:"bg-green-100",text:"text-green-800",label:"確定"},cancelled:{bg:"bg-red-100",text:"text-red-800",label:"キャンセル"},completed:{bg:"bg-purple-100",text:"text-purple-800",label:"完了"},expired:{bg:"bg-red-100",text:"text-red-800",label:"期限切れ"},preparing:{bg:"bg-yellow-100",text:"text-yellow-800",label:"準備中"}};return t[e]||t.inactive}static formatDate(e,t){if(!e)return"";let i={year:"numeric",month:"2-digit",day:"2-digit",...t};return new Date(e).toLocaleDateString("ja-JP",i)}static formatDateTime(e){return e?new Date(e).toLocaleDateString("ja-JP",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):""}static formatPrice(e){return"\xa5".concat(e.toLocaleString())}static isDateInRange(e,t,i){return(!t||!(e<t))&&(!i||!(e>i))}static calculateDaysUntil(e){let t=new Date;return Math.ceil((new Date(e).getTime()-t.getTime())/864e5)}static getValidityPeriodText(e,t){return e||t?e&&t?"".concat(this.formatDate(e)," - ").concat(this.formatDate(t)):e?"".concat(this.formatDate(e),"から"):t?"".concat(this.formatDate(t),"まで"):"期限なし":"期限なし"}}class r{static async getAllForms(){let{data:e,error:t}=await n.OQ.from("form_configurations").select("\n        id,\n        name,\n        description,\n        form_fields,\n        settings,\n        is_active,\n        valid_from,\n        valid_to,\n        version,\n        created_at,\n        updated_at\n      ").order("updated_at",{ascending:!1});if(t)throw t;let{data:i,error:a}=await n.OQ.from("reservations").select("form_id").not("form_id","is",null);a&&console.warn("Failed to fetch response counts:",a);let s=new Map;return null==i||i.forEach(e=>{let t=s.get(e.form_id)||0;s.set(e.form_id,t+1)}),(null==e?void 0:e.map(e=>{var t,i;return{...e,settings:e.settings||{},version:e.version||1,field_count:(null===(i=e.form_fields)||void 0===i?void 0:null===(t=i.fields)||void 0===t?void 0:t.length)||0,response_count:s.get(e.id)||0}}))||[]}static async createForm(e){let{data:t,error:i}=await n.OQ.from("form_configurations").insert([{name:e.name,description:e.description,form_fields:{fields:e.fields},is_active:e.isActive,valid_from:e.validFrom||null,valid_to:e.validTo||null,selected_products:e.selectedProducts||[]}]).select();if(i)throw i;return t[0]}static async updateForm(e,t){let i={};t.name&&(i.name=t.name),t.description&&(i.description=t.description),t.fields&&(i.form_fields={fields:t.fields}),void 0!==t.isActive&&(i.is_active=t.isActive),void 0!==t.validFrom&&(i.valid_from=t.validFrom||null),void 0!==t.validTo&&(i.valid_to=t.validTo||null),t.selectedProducts&&(i.selected_products=t.selectedProducts);let{data:a,error:s}=await n.OQ.from("form_configurations").update(i).eq("id",e).select();if(s)throw s;return a[0]}static async deleteForm(e){let{error:t}=await n.OQ.from("form_configurations").delete().eq("id",e);if(t)throw t;return!0}static async getFormById(e){let{data:t,error:i}=await n.OQ.from("form_configurations").select("*").eq("id",e).single();if(i)throw i;return t}static async toggleFormStatus(e,t){let{error:i}=await n.OQ.from("form_configurations").update({is_active:t}).eq("id",e);if(i)throw i;return!0}static isFormAccessible(e){if(!e.is_active)return!1;let t=new Date,i=e.valid_from?new Date(e.valid_from):null,a=e.valid_to?new Date(e.valid_to):null;return(!i||!(t<i))&&(!a||!(t>a))}static getFormStatus(e){if(!e.is_active)return"inactive";let t=new Date,i=e.valid_from?new Date(e.valid_from):null,a=e.valid_to?new Date(e.valid_to):null;return i&&t<i?"pending":a&&t>a?"expired":"active"}static getValidityPeriodText(e,t){return l.getValidityPeriodText(e,t)}static async checkFormConfiguration(){try{let e=await this.getAllForms(),t=0,i=0,a=0,s=[],n=[],l=new Date;return e.forEach(e=>{let r=this.getFormStatus(e);switch(r){case"active":t++;break;case"inactive":i++;break;case"expired":a++,s.push("フォーム「".concat(e.name,"」が有効期限切れです"));break;case"pending":s.push("フォーム「".concat(e.name,"」がまだ開始されていません"))}if(0===e.field_count&&s.push("フォーム「".concat(e.name,"」にフィールドが設定されていません")),0===e.response_count&&"active"===r&&n.push("フォーム「".concat(e.name,"」はアクティブですが回答がありません")),e.valid_to){let t=new Date(e.valid_to),i=Math.ceil((t.getTime()-l.getTime())/864e5);i<=7&&i>0&&"active"===r&&n.push("フォーム「".concat(e.name,"」が").concat(i,"日後に有効期限切れになります"))}}),0===t&&s.push("アクティブなフォームがありません"),0===e.length&&(s.push("フォームが作成されていません"),n.push("最初のフォームを作成することをお勧めします")),{totalForms:e.length,activeForms:t,inactiveForms:i,expiredForms:a,issuesFound:s,recommendations:n}}catch(e){return console.error("フォーム設定チェック中にエラーが発生:",e),{totalForms:0,activeForms:0,inactiveForms:0,expiredForms:0,issuesFound:["フォーム設定の確認中にエラーが発生しました"],recommendations:[]}}}}function c(){let[e,t]=(0,s.useState)([]),[i,n]=(0,s.useState)(!0),[l,c]=(0,s.useState)("all");(0,s.useEffect)(()=>{d()},[]);let d=async()=>{try{let e=await r.getAllForms();t(e)}catch(e){console.error("フォーム一覧の取得に失敗しました:",e),t([])}finally{n(!1)}},o=async(i,a)=>{try{await r.toggleFormStatus(i,!a),t(e.map(e=>e.id===i?{...e,is_active:!a}:e))}catch(e){console.error("フォームステータスの更新に失敗しました:",e),alert("フォームステータスの更新に失敗しました。")}},m=async i=>{if(confirm("このフォームを削除しますか？この操作は元に戻せません。"))try{await r.deleteForm(i),t(e.filter(e=>e.id!==i)),alert("フォームが削除されました。")}catch(e){console.error("フォームの削除に失敗しました:",e),alert("フォームの削除に失敗しました。")}},u=e.filter(e=>"all"===l||("active"===l?e.is_active:"inactive"!==l||!e.is_active)),g=e=>{let t={inactive:{bg:"bg-gray-100",text:"text-gray-800",label:"無効"},pending:{bg:"bg-blue-100",text:"text-blue-800",label:"開始前"},expired:{bg:"bg-red-100",text:"text-red-800",label:"期限切れ"},active:{bg:"bg-green-100",text:"text-green-800",label:"公開中"}}[r.getFormStatus(e)];return(0,a.jsx)("span",{className:"px-2 py-1 text-xs font-medium rounded-full ".concat(t.bg," ").concat(t.text),children:t.label})},x=e=>r.getValidityPeriodText(e.valid_from,e.valid_to);return i?(0,a.jsx)("div",{className:"flex justify-center items-center h-64",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-gray-800",children:"フォーム一覧"}),(0,a.jsx)("p",{className:"text-gray-600",children:"作成済みのフォームを管理できます"})]}),(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsxs)("select",{value:l,onChange:e=>c(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,a.jsx)("option",{value:"all",children:"すべて"}),(0,a.jsx)("option",{value:"active",children:"有効"}),(0,a.jsx)("option",{value:"inactive",children:"無効"})]}),(0,a.jsxs)("button",{onClick:()=>window.location.href="/admin?page=form-builder",className:"btn-modern btn-primary-modern flex items-center gap-2",children:[(0,a.jsx)("span",{className:"text-lg",children:"\uD83D\uDEE0️"}),"新しいフォーム"]})]})]}),(0,a.jsxs)("div",{className:"admin-stats-grid",children:[(0,a.jsxs)("div",{className:"admin-widget green",children:[(0,a.jsxs)("div",{className:"admin-widget-header",children:[(0,a.jsx)("div",{className:"admin-widget-title",children:"有効なフォーム"}),(0,a.jsx)("div",{className:"admin-widget-icon",children:"✅"})]}),(0,a.jsx)("div",{className:"admin-widget-value",children:e.filter(e=>e.is_active).length})]}),(0,a.jsxs)("div",{className:"admin-widget blue",children:[(0,a.jsxs)("div",{className:"admin-widget-header",children:[(0,a.jsx)("div",{className:"admin-widget-title",children:"総フォーム数"}),(0,a.jsx)("div",{className:"admin-widget-icon",children:"\uD83D\uDCDD"})]}),(0,a.jsx)("div",{className:"admin-widget-value",children:e.length})]}),(0,a.jsxs)("div",{className:"admin-widget purple",children:[(0,a.jsxs)("div",{className:"admin-widget-header",children:[(0,a.jsx)("div",{className:"admin-widget-title",children:"総回答数"}),(0,a.jsx)("div",{className:"admin-widget-icon",children:"\uD83D\uDCCA"})]}),(0,a.jsx)("div",{className:"admin-widget-value",children:e.reduce((e,t)=>e+t.response_count,0)})]}),(0,a.jsxs)("div",{className:"admin-widget orange",children:[(0,a.jsxs)("div",{className:"admin-widget-header",children:[(0,a.jsx)("div",{className:"admin-widget-title",children:"平均フィールド数"}),(0,a.jsx)("div",{className:"admin-widget-icon",children:"\uD83D\uDCCB"})]}),(0,a.jsx)("div",{className:"admin-widget-value",children:e.length>0?Math.round(e.reduce((e,t)=>e+t.field_count,0)/e.length):0})]})]}),(0,a.jsx)("div",{className:"space-y-4",children:u.map(e=>(0,a.jsx)("div",{className:"admin-card",children:(0,a.jsx)("div",{className:"admin-card-content",children:(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:e.name}),g(e)]}),(0,a.jsx)("p",{className:"text-gray-600 mb-4",children:e.description}),(0,a.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-500",children:"フィールド数:"}),(0,a.jsxs)("span",{className:"font-medium ml-1",children:[e.field_count,"個"]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-500",children:"回答数:"}),(0,a.jsxs)("span",{className:"font-medium ml-1 text-blue-600",children:[e.response_count,"件"]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-500",children:"有効期間:"}),(0,a.jsx)("span",{className:"font-medium ml-1",children:x(e)})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-500",children:"更新日:"}),(0,a.jsx)("span",{className:"font-medium ml-1",children:new Date(e.updated_at).toLocaleDateString("ja-JP")})]})]})]}),(0,a.jsxs)("div",{className:"flex gap-2 ml-4",children:[(0,a.jsx)("button",{onClick:()=>window.location.href="/admin?page=form-builder&id=".concat(e.id),className:"btn-modern btn-outline-modern btn-sm",title:"フォームを編集",children:"✏️ 編集"}),(0,a.jsx)("button",{onClick:()=>window.open("/form/".concat(e.id),"_blank"),className:"btn-modern btn-secondary-modern btn-sm",title:"フォームをプレビュー",children:"\uD83D\uDC41️ プレビュー"}),(0,a.jsx)("button",{onClick:()=>o(e.id,e.is_active),className:"btn-modern btn-sm ".concat(e.is_active?"btn-warning-modern":"btn-success-modern"),title:e.is_active?"フォームを無効にする":"フォームを有効にする",children:e.is_active?"⏸️":"▶️"}),(0,a.jsx)("button",{onClick:()=>m(e.id),className:"btn-modern btn-danger-modern btn-sm",title:"フォームを削除",children:"\uD83D\uDDD1️"})]})]})})},e.id))}),0===u.length&&(0,a.jsx)("div",{className:"admin-card",children:(0,a.jsxs)("div",{className:"text-center py-12",children:[(0,a.jsx)("div",{className:"text-6xl mb-4",children:"\uD83D\uDCDD"}),(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"フォームが見つかりません"}),(0,a.jsxs)("p",{className:"text-gray-600 mb-6",children:["all"!==l?"".concat("active"===l?"有効な":"無効な","フォームはありません。"):"まだフォームが作成されていません。",(0,a.jsx)("br",{}),"新しいフォームを作成してください。"]}),(0,a.jsx)("button",{onClick:()=>window.location.href="/admin?page=form-builder",className:"btn-modern btn-primary-modern",children:"\uD83D\uDEE0️ 新しいフォームを作成"})]})})]})}}}]);