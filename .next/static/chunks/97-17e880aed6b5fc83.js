"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[97],{5097:function(e,s,t){var a=t(7437),l=t(2265),r=t(2141),n=t(6882),i=t(1463);s.Z=()=>{let[e,s]=(0,l.useState)([]),[t,c]=(0,l.useState)(!0),[d,o]=(0,l.useState)(""),[x,m]=(0,l.useState)(!1),[u,g]=(0,l.useState)(null),[h,p]=(0,l.useState)(null),[f,b]=(0,l.useState)({name:"",furigana:"",email:"",phone:"",postal_code:"",prefecture:"",city:"",address:"",birth_date:"",gender:""}),[j,y]=(0,l.useState)({}),[N,v]=(0,l.useState)(!1);(0,l.useEffect)(()=>{w()},[]);let w=async()=>{c(!0);try{let{data:e,error:t}=await r.OQ.from("customers").select("*").order("created_at",{ascending:!1});if(t)throw t;s(e||[])}catch(e){console.error("顧客情報の取得に失敗しました:",e)}finally{c(!1)}},J=e.filter(e=>{var s,t;return e.name.toLowerCase().includes(d.toLowerCase())||(null===(s=e.phone)||void 0===s?void 0:s.includes(d))||(null===(t=e.email)||void 0===t?void 0:t.toLowerCase().includes(d.toLowerCase()))}),k=()=>{let e={};return f.name.trim()||(e.name="氏名は必須です"),f.phone.trim()?/^[\d\-\+\(\)\s]+$/.test(f.phone)||(e.phone="有効な電話番号を入力してください"):e.phone="電話番号は必須です",f.email&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(f.email)&&(e.email="有効なメールアドレスを入力してください"),f.postal_code&&!/^\d{3}-?\d{4}$/.test(f.postal_code)&&(e.postal_code="有効な郵便番号を入力してください（例: 123-4567）"),y(e),0===Object.keys(e).length},_=async e=>{if(e.preventDefault(),k()){v(!0);try{let e={name:f.name.trim(),furigana:f.furigana.trim()||null,email:f.email.trim()||null,phone:f.phone.trim(),postal_code:f.postal_code.trim()||null,prefecture:f.prefecture.trim()||null,city:f.city.trim()||null,address:f.address.trim()||null,birth_date:f.birth_date||null,gender:f.gender||null,updated_at:new Date().toISOString()};if(u){let{error:s}=await r.OQ.from("customers").update(e).eq("id",u.id);if(s)throw s}else{let{error:s}=await r.OQ.from("customers").insert([e]);if(s)throw s}z(),w()}catch(e){console.error("顧客情報の保存に失敗しました:",e),alert("保存に失敗しました。もう一度お試しください。")}finally{v(!1)}}},C=e=>{g(e),b({name:e.name,furigana:e.furigana||"",email:e.email||"",phone:e.phone||"",postal_code:e.postal_code||"",prefecture:e.prefecture||"",city:e.city||"",address:e.address||"",birth_date:e.birth_date||"",gender:e.gender||""}),m(!0)},O=async()=>{if(h)try{let{error:e}=await r.OQ.from("customers").delete().eq("id",h.id);if(e)throw e;p(null),w()}catch(e){console.error("顧客情報の削除に失敗しました:",e),alert("削除に失敗しました。もう一度お試しください。")}},z=()=>{b({name:"",furigana:"",email:"",phone:"",postal_code:"",prefecture:"",city:"",address:"",birth_date:"",gender:""}),y({}),g(null),m(!1)},P=e=>s=>{b({...f,[e]:s.target.value}),j[e]&&y({...j,[e]:""})};return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-gray-800",children:"顧客管理"}),(0,a.jsx)("p",{className:"text-gray-600",children:"顧客情報の一覧・追加・編集・削除"})]}),(0,a.jsxs)("button",{onClick:()=>m(!0),className:"btn-modern btn-primary-modern flex items-center space-x-2",children:[(0,a.jsx)(n.JO,{icon:n.PJ.add,size:"sm"}),(0,a.jsx)("span",{children:"新規顧客追加"})]})]}),(0,a.jsx)("div",{className:"admin-card",children:(0,a.jsx)("div",{className:"admin-card-content",children:(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,a.jsx)(n.JO,{icon:n.PJ.search,size:"sm",className:"text-gray-400"})}),(0,a.jsx)("input",{type:"text",placeholder:"名前、電話番号、メールアドレスで検索...",value:d,onChange:e=>o(e.target.value),className:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})})}),(0,a.jsxs)("div",{className:"admin-card",children:[(0,a.jsx)("div",{className:"admin-card-header",children:(0,a.jsxs)("h3",{className:"admin-card-title",children:["顧客一覧 (",J.length,"件)"]})}),(0,a.jsx)("div",{className:"admin-card-content",children:t?(0,a.jsxs)("div",{className:"flex items-center justify-center py-12",children:[(0,a.jsx)(n.JO,{icon:n.PJ.loading,size:"lg",className:"animate-spin text-blue-500"}),(0,a.jsx)("span",{className:"ml-2 text-gray-600",children:"読み込み中..."})]}):J.length>0?(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"顧客情報"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"連絡先"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"住所"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"登録日"}),(0,a.jsx)("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"操作"})]})}),(0,a.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:J.map(e=>(0,a.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"flex-shrink-0 h-10 w-10 lg:h-12 lg:w-12",children:(0,a.jsx)("div",{className:"h-10 w-10 lg:h-12 lg:w-12 rounded-full bg-gray-200 flex items-center justify-center",children:(0,a.jsx)(n.JO,{icon:n.PJ.user,size:"sm",className:"text-gray-500 lg:text-base"})})}),(0,a.jsxs)("div",{className:"ml-4",children:[(0,a.jsx)("div",{className:"text-sm lg:text-base font-medium text-gray-900",children:e.name}),e.furigana&&(0,a.jsx)("div",{className:"text-sm lg:text-base text-gray-500",children:e.furigana})]})]})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsxs)("div",{className:"text-sm text-gray-900",children:[e.phone&&(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(n.JO,{icon:n.PJ.phone,size:"xs",className:"text-gray-400 mr-1"}),e.phone]}),e.email&&(0,a.jsxs)("div",{className:"flex items-center mt-1",children:[(0,a.jsx)(n.JO,{icon:n.PJ.mail,size:"xs",className:"text-gray-400 mr-1"}),e.email]})]})}),(0,a.jsx)("td",{className:"px-6 py-4",children:(0,a.jsxs)("div",{className:"text-sm text-gray-900",children:[e.postal_code&&(0,a.jsxs)("div",{children:["〒",e.postal_code]}),(e.prefecture||e.city||e.address)&&(0,a.jsxs)("div",{className:"text-sm text-gray-600",children:[e.prefecture,e.city,e.address]})]})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:new Date(e.created_at).toLocaleDateString("ja-JP")}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:(0,a.jsxs)("div",{className:"flex items-center justify-end space-x-2",children:[(0,a.jsx)("button",{onClick:()=>C(e),className:"text-blue-600 hover:text-blue-900",title:"編集",children:(0,a.jsx)(n.JO,{icon:n.PJ.edit,size:"sm"})}),(0,a.jsx)("button",{onClick:()=>p(e),className:"text-red-600 hover:text-red-900",title:"削除",children:(0,a.jsx)(n.JO,{icon:n.PJ.delete,size:"sm"})})]})})]},e.id))})]})}):(0,a.jsxs)("div",{className:"text-center py-12",children:[(0,a.jsx)(n.JO,{icon:n.PJ.users,size:"xl",className:"text-gray-400 mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-gray-600",children:d?"検索条件に合う顧客が見つかりません":"登録されている顧客がいません"}),!d&&(0,a.jsx)("button",{onClick:()=>m(!0),className:"mt-4 btn-modern btn-primary-modern",children:"初めての顧客を追加"})]})})]}),x&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-hidden",children:[(0,a.jsx)("div",{className:"p-6 border-b border-gray-200",children:(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:u?"顧客情報編集":"新規顧客追加"}),(0,a.jsx)("button",{onClick:z,className:"text-gray-400 hover:text-gray-600",children:(0,a.jsx)(n.JO,{icon:n.PJ.closeIcon,size:"md"})})]})}),(0,a.jsxs)("form",{onSubmit:_,className:"p-6 overflow-y-auto",style:{maxHeight:"calc(90vh - 160px)"},children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["氏名 ",(0,a.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,a.jsx)("input",{type:"text",value:f.name,onChange:P("name"),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 ".concat(j.name?"border-red-300":"border-gray-300"),placeholder:"山田 太郎"}),j.name&&(0,a.jsx)("p",{className:"mt-1 text-sm text-red-600",children:j.name})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"フリガナ"}),(0,a.jsx)("input",{type:"text",value:f.furigana,onChange:P("furigana"),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"ヤマダ タロウ"})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["電話番号 ",(0,a.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,a.jsx)("input",{type:"tel",value:f.phone,onChange:P("phone"),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 ".concat(j.phone?"border-red-300":"border-gray-300"),placeholder:"090-1234-5678"}),j.phone&&(0,a.jsx)("p",{className:"mt-1 text-sm text-red-600",children:j.phone})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"メールアドレス"}),(0,a.jsx)("input",{type:"email",value:f.email,onChange:P("email"),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 ".concat(j.email?"border-red-300":"border-gray-300"),placeholder:"example@email.com"}),j.email&&(0,a.jsx)("p",{className:"mt-1 text-sm text-red-600",children:j.email})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"郵便番号"}),(0,a.jsx)("input",{type:"text",value:f.postal_code,onChange:P("postal_code"),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 ".concat(j.postal_code?"border-red-300":"border-gray-300"),placeholder:"123-4567"}),j.postal_code&&(0,a.jsx)("p",{className:"mt-1 text-sm text-red-600",children:j.postal_code})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"都道府県"}),(0,a.jsx)("input",{type:"text",value:f.prefecture,onChange:P("prefecture"),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"東京都"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"市区町村"}),(0,a.jsx)("input",{type:"text",value:f.city,onChange:P("city"),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"新宿区"})]}),(0,a.jsxs)("div",{className:"md:col-span-2",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"住所"}),(0,a.jsx)("input",{type:"text",value:f.address,onChange:P("address"),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"西新宿1-1-1"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"生年月日"}),(0,a.jsx)("input",{type:"date",value:f.birth_date,onChange:P("birth_date"),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"性別"}),(0,a.jsxs)("select",{value:f.gender,onChange:P("gender"),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,a.jsx)("option",{value:"",children:"選択してください"}),(0,a.jsx)("option",{value:"男性",children:"男性"}),(0,a.jsx)("option",{value:"女性",children:"女性"}),(0,a.jsx)("option",{value:"その他",children:"その他"}),(0,a.jsx)("option",{value:"回答しない",children:"回答しない"})]})]})]}),(0,a.jsxs)("div",{className:"flex justify-end space-x-3 mt-6 pt-6 border-t",children:[(0,a.jsx)("button",{type:"button",onClick:z,className:"px-4 py-2 text-gray-700 bg-gray-200 rounded-lg hover:bg-gray-300 transition-colors",children:"キャンセル"}),(0,a.jsx)("button",{type:"submit",disabled:N,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2",children:N?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.JO,{icon:n.PJ.loading,size:"sm",className:"animate-spin"}),(0,a.jsx)("span",{children:"保存中..."})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.JO,{icon:n.PJ.save,size:"sm"}),(0,a.jsx)("span",{children:u?"更新":"追加"})]})})]})]})]})}),(0,a.jsx)(i.$,{isOpen:!!h,title:"顧客情報の削除",itemName:(null==h?void 0:h.name)||"",onConfirm:O,onCancel:()=>p(null)})]})}},1463:function(e,s,t){t.d(s,{$:function(){return n}});var a=t(7437);t(2265);var l=t(6882);let r=e=>{let{isOpen:s,title:t,message:r,confirmText:n="実行",cancelText:i="キャンセル",confirmButtonVariant:c="danger",onConfirm:d,onCancel:o,isLoading:x=!1,icon:m="warning"}=e;return s?(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onKeyDown:e=>{"Escape"===e.key?o():"Enter"!==e.key||x||d()},onClick:e=>{e.target===e.currentTarget&&o()},children:(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full mx-4 transform transition-all",role:"dialog","aria-modal":"true","aria-labelledby":"dialog-title","aria-describedby":"dialog-message",children:[(0,a.jsx)("div",{className:"p-6 pb-0",children:(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsxs)("div",{className:"flex-shrink-0 ".concat((()=>{switch(c){case"danger":default:return"text-red-500";case"warning":return"text-yellow-500";case"primary":return"text-blue-500";case"success":return"text-green-500"}})()),children:["delete"===m&&(0,a.jsx)(l.JO,{icon:l.PJ.delete,size:"lg"}),"warning"===m&&(0,a.jsx)(l.JO,{icon:l.PJ.warning,size:"lg"}),"success"===m&&(0,a.jsx)(l.JO,{icon:l.PJ.success,size:"lg"}),"error"===m&&(0,a.jsx)(l.JO,{icon:l.PJ.error,size:"lg"}),"info"===m&&(0,a.jsx)(l.JO,{icon:l.PJ.info,size:"lg"}),!["delete","warning","success","error","info"].includes(m)&&(0,a.jsx)(l.JO,{icon:l.PJ.alert,size:"lg"})]}),(0,a.jsx)("div",{children:(0,a.jsx)("h3",{id:"dialog-title",className:"text-lg font-semibold text-gray-900",children:t})})]})}),(0,a.jsx)("div",{className:"p-6 pt-4",children:(0,a.jsx)("p",{id:"dialog-message",className:"text-gray-600 leading-relaxed",children:r})}),(0,a.jsxs)("div",{className:"p-6 pt-0 flex justify-end space-x-3",children:[(0,a.jsx)("button",{type:"button",onClick:o,disabled:x,className:"px-4 py-2 text-gray-700 bg-gray-200 rounded-md font-medium hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:i}),(0,a.jsx)("button",{type:"button",onClick:d,disabled:x,className:(()=>{let e="px-4 py-2 rounded-md font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed";switch(c){case"danger":default:return"".concat(e," bg-red-600 text-white hover:bg-red-700 focus:ring-red-500");case"warning":return"".concat(e," bg-yellow-600 text-white hover:bg-yellow-700 focus:ring-yellow-500");case"primary":return"".concat(e," bg-blue-600 text-white hover:bg-blue-700 focus:ring-blue-500");case"success":return"".concat(e," bg-green-600 text-white hover:bg-green-700 focus:ring-green-500")}})(),children:x?(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(l.JO,{icon:l.PJ.loading,size:"sm",className:"animate-spin"}),(0,a.jsx)("span",{children:"処理中..."})]}):n})]})]})}):null},n=e=>{let{isOpen:s,title:t="削除の確認",itemName:l="この項目",onConfirm:n,onCancel:i,isLoading:c=!1}=e;return(0,a.jsx)(r,{isOpen:s,title:t,message:"".concat(l,"を削除しますか？この操作は取り消すことができません。"),confirmText:"削除",cancelText:"キャンセル",confirmButtonVariant:"danger",onConfirm:n,onCancel:i,isLoading:c,icon:"delete"})}}}]);