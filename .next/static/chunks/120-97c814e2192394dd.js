"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[120],{5120:function(e,s,a){a.d(s,{Z:function(){return r}});var t=a(7437),l=a(2265),n=a(2141);function r(){let[e,s]=(0,l.useState)([]),[a,r]=(0,l.useState)(null),[i,d]=(0,l.useState)(!1),[c,o]=(0,l.useState)(!1),[m,u]=(0,l.useState)(!0),b=[{value:"reservation_confirmation",label:"予約確定通知",icon:"✅"},{value:"reservation_reminder",label:"予約リマインダー",icon:"⏰"},{value:"payment_confirmation",label:"支払い確認通知",icon:"\uD83D\uDCB0"},{value:"cancellation",label:"キャンセル通知",icon:"❌"}];(0,l.useEffect)(()=>{x()},[]);let x=async()=>{try{let{data:e,error:a}=await n.OQ.from("line_templates").select("*").order("created_at",{ascending:!1});if(a)throw a;s(e||[]),e&&e.length>0&&r(e[0])}catch(e){console.error("テンプレートの取得に失敗しました:",e),s([])}finally{u(!1)}},h=async()=>{if(a)try{let{error:e}=await n.OQ.from("line_templates").update({name:a.name,template_type:a.template_type,subject:a.subject,message:a.message,is_active:a.is_active}).eq("id",a.id);if(e)throw e;await x(),d(!1),alert("テンプレートが保存されました！")}catch(e){console.error("テンプレートの保存に失敗しました:",e),alert("テンプレートの保存に失敗しました。")}},p=async()=>{try{let{data:e,error:s}=await n.OQ.from("line_templates").insert([{name:"新しいテンプレート",template_type:"reservation_confirmation",subject:"",message:"",is_active:!1}]).select().single();if(s)throw s;await x(),r(e),d(!0)}catch(e){console.error("テンプレートの作成に失敗しました:",e),alert("テンプレートの作成に失敗しました。")}},g=async s=>{if(confirm("このテンプレートを削除しますか？"))try{let{error:t}=await n.OQ.from("line_templates").delete().eq("id",s);if(t)throw t;await x(),(null==a?void 0:a.id)===s&&r(e[0]||null),alert("テンプレートが削除されました。")}catch(e){console.error("テンプレートの削除に失敗しました:",e),alert("テンプレートの削除に失敗しました。")}},v=async s=>{let a=e.find(e=>e.id===s);if(a)try{let{error:e}=await n.OQ.from("line_templates").update({is_active:!a.is_active}).eq("id",s);if(e)throw e;await x()}catch(e){console.error("テンプレートの有効/無効の切り替えに失敗しました:",e),alert("テンプレートの有効/無効の切り替えに失敗しました。")}};return m?(0,t.jsx)("div",{className:"flex justify-center items-center h-64",children:(0,t.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):(0,t.jsxs)("div",{className:"flex h-full bg-gray-50",children:[(0,t.jsxs)("div",{className:"w-1/3 border-r border-gray-200 bg-white",children:[(0,t.jsx)("div",{className:"p-4 border-b border-gray-200",children:(0,t.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,t.jsx)("h3",{className:"font-semibold text-gray-900",children:"LINEテンプレート"}),(0,t.jsx)("button",{onClick:p,className:"btn-modern btn-primary-modern btn-sm",children:"+ 新規作成"})]})}),(0,t.jsx)("div",{className:"p-4 space-y-3",children:e.map(e=>{var s,l;return(0,t.jsxs)("div",{className:"p-4 border rounded-lg cursor-pointer transition-all ".concat((null==a?void 0:a.id)===e.id?"border-blue-500 bg-blue-50":"border-gray-200 hover:bg-gray-50"),onClick:()=>r(e),children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:"text-lg",children:null===(s=b.find(s=>s.value===e.template_type))||void 0===s?void 0:s.icon}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"font-medium text-sm",children:e.name}),(0,t.jsx)("div",{className:"text-xs text-gray-500",children:null===(l=b.find(s=>s.value===e.template_type))||void 0===l?void 0:l.label})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("button",{onClick:s=>{s.stopPropagation(),v(e.id)},className:"btn-modern btn-sm btn-icon-only ".concat(e.is_active?"btn-success-modern":"btn-secondary-modern"),children:e.is_active?"✓":"○"}),(0,t.jsx)("button",{onClick:s=>{s.stopPropagation(),g(e.id)},className:"btn-modern btn-danger-modern btn-sm btn-icon-only",children:"\uD83D\uDDD1️"})]})]}),(0,t.jsxs)("div",{className:"text-xs text-gray-400",children:["最終更新: ",new Date(e.updated_at).toLocaleDateString()]})]},e.id)})})]}),a&&(0,t.jsx)("div",{className:"flex-1 flex",children:(0,t.jsx)("div",{className:"flex-1 p-6",children:(0,t.jsxs)("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold",children:"テンプレート編集"}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("button",{onClick:()=>o(!c),className:"btn-modern btn-sm ".concat(c?"btn-warning-modern":"btn-secondary-modern"),children:c?"\uD83D\uDCDD 編集":"\uD83D\uDC41️ プレビュー"}),i?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("button",{onClick:h,className:"btn-modern btn-success-modern btn-sm",children:"\uD83D\uDCBE 保存"}),(0,t.jsx)("button",{onClick:()=>d(!1),className:"btn-modern btn-secondary-modern btn-sm",children:"キャンセル"})]}):(0,t.jsx)("button",{onClick:()=>d(!0),className:"btn-modern btn-primary-modern btn-sm",children:"✏️ 編集"})]})]}),c?(0,t.jsx)("div",{className:"space-y-4",children:(0,t.jsxs)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[(0,t.jsx)("h4",{className:"font-medium text-green-800 mb-2",children:"\uD83D\uDCF1 LINEメッセージ プレビュー"}),(0,t.jsxs)("div",{className:"bg-white rounded-lg p-4 border",children:[(0,t.jsxs)("div",{className:"text-sm font-medium text-gray-600 mb-2",children:["件名: ",a.subject]}),(0,t.jsx)("div",{className:"whitespace-pre-line text-sm leading-relaxed",children:(()=>{if(!a)return"";let e=a.message;return Object.entries({customer_name:"山田太郎",reservation_id:"R20240101001",phone_number:"090-1234-5678",reservation_date:"2024年1月15日",pickup_time:"10:00-12:00",product_list:"有機肥料A \xd7 2袋\nトマト苗 \xd7 10株",total_amount:"15,000",payment_amount:"15,000",payment_method:"クレジットカード",payment_date:"2024年1月14日 15:30",cancellation_date:"2024年1月14日 16:00",cancellation_reason:"お客様都合",shop_name:"グリーンファーム種苗店",shop_phone:"03-1234-5678"}).forEach(s=>{let[a,t]=s;e=e.replace(RegExp("{".concat(a,"}"),"g"),t)}),e})()})]})]})}):(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"テンプレート名"}),(0,t.jsx)("input",{type:"text",value:a.name,onChange:e=>r({...a,name:e.target.value}),disabled:!i,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:bg-gray-50"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"テンプレートタイプ"}),(0,t.jsx)("select",{value:a.template_type,onChange:e=>r({...a,template_type:e.target.value}),disabled:!i,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:bg-gray-50",children:b.map(e=>(0,t.jsxs)("option",{value:e.value,children:[e.icon," ",e.label]},e.value))})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"件名"}),(0,t.jsx)("input",{type:"text",value:a.subject,onChange:e=>r({...a,subject:e.target.value}),disabled:!i,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:bg-gray-50",placeholder:"メッセージの件名を入力"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"メッセージ本文"}),(0,t.jsx)("textarea",{value:a.message,onChange:e=>r({...a,message:e.target.value}),disabled:!i,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:bg-gray-50",rows:12,placeholder:"メッセージ本文を入力してください。変数は {variable_name} の形式で使用できます。"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"利用可能な変数"}),(0,t.jsx)("div",{className:"bg-gray-50 rounded-lg p-4",children:(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("code",{className:"bg-blue-100 px-2 py-1 rounded text-blue-800",children:"{customer_name}"})," - お客様名"]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("code",{className:"bg-blue-100 px-2 py-1 rounded text-blue-800",children:"{reservation_id}"})," - 予約番号"]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("code",{className:"bg-blue-100 px-2 py-1 rounded text-blue-800",children:"{phone_number}"})," - 電話番号"]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("code",{className:"bg-blue-100 px-2 py-1 rounded text-blue-800",children:"{reservation_date}"})," - 予約日"]})]}),(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("code",{className:"bg-blue-100 px-2 py-1 rounded text-blue-800",children:"{product_list}"})," - 商品一覧"]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("code",{className:"bg-blue-100 px-2 py-1 rounded text-blue-800",children:"{total_amount}"})," - 合計金額"]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("code",{className:"bg-blue-100 px-2 py-1 rounded text-blue-800",children:"{shop_name}"})," - 店舗名"]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("code",{className:"bg-blue-100 px-2 py-1 rounded text-blue-800",children:"{shop_phone}"})," - 店舗電話"]})]})]})})]}),(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)("input",{type:"checkbox",id:"isActive",checked:a.is_active,onChange:e=>r({...a,is_active:e.target.checked}),disabled:!i,className:"mr-2"}),(0,t.jsx)("label",{htmlFor:"isActive",className:"text-sm font-medium text-gray-700",children:"このテンプレートを有効にする"})]})]})]})})})]})}}}]);