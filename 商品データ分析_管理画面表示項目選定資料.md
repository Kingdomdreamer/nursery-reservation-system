# 商品データ分析・管理画面表示項目選定資料

## 実際の商品データ分析結果

### データ構造概要
実際のデータベースには **112件の商品** が登録されており、以下の特徴があります：

#### 商品の種類
1. **農業用肥料・資材** (主力商品)
   - 種粕、化成肥料、有機肥料、石灰類など
   - 重量単位: 20kg, 15kg, 10kg等

2. **培養土・堆肥類**
   - 容量単位: 30L, 40L, 45L等

3. **価格バリエーション商品**
   - 同一商品で「通常価格」「売出価格」「予約売出価格」の3パターン

#### データ品質の問題
- `visible` フィールド: 一部商品が `false` (非表示)
- `receipt_print` フィールド: 一部商品が `false` (レシート印字なし)
- `product_code`: 一部商品でnull
- `barcode`: 一部商品でnull

## 管理画面での商品選択に必要な表示項目

### 🎯 **必須表示項目（優先度：高）**

#### 1. **基本識別情報**
```typescript
interface ProductDisplayInfo {
  id: number;                    // 商品ID
  display_name: string;          // 表示用商品名
  product_code?: string;         // 商品コード
  price: number;                 // 価格
}
```

#### 2. **商品名の表示ロジック**
```typescript
// バリエーション商品の場合
display_name = base_product_name + " (" + variation_name + ")"
// 例: "種粕 20kg (通常価格 1)"

// 単一商品の場合
display_name = name
// 例: "ナチュラル 20kg"
```

### 📊 **推奨表示項目（優先度：中）**

#### 3. **商品分類・ステータス**
```typescript
interface ProductStatus {
  category_id: number;           // カテゴリID
  visible: boolean;              // 表示/非表示
  receipt_print: boolean;        // レシート印字
  variation_type?: string;       // バリエーション種別
}
```

#### 4. **価格・税金情報**
```typescript
interface ProductPricing {
  price: number;                 // 販売価格
  cost_price?: number;           // 原価
  tax_rate: number;              // 税率
  tax_type: string;              // 税種別
}
```

### 🔍 **検索・フィルタリング項目**

#### 5. **検索対象フィールド**
```typescript
interface SearchableFields {
  name: string;                  // 商品名
  base_product_name?: string;    // 基本商品名
  product_code?: string;         // 商品コード
  variation_name?: string;       // バリエーション名
}
```

## 管理画面UI設計提案

### 商品選択ドロップダウンの表示形式

```
┌─────────────────────────────────────────────────────────┐
│ 🔍 商品名・商品コードで検索...                           │
├─────────────────────────────────────────────────────────┤
│ 種粕 20kg (通常価格 1)                    ¥1,800        │
│ 商品コード: #2000000000619                              │
│ ─────────────────────────────────────────────────────── │
│ 種粕 20kg (売出価格 2)                    ¥1,700        │
│ 商品コード: #2000000000077                              │
│ ─────────────────────────────────────────────────────── │
│ ナチュラル 20kg                           ¥4,180        │
│ 商品コード: #2000000000046                              │
│ ─────────────────────────────────────────────────────── │
│ 【サービス品】たわらファームの培養土        ¥0          │
│ 商品コード: なし                                        │
└─────────────────────────────────────────────────────────┘
```

### 選択済み商品の表示形式

```
┌─────────────────────────────────────────────────────────┐
│ ✅ 種粕 20kg (通常価格 1)                 ¥1,800  [削除] │
│    商品コード: #2000000000619                           │
│ ✅ ナチュラル 20kg                        ¥4,180  [削除] │
│    商品コード: #2000000000046                           │
└─────────────────────────────────────────────────────────┘
```

## 実装仕様

### 1. **商品取得API仕様**

```typescript
// GET /api/admin/products/all
interface ProductListResponse {
  success: boolean;
  data: EnhancedProduct[];
  total: number;
}

interface EnhancedProduct {
  id: number;
  name: string;
  display_name: string;          // 計算済み表示名
  price: number;
  product_code?: string;
  base_product_name?: string;
  variation_name?: string;
  variation_type?: string;
  category_id: number;
  visible: boolean;
  receipt_print: boolean;
  
  // 検索・表示用の追加フィールド
  search_text: string;           // 検索用統合テキスト
  price_display: string;         // 価格表示用文字列
  status_badges: string[];       // ステータスバッジ配列
}
```

### 2. **検索ロジック**

```typescript
// 検索対象フィールドの統合
search_text = [
  name,
  base_product_name,
  variation_name,
  product_code
].filter(Boolean).join(' ').toLowerCase();

// 検索実行
const filteredProducts = products.filter(product => 
  product.search_text.includes(searchQuery.toLowerCase())
);
```

### 3. **表示名生成ロジック**

```typescript
function generateDisplayName(product: Product): string {
  if (product.base_product_name && product.variation_name) {
    return `${product.base_product_name} (${product.variation_name})`;
  }
  return product.name;
}
```

### 4. **ステータスバッジ生成**

```typescript
function generateStatusBadges(product: Product): string[] {
  const badges: string[] = [];
  
  if (!product.visible) badges.push('非表示');
  if (!product.receipt_print) badges.push('レシート印字なし');
  if (product.price === 0) badges.push('サービス品');
  if (product.variation_type === 'price') badges.push('価格バリエーション');
  
  return badges;
}
```

## データベース最適化提案

### インデックス追加推奨

```sql
-- 検索パフォーマンス向上用インデックス
CREATE INDEX IF NOT EXISTS idx_products_search 
ON products USING gin(to_tsvector('japanese', name || ' ' || COALESCE(base_product_name, '') || ' ' || COALESCE(product_code, '')));

-- 商品コード検索用
CREATE INDEX IF NOT EXISTS idx_products_product_code ON products(product_code) WHERE product_code IS NOT NULL;

-- バリエーション商品検索用
CREATE INDEX IF NOT EXISTS idx_products_base_name ON products(base_product_name) WHERE base_product_name IS NOT NULL;
```

## 実装優先度

### Phase 1: 基本機能（緊急）
- ✅ 商品取得API実装
- ✅ 表示名生成ロジック
- ✅ 基本的な検索機能

### Phase 2: UI改善（高優先度）
- 商品コード表示
- ステータスバッジ表示
- 価格表示の改善

### Phase 3: 最適化（中優先度）
- 検索パフォーマンス向上
- データベースインデックス追加
- キャッシュ機能

## 注意事項

### データ品質の課題
1. **商品コードの欠損**: 一部商品で `product_code` が null
2. **バーコードの欠損**: 一部商品で `barcode` が null
3. **非表示商品**: `visible: false` の商品が存在
4. **レシート印字設定**: `receipt_print: false` の商品が存在

### 対応方針
- 商品コードがない場合は「商品コード: なし」と表示
- 非表示商品も管理画面では選択可能にする
- ステータスを視覚的に分かりやすく表示

## 完了基準

1. ✅ 全商品（非表示含む）が検索・選択可能
2. ✅ 商品名・商品コードでの検索が動作
3. ✅ バリエーション商品が適切に表示される
4. ✅ 価格・ステータス情報が明確に表示される
5. ✅ 検索パフォーマンスが許容範囲内

この資料に基づいて、管理画面の商品選択機能を実装することで、使いやすく効率的なフォーム作成が可能になります。